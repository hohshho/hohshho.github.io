{"componentChunkName":"component---src-templates-post-tsx","path":"/SpringSecurity2_2/","result":{"data":{"site":{"siteMetadata":{"title":"Just Keep Going","description":"Ian's Archive","siteUrl":"https://hohshho.github.io"}},"allMarkdownRemark":{"edges":[{"node":{"id":"ab084a2e-033d-5217-91e8-97ea9cd69e93","html":"<h1 id=\"oauth-20-client\" style=\"position:relative;\"><a href=\"#oauth-20-client\" aria-label=\"oauth 20 client permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Client</h1>\n<blockquote>\n<p>OAuth 2.0 인가 프레임워크의 역할 중 인가 서버 및 리소스 서버와의 통신을 담당하는 클라이언트의 기능을 필터 기반으로 구현한 모듈</p>\n</blockquote>\n<h2 id=\"oauth-20-login-api\" style=\"position:relative;\"><a href=\"#oauth-20-login-api\" aria-label=\"oauth 20 login api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Login API</h2>\n<blockquote>\n<p>어플리케이션 사용자를 외부 OAuth2.0 Provider나 OpenID Connect 1.0 Provider 계정으로 로그인 할 수 있는 기능 제공</p>\n</blockquote>\n<ul>\n<li>권한 부여 유형 중 Authorization Code 방식을 사용</li>\n</ul>\n<h2 id=\"oauth-20-client-api\" style=\"position:relative;\"><a href=\"#oauth-20-client-api\" aria-label=\"oauth 20 client api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Client API</h2>\n<blockquote>\n<p>인가 서버의 권한 부여 유형에 따른 엔드 포인트와 직접 통신할 수 있는 API 제공</p>\n</blockquote>\n<ul>\n<li>권한 부여 종류\n<ul>\n<li>Client Credentials</li>\n<li>Resource Owner Password Credentials</li>\n<li>Refresh Token</li>\n</ul>\n</li>\n<li>리소스 서버와 연동해서 Token을 가지고 원하는 데이터를 가지고 오는 기능 구현 가능</li>\n</ul>\n<h2 id=\"oauth-20-client-fundamentals\" style=\"position:relative;\"><a href=\"#oauth-20-client-fundamentals\" aria-label=\"oauth 20 client fundamentals permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Client Fundamentals</h2>\n<h3 id=\"client-권한-설정-과정\" style=\"position:relative;\"><a href=\"#client-%EA%B6%8C%ED%95%9C-%EC%84%A4%EC%A0%95-%EA%B3%BC%EC%A0%95\" aria-label=\"client 권한 설정 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Client 권한 설정 과정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cbde6a9309f7bf21c52c3a027af50f95/5b5fb/clientRegistrationFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.901840490797547%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABBElEQVR42o2QW2uDQBCF8//71P+Uig/iJa0SjBVRUi+s66Ve4qKeziwpNPQlA7Psw5lzvpkDqOZ5Rtd1qKoKZVmibVv0fY9t2zAMA76uV+RZiqIogFXhKBe8JAvmcUBHum/SsJbrwA8PJUkC0zRhGAaiKNLm67piUUr3jUKHcQTUDW9ixmu6oJW11kkpHw2ZJk1TBEEA3/cRx7EmHacJTV2jpv9ENM+UNszzHJ7nwbIsOI4D27aRZZle8UIhF89F6H+guJ9DMTG1uve+74+GPBiGITzXxfvppEk5ZCJySSZ8X0GkTC2EQNM02vj31v8IeaAmYUjrfp7PqHhdvhfV3/RnVv4B9LjICv/DMK0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/cbde6a9309f7bf21c52c3a027af50f95/a81b5/clientRegistrationFlow.webp 163w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/da3ef/clientRegistrationFlow.webp 325w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/309d5/clientRegistrationFlow.webp 650w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/78344/clientRegistrationFlow.webp 975w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/bdb72/clientRegistrationFlow.webp 1300w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/61647/clientRegistrationFlow.webp 2128w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/cbde6a9309f7bf21c52c3a027af50f95/5e043/clientRegistrationFlow.png 163w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/e5cc6/clientRegistrationFlow.png 325w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/663f3/clientRegistrationFlow.png 650w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/d880f/clientRegistrationFlow.png 975w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/4c573/clientRegistrationFlow.png 1300w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/5b5fb/clientRegistrationFlow.png 2128w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/cbde6a9309f7bf21c52c3a027af50f95/663f3/clientRegistrationFlow.png\"\n            alt=\"clientRegistrationFlow\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol>\n<li>application.yml에 환경 설정 파일에 <strong>클라이언트, 인가서버 엔드포인트 설정</strong></li>\n<li>환경설정에 있는 정보가 <strong>OAuth2ClientProperties</strong>의 각 속성에 바인딩</li>\n<li><strong>ClientRegistration</strong>클래스에 인가서버로 권한부여 요청을 하기 위한 OAuth2ClientProperties가 저장된다.</li>\n<li>OAuth2Client는 ClientRegistration을 참조해 권한 요청을 위한 매개변수를 구성하고 인가 서버와 통신한다.</li>\n</ol>\n<h3 id=\"client-registration-초기화-과정\" style=\"position:relative;\"><a href=\"#client-registration-%EC%B4%88%EA%B8%B0%ED%99%94-%EA%B3%BC%EC%A0%95\" aria-label=\"client registration 초기화 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Client Registration 초기화 과정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e2f5840818896506175f626938ab6203/5e566/clientRegistraionConfigFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.44171779141104%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACB0lEQVR42o1STWsTURSd/6ErqdAglKamNtCKLgQXYqWRVFppCk0E41YQiuA/KLh1ISou27+STxKISUigycxkkvnKZJLM5Ov47o2JEAr64HDv3HnvvHPPfZLa0lD6Vcb1dQOKrEBRVKhqS0CFaVnodrsMx+kJOJz3+y58378Rki0OZbNZZDIZpFIppNNpRj6fR6fTWZL0enNC27YxGAwwm80Y0+lsmRMkSxBWKhUUCgXkcjkmLxaLqNVqQkkftBab/2dJrVYLuq6j0WiwMiKVZRlUt/60rCgK56Su54j2DR2ubcER/6gLwzBgmibG4zEkKpCaarXKykqlEhNQnXxsNpv8TRfIwlutbUBVNIZuWBgOh/A8D5PJZN4ytUWHyuUyH6KbyKPFBvKt3Z57aToD6I6PtuGiY7rQ7QHXF9Zwy2T2gpAUUYsk3Rt68D2fbx+NRiIXUUzxX15KREBDoalqmobLyyucxE6RSCYRf/dWIInTxBucnMURiycQO0vg/OMn0cEUsxsGJpFkIqRh0HAuLj7j1todBEKbWA9uILAt4tYGI3B/E7fvruHRk6dLklXFrJCeTFq8Q5r09x8/sf/sBV5Gonh+EMVB9AiRw+NljLx6jf3IId5/OGcrVkkl13VRr9dZYVc8iy9fv2EnFMZe+CFChJ2/Mbi9i60Hu1i/F0R47zH7u0r4GyrZ9ki0BT3tAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e2f5840818896506175f626938ab6203/a81b5/clientRegistraionConfigFlow.webp 163w,\n/static/e2f5840818896506175f626938ab6203/da3ef/clientRegistraionConfigFlow.webp 325w,\n/static/e2f5840818896506175f626938ab6203/309d5/clientRegistraionConfigFlow.webp 650w,\n/static/e2f5840818896506175f626938ab6203/78344/clientRegistraionConfigFlow.webp 975w,\n/static/e2f5840818896506175f626938ab6203/bdb72/clientRegistraionConfigFlow.webp 1300w,\n/static/e2f5840818896506175f626938ab6203/3c634/clientRegistraionConfigFlow.webp 2614w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e2f5840818896506175f626938ab6203/5e043/clientRegistraionConfigFlow.png 163w,\n/static/e2f5840818896506175f626938ab6203/e5cc6/clientRegistraionConfigFlow.png 325w,\n/static/e2f5840818896506175f626938ab6203/663f3/clientRegistraionConfigFlow.png 650w,\n/static/e2f5840818896506175f626938ab6203/d880f/clientRegistraionConfigFlow.png 975w,\n/static/e2f5840818896506175f626938ab6203/4c573/clientRegistraionConfigFlow.png 1300w,\n/static/e2f5840818896506175f626938ab6203/5e566/clientRegistraionConfigFlow.png 2614w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e2f5840818896506175f626938ab6203/663f3/clientRegistraionConfigFlow.png\"\n            alt=\"clientRegistraionConfigFlow\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol>\n<li>\n<p><strong>OAuth2ClientRegistrationRepositoryConfiguration</strong>에서<br>\n<strong>OAuth2ClientPropertiesRegistrationAdapter의 getClientRegistration함수</strong>를 실행</p>\n<ul>\n<li>(ClientRegistrationRepository 빈이 존재하지 않을 경우 실행)</li>\n</ul>\n</li>\n<li>\n<p>getClientRegistration 함수 내에서 ClientRegistrations객체의<br>\nfromIssuerLocation가 실행되는데 application.yml에 issuer-uri의 OIDC, AUTH 경로에 요청해 필요한 메타데이터 값을 가져온다</p>\n</li>\n</ol>\n<p>요약</p>\n<ul>\n<li>Client Registration은 인가 서버에 요청해 메타 데이터값을 가져오는데 yml 설정으로 값을 수동으로 지정해 줄 수 있다.</li>\n<li>ClientRepository를 @Bean으로 등록해 yml 설정 없이 코드로 설정 가능</li>\n</ul>\n<h4 id=\"clientregistration-상세-값\" style=\"position:relative;\"><a href=\"#clientregistration-%EC%83%81%EC%84%B8-%EA%B0%92\" aria-label=\"clientregistration 상세 값 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ClientRegistration 상세 값</h4>\n<table>\n<thead>\n<tr>\n<th>title</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>registrationId</td>\n<td>ClientRegistration을 식별할 수 있는 유니크한 ID.</td>\n</tr>\n<tr>\n<td>clientId</td>\n<td>클라이언트 식별자.</td>\n</tr>\n<tr>\n<td>clientSecret</td>\n<td>클라이언트 secret.</td>\n</tr>\n<tr>\n<td>clientAuthenticationMethod</td>\n<td>provider에서 클라이언트를 인증 시 사용 메소드 <br> basic, post, none (public 클라이언트).</td>\n</tr>\n<tr>\n<td>authorizationGrantType</td>\n<td>네 가지 권한 부여 타입 정의 <br>(authorization_code, implicit, client_credentials, password)</td>\n</tr>\n<tr>\n<td>redirectUriTemplate</td>\n<td>클라이언트에 등록한 리다이렉트 URL<br> 사용자의 인증으로 클라이언트에 접근 권한을 부여하고 나면, 인가 서버가 이 URL로 최종 사용자의 브라우저를 리다이렉트</td>\n</tr>\n<tr>\n<td>Scopes</td>\n<td>인가 요청 플로우에서 클라이언트가 요청한 openid, 이메일, 프로필 등의 scope.</td>\n</tr>\n<tr>\n<td>clientName</td>\n<td>클라이언트를 나타내는 이름</td>\n</tr>\n<tr>\n<td>authorizationUri</td>\n<td>인가 서버의 인가 엔드포인트 URI.</td>\n</tr>\n<tr>\n<td>tokenUri</td>\n<td>인가 서버의 토큰 엔드포인트 URI.</td>\n</tr>\n<tr>\n<td>jwkSetUri</td>\n<td>인가 서버에서 JSON 웹 키 (JWK) 셋을 가져올 때 사용할 URI. 이 키 셋엔 ID 토큰의 JSON Web Signature (JWS) 를 검증할 때 사용할 암호키가 있으며, UserInfo 응답을 검증할 때도 사용할 수 있다.</td>\n</tr>\n<tr>\n<td>configurationMetadata</td>\n<td>OpenID Provider 설정 정보로서 application.properties 에 spring.security.oauth2.client.provider.[providerId].issuerUri를 설정했을 때만 사용할 수 있다.</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"client-repository\" style=\"position:relative;\"><a href=\"#client-repository\" aria-label=\"client repository permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Client Repository</h3>\n<blockquote>\n<p>OAuth2.0 &#x26; OpenID Connect1.0의 ClientRegistration 저장소 역할</p>\n</blockquote>\n<ul>\n<li>인가 서버에 일차적으로 저장된 클라이언트 등록 정보의 일부를 검색하는 기능 제공</li>\n<li>자동 설정을 사용하면 ClientRegistrationRepository도 ApplicationContext내 @Bean으로 등록하므로 필요하면 원하는 곳에 의존성 주입이 가능<br>\n-> 등록된 클라이언트 정보를 가져올 수 있다.</li>\n</ul>\n<h3 id=\"자동-설정에-의한-초기화-과정\" style=\"position:relative;\"><a href=\"#%EC%9E%90%EB%8F%99-%EC%84%A4%EC%A0%95%EC%97%90-%EC%9D%98%ED%95%9C-%EC%B4%88%EA%B8%B0%ED%99%94-%EA%B3%BC%EC%A0%95\" aria-label=\"자동 설정에 의한 초기화 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>자동 설정에 의한 초기화 과정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4311375beda5f3951a43df59bf897719/ff716/AutoconfigInitialize.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.05521472392638%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACLElEQVR42mWSW28SURSF+S/GxEdtsC3tcC0wQEeLxPhCA/psjK+Nz14qbWmrrc82thZ8sP9ATYz+Bi33GQj3+21AYHn2IUwlnmTNydmZfFlr762rVGvIyApkJYtfvy9xyZRKJKFkZDQaDYxGY6jqAGpfRZ9JVafq9/vo9Xqa6D0YDKAbjUao1WpotVrI5XJIJBLIFwooVyqosjrBhsMhJgAmk8mc/j2zmm48HqNeb3A3FQbJZDJc2WwWxWKRwf7g54/vCG+/xOFeGKHQDrZfh7Czu4ej43d4e3SMXVb/8vUbB2sOy+UykskkV6lU4o7b7Tb/6ezsFEb9LYhmKwTBhBUmg2DE4vIK17XrN/D8xaspkBxWq1UOKbCo+Xyew6nW6XSmwPMozKZVeCUJbpcHotsDh+iGze6E3enC7SUDwvsHV0CKSiBZlpFOp3lcgmoOzyMwCwbc9axDdLo1mNm6BuuaAwv6RRZ7fwqkRqZSKT6MeDzOb3oTmGLT+XD6ERZhGV6PB07RNQe02Oz/AykuOVQURRMNhlpA5+TkPexmEyRRgp2BbA4nB5I7um8u6PmQOJA+1Cua6CwywchlLB5Dt9tF9FMUkssJ3z0fJOkO3OvzWjIIODh8Mw+cuYzFYloLaC/7bIkvLj7D/+A+gsFH8AeC2Aw8hH8zgA2vD1tbz3ivabk1IK0OFZvNJh8QrRFNuV6v858ikQhsVgs80gbTlbNVoxmPnzzVFpuAfwFqNbK86V1PKgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4311375beda5f3951a43df59bf897719/a81b5/AutoconfigInitialize.webp 163w,\n/static/4311375beda5f3951a43df59bf897719/da3ef/AutoconfigInitialize.webp 325w,\n/static/4311375beda5f3951a43df59bf897719/309d5/AutoconfigInitialize.webp 650w,\n/static/4311375beda5f3951a43df59bf897719/78344/AutoconfigInitialize.webp 975w,\n/static/4311375beda5f3951a43df59bf897719/bdb72/AutoconfigInitialize.webp 1300w,\n/static/4311375beda5f3951a43df59bf897719/5dad4/AutoconfigInitialize.webp 2578w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4311375beda5f3951a43df59bf897719/5e043/AutoconfigInitialize.png 163w,\n/static/4311375beda5f3951a43df59bf897719/e5cc6/AutoconfigInitialize.png 325w,\n/static/4311375beda5f3951a43df59bf897719/663f3/AutoconfigInitialize.png 650w,\n/static/4311375beda5f3951a43df59bf897719/d880f/AutoconfigInitialize.png 975w,\n/static/4311375beda5f3951a43df59bf897719/4c573/AutoconfigInitialize.png 1300w,\n/static/4311375beda5f3951a43df59bf897719/ff716/AutoconfigInitialize.png 2578w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4311375beda5f3951a43df59bf897719/663f3/AutoconfigInitialize.png\"\n            alt=\"AutoconfigInitialize\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol>\n<li>\n<p>OAuth2ImportSelector에서 설정 클래스에 따라 class load</p>\n</li>\n<li>\n<p>위 이미지 와 같이 로드되고 <strong>OAuth2ClientWebMvcSecurityConfiguration</strong>에서 2개의 클래스 로드</p>\n</li>\n<li>\n<p>DefaultOAuth2AuthorizedClientManager는 실제 권한 부여 요청에 따라 작업을 담당하는 클래스</p>\n</li>\n<li>\n<p>HandlerMethodArgumentResolver 는 웹 mvc관련 클래스</p>\n</li>\n</ol>\n<p>DefaultOAuth2AuthorizedClientManager가 실제 권한 부여 작업 담당 클래스로 중요!</p>\n<p>Bean 등록 과정</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/7f319/OAuth2ClientAutoConfiguration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.21472392638037%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB5ElEQVR42m1SSW7bQBDkR3wJjMSRY2R9gQ04pqybXqHXJfDRCKhc4g9I0C5qMUlxE8VFe0SVp8YeQTHSQHN6enqK1dWj+UEI1wswjWYIwgiB58OzJ/AdF65lI4kTbLdbbDZbpGkGZzKB5/uYz+cyv16vxdnm4Np+D+zFh5vFYoFOp4Nur4dut4te/3llzrZteJ6HRqOBVquFdrt9OPP9QID/RZ7voUHYbrfDarWSwEmSSI/jWK5RFEkw13VlTJ8IlirHGt4lIZpGEAX4P8vzXIITiB2w1hctW5YFx3HkvSzL5Dkl0Pr9vqRP6qo1/uS1sZjAQRBgMBhgNBrJmMwU6+VyCS1NU0l7Op2CMVkcA6o4DEPU63WpG0nQe0JrDue4TlNtcVrq4NjZIllQL3ZAZsPhUDpzvMcaOus1BUK6asq1Wg3NZlNOkzFb5CTH47HUjiuBbaGh9fgIW+QUIe31AOZCYIqciVYoAXXj3hyYuP91j2q1Ktx49t/Gy76KPw8PqAlJDoCKcv7SKoUmE9M0Ec1muPv5A4W3p/j26Qu+Xpzj83kBHwsFfDh7j4uzd3hzcgL95uZfQNpSsIkFQCiehi8eMh8zhTcMA/r3a5TLZZRKJRT1IopF4bqO0u0tri4vUalU8ARc+RoIUkjfRwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/a81b5/OAuth2ClientAutoConfiguration.webp 163w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/da3ef/OAuth2ClientAutoConfiguration.webp 325w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/309d5/OAuth2ClientAutoConfiguration.webp 650w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/78344/OAuth2ClientAutoConfiguration.webp 975w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/bdb72/OAuth2ClientAutoConfiguration.webp 1300w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/507e6/OAuth2ClientAutoConfiguration.webp 2498w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/5e043/OAuth2ClientAutoConfiguration.png 163w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/e5cc6/OAuth2ClientAutoConfiguration.png 325w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/663f3/OAuth2ClientAutoConfiguration.png 650w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/d880f/OAuth2ClientAutoConfiguration.png 975w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/4c573/OAuth2ClientAutoConfiguration.png 1300w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/7f319/OAuth2ClientAutoConfiguration.png 2498w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/663f3/OAuth2ClientAutoConfiguration.png\"\n            alt=\"OAuth2ClientAutoConfiguration\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>OAuth2ClientRegistrationRepositoryConfiguration은 위에서 살펴본 부분이고</p>\n<p>OAuth2WebSecurityConfiguration을 살펴보면 InMemoryOAuth2AuthorizedClientService에서 OAuth2AuthorizedClient를 관리 한다</p>\n<p><strong>OAuth2AuthorizedClient</strong>는 인가서버로 부터 권한 부여가 되면 승인된 정보들이 저장되는데 <strong>Client정보, accessToken, refreshToken, 사용자 정보 같은 것들이 저장되고 이 객체를 Spring MVC에서 참조해 사용</strong></p>\n<h2 id=\"oauth-20-client---oauth2login\" style=\"position:relative;\"><a href=\"#oauth-20-client---oauth2login\" aria-label=\"oauth 20 client   oauth2login permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Client - oauth2Login()</h2>\n<blockquote>\n<p>OAuth2.0 Client Module을 통해서 클라이언트가 인가 서버로 부터 권한 부여 받고, 사용자 인증 처리, 권한 체크까지 인증 처리</p>\n</blockquote>\n<p>oauth2.0 config 설정을 통해 http.oauth2Login()이 실행이 되면</p>\n<p>Form방식과 동일하게 OAuth2LoginConfigurer클래스가 init, configure 함수를 초기화 한다.</p>\n<p>init함수부터 먼저 살펴보면</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b2be3b00365ba169ba5ecade1eaaddbe/912ae/OAuth2.0LoginApiInit.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.282208588957054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACrUlEQVR42nVT7U9ScRjlf2mtrZnNlTlUxAsarZTUEC4qiiiuNwE181tbLVfrY/W50lbi1tz6E6qpUMtappQgb1e40AyQNzcFTs/vIrG19WyH89y73bNznudBFotEERV2sBMWEAiGEBVjSKfTSCSSyGSyyGaz+Lr2GR9XXXC53Fg9wsrKKpaXVyR+9/4DfNvbKBSLkB0cHCCRTGJ3dxdenw+f3G64XS5sbG4iHo9jy+vFEK+DVq3GpXYNuLZ2qNrOg1MzUE+oqa3D4ydPwUqWz+eRzmQQF0US/Q2RHIo7EfyKxSWHIrGZ70GXug0XSKylVUXgoFByaFIoJT5ZU1sV3N/fR6lUwuHhIYrFktQzFMk+q9TeHmYmbsJqGsSIeRiDg2b0UW/sN0kYoGft5W7Mzc1XHaZSKUQiEfgospciVpi9CwaDsF0bg7lXj1FjP0wGI3oNPPTEBp5g7EOntgtTt26jUKAZihR1j1xkKHaSZllBIpFAPpdDJBqDrkeLDq4FGk6NVk4lxZQ3KSBvVkix686eg2nITIIFyDwej/QxKxa1UpU+Se7t18dg4XkMkEPmiLnT6Q0EHj06PS52aDE5NV0WzJELFjlEaw/7CcRBihz2+6VeCIcxe/cOpsdtmHFMYNLugM3mwLi9DLtjEpYRK+ZfvirPkP2wuwvRrEKBAAIk5CfBILEQCuLHzy0MGK6gU6WChp3L0aabW1olKGkMp07X4cHDR1XBPG2azTESjSJMjgRBQIiYORdoMfruDmgaG8E1K8uzIzTIm3CmvgH1DXIcO34C9+7PVgVzuSw8Gxvw0DGvr69jbe2LdNjf6d03en679AZLTicWnYtYWHBigTHh9VH/7PkL6V/0V9Dr3cLEdSscY1dhtY5iyGLBsGUUJrqxGzQ75vTfpf2v/gDSU9HlV5U18AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b2be3b00365ba169ba5ecade1eaaddbe/a81b5/OAuth2.0LoginApiInit.webp 163w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/da3ef/OAuth2.0LoginApiInit.webp 325w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/309d5/OAuth2.0LoginApiInit.webp 650w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/78344/OAuth2.0LoginApiInit.webp 975w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/bdb72/OAuth2.0LoginApiInit.webp 1300w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/84941/OAuth2.0LoginApiInit.webp 2472w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b2be3b00365ba169ba5ecade1eaaddbe/5e043/OAuth2.0LoginApiInit.png 163w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/e5cc6/OAuth2.0LoginApiInit.png 325w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/663f3/OAuth2.0LoginApiInit.png 650w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/d880f/OAuth2.0LoginApiInit.png 975w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/4c573/OAuth2.0LoginApiInit.png 1300w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/912ae/OAuth2.0LoginApiInit.png 2472w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b2be3b00365ba169ba5ecade1eaaddbe/663f3/OAuth2.0LoginApiInit.png\"\n            alt=\"OAuth2 0LoginApiInit\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol>\n<li>\n<p>OAuth2LoginAuthenticationFilter 인증 필터가 생성되는데 설정한 경로로 요청이 오면 Authorization Code Grant Type 방식에서 code를 가지고 AccessToken을 발급하는 단계를 담당한다.<br>\n(default : /login/oauth2/code/*)</p>\n</li>\n<li>\n<p>OAuth2LoginAuthenticationProvider 는 실제로 OAuth2.0 인가서버와 통신하는 기능을 담당한다.</p>\n</li>\n<li>\n<p>OidcAuthorizationCodeAuthenticationProvider 는 OpenID 프로토콜을 통해 사용자 정보를 가져온다.</p>\n</li>\n<li>\n<p>DefaultLoginPageGeneratingFilter는 실제 로그인 페이지가 필요한데 해당 페이지를 생성해 주는 기능 담당</p>\n</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/51c36e5f5079e8d277daef951fcc1af3/b5b51/LoginApiConfigure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.987730061349694%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACAklEQVR42oWS22oTURSG8zoiImqPOUzOk5lJYguWFIqiiMeXUMSmmQap4K2lD2IrThKLXuQFchEC2slkxprYxBxJ8rvWnhCotHTBx7/27DX/WnvPeByrgYZZh1234Pw6hXP6G4PhEMMZIh+N5uur8EwBzJlOBZPJBOPxGBxn7TYqlQqq1Sp6vZ6o4z2uuQgPLgk25uh2u6jVajBNU0xwVQjD/7uw2YiOySa246DRaMC2HViWRWrTpH1q1MNfot8fzN+bG14UXPCn1UKbjtxsNtES+Rk6nY7bdMLXw1c1PT/hoN/D9+MSvhWJ0lccl0owKC8SRqGIQrGIT4eH+GIYImc1CgWRsxpGAUdHn1Eul907PKEvvLkm424kinvxBJKRGGLhKIKkYSLEGo0jSM8CwTD8Ugi+QBBev4QVrx+rvgBu3lrAw0ePxTUJw411FZmkgoyWwqaWREbVIMsK4ooKmUgoGuIJVaxZuQk3YLgZmz55+nxmeFJHOq1ha03BhprCOpml1CQUMpFnxMg8EpOFsmGUTiIaEAmqlUIRPHvx0jX88dNELCohHfZBC4ShBCRECMnvHovhCZZWvOdYXF7F7YUl3FlcxrXrN7B1/4Fr2KSv92Evj3e6jr3dPN4zeh56TkdW38VOjiDNMbSXoz3WLO2/3d7BdjaHV6/f4OP+gfjh/wF1F5/CdKdmpwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/51c36e5f5079e8d277daef951fcc1af3/a81b5/LoginApiConfigure.webp 163w,\n/static/51c36e5f5079e8d277daef951fcc1af3/da3ef/LoginApiConfigure.webp 325w,\n/static/51c36e5f5079e8d277daef951fcc1af3/309d5/LoginApiConfigure.webp 650w,\n/static/51c36e5f5079e8d277daef951fcc1af3/78344/LoginApiConfigure.webp 975w,\n/static/51c36e5f5079e8d277daef951fcc1af3/bdb72/LoginApiConfigure.webp 1300w,\n/static/51c36e5f5079e8d277daef951fcc1af3/4836c/LoginApiConfigure.webp 2608w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/51c36e5f5079e8d277daef951fcc1af3/5e043/LoginApiConfigure.png 163w,\n/static/51c36e5f5079e8d277daef951fcc1af3/e5cc6/LoginApiConfigure.png 325w,\n/static/51c36e5f5079e8d277daef951fcc1af3/663f3/LoginApiConfigure.png 650w,\n/static/51c36e5f5079e8d277daef951fcc1af3/d880f/LoginApiConfigure.png 975w,\n/static/51c36e5f5079e8d277daef951fcc1af3/4c573/LoginApiConfigure.png 1300w,\n/static/51c36e5f5079e8d277daef951fcc1af3/b5b51/LoginApiConfigure.png 2608w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/51c36e5f5079e8d277daef951fcc1af3/663f3/LoginApiConfigure.png\"\n            alt=\"LoginApiConfigure\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>configure함수를 살펴보면 OAuth2AuthorizationRequestRedirectFilter가 생성되는데 해당 필터는 Authorization Code Grant Type 방식에서 code를 발급해주는 기능 담당</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/316c06e55e75e4427c13d5d37c83353c/78929/LoginApiConfigurerConfig.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.987730061349694%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAClElEQVR42n2Ty28SURTG+U9M9A8w2NYCBQbKY2Z4tbQu+tCY+GihqIuurGnig0Jb3akbG2PduLJpUauxTWpctUEsrhRiEKLCMLxNymOghc87Fxe6cZIv59473/ndc2/OVYgZAWK6q1yugFy+iHq9AUlqotVs4vtPAV/iCcS/pmgslX/h8PAQjUaTev5Wk/gVHfzv62D73S5WVtfw9NkLPHryHInkD/qn3f43U563220o5Im8Y6lYRKlUoiqScTabpRKELEQxh0qlgnQ6Q9dEUUShUEC5XKb+SqVMTlWnYApstVrEnEZGEGiUk1KpFEnKk7GAeDxOoQWykQzL5/PUI0OTySQSiQRdo8BU8huWA3dwb2kZdxeXEAguwr8QgD8QxM1bt3H/wUPUGxJWH69g0e9HkHgWiCdI/Nfn5hGNfqKgo6OjLvBDeA+G/h5YNTroVGr09XfVrx7ASWUPXMMjODio4vy5CZxSKqHSaNF7WkU8Khw7fgJr6+sUJEkSOp0OFPv7EbhZE9w2J1iWg5llMWixwmiyQD2gw9jEJKrVGma8HnCcAcMjNjhcLFxuHoxRjbehLlC+Y7lKCnRaDDjD22FjeZisLIxmK0wWFlodg7HxP0DPNKxWhlTMwTnEUbBG24c3oQ0KrNVq3SNHox/h5s0YcwzBbXfCwZMKCJwlUcsYMT55lgKv+LwwmwbB2+3gbHKVLnJ8DV6/2qQguXdp20QiYfCMBvygBYzeAIZUpdfpSXV6KHv7MDw6ioNqFZ6pSwSoJyAeDicHu4Ml96jE5kaIAkukheRuUcRinzHrm8bs1WvwzPgw5fXhsseLaRIvXJzC3I15NIkxFotha2sbG6GXCBHt7LzH7l4YedI69Al0uo3+GxI/kqH+ylvZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/316c06e55e75e4427c13d5d37c83353c/a81b5/LoginApiConfigurerConfig.webp 163w,\n/static/316c06e55e75e4427c13d5d37c83353c/da3ef/LoginApiConfigurerConfig.webp 325w,\n/static/316c06e55e75e4427c13d5d37c83353c/309d5/LoginApiConfigurerConfig.webp 650w,\n/static/316c06e55e75e4427c13d5d37c83353c/78344/LoginApiConfigurerConfig.webp 975w,\n/static/316c06e55e75e4427c13d5d37c83353c/bdb72/LoginApiConfigurerConfig.webp 1300w,\n/static/316c06e55e75e4427c13d5d37c83353c/8beca/LoginApiConfigurerConfig.webp 2546w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/316c06e55e75e4427c13d5d37c83353c/5e043/LoginApiConfigurerConfig.png 163w,\n/static/316c06e55e75e4427c13d5d37c83353c/e5cc6/LoginApiConfigurerConfig.png 325w,\n/static/316c06e55e75e4427c13d5d37c83353c/663f3/LoginApiConfigurerConfig.png 650w,\n/static/316c06e55e75e4427c13d5d37c83353c/d880f/LoginApiConfigurerConfig.png 975w,\n/static/316c06e55e75e4427c13d5d37c83353c/4c573/LoginApiConfigurerConfig.png 1300w,\n/static/316c06e55e75e4427c13d5d37c83353c/78929/LoginApiConfigurerConfig.png 2546w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/316c06e55e75e4427c13d5d37c83353c/663f3/LoginApiConfigurerConfig.png\"\n            alt=\"LoginApiConfigurerConfig\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>마지막으로 Configurer가 가지고 있는 속성파일을 보면 4개의 Config를 가지고 있다</p>\n<ol>\n<li>\n<p>AuthorizationEndpointConfig : code 발급 요청 시 설정 파일</p>\n</li>\n<li>\n<p>RedirectionEndpointConfig : 인가서버에서 클라이언트에게 코드를 발급하기 위해 redirect하는데 이 정보를 관리</p>\n</li>\n<li>\n<p>TokenEndpointConfig : AccessToken을 요청할 때 인가 서버에 요청하는데 이 때 사용되는 속성</p>\n</li>\n<li>\n<p>UserInfoEndpointConfig : AccessToken을 가지고 인가서버에서 User정보를 가지고 올 때 관련된 url나 설정 된 정보를 가지고 있는 config</p>\n</li>\n</ol>\n<h3 id=\"authorization-code---주요-클래스\" style=\"position:relative;\"><a href=\"#authorization-code---%EC%A3%BC%EC%9A%94-%ED%81%B4%EB%9E%98%EC%8A%A4\" aria-label=\"authorization code   주요 클래스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authorization Code - 주요 클래스</h3>\n<h4 id=\"1-oauth2authorizationrequestredirectfilter\" style=\"position:relative;\"><a href=\"#1-oauth2authorizationrequestredirectfilter\" aria-label=\"1 oauth2authorizationrequestredirectfilter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1) OAuth2AuthorizationRequestRedirectFilter</h4>\n<p>-> 권한 코드 부여 흐름 시작<br>\n-> 해당 필터의 동작 조건 : AuthorizationRequestMatcher : /oauth2/authorization/{registrationId}*<br>\n-> AuthorizationEndpointConfig. authorizationRequestBaseUri 를 통해 재정의 가능</p>\n<h4 id=\"2-defaultoauth2authorizationrequestresolver\" style=\"position:relative;\"><a href=\"#2-defaultoauth2authorizationrequestresolver\" aria-label=\"2 defaultoauth2authorizationrequestresolver permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2) DefaultOAuth2AuthorizationRequestResolver</h4>\n<ul>\n<li>웹 요청에 대하여 <strong>OAuth2AuthorizationRequest 객체</strong> 생성</li>\n<li>/oauth2/authorization/{registrationId} 와 일치하는지 확인해서 일치하면 registrationId를 추출하고 이를 사용해서 ClientRegistration을 가져와 OAuth2AuthorizationRequest 빌드</li>\n</ul>\n<h4 id=\"3-oauth2authorizationrequest\" style=\"position:relative;\"><a href=\"#3-oauth2authorizationrequest\" aria-label=\"3 oauth2authorizationrequest permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3) OAuth2AuthorizationRequest</h4>\n<ul>\n<li>토큰 엔드포인트 요청 파라미터를 담은 객체로서 인가 응답을 연계하고 검증할 때 사용<br>\n(임시 코드를 받기위한 서버의 엔드 포인트)</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/29ad66c67fa073d7914b84a4e9fe0e2b/248ff/OAuth2AuthorizationRequest.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.96932515337423%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3klEQVR42n2RUW7DIBBEfbHYBpbdxYFGTdpEVe9/jukCVpw0bj+eFiH7MQzDpURcl4RbyjhrAjGDVO7EOoUxBb/h+xxtHib3xHDKhK8i+NAjiigSKwJXiTbiyuRMMLsnDrN7FSYlXDMjRcFEoZ1aE4zrx+PsG79//IvhbQm4JIYQw0VqeO5ztgMaIexeb1dYTHg7Kjhy68pbh0HqWuzqETFZBRK7dC/p+EAVvueA76Ktw8+0IIt2obLJZKXvhcfH8dvjVOZ1b1isw/NC0CqxRGRJazJHRqjJqK23Tv/nB7a6+ch9vvxbAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/29ad66c67fa073d7914b84a4e9fe0e2b/a81b5/OAuth2AuthorizationRequest.webp 163w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/da3ef/OAuth2AuthorizationRequest.webp 325w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/309d5/OAuth2AuthorizationRequest.webp 650w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/78344/OAuth2AuthorizationRequest.webp 975w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/bdb72/OAuth2AuthorizationRequest.webp 1300w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/fe44d/OAuth2AuthorizationRequest.webp 2254w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/29ad66c67fa073d7914b84a4e9fe0e2b/5e043/OAuth2AuthorizationRequest.png 163w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/e5cc6/OAuth2AuthorizationRequest.png 325w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/663f3/OAuth2AuthorizationRequest.png 650w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/d880f/OAuth2AuthorizationRequest.png 975w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/4c573/OAuth2AuthorizationRequest.png 1300w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/248ff/OAuth2AuthorizationRequest.png 2254w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/29ad66c67fa073d7914b84a4e9fe0e2b/663f3/OAuth2AuthorizationRequest.png\"\n            alt=\"OAuth2AuthorizationRequest\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h4 id=\"4-oauth2authorizationrequestrepository\" style=\"position:relative;\"><a href=\"#4-oauth2authorizationrequestrepository\" aria-label=\"4 oauth2authorizationrequestrepository permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4) OAuth2AuthorizationRequestRepository</h4>\n<ul>\n<li>인가 요청을 시작한 시점부터 인가 요청을 받는 시점까지 (리다이렉트) OAuth2AuthorizationRequest 유지</li>\n</ul>\n<h3 id=\"authorization-code-grant-type---get-code\" style=\"position:relative;\"><a href=\"#authorization-code-grant-type---get-code\" aria-label=\"authorization code grant type   get code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authorization Code Grant Type - get code</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1e9b26d94d0f831a9d50a3887ee907ec/ea3e4/AuthorizationFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.828220858895705%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACOUlEQVR42m1TTW/TQBD1X0LqnVAVTvwfeiS0AnFDXPgvqMApEoUkh0LixvHXxh+xYzuxnazt2LEfs5tGFImRnta7fp5982asxFGClTZHNNfBGUO9WqEuS+z3NcpqT+sevKjAK9rT2Wa3R7jmCJMtAsIyyhBsOIK0RM4rKF3bAVUF1PTxeo0qTVGJhHWNojwmzIjI/IgQwvJWsNwQbBnDdMU+gkXvdCfAlpdQQJFmGfzlEvXhAN00Mbm7w3w6hUqrMdewCgMsFgzabAbf82CZBn7cfse3r18wGv6E6yzQoUXXtceEInzfw6ePH/D+7Tv0r/p4/aaPq+trvLq8xHA4QtcekOcZ+G4HyzIxGo3pfChh27bM0XUdlLZt5ca2Tby86KH37BxPL87RI5y/eI4nZ2f4fHMjOaKChhzKtjtSvIBJ1biuC875SReUbZ6DMRtJEuP+9y+YuiGJlmnB0nUs6PYgXMF2AzAvkH45wkvLwnSqwnEcRFEkkZF1iucvoVsMc9MmMDDHlWShQJBNm+Fe06HRFGh0mVhnBLZwpJAgCDAejzEYDKRaZVfskXIah0KgQUNdF12uqcstlVjWLdKqRU7vBS8tD1jzRp6TabLMMAyhquqxZDyK7oGw2WxgGIZUmFMZu22Ohi74HzeOY8yo+1OaCt/3/ybsHpGEFzl5exAKSW2cJORxIi8SEM+lmF0K4Z1OXp8a9I/CU4hyxUALFEUBj5Sqk4ksa0KrpmlI6Qdomkaqkk188P0PR6IoUuEA1PsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1e9b26d94d0f831a9d50a3887ee907ec/a81b5/AuthorizationFlow.webp 163w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/da3ef/AuthorizationFlow.webp 325w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/309d5/AuthorizationFlow.webp 650w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/78344/AuthorizationFlow.webp 975w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/bdb72/AuthorizationFlow.webp 1300w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/da511/AuthorizationFlow.webp 2514w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1e9b26d94d0f831a9d50a3887ee907ec/5e043/AuthorizationFlow.png 163w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/e5cc6/AuthorizationFlow.png 325w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/663f3/AuthorizationFlow.png 650w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/d880f/AuthorizationFlow.png 975w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/4c573/AuthorizationFlow.png 1300w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/ea3e4/AuthorizationFlow.png 2514w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1e9b26d94d0f831a9d50a3887ee907ec/663f3/AuthorizationFlow.png\"\n            alt=\"AuthorizationFlow\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol>\n<li>\n<p>oauth2/authorization/{registrationId}로 request 요청이 오면 <strong>OAuth2AuthorizationRequestRedirectFilter</strong>가 받고 DefaultOAuth2AuthorizationRequestResolver가 요청 정보와 가지고 있는 requestMatcher값을 비교</p>\n</li>\n<li>\n<p>값이 동일하면 /login/oauth2/code/{registrationId} 경로를 생성 하면서 OAuth2AutorizationRequest객체 생성</p>\n</li>\n<li>\n<p>OAuth2AutorizationRequest 객체를 세션에 저장<br>\n(세션을 사용하지 않을 경우 쿠키에 저장해서 참조하도록 repository 객체 재정의 가능)</p>\n</li>\n<li>\n<p>인가서버에서 검증 후 code와 state값을 담아 반환한다.</p>\n<ul>\n<li>1번에서 값이 동일하지 않을경우 AuthenticationEntryPoint에 설정된 Url로 이동 ()</li>\n</ul>\n</li>\n</ol>\n<p>요약하면 Authorization Code Grant Type 첫번째 code를 받는 기능을 담당하는 Filter가<br>\n<strong>OAuth2AuthorizationRequestRedirectFilter</strong></p>\n<h3 id=\"authorization-accesstoken-주요-클래스\" style=\"position:relative;\"><a href=\"#authorization-accesstoken-%EC%A3%BC%EC%9A%94-%ED%81%B4%EB%9E%98%EC%8A%A4\" aria-label=\"authorization accesstoken 주요 클래스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authorization AccessToken 주요 클래스</h3>\n<h4 id=\"1-oauth2loginauthenticationfilter\" style=\"position:relative;\"><a href=\"#1-oauth2loginauthenticationfilter\" aria-label=\"1 oauth2loginauthenticationfilter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1) OAuth2LoginAuthenticationFilter</h4>\n<ul>\n<li>인가서버로부터 리다이렉트 되면서 전달된 code 를 인가서버의 Access Token 으로 교환</li>\n<li>Access Token 이 저장된 OAuth2LoginAuthenticationToken을 AuthenticationManager에 위임하여 UserInfo 정보를 요청해서 최종 사용자에 로그인</li>\n<li>OAuth2AuthorizedClientRepository를 사용하여 OAuth2AuthorizedClient 를 저장한다.</li>\n<li>인증에 성공 시 OAuth2AuthenticationToken 이 생성, SecurityContext에 저장되며 인증 처리를 완료</li>\n<li>/login/oauth2/code/*로 url이 매핑된다</li>\n</ul>\n<h4 id=\"2-oauth2loginauthenticationprovider\" style=\"position:relative;\"><a href=\"#2-oauth2loginauthenticationprovider\" aria-label=\"2 oauth2loginauthenticationprovider permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2) OAuth2LoginAuthenticationProvider</h4>\n<ul>\n<li>Access Token 으로 교환하고 이 토큰을 사용하여 UserInfo 처리를 담당</li>\n<li>Scope 에 openid 유,무에 따라 OAuth처리 Provider, OpenId처리 Provider 호출</li>\n</ul>\n<h4 id=\"3-oauth2authorizationcodeauthenticationprovider\" style=\"position:relative;\"><a href=\"#3-oauth2authorizationcodeauthenticationprovider\" aria-label=\"3 oauth2authorizationcodeauthenticationprovider permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3) OAuth2AuthorizationCodeAuthenticationProvider</h4>\n<ul>\n<li>권한 코드 부여 흐름을 처리하는 AuthenticationProvider</li>\n<li>인가서버에 Authorization Code 와 AccessToken 의 교환을 담당하는 클래스</li>\n</ul>\n<h4 id=\"4-oidcauthorizationcodeauthenticationprovider\" style=\"position:relative;\"><a href=\"#4-oidcauthorizationcodeauthenticationprovider\" aria-label=\"4 oidcauthorizationcodeauthenticationprovider permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4) OidcAuthorizationCodeAuthenticationProvider</h4>\n<ul>\n<li>OpenID Connect Core 1.0 권한 코드 부여 흐름을 처리하는 AuthenticationProvider 이며 요청 Scope 에 openid 가 존재할 경우 실행</li>\n</ul>\n<h4 id=\"5-defaultauthorizationcodetokenresponseclient\" style=\"position:relative;\"><a href=\"#5-defaultauthorizationcodetokenresponseclient\" aria-label=\"5 defaultauthorizationcodetokenresponseclient permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5) DefaultAuthorizationCodeTokenResponseClient</h4>\n<ul>\n<li>인가서버의 token 엔드 포인트로 통신을 담당하며 AccessToken 을 받은 후 OAuth2AccessTokenResponse 에 저장하고 반환한다</li>\n</ul>\n<h3 id=\"authorization-code-grant-type---get-accesstoken\" style=\"position:relative;\"><a href=\"#authorization-code-grant-type---get-accesstoken\" aria-label=\"authorization code grant type   get accesstoken permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authorization Code Grant Type - get AccessToken</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c87dd2a73622aa1c29b0013bc9e3e2a1/fa34b/AccessTokenFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.21472392638037%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACeklEQVR42j2Sa08TQRSG919JTDQxmCB8MkF+Cv+BRL8RqfSThhhNiCAQxUuM1cCyrQp0t+323t3upd1L7+12l7J9PTOIk7x7zuSc2XnekxG6vT46YYRRPAdbpmHg4vISipJDNitDlhVMp1OqzBFfRZjHM57PZteI4xjz+ZyL5VdUFwajETrJJDrr6/ALKjaePcXCwh08XHqEu/fuY2l5GdK5gv2fMnYOf+D1sYhjSYXeNFGpVFAoFLgajQaCIIAwodv7u7vobWwgdj1sbb/A4uIDPF59gqWVFayurUFWKxDzBqmJ01wTadWAadmQJAnfUylkMhnU63XuRLhFvl1DInacNuxWC7Ztw3HdGztRiGA8xHQyuukbDjlVs9mEaZq8NwxDCP1+H206XMznYVGB7Vkjs5HL5VCr1en2BmRFQZpIMplfKBZLMGjWjKpcLnPruq7fEA4GA+6dxW63C89z4fse3LYNQ2+g4zkYUm08Hv/XiFwwuURvWRZaBMTOz2YzCFEUcWRWrNZqlBuw3A52U1nsfBTx6oOIombDpTFUKlVOxXqZ1Rr1MzE6tmfO+A+ZTU3TUFVVGFqdbnSQOpPxLa3gy+klSnUdwWTCqRgJi2yGTOxstVpFnkbGcoENMo6v+RuKwinP6YM4nOB6dkWKEIzIMjX3e10avoWmrsGn0bBYr1VRKqq4uDjnUELb68LtDNAbBugOJ+iNAkymIfzBGH6f3ijJo7ppO9AMGzqpVNOgmS1kcyqUQgm65aDt+Rgwwrdf/2Dz3QkS70U83zvBy0+/kZbLSOyfInEgYutfTByc8dqbz2nKJWwfSUgepZE8lLC5J0LMNfhz+gsnSQ9+Zgl66AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c87dd2a73622aa1c29b0013bc9e3e2a1/a81b5/AccessTokenFlow.webp 163w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/da3ef/AccessTokenFlow.webp 325w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/309d5/AccessTokenFlow.webp 650w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/78344/AccessTokenFlow.webp 975w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/bdb72/AccessTokenFlow.webp 1300w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/237f9/AccessTokenFlow.webp 2524w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c87dd2a73622aa1c29b0013bc9e3e2a1/5e043/AccessTokenFlow.png 163w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/e5cc6/AccessTokenFlow.png 325w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/663f3/AccessTokenFlow.png 650w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/d880f/AccessTokenFlow.png 975w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/4c573/AccessTokenFlow.png 1300w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/fa34b/AccessTokenFlow.png 2524w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c87dd2a73622aa1c29b0013bc9e3e2a1/663f3/AccessTokenFlow.png\"\n            alt=\"AccessTokenFlow\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol>\n<li>code를 받아오면 <strong>OAuth2LoginAuthenticationFilter</strong> 실행</li>\n<li>OAuth2AuthorizationRequest(세션에 저장 된), OAuth2AccessTokenResponse(인가 서버로 부터 받은)를 가진 OAuth2LoginTuthenticationToken을 저장</li>\n<li><strong>OAuth2LoginAuthenticationProvider</strong>에서 AccessToken을 가져옴(/token)</li>\n<li>가져온 OAuth2AuthorizationCodeAuthentication Token을 사용해 <strong>DefaultOAuth2UserService</strong>에서 인가서버로 부터 사용자 정보를 가져온다.</li>\n</ol>\n<p>추가로</p>\n<ul>\n<li>\n<p>Code 가지고 있는 객체는 RequestEntity<OAuth2AuthorizationRequest></p>\n</li>\n<li>\n<p>AccessToken가지고 있는 객체는 ResponseEntity<OAuth2AccessTokenResponse></p>\n</li>\n</ul>\n<h3 id=\"oauth2userservice\" style=\"position:relative;\"><a href=\"#oauth2userservice\" aria-label=\"oauth2userservice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2UserService</h3>\n<blockquote>\n<p>AccessToken을 사용해 리소스 소유자의 정보를 가져오며 OAuth2User타입의 객체를 리턴한다.</p>\n</blockquote>\n<ul>\n<li>구현체는 <strong>DefaultOAuth2UserService와 OidcUserService</strong>가 있다.</li>\n</ul>\n<h4 id=\"defaultoauth2userservice\" style=\"position:relative;\"><a href=\"#defaultoauth2userservice\" aria-label=\"defaultoauth2userservice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DefaultOAuth2UserService</h4>\n<blockquote>\n<p>표준 OAuth2.0 Provider를 지원하는 구현체</p>\n</blockquote>\n<ul>\n<li>OAuth2User 반환\n<ul>\n<li>OAuth2.0 Provider에 연결된 사용자 주체</li>\n<li>사용자 인증정보를 가지고 있다 (name, email, phone number, address)</li>\n<li>기본 구현체는 <strong>DefaultOAuth2User</strong>이며 Authentication principal에 저장</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"oidcuserservice\" style=\"position:relative;\"><a href=\"#oidcuserservice\" aria-label=\"oidcuserservice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OidcUserService</h4>\n<blockquote>\n<p>OpenID Connect 1.0 Provider를 지원하는 구현체</p>\n</blockquote>\n<ul>\n<li>OidcUserRequest의 ID Token을 통해 인증처리, 필요 시 DefaultOAuth2UserService 사용</li>\n<li>OidcUser타입 반환\n<ul>\n<li>최종 사용자의 인증 정보인 Claims을 포함</li>\n<li>기본 구현체는 <strong>DefaultOidcUser</strong> 이며 인증 이후 Authentication principal에 저장</li>\n<li>ID토큰은 개인키로 서명이 되어있기 때문에 정해진 알고리즘을 통해 검증하고 Oidc 객체를 생성해야 한다.</li>\n</ul>\n</li>\n</ul>\n<!-- TODO: Flow나중에 정리 OAuth2 로그인 구현 - Oauth 2.0 User 모델 소개(1) 10분 경-->\n<p>여기까진 Login 과정으로 SecurityConfig에</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"22278932007707697000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"복사 되었습니다!\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`    @Bean\r\n    SecurityFilterChain oauth2SecurityFilterChain(HttpSecurity http) throws Exception {\r\n        http.authorizeRequests((requests) -> requests.anyRequest().authenticated());\r\n        http.oauth2Login(Customizer.withDefaults());\r\n        return http.build();\r\n    }`, `22278932007707697000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                복사<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">SecurityFilterChain</span><span class=\"mtk1\"> </span><span class=\"mtk11\">oauth2SecurityFilterChain</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpSecurity</span><span class=\"mtk1\"> http) throws Exception {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorizeRequests</span><span class=\"mtk1\">((requests) </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">requests</span><span class=\"mtk1\">.</span><span class=\"mtk11\">anyRequest</span><span class=\"mtk1\">().</span><span class=\"mtk11\">authenticated</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">oauth2Login</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Customizer</span><span class=\"mtk1\">.</span><span class=\"mtk11\">withDefaults</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>으로 실행된다</p>\n<h3 id=\"openid-logout\" style=\"position:relative;\"><a href=\"#openid-logout\" aria-label=\"openid logout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OpenID Logout</h3>\n<ul>\n<li>클라이언트는 로그아웃 엔드포인트를 사용하여 웹 브라우저에 대한 세션과 쿠키를 지운다.</li>\n<li>클라이언트 로그아웃 성공 후 OidcClientInitiatedLogoutSuccessHandler 를 호출하여 OpenID Provider 세션 로그아웃 요청</li>\n<li>OpenID Provider 로그아웃이 성공하면 지정된 위치로 리다이렉트 한다</li>\n<li>로그아웃 엔드 포인트는 end_session_endpoint 로 정의되어 있다</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"93810124780574880000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"복사 되었습니다!\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`@Configuration(proxyBeanMethods = false)\r\npublic class OAuth2ClientConfig {\r\n\r\n    @Autowired\r\n    private ClientRegistrationRepository clientRegistrationRepository;\r\n\r\n    @Bean\r\n    SecurityFilterChain oauth2SecurityFilterChain(HttpSecurity http) throws Exception {\r\n        http.authorizeRequests((requests) -> requests.anyRequest().authenticated());\r\n        http.oauth2Login(Customizer.withDefaults());\r\n        http.logout()\r\n                .logoutSuccessHandler(oidcLogoutSuccessHandler())\r\n                .invalidateHttpSession(true)\r\n                .clearAuthentication(true)\r\n                .deleteCookies(&quot;JSESSIONID&quot;);\r\n\r\n        return http.build();\r\n    }\r\n\r\n    private OidcClientInitiatedLogoutSuccessHandler oidcLogoutSuccessHandler() {\r\n        OidcClientInitiatedLogoutSuccessHandler successHandler = new OidcClientInitiatedLogoutSuccessHandler(clientRegistrationRepository);\r\n        successHandler.setPostLogoutRedirectUri(&quot;http://localhost:8081/login&quot;);\r\n        return successHandler;\r\n    }\r\n}`, `93810124780574880000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                복사<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Configuration</span><span class=\"mtk1\">(proxyBeanMethods = </span><span class=\"mtk4\">false</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2ClientConfig</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Autowired</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ClientRegistrationRepository</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistrationRepository</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">SecurityFilterChain</span><span class=\"mtk1\"> </span><span class=\"mtk11\">oauth2SecurityFilterChain</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpSecurity</span><span class=\"mtk1\"> </span><span class=\"mtk12\">http</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Exception</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorizeRequests</span><span class=\"mtk1\">((requests) </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">requests</span><span class=\"mtk1\">.</span><span class=\"mtk11\">anyRequest</span><span class=\"mtk1\">().</span><span class=\"mtk11\">authenticated</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">oauth2Login</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Customizer</span><span class=\"mtk1\">.</span><span class=\"mtk11\">withDefaults</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">logout</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">logoutSuccessHandler</span><span class=\"mtk1\">(</span><span class=\"mtk11\">oidcLogoutSuccessHandler</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">invalidateHttpSession</span><span class=\"mtk1\">(</span><span class=\"mtk4\">true</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">clearAuthentication</span><span class=\"mtk1\">(</span><span class=\"mtk4\">true</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">deleteCookies</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;JSESSIONID&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OidcClientInitiatedLogoutSuccessHandler</span><span class=\"mtk1\"> </span><span class=\"mtk11\">oidcLogoutSuccessHandler</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OidcClientInitiatedLogoutSuccessHandler</span><span class=\"mtk1\"> </span><span class=\"mtk12\">successHandler</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">OidcClientInitiatedLogoutSuccessHandler</span><span class=\"mtk1\">(clientRegistrationRepository);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">successHandler</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setPostLogoutRedirectUri</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;http://localhost:8081/login&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> successHandler;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h3 id=\"mvc에서-인증-객체-참조-방법\" style=\"position:relative;\"><a href=\"#mvc%EC%97%90%EC%84%9C-%EC%9D%B8%EC%A6%9D-%EA%B0%9D%EC%B2%B4-%EC%B0%B8%EC%A1%B0-%EB%B0%A9%EB%B2%95\" aria-label=\"mvc에서 인증 객체 참조 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MVC에서 인증 객체 참조 방법</h3>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"86786295055207510000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"복사 되었습니다!\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`    // 1.Authentication 객체로 전달 받기\r\n    @GetMapping(&quot;/user&quot;)\r\n    public OAuth2User user(Authentication authentication){\r\n        OAuth2User oAuth2User = (OAuth2User)authentication.getPrincipal();\r\n\r\n        // 2. ContextHolder에서 꺼내오기\r\n        OAuth2AuthenticationToken oAuth2AuthenticationToken = (OAuth2AuthenticationToken) SecurityContextHolder.getContext().getAuthentication();\r\n        OAuth2User oAuth2User2 = oAuth2AuthenticationToken.getPrincipal();\r\n        System.out.println(&quot;oAuth2User = &quot; + oAuth2User);\r\n        System.out.println(&quot;oAuth2User2 = &quot; + oAuth2User2);\r\n        return oAuth2User;\r\n    }\r\n\r\n    // 3. AuthenticationPrincipal 어노테이션 사용\r\n    @GetMapping(&quot;/oauth2User&quot;)\r\n    public OAuth2User oauth2User(@AuthenticationPrincipal OAuth2User oAuth2User){\r\n        System.out.println(&quot;oAuth2User = &quot; + oAuth2User);\r\n        return oAuth2User;\r\n    }\r\n\r\n    @GetMapping(&quot;/oidcUser&quot;)\r\n    public OidcUser oidcUser(@AuthenticationPrincipal OidcUser oidcUser){\r\n        System.out.println(&quot;oidcUser = &quot; + oidcUser);\r\n        return oidcUser;\r\n    }`, `86786295055207510000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                복사<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// 1.Authentication 객체로 전달 받기</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">GetMapping</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/user&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2User</span><span class=\"mtk1\"> </span><span class=\"mtk11\">user</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Authentication</span><span class=\"mtk1\"> authentication){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2User</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2User</span><span class=\"mtk1\"> = (OAuth2User)</span><span class=\"mtk12\">authentication</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getPrincipal</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// 2. ContextHolder에서 꺼내오기</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2AuthenticationToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthenticationToken</span><span class=\"mtk1\"> = (OAuth2AuthenticationToken) </span><span class=\"mtk12\">SecurityContextHolder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getContext</span><span class=\"mtk1\">().</span><span class=\"mtk11\">getAuthentication</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2User</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2User2</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2AuthenticationToken</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getPrincipal</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;oAuth2User = &quot;</span><span class=\"mtk1\"> + oAuth2User);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;oAuth2User2 = &quot;</span><span class=\"mtk1\"> + oAuth2User2);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> oAuth2User;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// 3. AuthenticationPrincipal 어노테이션 사용</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">GetMapping</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/oauth2User&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2User</span><span class=\"mtk1\"> </span><span class=\"mtk11\">oauth2User</span><span class=\"mtk1\">(@</span><span class=\"mtk10\">AuthenticationPrincipal</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2User</span><span class=\"mtk1\"> oAuth2User){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;oAuth2User = &quot;</span><span class=\"mtk1\"> + oAuth2User);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> oAuth2User;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">GetMapping</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/oidcUser&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OidcUser</span><span class=\"mtk1\"> </span><span class=\"mtk11\">oidcUser</span><span class=\"mtk1\">(@</span><span class=\"mtk10\">AuthenticationPrincipal</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OidcUser</span><span class=\"mtk1\"> oidcUser){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;oidcUser = &quot;</span><span class=\"mtk1\"> + oidcUser);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> oidcUser;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<h3 id=\"oauth2-custom\" style=\"position:relative;\"><a href=\"#oauth2-custom\" aria-label=\"oauth2 custom permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2 Custom</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2393551ef5697134cc345fe5c421cd12/13ce4/oauth2configurer.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.380368098159508%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA0klEQVR42lWQWY4DIQwFc51paPDKkmTuf6wXN7Qi5aNkgU3x4CGqMMmYkjCnYLzfmP8vtD7RLNYusD7QxxNtTLAozvMEEaNW2tCuOWc8iBV0hoz+0IThbW5ZHPbW4doCD/mI2uNygSqvfp+v71wpdQvrLfR6QGqBmi8k9oWCquDCqydqIdtcKS9Bzrsex4GU0hZySRh0wJhgbayE5h0qISeDkUdPoSxwiy+KROYNYgaOvRyidPOTUClSWFvDV0qOhFptSblycN4v2DPEHJL8lV3CD0r9ng9bPNFgAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/2393551ef5697134cc345fe5c421cd12/a81b5/oauth2configurer.webp 163w,\n/static/2393551ef5697134cc345fe5c421cd12/da3ef/oauth2configurer.webp 325w,\n/static/2393551ef5697134cc345fe5c421cd12/309d5/oauth2configurer.webp 650w,\n/static/2393551ef5697134cc345fe5c421cd12/78344/oauth2configurer.webp 975w,\n/static/2393551ef5697134cc345fe5c421cd12/bdb72/oauth2configurer.webp 1300w,\n/static/2393551ef5697134cc345fe5c421cd12/30e03/oauth2configurer.webp 2006w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/2393551ef5697134cc345fe5c421cd12/5e043/oauth2configurer.png 163w,\n/static/2393551ef5697134cc345fe5c421cd12/e5cc6/oauth2configurer.png 325w,\n/static/2393551ef5697134cc345fe5c421cd12/663f3/oauth2configurer.png 650w,\n/static/2393551ef5697134cc345fe5c421cd12/d880f/oauth2configurer.png 975w,\n/static/2393551ef5697134cc345fe5c421cd12/4c573/oauth2configurer.png 1300w,\n/static/2393551ef5697134cc345fe5c421cd12/13ce4/oauth2configurer.png 2006w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/2393551ef5697134cc345fe5c421cd12/663f3/oauth2configurer.png\"\n            alt=\"oauth2configurer\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>oauth2LoginConfig 설정 클래스를 살펴보면 4개의 하위 config설정 클래스가 있다.</p>\n<p>이 설정 클래스들의 값을 변경하면 requestMatcher가 요청을 처리할 url경로를 변경할 수 있다.</p>\n<h4 id=\"authorizationbaseurl--redirectionbaseurl-변경\" style=\"position:relative;\"><a href=\"#authorizationbaseurl--redirectionbaseurl-%EB%B3%80%EA%B2%BD\" aria-label=\"authorizationbaseurl  redirectionbaseurl 변경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AuthorizationBaseUrl &#x26; RedirectionBaseUrl 변경</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d9e49f1066248f14055a6f339b0c9d78/88eef/AuthorizationBaseUrlRedirectionBaseUrl.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.288343558282207%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3klEQVR42o1Q2Q6DMAzj/39wT9znKFfLOAQqXlzWt2laJPdKbKcJjDGI4xhpmiJJEocwDNF1HcZxRCb37PFAKsiiCHVdY55ntG3rOFmeo24aXNcFRrDvO7TWoLAH79u2uQIreStkOwywywLSSF7kPMibqioYpXAdxy3IRN/3aMSF7kVRQEnBNE2O5Axk19KVEbA7mh0isInZrifg9YIU34LruqIsS9d+JW50JSjGHMXV84lWzHjmGM7zhLXWwX/VR8CFbhTlLEki4e/wgn6G+MyEQvw29+MzD75/w694Aw0WzmzNxr2JAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d9e49f1066248f14055a6f339b0c9d78/a81b5/AuthorizationBaseUrlRedirectionBaseUrl.webp 163w,\n/static/d9e49f1066248f14055a6f339b0c9d78/da3ef/AuthorizationBaseUrlRedirectionBaseUrl.webp 325w,\n/static/d9e49f1066248f14055a6f339b0c9d78/309d5/AuthorizationBaseUrlRedirectionBaseUrl.webp 650w,\n/static/d9e49f1066248f14055a6f339b0c9d78/78344/AuthorizationBaseUrlRedirectionBaseUrl.webp 975w,\n/static/d9e49f1066248f14055a6f339b0c9d78/bdb72/AuthorizationBaseUrlRedirectionBaseUrl.webp 1300w,\n/static/d9e49f1066248f14055a6f339b0c9d78/27ba4/AuthorizationBaseUrlRedirectionBaseUrl.webp 2528w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d9e49f1066248f14055a6f339b0c9d78/5e043/AuthorizationBaseUrlRedirectionBaseUrl.png 163w,\n/static/d9e49f1066248f14055a6f339b0c9d78/e5cc6/AuthorizationBaseUrlRedirectionBaseUrl.png 325w,\n/static/d9e49f1066248f14055a6f339b0c9d78/663f3/AuthorizationBaseUrlRedirectionBaseUrl.png 650w,\n/static/d9e49f1066248f14055a6f339b0c9d78/d880f/AuthorizationBaseUrlRedirectionBaseUrl.png 975w,\n/static/d9e49f1066248f14055a6f339b0c9d78/4c573/AuthorizationBaseUrlRedirectionBaseUrl.png 1300w,\n/static/d9e49f1066248f14055a6f339b0c9d78/88eef/AuthorizationBaseUrlRedirectionBaseUrl.png 2528w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d9e49f1066248f14055a6f339b0c9d78/663f3/AuthorizationBaseUrlRedirectionBaseUrl.png\"\n            alt=\"AuthorizationBaseUrlRedirectionBaseUrl\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Authorization Code Grant Type 로그인 과정에서</p>\n<p>code를 받아올 때 사용하는 base url과 code를 받아온 후 App으로 리다이렉트 해주는 redirection base url을 변경 할 수 있다.</p>\n<ol>\n<li>config 설정 파일에 oauth2LoginConfig 설정 변경, yml파일에 등록한 client redirect-uri 변경</li>\n</ol>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"19045020583584727000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"복사 되었습니다!\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`// application.yml\r\nredirect-uri: http://localhost:8081/login/v1/oauth2/code/keycloak\r\n\r\n// Config\r\n        http\r\n                .oauth2Login(oauth2 -> oauth2\r\n                        .loginPage(&quot;/login&quot;)\r\n//                        .loginProcessingUrl(&quot;/login/v1/oauth2/code/*&quot;)\r\n                        .authorizationEndpoint(authorizationEndpointConfig ->\r\n                                authorizationEndpointConfig.baseUri(&quot;/oauth2/v1/authorization&quot;))\r\n                        .redirectionEndpoint(redirectionEndpointConfig ->\r\n                                redirectionEndpointConfig.baseUri(&quot;/login/v1/oauth2/code/*&quot;))\r\n                );`, `19045020583584727000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                복사<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// application.yml</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">redirect-uri</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> http</span><span class=\"mtk15\">:</span><span class=\"mtk3\">//localhost:8081/login/v1/oauth2/code/keycloak</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// Config</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        http</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">oauth2Login</span><span class=\"mtk1\">(oauth2 </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> oauth2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">loginPage</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/login&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//                        .loginProcessingUrl(&quot;/login/v1/oauth2/code/*&quot;)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">authorizationEndpoint</span><span class=\"mtk1\">(authorizationEndpointConfig </span><span class=\"mtk4\">-&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                </span><span class=\"mtk12\">authorizationEndpointConfig</span><span class=\"mtk1\">.</span><span class=\"mtk11\">baseUri</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/oauth2/v1/authorization&quot;</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">redirectionEndpoint</span><span class=\"mtk1\">(redirectionEndpointConfig </span><span class=\"mtk4\">-&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                </span><span class=\"mtk12\">redirectionEndpointConfig</span><span class=\"mtk1\">.</span><span class=\"mtk11\">baseUri</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/login/v1/oauth2/code/*&quot;</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                );</span></span></span></code></pre>\n<ol start=\"2\">\n<li>인가 서버의 valid post logout redirect url 설정 추가</li>\n</ol>\n<h4 id=\"pcke-사용\" style=\"position:relative;\"><a href=\"#pcke-%EC%82%AC%EC%9A%A9\" aria-label=\"pcke 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PCKE 사용</h4>\n<p>pcke방식 grant type을 설정하려면 Code Challenge를 암호화 해서 사용해야 하는데 OAuth2AuthorizationRequestResolver를 상속받은 구현체를 만들어 resolve함수를 custom 해야한다.</p>\n<p>resolve 로직을 간단히 요약하면 request 요청에 registrationId를 <strong>keycloakWithPKCE</strong>(yml 파일에서 해당 이름으로 매칭 시켜 놓음) 값이 있을 경우에 대한 분기처리를 한다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"42430931443756780000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"복사 되었습니다!\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`// config\r\n    @Bean\r\n    SecurityFilterChain oauth2SecurityFilterChain(HttpSecurity http) throws Exception {\r\n        http.authorizeRequests((requests) -> requests.antMatchers(&quot;/home&quot;).permitAll()\r\n                .anyRequest().authenticated());\r\n        http.oauth2Login(authLogin ->\r\n                authLogin.authorizationEndpoint(authEndpoint ->\r\n                        authEndpoint.authorizationRequestResolver(customOAuth2AuthenticationRequestResolver())));\r\n        http.logout().logoutSuccessUrl(&quot;/home&quot;);\r\n\r\n        return http.build();\r\n    }\r\n\r\n    private OAuth2AuthorizationRequestResolver customOAuth2AuthenticationRequestResolver() {\r\n        return new CustomOAuth2AuthorizationRequestResolver(clientRegistrationRepository, &quot;/oauth2/authorization&quot;);\r\n    }\r\n\r\n// CustomOAuth2AuthorizationRequestResolver\r\npublic class CustomOAuth2AuthorizationRequestResolver implements OAuth2AuthorizationRequestResolver {\r\n    ...\r\n\r\n    public CustomOAuth2AuthorizationRequestResolver(ClientRegistrationRepository clientRegistrationRepository, String authorizationRequestBaseUri) {\r\n\r\n        this.clientRegistrationRepository = clientRegistrationRepository;\r\n        this.authorizationRequestMatcher = new AntPathRequestMatcher(\r\n                authorizationRequestBaseUri + &quot;/{&quot; + REGISTRATION_ID_URI_VARIABLE_NAME + &quot;}&quot;);\r\n\r\n        defaultResolver = new DefaultOAuth2AuthorizationRequestResolver(clientRegistrationRepository, authorizationRequestBaseUri);\r\n    }\r\n\r\n    @Override\r\n    public OAuth2AuthorizationRequest resolve(HttpServletRequest request) {\r\n        String registrationId = resolveRegistrationId(request);\r\n        if (registrationId == null) {\r\n            return null;\r\n        }\r\n        ClientRegistration clientRegistration = clientRegistrationRepository.findByRegistrationId(registrationId);\r\n        if(registrationId.equals(&quot;keycloakWithPKCE&quot;)){\r\n            OAuth2AuthorizationRequest oAuth2AuthorizationRequest = defaultResolver.resolve(request);\r\n            return customResolve(oAuth2AuthorizationRequest, clientRegistration);\r\n\r\n        }\r\n        return defaultResolver.resolve(request);\r\n    }\r\n\r\n    @Override\r\n    public OAuth2AuthorizationRequest resolve(HttpServletRequest request, String clientRegistrationId) {\r\n        ClientRegistration clientRegistration = clientRegistrationRepository.findByRegistrationId(clientRegistrationId);\r\n        if(clientRegistrationId.equals(&quot;keycloakWithPKCE&quot;)){\r\n            OAuth2AuthorizationRequest oAuth2AuthorizationRequest = defaultResolver.resolve(request);\r\n            return customResolve(oAuth2AuthorizationRequest, clientRegistration);\r\n        }\r\n        return defaultResolver.resolve(request,clientRegistrationId);\r\n    }\r\n    private OAuth2AuthorizationRequest customResolve(OAuth2AuthorizationRequest authorizationRequest, ClientRegistration clientRegistration) {\r\n\r\n        Map<String,Object> extraParam = new HashMap<>();\r\n        extraParam.put(&quot;customName1&quot;,&quot;customValue1&quot;);\r\n        extraParam.put(&quot;customName2&quot;,&quot;customValue2&quot;);\r\n        extraParam.put(&quot;customName3&quot;,&quot;customValue3&quot;);\r\n\r\n        OAuth2AuthorizationRequest.Builder builder = OAuth2AuthorizationRequest\r\n                .from(authorizationRequest)\r\n                .additionalParameters(extraParam)\r\n                ;\r\n        DEFAULT_PKCE_APPLIER.accept(builder);\r\n\r\n        return builder.build();\r\n    }\r\n    ...\r\n}`, `42430931443756780000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                복사<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// config</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">SecurityFilterChain</span><span class=\"mtk1\"> </span><span class=\"mtk11\">oauth2SecurityFilterChain</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpSecurity</span><span class=\"mtk1\"> http) throws Exception {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorizeRequests</span><span class=\"mtk1\">((requests) </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">requests</span><span class=\"mtk1\">.</span><span class=\"mtk11\">antMatchers</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/home&quot;</span><span class=\"mtk1\">).</span><span class=\"mtk11\">permitAll</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">anyRequest</span><span class=\"mtk1\">().</span><span class=\"mtk11\">authenticated</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">oauth2Login</span><span class=\"mtk1\">(authLogin </span><span class=\"mtk4\">-&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">authLogin</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorizationEndpoint</span><span class=\"mtk1\">(authEndpoint </span><span class=\"mtk4\">-&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk12\">authEndpoint</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorizationRequestResolver</span><span class=\"mtk1\">(</span><span class=\"mtk11\">customOAuth2AuthenticationRequestResolver</span><span class=\"mtk1\">())));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">logout</span><span class=\"mtk1\">().</span><span class=\"mtk11\">logoutSuccessUrl</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/home&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizationRequestResolver</span><span class=\"mtk1\"> </span><span class=\"mtk11\">customOAuth2AuthenticationRequestResolver</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">CustomOAuth2AuthorizationRequestResolver</span><span class=\"mtk1\">(clientRegistrationRepository, </span><span class=\"mtk8\">&quot;/oauth2/authorization&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// CustomOAuth2AuthorizationRequestResolver</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">CustomOAuth2AuthorizationRequestResolver</span><span class=\"mtk1\"> </span><span class=\"mtk4\">implements</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizationRequestResolver</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">CustomOAuth2AuthorizationRequestResolver</span><span class=\"mtk1\">(</span><span class=\"mtk10\">ClientRegistrationRepository</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistrationRepository</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizationRequestBaseUri</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">clientRegistrationRepository</span><span class=\"mtk1\"> = clientRegistrationRepository;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">authorizationRequestMatcher</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">AntPathRequestMatcher</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                authorizationRequestBaseUri + </span><span class=\"mtk8\">&quot;/{&quot;</span><span class=\"mtk1\"> + REGISTRATION_ID_URI_VARIABLE_NAME + </span><span class=\"mtk8\">&quot;}&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        defaultResolver = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DefaultOAuth2AuthorizationRequestResolver</span><span class=\"mtk1\">(clientRegistrationRepository, authorizationRequestBaseUri);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizationRequest</span><span class=\"mtk1\"> </span><span class=\"mtk11\">resolve</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpServletRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">request</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">registrationId</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">resolveRegistrationId</span><span class=\"mtk1\">(request);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (registrationId == </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">null</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">ClientRegistration</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistration</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">clientRegistrationRepository</span><span class=\"mtk1\">.</span><span class=\"mtk11\">findByRegistrationId</span><span class=\"mtk1\">(registrationId);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\">(</span><span class=\"mtk12\">registrationId</span><span class=\"mtk1\">.</span><span class=\"mtk11\">equals</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;keycloakWithPKCE&quot;</span><span class=\"mtk1\">)){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2AuthorizationRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthorizationRequest</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">defaultResolver</span><span class=\"mtk1\">.</span><span class=\"mtk11\">resolve</span><span class=\"mtk1\">(request);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">customResolve</span><span class=\"mtk1\">(oAuth2AuthorizationRequest, clientRegistration);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">defaultResolver</span><span class=\"mtk1\">.</span><span class=\"mtk11\">resolve</span><span class=\"mtk1\">(request);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizationRequest</span><span class=\"mtk1\"> </span><span class=\"mtk11\">resolve</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpServletRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">request</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistrationId</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">ClientRegistration</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistration</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">clientRegistrationRepository</span><span class=\"mtk1\">.</span><span class=\"mtk11\">findByRegistrationId</span><span class=\"mtk1\">(clientRegistrationId);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\">(</span><span class=\"mtk12\">clientRegistrationId</span><span class=\"mtk1\">.</span><span class=\"mtk11\">equals</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;keycloakWithPKCE&quot;</span><span class=\"mtk1\">)){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2AuthorizationRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthorizationRequest</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">defaultResolver</span><span class=\"mtk1\">.</span><span class=\"mtk11\">resolve</span><span class=\"mtk1\">(request);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">customResolve</span><span class=\"mtk1\">(oAuth2AuthorizationRequest, clientRegistration);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">defaultResolver</span><span class=\"mtk1\">.</span><span class=\"mtk11\">resolve</span><span class=\"mtk1\">(request,clientRegistrationId);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizationRequest</span><span class=\"mtk1\"> </span><span class=\"mtk11\">customResolve</span><span class=\"mtk1\">(</span><span class=\"mtk10\">OAuth2AuthorizationRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizationRequest</span><span class=\"mtk1\">, </span><span class=\"mtk10\">ClientRegistration</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistration</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">,</span><span class=\"mtk10\">Object</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">extraParam</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">HashMap</span><span class=\"mtk1\">&lt;&gt;();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">extraParam</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;customName1&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;customValue1&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">extraParam</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;customName2&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;customValue2&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">extraParam</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;customName3&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;customValue3&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2AuthorizationRequest</span><span class=\"mtk1\">.</span><span class=\"mtk10\">Builder</span><span class=\"mtk1\"> </span><span class=\"mtk12\">builder</span><span class=\"mtk1\"> = </span><span class=\"mtk10\">OAuth2AuthorizationRequest</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">from</span><span class=\"mtk1\">(authorizationRequest)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">additionalParameters</span><span class=\"mtk1\">(extraParam)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                ;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">DEFAULT_PKCE_APPLIER</span><span class=\"mtk1\">.</span><span class=\"mtk11\">accept</span><span class=\"mtk1\">(builder);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">builder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h2 id=\"oauth-20-client---oauth2client\" style=\"position:relative;\"><a href=\"#oauth-20-client---oauth2client\" aria-label=\"oauth 20 client   oauth2client permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Client - oauth2Client()</h2>\n<ul>\n<li>OAuth2AuthorizedClient 는 인가받은 클라이언트를 의미하는 클래스</li>\n<li>OAuth2AuthorizedClient 는 AccessToken 과 RefreshToken 을 ClientRegistration (클라이언트)와 권한을 부여한 최종 사용자인 Principal과 함께 묶는다.</li>\n<li>OAuth2AuthorizedClient 의 AccessToken 을 사용해서 리소스 서버의 자원에 접근, 인가서버와의 통신으로 토큰을 검증</li>\n</ul>\n<!-- TODO: 이거 어떤거 말하는지 확인해야 함\r\nOAuth2.0 Login() 인증, 인가 포함\r\nOAuth2.0 Client() 인가처리는 가능하지만 최종 사용자의 인증은 처리 x -->\n<h3 id=\"oauth20-client-주요-클래스\" style=\"position:relative;\"><a href=\"#oauth20-client-%EC%A3%BC%EC%9A%94-%ED%81%B4%EB%9E%98%EC%8A%A4\" aria-label=\"oauth20 client 주요 클래스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2.0 Client 주요 클래스</h3>\n<h4 id=\"authorizationcodegrantconfigurer\" style=\"position:relative;\"><a href=\"#authorizationcodegrantconfigurer\" aria-label=\"authorizationcodegrantconfigurer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AuthorizationCodeGrantConfigurer</h4>\n<blockquote>\n<p>해당 클래스는 위에서 코드를 받아오기 위한 3개의 클래스를 생성하고, 추가로 accessToken을 받아오기 위한 <strong>OAuth2AuthorizationCodeGrantFilter</strong>도 생성</p>\n</blockquote>\n<h4 id=\"oauth2authorizedclientrepository\" style=\"position:relative;\"><a href=\"#oauth2authorizedclientrepository\" aria-label=\"oauth2authorizedclientrepository permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2AuthorizedClientRepository</h4>\n<blockquote>\n<p>다른 웹 요청이 와도 동일한 OAuth2AuthorizedClient 를 유지하는 역할</p>\n</blockquote>\n<h4 id=\"oauth2authorizedclientservice\" style=\"position:relative;\"><a href=\"#oauth2authorizedclientservice\" aria-label=\"oauth2authorizedclientservice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2AuthorizedClientService</h4>\n<blockquote>\n<p>OAuth2AuthorizedClientService 는 어플리케이션 레벨에서 OAuth2AuthorizedClient 를 관리(저장, 조회, 삭제 )</p>\n</blockquote>\n<h4 id=\"oauth2authorizedclientmanager\" style=\"position:relative;\"><a href=\"#oauth2authorizedclientmanager\" aria-label=\"oauth2authorizedclientmanager permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2AuthorizedClientManager</h4>\n<blockquote>\n<p>OAuth2AuthorizedClient 를 전반적으로 관리하는 인터페이스</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/989b9/OAuth2AuthorizedClientManagerStructure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.46625766871166%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB4UlEQVR42nVSXY+iQBDk//+Qe9u9XHJ7L/egp9Eo8WN1/QARUERUjkURP1CQuupJdp/2JqkUM9Pd1V2Mtt/v8dXqzzf40TTwqz0jLLyQf7YMvOg2vN1BxZRf5Gn4z+qx4HN9jKfqAE9/hvhee8Mz+dvvHpx1pMo9Hg+UZanw8a1lWYbL5QLha3ZVnOe5SiiLO/DIlUB+z1SCrIL3m80G8/kctm0rNk0Tt9sN2mQyQavVQrPZRKPRUJjNZjifz7jfczWWQL5PFL4/SrUPggDtdht6W1cskGa0MAyVymAw+ITruupSdX29svMMKQW2iwUSx0HEjlzmBNstjmmK5HhESi44tjYajdDr9T6LdbtdOEwSG6QLwY4ICZ/ntmHA5nimaSBYetjvdohYeEuIVZok6LqOer2uxhUWkTiOYVkWpkxe0BafQstuB/1OB2/jMRx26DFu9drHfPAKg3GqoOd58H0fq9VK8ZL7KIrUpZyZ9HNF0a1j412KcL9cr3GmDe9JgojCIeMPhwOKooA2plqtVkO1WkWlUlGQsRMGW0z2p1OEHM9l3IwFF/TRGw4RTTkyxxe/j4xVHkrB9JiqTuRCfo6w2HA6nSA/LKZHCVm82hHx3wjxJsCeMbF4y7OPZydv8R8t5eDtWZ/bugAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/a81b5/OAuth2AuthorizedClientManagerStructure.webp 163w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/da3ef/OAuth2AuthorizedClientManagerStructure.webp 325w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/309d5/OAuth2AuthorizedClientManagerStructure.webp 650w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/78344/OAuth2AuthorizedClientManagerStructure.webp 975w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/bdb72/OAuth2AuthorizedClientManagerStructure.webp 1300w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/45e15/OAuth2AuthorizedClientManagerStructure.webp 2588w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/5e043/OAuth2AuthorizedClientManagerStructure.png 163w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/e5cc6/OAuth2AuthorizedClientManagerStructure.png 325w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/663f3/OAuth2AuthorizedClientManagerStructure.png 650w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/d880f/OAuth2AuthorizedClientManagerStructure.png 975w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/4c573/OAuth2AuthorizedClientManagerStructure.png 1300w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/989b9/OAuth2AuthorizedClientManagerStructure.png 2588w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/663f3/OAuth2AuthorizedClientManagerStructure.png\"\n            alt=\"OAuth2AuthorizedClientManagerStructure\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ul>\n<li>Client Credentials Flow, Resource Owner Password Flow, Refresh Token Flow 3개의 권한 부여 방식 사용</li>\n<li>OAuth2AuthorizedClientService 나 OAuth2AuthorizedClientRepository 에 OAuth2AuthorizedClient 저장을 위임한 후 OAuth2AuthorizedClient 최종 반환</li>\n<li>HttpServletRequest는 DefaultOAuth2AuthorizedClientManager 클래스가 처리</li>\n<li>데몬, 백그라운드 실행 시 AuthorizedClientServiceOAuth2AuthorizedClientManager 클래스가 처리</li>\n</ul>\n<h3 id=\"oauth2-client---resource-owner-password-flow\" style=\"position:relative;\"><a href=\"#oauth2-client---resource-owner-password-flow\" aria-label=\"oauth2 client   resource owner password flow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2 client - Resource Owner Password Flow</h3>\n<h4 id=\"인증-처리\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9D-%EC%B2%98%EB%A6%AC\" aria-label=\"인증 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증 처리</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/818fe/ResourceOwnerPasswordFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.828220858895705%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACCUlEQVR42o1S2W7TQBT1hyFReKiQkBCfwANPfFefWKS+BKSUFIQKWbwkbVYlDtTOasexHe/xdrgzJAjRCnGlI89c3zlz5t4jrA0T8+UKmj7Dam1gu3Xg+z4hQBwn2O/3HFmScORxjCyKkSfx732eZsiyjNcJ5orIplMsl0sYhoHhcIhGo8HheR5YFGWJwLLgzudwZzphBpfqd6s1vMUCLv1jIlIiFXZBgCRNURQFHMfhpJqmYUaHElJwjImqoiVJkBQFIkFutyHKMpROByLlFcqx84Kn3WLbvcFO1xGFIcyNicV8AYtuLUnZv6IkERxUVxzWAogAUxVwXaSklElf0XNs2+ZwKe8y5ZYNy/Wx3YXYOD5sL7j3EuHIziKmBuuklD2ZfRlZFIUcfVXHp1YP1SsFteYN5O4EoP5zrNe/QPUC/jPYYAzTRH8wwO1sjjQkhYqEUpGBXhe47oB6dZfw774Vh708+I6zyle8qTbx+qKJxvUYqWOD+kQW2iMny5R5fpcwp2Ttoorzt+9QqVTwsXaJev0b2v0x3n9u4IvYxfmliLMPdVx1p3D8CDo5QiXr5X8SHpVFZOZXL1/gyckjPD49xYOHJ3j67DlarSa9SoE6GUPs9DBQNci9MUbqDz5EZjM21Ht7aFkbSMxzBOaxDnltSgqGoxH3Y0BOWFK/dLKcqk74EIuDfX4CqsUwM87lzJsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/a81b5/ResourceOwnerPasswordFlow.webp 163w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/da3ef/ResourceOwnerPasswordFlow.webp 325w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/309d5/ResourceOwnerPasswordFlow.webp 650w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/78344/ResourceOwnerPasswordFlow.webp 975w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/bdb72/ResourceOwnerPasswordFlow.webp 1300w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/3a126/ResourceOwnerPasswordFlow.webp 2616w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/5e043/ResourceOwnerPasswordFlow.png 163w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/e5cc6/ResourceOwnerPasswordFlow.png 325w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/663f3/ResourceOwnerPasswordFlow.png 650w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/d880f/ResourceOwnerPasswordFlow.png 975w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/4c573/ResourceOwnerPasswordFlow.png 1300w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/818fe/ResourceOwnerPasswordFlow.png 2616w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/663f3/ResourceOwnerPasswordFlow.png\"\n            alt=\"ResourceOwnerPasswordFlow\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Resource Owner Password 인증을 살펴보면</p>\n<ol>\n<li>\n<p>인증하는데 필요한 요청 정보를 <strong>OAuth2AuthorizeRequest</strong>에 담아 ClientManager로 보낸다.</p>\n</li>\n<li>\n<p>OAuth2AuthorizedClient 객체가 있는지 확인</p>\n</li>\n<li>\n<p>OAuth2AuthorizedClient가 없을 경우 OAuth2AutorizationContext객체를 생성해 <strong>PasswordOAuth2AuthorizedClientProvider 전달하고 클라이언트 인가 처리</strong></p>\n</li>\n<li>\n<p>AccessToken과 RefreshToken 로직 분기 처리 후 필요 시 인가 서버로 <strong>DefaultPasswordTokenResponseClient</strong>클래스를 사용해 처리</p>\n</li>\n</ol>\n<h4 id=\"인가처리\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EA%B0%80%EC%B2%98%EB%A6%AC\" aria-label=\"인가처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인가처리</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a40c5f428b7f514365c30a795950de4a/ae5c4/restAuthorizationFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.828220858895705%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB+0lEQVR42pWS2U5TURSGz5N4w6VGK0akGIxI5MKrRm9N1Jj4KOqF0SdQVFppCcUqNR3UgoVIUXo6cEjbtCrSSWmgg50HPs8+toRGDfonf7L2Wv/ea9hL2s0XyBeKNBqNfbbbbQqFgmY3m82+2GGU9vb26HQ62iOCwt7d2SEaiZBKJTWf0BzGHiQOoBf4upVkcek9IWWjT/w3CI3opNVqIb1xOzEZTUybLRifTWO3v+JLMsu8Z4U1Ja5VLMTValWzRVulUoli8deYxGOii83NTba3t5Fu3bzBmWE9o2MXGBk9h+HyFbbS31halVGicfVCR8ssxJVKhXq9TiaTIZfLUavVKJfLmk8kyOfzSNevXUU3eILTej3HTw4yPjGBLxTF7g3glWPIfhm3y4ntxUue22w4nC4i0ShL7xaZm7XycHISs8XCrNVKPJFAcjocGKeeMmUy8ejxEzUwh/Iphcm+jBzPcOfubXRqovPjFxlTOaQ/y737DzAYLnFUd4xTw0MMjeg5MjCAeWam/1MEauqsYmoFHo+XYDBMMCATCoVRFIX1LlOpND7fCm8XPCyolQq63K9JpdNIYtC9tRHIZrP41z4SDsoEZb82r//BbxWKAa9HEyyvBvgQ2KBQ+kFvVzV2927/fIDCL/1pp+LJ7wRiWyifs1Tqza7/3yr8CcQuDbjHmc5EAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a40c5f428b7f514365c30a795950de4a/a81b5/restAuthorizationFlow.webp 163w,\n/static/a40c5f428b7f514365c30a795950de4a/da3ef/restAuthorizationFlow.webp 325w,\n/static/a40c5f428b7f514365c30a795950de4a/309d5/restAuthorizationFlow.webp 650w,\n/static/a40c5f428b7f514365c30a795950de4a/78344/restAuthorizationFlow.webp 975w,\n/static/a40c5f428b7f514365c30a795950de4a/bdb72/restAuthorizationFlow.webp 1300w,\n/static/a40c5f428b7f514365c30a795950de4a/35f29/restAuthorizationFlow.webp 2622w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a40c5f428b7f514365c30a795950de4a/5e043/restAuthorizationFlow.png 163w,\n/static/a40c5f428b7f514365c30a795950de4a/e5cc6/restAuthorizationFlow.png 325w,\n/static/a40c5f428b7f514365c30a795950de4a/663f3/restAuthorizationFlow.png 650w,\n/static/a40c5f428b7f514365c30a795950de4a/d880f/restAuthorizationFlow.png 975w,\n/static/a40c5f428b7f514365c30a795950de4a/4c573/restAuthorizationFlow.png 1300w,\n/static/a40c5f428b7f514365c30a795950de4a/ae5c4/restAuthorizationFlow.png 2622w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a40c5f428b7f514365c30a795950de4a/663f3/restAuthorizationFlow.png\"\n            alt=\"restAuthorizationFlow\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>인증 처리가 끝나면 위와 같이 AccessToken을 사용해 사용자 정보를 가져올 수 있다.</p>\n<h4 id=\"구현\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%ED%98%84\" aria-label=\"구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>구현</h4>\n<ul>\n<li>인증 처리를 하기 위해선 username과 password를 처리하는 기능이 필요해 <strong>contextAttributesMapper</strong>를 구현해 OAuth2AutorizedClientManager에 등록시켜야 한다.</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"90733739179583770000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"복사 되었습니다!\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`// OAuth2ClientConfig\r\n    @Bean\r\n    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\r\n        http.authorizeRequests(authRequest -> authRequest\r\n                .antMatchers(&quot;/&quot;,&quot;/oauth2Login&quot;,&quot;/client&quot;).permitAll()\r\n                .anyRequest().authenticated());\r\n        http\r\n//                .oauth2Login(Customizer.withDefaults())\r\n                .oauth2Client(Customizer.withDefaults());\r\n        return http.build();\r\n    }\r\n\r\n// AppConfig\r\n@Configuration\r\npublic class AppConfig {\r\n\r\n    @Bean\r\n    public DefaultOAuth2AuthorizedClientManager authorizedClientManager(ClientRegistrationRepository clientRegistrationRepository,\r\n                                                                        OAuth2AuthorizedClientRepository authorizedClientRepository) {\r\n\r\n        OAuth2AuthorizedClientProvider authorizedClientProvider =\r\n                OAuth2AuthorizedClientProviderBuilder.builder()\r\n                        .authorizationCode()\r\n                        .clientCredentials()\r\n                        .password(passwordGrantBuilder -> {\r\n                            passwordGrantBuilder.clockSkew(Duration.ofSeconds(3600));\r\n                        })\r\n                        .refreshToken(refreshTokenGrantBuilder -> refreshTokenGrantBuilder.clockSkew(Duration.ofSeconds(3600)))\r\n                        .build();\r\n\r\n        DefaultOAuth2AuthorizedClientManager authorizedClientManager =\r\n                new DefaultOAuth2AuthorizedClientManager(\r\n                        clientRegistrationRepository, authorizedClientRepository);\r\n        authorizedClientManager.setAuthorizedClientProvider(authorizedClientProvider);\r\n        authorizedClientManager.setContextAttributesMapper(contextAttributesMapper());\r\n\r\n        return authorizedClientManager;\r\n    }\r\n\r\n    private Function<OAuth2AuthorizeRequest, Map<String, Object>> contextAttributesMapper() {\r\n        return authorizeRequest -> {\r\n            Map<String, Object> contextAttributes = Collections.emptyMap();\r\n            HttpServletRequest servletRequest = authorizeRequest.getAttribute(HttpServletRequest.class.getName());\r\n\r\n            String username = servletRequest.getParameter(OAuth2ParameterNames.USERNAME);\r\n            String password = servletRequest.getParameter(OAuth2ParameterNames.PASSWORD);\r\n\r\n            if (StringUtils.hasText(username) && StringUtils.hasText(password)) {\r\n                contextAttributes = new HashMap<>();\r\n\r\n                // \\`PasswordOAuth2AuthorizedClientProvider\\` requires both attributes\r\n                contextAttributes.put(OAuth2AuthorizationContext.USERNAME_ATTRIBUTE_NAME, username);\r\n                contextAttributes.put(OAuth2AuthorizationContext.PASSWORD_ATTRIBUTE_NAME, password);\r\n            }\r\n            return contextAttributes;\r\n        };\r\n    }\r\n}`, `90733739179583770000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                복사<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// OAuth2ClientConfig</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">SecurityFilterChain</span><span class=\"mtk1\"> </span><span class=\"mtk11\">securityFilterChain</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpSecurity</span><span class=\"mtk1\"> http) throws Exception {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorizeRequests</span><span class=\"mtk1\">(authRequest </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> authRequest</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">antMatchers</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;/oauth2Login&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;/client&quot;</span><span class=\"mtk1\">).</span><span class=\"mtk11\">permitAll</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">anyRequest</span><span class=\"mtk1\">().</span><span class=\"mtk11\">authenticated</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        http</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//                .oauth2Login(Customizer.withDefaults())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">oauth2Client</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Customizer</span><span class=\"mtk1\">.</span><span class=\"mtk11\">withDefaults</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// AppConfig</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Configuration</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">AppConfig</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">DefaultOAuth2AuthorizedClientManager</span><span class=\"mtk1\"> </span><span class=\"mtk11\">authorizedClientManager</span><span class=\"mtk1\">(</span><span class=\"mtk10\">ClientRegistrationRepository</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistrationRepository</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                                                        </span><span class=\"mtk10\">OAuth2AuthorizedClientRepository</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizedClientRepository</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2AuthorizedClientProvider</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizedClientProvider</span><span class=\"mtk1\"> =</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">OAuth2AuthorizedClientProviderBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">builder</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">authorizationCode</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">clientCredentials</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">password</span><span class=\"mtk1\">(passwordGrantBuilder </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                            </span><span class=\"mtk12\">passwordGrantBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">clockSkew</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Duration</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ofSeconds</span><span class=\"mtk1\">(</span><span class=\"mtk7\">3600</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">refreshToken</span><span class=\"mtk1\">(refreshTokenGrantBuilder </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">refreshTokenGrantBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">clockSkew</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Duration</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ofSeconds</span><span class=\"mtk1\">(</span><span class=\"mtk7\">3600</span><span class=\"mtk1\">)))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">DefaultOAuth2AuthorizedClientManager</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizedClientManager</span><span class=\"mtk1\"> =</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DefaultOAuth2AuthorizedClientManager</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        clientRegistrationRepository, authorizedClientRepository);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">authorizedClientManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setAuthorizedClientProvider</span><span class=\"mtk1\">(authorizedClientProvider);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">authorizedClientManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setContextAttributesMapper</span><span class=\"mtk1\">(</span><span class=\"mtk11\">contextAttributesMapper</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> authorizedClientManager;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Function</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">OAuth2AuthorizeRequest</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Object</span><span class=\"mtk1\">&gt;&gt; </span><span class=\"mtk11\">contextAttributesMapper</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> authorizeRequest </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Object</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">contextAttributes</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Collections</span><span class=\"mtk1\">.</span><span class=\"mtk11\">emptyMap</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">HttpServletRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletRequest</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">authorizeRequest</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getAttribute</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">username</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">servletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getParameter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">OAuth2ParameterNames</span><span class=\"mtk1\">.</span><span class=\"mtk12\">USERNAME</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">password</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">servletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getParameter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">OAuth2ParameterNames</span><span class=\"mtk1\">.</span><span class=\"mtk12\">PASSWORD</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">StringUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">hasText</span><span class=\"mtk1\">(username) &amp;&amp; </span><span class=\"mtk12\">StringUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">hasText</span><span class=\"mtk1\">(password)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                contextAttributes = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">HashMap</span><span class=\"mtk1\">&lt;&gt;();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\">// `PasswordOAuth2AuthorizedClientProvider` requires both attributes</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">contextAttributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk12\">OAuth2AuthorizationContext</span><span class=\"mtk1\">.</span><span class=\"mtk12\">USERNAME_ATTRIBUTE_NAME</span><span class=\"mtk1\">, username);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">contextAttributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk12\">OAuth2AuthorizationContext</span><span class=\"mtk1\">.</span><span class=\"mtk12\">PASSWORD_ATTRIBUTE_NAME</span><span class=\"mtk1\">, password);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> contextAttributes;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        };</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>코드를 간략히 설명하면</p>\n<ol>\n<li>\n<p><strong>DefaultOAuth2AutorizedClientManager</strong> 객체 생성</p>\n</li>\n<li>\n<p>setAuthorizedClientProvider 함수로 Provider 등록</p>\n</li>\n<li>\n<p>parameter 처리 부분이 있는 contextAttributesMapper 함수를 등록한다.</p>\n</li>\n</ol>\n<p>DefaultOAuth2AuthorizedClientManager 객체를 통해 동작 확인 가능</p>\n<p>Config 설정은 끝이고</p>\n<p>실제 로그인 기능을 구현하기 위해서 Controller 구현해야 한다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"98047929994976890000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"복사 되었습니다!\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`@Controller\r\npublic class LoginController {\r\n\r\n    @Autowired\r\n    DefaultOAuth2AuthorizedClientManager authorizedClientManager;\r\n\r\n    @Autowired\r\n    OAuth2AuthorizedClientRepository authorizedClientRepository;\r\n\r\n    private Duration clockSkew = Duration.ofSeconds(3600);\r\n\r\n    private Clock clock = Clock.systemUTC();\r\n\r\n    @GetMapping(&quot;/oauth2Login&quot;)\r\n    public String oauth2Login(Model model, HttpServletResponse servletResponse, HttpServletRequest servletRequest) throws IOException {\r\n\r\n        Authentication principal = SecurityContextHolder.getContext().getAuthentication();\r\n\r\n        if (principal == null) {\r\n            principal = new AnonymousAuthenticationToken(&quot;anonymous&quot;,&quot;anonymousUser&quot;, AuthorityUtils.createAuthorityList(&quot;ROLE_ANONYMOUS&quot;));\r\n        }\r\n\r\n        OAuth2AuthorizeRequest authorizeRequest = OAuth2AuthorizeRequest\r\n                .withClientRegistrationId(&quot;keycloak&quot;)\r\n                .principal(principal)\r\n                .attribute(HttpServletRequest.class.getName(), servletRequest)\r\n                .attribute(HttpServletResponse.class.getName(), servletResponse)\r\n                .build();\r\n\r\n        OAuth2AuthorizationSuccessHandler authorizationSuccessHandler = (authorizedClient, authentication, attributes) ->\r\n                authorizedClientRepository\r\n                        .saveAuthorizedClient(authorizedClient, authentication,\r\n                                (HttpServletRequest) attributes.get(HttpServletRequest.class.getName()),\r\n                                (HttpServletResponse) attributes.get(HttpServletResponse.class.getName()));\r\n        authorizedClientManager.setAuthorizationSuccessHandler(authorizationSuccessHandler);\r\n\r\n        OAuth2AuthorizedClient oAuth2AuthorizedClient = authorizedClientManager.authorize(authorizeRequest);\r\n\r\n        if (oAuth2AuthorizedClient != null && hasTokenExpired(oAuth2AuthorizedClient.getAccessToken())\r\n                && oAuth2AuthorizedClient.getRefreshToken() != null) {\r\n            ClientRegistration.withClientRegistration(oAuth2AuthorizedClient.getClientRegistration()).authorizationGrantType(AuthorizationGrantType.REFRESH_TOKEN);\r\n            oAuth2AuthorizedClient = authorizedClientManager.authorize(authorizeRequest);\r\n        }\r\n\r\n        if(oAuth2AuthorizedClient != null) {\r\n\r\n            ClientRegistration clientRegistration = oAuth2AuthorizedClient.getClientRegistration();\r\n            OAuth2AccessToken accessToken = oAuth2AuthorizedClient.getAccessToken();\r\n            OAuth2RefreshToken refreshToken = oAuth2AuthorizedClient.getRefreshToken();\r\n\r\n            OAuth2UserService oAuth2UserService = new DefaultOAuth2UserService();\r\n\r\n            // 사용자 정보 가져오는 함수\r\n            OAuth2User oauth2User = oAuth2UserService.loadUser(new OAuth2UserRequest(\r\n                    oAuth2AuthorizedClient.getClientRegistration(), accessToken));\r\n\r\n            // 권한 매핑\r\n            SimpleAuthorityMapper simpleAuthorityMapper = new SimpleAuthorityMapper();\r\n            simpleAuthorityMapper.setPrefix(&quot;&quot;); // SYSTEM_ 이런식으로 prefix 줄 수 있음\r\n            Collection<? extends GrantedAuthority> authorities = simpleAuthorityMapper.mapAuthorities(oauth2User.getAuthorities());\r\n            OAuth2AuthenticationToken oAuth2AuthenticationToken = new OAuth2AuthenticationToken(oauth2User, authorities, clientRegistration.getRegistrationId());\r\n\r\n            SecurityContext context = SecurityContextHolder.createEmptyContext();\r\n            context.setAuthentication(oAuth2AuthenticationToken);\r\n            SecurityContextHolder.setContext(context);\r\n\r\n            authorizationSuccessHandler.onAuthorizationSuccess(oAuth2AuthorizedClient, oAuth2AuthenticationToken, createAttributes(servletRequest, servletResponse));\r\n            model.addAttribute(&quot;oAuth2AuthenticationToken&quot;,oAuth2AuthenticationToken);\r\n        }\r\n\r\n        return &quot;home&quot;;\r\n    }\r\n\r\n    private static Map<String, Object> createAttributes(HttpServletRequest servletRequest, HttpServletResponse servletResponse) {\r\n        Map<String, Object> attributes = new HashMap<>();\r\n        attributes.put(HttpServletRequest.class.getName(), servletRequest);\r\n        attributes.put(HttpServletResponse.class.getName(), servletResponse);\r\n        return attributes;\r\n    }\r\n\r\n    @GetMapping(&quot;/logout&quot;)\r\n    public String logout(HttpServletRequest servletRequest, HttpServletResponse servletResponse, Authentication authentication){\r\n        SecurityContextLogoutHandler logoutHandler = new SecurityContextLogoutHandler();\r\n        logoutHandler.logout(servletRequest, servletResponse, authentication);\r\n        return &quot;index&quot;;\r\n    }\r\n\r\n    private boolean hasTokenExpired(OAuth2Token token) {\r\n        return this.clock.instant().isAfter(token.getExpiresAt().minus(this.clockSkew));\r\n    }\r\n}`, `98047929994976890000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                복사<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Controller</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">LoginController</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Autowired</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">DefaultOAuth2AuthorizedClientManager</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizedClientManager</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Autowired</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">OAuth2AuthorizedClientRepository</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizedClientRepository</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Duration</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clockSkew</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Duration</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ofSeconds</span><span class=\"mtk1\">(</span><span class=\"mtk7\">3600</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Clock</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clock</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Clock</span><span class=\"mtk1\">.</span><span class=\"mtk11\">systemUTC</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">GetMapping</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/oauth2Login&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk11\">oauth2Login</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Model</span><span class=\"mtk1\"> </span><span class=\"mtk12\">model</span><span class=\"mtk1\">, </span><span class=\"mtk10\">HttpServletResponse</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletResponse</span><span class=\"mtk1\">, </span><span class=\"mtk10\">HttpServletRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletRequest</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">IOException</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Authentication</span><span class=\"mtk1\"> </span><span class=\"mtk12\">principal</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">SecurityContextHolder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getContext</span><span class=\"mtk1\">().</span><span class=\"mtk11\">getAuthentication</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (principal == </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            principal = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">AnonymousAuthenticationToken</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;anonymous&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;anonymousUser&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">AuthorityUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">createAuthorityList</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;ROLE_ANONYMOUS&quot;</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2AuthorizeRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizeRequest</span><span class=\"mtk1\"> = </span><span class=\"mtk10\">OAuth2AuthorizeRequest</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">withClientRegistrationId</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;keycloak&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">principal</span><span class=\"mtk1\">(principal)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">attribute</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">(), servletRequest)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">attribute</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletResponse</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">(), servletResponse)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2AuthorizationSuccessHandler</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizationSuccessHandler</span><span class=\"mtk1\"> = (authorizedClient, authentication, attributes) </span><span class=\"mtk4\">-&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                authorizedClientRepository</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">saveAuthorizedClient</span><span class=\"mtk1\">(authorizedClient, authentication,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                (HttpServletRequest) </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">get</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">()),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                (HttpServletResponse) </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">get</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletResponse</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">()));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">authorizedClientManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setAuthorizationSuccessHandler</span><span class=\"mtk1\">(authorizationSuccessHandler);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2AuthorizedClient</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">authorizedClientManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorize</span><span class=\"mtk1\">(authorizeRequest);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (oAuth2AuthorizedClient != </span><span class=\"mtk4\">null</span><span class=\"mtk1\"> &amp;&amp; </span><span class=\"mtk11\">hasTokenExpired</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getAccessToken</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                &amp;&amp; </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getRefreshToken</span><span class=\"mtk1\">() != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">ClientRegistration</span><span class=\"mtk1\">.</span><span class=\"mtk11\">withClientRegistration</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getClientRegistration</span><span class=\"mtk1\">()).</span><span class=\"mtk11\">authorizationGrantType</span><span class=\"mtk1\">(</span><span class=\"mtk12\">AuthorizationGrantType</span><span class=\"mtk1\">.</span><span class=\"mtk12\">REFRESH_TOKEN</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            oAuth2AuthorizedClient = </span><span class=\"mtk12\">authorizedClientManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorize</span><span class=\"mtk1\">(authorizeRequest);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\">(oAuth2AuthorizedClient != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">ClientRegistration</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistration</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getClientRegistration</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2AccessToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">accessToken</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getAccessToken</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2RefreshToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">refreshToken</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getRefreshToken</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2UserService</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2UserService</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DefaultOAuth2UserService</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// 사용자 정보 가져오는 함수</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2User</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oauth2User</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2UserService</span><span class=\"mtk1\">.</span><span class=\"mtk11\">loadUser</span><span class=\"mtk1\">(</span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">OAuth2UserRequest</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getClientRegistration</span><span class=\"mtk1\">(), accessToken));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// 권한 매핑</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">SimpleAuthorityMapper</span><span class=\"mtk1\"> </span><span class=\"mtk12\">simpleAuthorityMapper</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">SimpleAuthorityMapper</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">simpleAuthorityMapper</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setPrefix</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">); </span><span class=\"mtk3\">// SYSTEM_ 이런식으로 prefix 줄 수 있음</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">Collection</span><span class=\"mtk1\">&lt;</span><span class=\"mtk4\">?</span><span class=\"mtk1\"> </span><span class=\"mtk4\">extends</span><span class=\"mtk1\"> </span><span class=\"mtk10\">GrantedAuthority</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">authorities</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">simpleAuthorityMapper</span><span class=\"mtk1\">.</span><span class=\"mtk11\">mapAuthorities</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oauth2User</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getAuthorities</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2AuthenticationToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthenticationToken</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">OAuth2AuthenticationToken</span><span class=\"mtk1\">(oauth2User, authorities, </span><span class=\"mtk12\">clientRegistration</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getRegistrationId</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">SecurityContext</span><span class=\"mtk1\"> </span><span class=\"mtk12\">context</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">SecurityContextHolder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">createEmptyContext</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">context</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setAuthentication</span><span class=\"mtk1\">(oAuth2AuthenticationToken);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">SecurityContextHolder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setContext</span><span class=\"mtk1\">(context);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">authorizationSuccessHandler</span><span class=\"mtk1\">.</span><span class=\"mtk11\">onAuthorizationSuccess</span><span class=\"mtk1\">(oAuth2AuthorizedClient, oAuth2AuthenticationToken, </span><span class=\"mtk11\">createAttributes</span><span class=\"mtk1\">(servletRequest, servletResponse));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">model</span><span class=\"mtk1\">.</span><span class=\"mtk11\">addAttribute</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;oAuth2AuthenticationToken&quot;</span><span class=\"mtk1\">,oAuth2AuthenticationToken);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;home&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Object</span><span class=\"mtk1\">&gt; </span><span class=\"mtk11\">createAttributes</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpServletRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletRequest</span><span class=\"mtk1\">, </span><span class=\"mtk10\">HttpServletResponse</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletResponse</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Object</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">HashMap</span><span class=\"mtk1\">&lt;&gt;();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">(), servletRequest);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletResponse</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">(), servletResponse);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> attributes;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">GetMapping</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/logout&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk11\">logout</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpServletRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletRequest</span><span class=\"mtk1\">, </span><span class=\"mtk10\">HttpServletResponse</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletResponse</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Authentication</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authentication</span><span class=\"mtk1\">){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">SecurityContextLogoutHandler</span><span class=\"mtk1\"> </span><span class=\"mtk12\">logoutHandler</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">SecurityContextLogoutHandler</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">logoutHandler</span><span class=\"mtk1\">.</span><span class=\"mtk11\">logout</span><span class=\"mtk1\">(servletRequest, servletResponse, authentication);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;index&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">boolean</span><span class=\"mtk1\"> </span><span class=\"mtk11\">hasTokenExpired</span><span class=\"mtk1\">(</span><span class=\"mtk10\">OAuth2Token</span><span class=\"mtk1\"> </span><span class=\"mtk12\">token</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">clock</span><span class=\"mtk1\">.</span><span class=\"mtk11\">instant</span><span class=\"mtk1\">().</span><span class=\"mtk11\">isAfter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getExpiresAt</span><span class=\"mtk1\">().</span><span class=\"mtk11\">minus</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">clockSkew</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h3 id=\"client-credentials-refresh-token\" style=\"position:relative;\"><a href=\"#client-credentials-refresh-token\" aria-label=\"client credentials refresh token permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Client Credentials, Refresh Token</h3>\n<p>Credentials는 Resource Owner Password Flow 로직과 대부분 유사한데</p>\n<p>권한 부여에 따른 처리 하는 클래스들이 차이가 난다.</p>\n<p>해당 부분의 Config를 수정하면서 구현</p>\n<p>Refresh Token은 위에 적용이 되어있는데 App Config와 controller에 처리하는 부분을 추가하면 된다.</p>\n<h3 id=\"custom-login-filter\" style=\"position:relative;\"><a href=\"#custom-login-filter\" aria-label=\"custom login filter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Custom Login Filter</h3>\n<p>이전까지 과정은 Client Manager를 이용해 Spring MVC에서 Login Controller에서 인가처리를 했는데</p>\n<p>Spring Security에서 지원하는 Filter 기반으로 적용이 가능</p>\n<p>인가 처리 로직은 이전과 동일하고 Config 설정에서 Filter 등록을 한다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"11797202260015682000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"복사 되었습니다!\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`@Configuration(proxyBeanMethods = false)\r\npublic class OAuth2ClientConfig {\r\n\r\n    @Autowired\r\n    private DefaultOAuth2AuthorizedClientManager authorizedClientManager;\r\n\r\n    @Autowired\r\n    private OAuth2AuthorizedClientRepository authorizedClientRepository;\r\n\r\n    @Bean\r\n    SecurityFilterChain oauth2SecurityFilterChain(HttpSecurity http) throws Exception {\r\n                http.authorizeRequests((requests) -> requests.antMatchers(&quot;/&quot;,&quot;/oauth2Login&quot;,&quot;/logout&quot;).permitAll().anyRequest().authenticated());\r\n        http\r\n//                .oauth2Login().and()\r\n                .oauth2Client()\r\n                .and()\r\n                .addFilterBefore(customOAuth2LoginAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class)\r\n        ;\r\n        return http.build();\r\n    }\r\n\r\n    public CustomOAuth2LoginAuthenticationFilter customOAuth2LoginAuthenticationFilter() throws Exception {\r\n        CustomOAuth2LoginAuthenticationFilter customOAuth2LoginAuthenticationFilter =\r\n                new CustomOAuth2LoginAuthenticationFilter(authorizedClientManager,authorizedClientRepository);\r\n        customOAuth2LoginAuthenticationFilter.setAuthenticationSuccessHandler((request, response, authentication) -> {\r\n            response.sendRedirect(&quot;/home&quot;);\r\n        });\r\n        return customOAuth2LoginAuthenticationFilter;\r\n    }`, `11797202260015682000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                복사<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Configuration</span><span class=\"mtk1\">(proxyBeanMethods = </span><span class=\"mtk4\">false</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2ClientConfig</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Autowired</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">DefaultOAuth2AuthorizedClientManager</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizedClientManager</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Autowired</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizedClientRepository</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizedClientRepository</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">SecurityFilterChain</span><span class=\"mtk1\"> </span><span class=\"mtk11\">oauth2SecurityFilterChain</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpSecurity</span><span class=\"mtk1\"> </span><span class=\"mtk12\">http</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Exception</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorizeRequests</span><span class=\"mtk1\">((requests) </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">requests</span><span class=\"mtk1\">.</span><span class=\"mtk11\">antMatchers</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;/oauth2Login&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;/logout&quot;</span><span class=\"mtk1\">).</span><span class=\"mtk11\">permitAll</span><span class=\"mtk1\">().</span><span class=\"mtk11\">anyRequest</span><span class=\"mtk1\">().</span><span class=\"mtk11\">authenticated</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        http</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//                .oauth2Login().and()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">oauth2Client</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">and</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">addFilterBefore</span><span class=\"mtk1\">(</span><span class=\"mtk11\">customOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\">(), </span><span class=\"mtk12\">UsernamePasswordAuthenticationFilter</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        ;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">CustomOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\"> </span><span class=\"mtk11\">customOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\">() </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Exception</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">CustomOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\"> </span><span class=\"mtk12\">customOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\"> =</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">CustomOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\">(authorizedClientManager,authorizedClientRepository);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">customOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setAuthenticationSuccessHandler</span><span class=\"mtk1\">((request, response, authentication) </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">response</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sendRedirect</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/home&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> customOAuth2LoginAuthenticationFilter;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>customOAuth2LoginAuthenticationFilter 설정을 살펴보면</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"45155639511832610000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"복사 되었습니다!\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`public class CustomOAuth2LoginAuthenticationFilter extends AbstractAuthenticationProcessingFilter {\r\n\r\n    public static final String DEFAULT_FILTER_PROCESSES_URI = &quot;/oauth2Login/**&quot;;\r\n    private OAuth2AuthorizedClientRepository authorizedClientRepository;\r\n    private DefaultOAuth2AuthorizedClientManager oAuth2AuthorizedClientManager;\r\n    private OAuth2AuthorizationSuccessHandler authorizationSuccessHandler;\r\n\r\n    private OAuth2AuthorizationFailureHandler authorizationFailureHandler;\r\n\r\n    private Duration clockSkew = Duration.ofSeconds(3600);\r\n\r\n    private Clock clock = Clock.systemUTC();\r\n\r\n    public CustomOAuth2LoginAuthenticationFilter(DefaultOAuth2AuthorizedClientManager oAuth2AuthorizedClientManager, OAuth2AuthorizedClientRepository oAuth2AuthorizedClientRepository) {\r\n        super(DEFAULT_FILTER_PROCESSES_URI);\r\n        this.oAuth2AuthorizedClientManager = oAuth2AuthorizedClientManager;\r\n        this.authorizedClientRepository = oAuth2AuthorizedClientRepository;\r\n\r\n        this.authorizationSuccessHandler = (authorizedClient, authentication, attributes) ->\r\n                authorizedClientRepository\r\n                        .saveAuthorizedClient(authorizedClient, authentication,\r\n                                (HttpServletRequest) attributes.get(HttpServletRequest.class.getName()),\r\n                                (HttpServletResponse) attributes.get(HttpServletResponse.class.getName()));\r\n        this.oAuth2AuthorizedClientManager.setAuthorizationSuccessHandler(authorizationSuccessHandler);\r\n    }\r\n\r\n    @Override\r\n    public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response) throws AuthenticationException, IOException, ServletException {\r\n\r\n        Authentication principal = SecurityContextHolder.getContext().getAuthentication();\r\n\r\n        if (principal == null) {\r\n            principal = new AnonymousAuthenticationToken(&quot;anonymous&quot;, &quot;anonymousUser&quot;, AuthorityUtils.createAuthorityList(&quot;ROLE_ANONYMOUS&quot;));\r\n        }\r\n\r\n        OAuth2AuthorizeRequest authorizeRequest = OAuth2AuthorizeRequest\r\n                .withClientRegistrationId(&quot;keycloak&quot;)\r\n                .principal(principal)\r\n                .attribute(HttpServletRequest.class.getName(), request)\r\n                .attribute(HttpServletResponse.class.getName(), response)\r\n                .build();\r\n\r\n        OAuth2AuthorizedClient oAuth2AuthorizedClient = oAuth2AuthorizedClientManager.authorize(authorizeRequest);\r\n\r\n        if (oAuth2AuthorizedClient != null && hasTokenExpired(oAuth2AuthorizedClient.getAccessToken())\r\n                && oAuth2AuthorizedClient.getRefreshToken() != null) {\r\n            ClientRegistration.withClientRegistration(oAuth2AuthorizedClient.getClientRegistration()).authorizationGrantType(AuthorizationGrantType.REFRESH_TOKEN);\r\n            oAuth2AuthorizedClient = oAuth2AuthorizedClientManager.authorize(authorizeRequest);\r\n        }\r\n\r\n        if (oAuth2AuthorizedClient != null) {\r\n            ClientRegistration clientRegistration = oAuth2AuthorizedClient.getClientRegistration();\r\n            OAuth2AccessToken accessToken = oAuth2AuthorizedClient.getAccessToken();\r\n            OAuth2RefreshToken refreshToken = oAuth2AuthorizedClient.getRefreshToken();\r\n\r\n            OAuth2UserService oAuth2UserService = new DefaultOAuth2UserService();\r\n            OAuth2User oauth2User = oAuth2UserService.loadUser(new OAuth2UserRequest(\r\n                    oAuth2AuthorizedClient.getClientRegistration(), accessToken));\r\n\r\n            SimpleAuthorityMapper simpleAuthorityMapper = new SimpleAuthorityMapper();\r\n            Collection<? extends GrantedAuthority> authorities = simpleAuthorityMapper.mapAuthorities(oauth2User.getAuthorities());\r\n            OAuth2AuthenticationToken oAuth2AuthenticationToken = new OAuth2AuthenticationToken(oauth2User, authorities, clientRegistration.getRegistrationId());\r\n\r\n            // 인증 받은 사용자를 저장해줘야 한다.\r\n            authorizationSuccessHandler.onAuthorizationSuccess(oAuth2AuthorizedClient, oAuth2AuthenticationToken, createAttributes(request, response));\r\n\r\n            return oAuth2AuthenticationToken;\r\n        }\r\n\r\n        return null;\r\n\r\n    }\r\n\r\n    private static Map<String, Object> createAttributes(HttpServletRequest servletRequest, HttpServletResponse servletResponse) {\r\n        Map<String, Object> attributes = new HashMap<>();\r\n        attributes.put(HttpServletRequest.class.getName(), servletRequest);\r\n        attributes.put(HttpServletResponse.class.getName(), servletResponse);\r\n        return attributes;\r\n    }\r\n\r\n    private boolean hasTokenExpired(OAuth2Token token) {\r\n        return this.clock.instant().isAfter(token.getExpiresAt().minus(this.clockSkew));\r\n    }\r\n}`, `45155639511832610000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                복사<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">CustomOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\"> </span><span class=\"mtk4\">extends</span><span class=\"mtk1\"> </span><span class=\"mtk10\">AbstractAuthenticationProcessingFilter</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">DEFAULT_FILTER_PROCESSES_URI</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;/oauth2Login/**&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizedClientRepository</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizedClientRepository</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">DefaultOAuth2AuthorizedClientManager</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthorizedClientManager</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizationSuccessHandler</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizationSuccessHandler</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizationFailureHandler</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizationFailureHandler</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Duration</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clockSkew</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Duration</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ofSeconds</span><span class=\"mtk1\">(</span><span class=\"mtk7\">3600</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Clock</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clock</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Clock</span><span class=\"mtk1\">.</span><span class=\"mtk11\">systemUTC</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">CustomOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\">(</span><span class=\"mtk10\">DefaultOAuth2AuthorizedClientManager</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthorizedClientManager</span><span class=\"mtk1\">, </span><span class=\"mtk10\">OAuth2AuthorizedClientRepository</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthorizedClientRepository</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">super</span><span class=\"mtk1\">(DEFAULT_FILTER_PROCESSES_URI);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">oAuth2AuthorizedClientManager</span><span class=\"mtk1\"> = oAuth2AuthorizedClientManager;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">authorizedClientRepository</span><span class=\"mtk1\"> = oAuth2AuthorizedClientRepository;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">authorizationSuccessHandler</span><span class=\"mtk1\"> = (authorizedClient, authentication, attributes) </span><span class=\"mtk4\">-&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                authorizedClientRepository</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">saveAuthorizedClient</span><span class=\"mtk1\">(authorizedClient, authentication,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                (HttpServletRequest) </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">get</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">()),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                (HttpServletResponse) </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">get</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletResponse</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">()));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">oAuth2AuthorizedClientManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setAuthorizationSuccessHandler</span><span class=\"mtk1\">(authorizationSuccessHandler);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Authentication</span><span class=\"mtk1\"> </span><span class=\"mtk11\">attemptAuthentication</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpServletRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">request</span><span class=\"mtk1\">, </span><span class=\"mtk10\">HttpServletResponse</span><span class=\"mtk1\"> </span><span class=\"mtk12\">response</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">AuthenticationException</span><span class=\"mtk1\">, </span><span class=\"mtk10\">IOException</span><span class=\"mtk1\">, </span><span class=\"mtk10\">ServletException</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Authentication</span><span class=\"mtk1\"> </span><span class=\"mtk12\">principal</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">SecurityContextHolder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getContext</span><span class=\"mtk1\">().</span><span class=\"mtk11\">getAuthentication</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (principal == </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            principal = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">AnonymousAuthenticationToken</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;anonymous&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;anonymousUser&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">AuthorityUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">createAuthorityList</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;ROLE_ANONYMOUS&quot;</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2AuthorizeRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizeRequest</span><span class=\"mtk1\"> = </span><span class=\"mtk10\">OAuth2AuthorizeRequest</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">withClientRegistrationId</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;keycloak&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">principal</span><span class=\"mtk1\">(principal)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">attribute</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">(), request)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">attribute</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletResponse</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">(), response)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2AuthorizedClient</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2AuthorizedClientManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorize</span><span class=\"mtk1\">(authorizeRequest);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (oAuth2AuthorizedClient != </span><span class=\"mtk4\">null</span><span class=\"mtk1\"> &amp;&amp; </span><span class=\"mtk11\">hasTokenExpired</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getAccessToken</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                &amp;&amp; </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getRefreshToken</span><span class=\"mtk1\">() != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">ClientRegistration</span><span class=\"mtk1\">.</span><span class=\"mtk11\">withClientRegistration</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getClientRegistration</span><span class=\"mtk1\">()).</span><span class=\"mtk11\">authorizationGrantType</span><span class=\"mtk1\">(</span><span class=\"mtk12\">AuthorizationGrantType</span><span class=\"mtk1\">.</span><span class=\"mtk12\">REFRESH_TOKEN</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            oAuth2AuthorizedClient = </span><span class=\"mtk12\">oAuth2AuthorizedClientManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorize</span><span class=\"mtk1\">(authorizeRequest);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (oAuth2AuthorizedClient != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">ClientRegistration</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistration</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getClientRegistration</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2AccessToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">accessToken</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getAccessToken</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2RefreshToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">refreshToken</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getRefreshToken</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2UserService</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2UserService</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DefaultOAuth2UserService</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2User</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oauth2User</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2UserService</span><span class=\"mtk1\">.</span><span class=\"mtk11\">loadUser</span><span class=\"mtk1\">(</span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">OAuth2UserRequest</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getClientRegistration</span><span class=\"mtk1\">(), accessToken));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">SimpleAuthorityMapper</span><span class=\"mtk1\"> </span><span class=\"mtk12\">simpleAuthorityMapper</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">SimpleAuthorityMapper</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">Collection</span><span class=\"mtk1\">&lt;</span><span class=\"mtk4\">?</span><span class=\"mtk1\"> </span><span class=\"mtk4\">extends</span><span class=\"mtk1\"> </span><span class=\"mtk10\">GrantedAuthority</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">authorities</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">simpleAuthorityMapper</span><span class=\"mtk1\">.</span><span class=\"mtk11\">mapAuthorities</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oauth2User</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getAuthorities</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2AuthenticationToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthenticationToken</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">OAuth2AuthenticationToken</span><span class=\"mtk1\">(oauth2User, authorities, </span><span class=\"mtk12\">clientRegistration</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getRegistrationId</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// 인증 받은 사용자를 저장해줘야 한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">authorizationSuccessHandler</span><span class=\"mtk1\">.</span><span class=\"mtk11\">onAuthorizationSuccess</span><span class=\"mtk1\">(oAuth2AuthorizedClient, oAuth2AuthenticationToken, </span><span class=\"mtk11\">createAttributes</span><span class=\"mtk1\">(request, response));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> oAuth2AuthenticationToken;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">null</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Object</span><span class=\"mtk1\">&gt; </span><span class=\"mtk11\">createAttributes</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpServletRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletRequest</span><span class=\"mtk1\">, </span><span class=\"mtk10\">HttpServletResponse</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletResponse</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Object</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">HashMap</span><span class=\"mtk1\">&lt;&gt;();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">(), servletRequest);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletResponse</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">(), servletResponse);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> attributes;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">boolean</span><span class=\"mtk1\"> </span><span class=\"mtk11\">hasTokenExpired</span><span class=\"mtk1\">(</span><span class=\"mtk10\">OAuth2Token</span><span class=\"mtk1\"> </span><span class=\"mtk12\">token</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">clock</span><span class=\"mtk1\">.</span><span class=\"mtk11\">instant</span><span class=\"mtk1\">().</span><span class=\"mtk11\">isAfter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getExpiresAt</span><span class=\"mtk1\">().</span><span class=\"mtk11\">minus</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">clockSkew</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>코드 설명을 간략히 하면</p>\n<ol>\n<li>CustomOAuth2LoginAuthenticationFilter 생성자 내부에서 default url설정을 해 어떤 경로로 들어오면 filter처리를 할 지 등록시켜 준다.<br>\n(AbstractAuthenticationProcessingFilter 생성자에서 url 등록)</li>\n<li>config설정을 보면 UsernamePasswordAuthenticationFilter 앞에 Filter가 동작하도록 설정해서 MVC Controller에서 처리하는 부분과 다르게 SecurityContextHolder안에 Token이 존재하지 않아 principal이 null일 경우 AnonymousAuthenticationToken을 만들어주는 로직이 필요</li>\n<li>나머지는 위에 MVC 처리 부분과 동일하다</li>\n</ol>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h1>\n<ul>\n<li><a href=\"https://www.inflearn.com/course/%EC%A0%95%EC%88%98%EC%9B%90-%EC%8A%A4%ED%94%84%EB%A7%81-%EC%8B%9C%ED%81%90%EB%A6%AC%ED%8B%B0/dashboard\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">스프링 시큐리티 OAuth2 - Spring Boot 기반으로 개발하는 Spring Security OAuth2</a></li>\n</ul>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .mtk1 { color: #D4D4D4; }\n  .default-dark .mtk10 { color: #4EC9B0; }\n  .default-dark .mtk11 { color: #DCDCAA; }\n  .default-dark .mtk12 { color: #9CDCFE; }\n  .default-dark .mtk4 { color: #569CD6; }\n  .default-dark .mtk15 { color: #C586C0; }\n  .default-dark .mtk8 { color: #CE9178; }\n  .default-dark .mtk3 { color: #6A9955; }\n  .default-dark .mtk7 { color: #B5CEA8; }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#oauth-20-client\">OAuth 2.0 Client</a></p>\n<ul>\n<li><a href=\"#oauth-20-login-api\">OAuth 2.0 Login API</a></li>\n<li><a href=\"#oauth-20-client-api\">OAuth 2.0 Client API</a></li>\n<li><a href=\"#oauth-20-client-fundamentals\">OAuth 2.0 Client Fundamentals</a></li>\n<li><a href=\"#oauth-20-client---oauth2login\">OAuth 2.0 Client - oauth2Login()</a></li>\n<li><a href=\"#oauth-20-client---oauth2client\">OAuth 2.0 Client - oauth2Client()</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#reference\">Reference</a></p>\n</li>\n</ul>","frontmatter":{"title":"Spring Security OAuth2.0 Client","summary":["Spring Security 라이브러리 뜯어보며 알아보자"],"date":"2023.02.08.","update":"2023.02.13.","category":["Spring"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADbklEQVR42nVUSWgUQRTtROOGoiJxS6aqe2ZU0INKRFBQRLx4VYSIuB4iioqamV5mknTE5SYeBDF4EATB5GTArN09PZmMUckkKlFEL3pyP3hRQZMp3+9Jtz0hafjU76r/339/qZKkKZ8QUgVJ8C9JFeZdPs90+byy/bBdaH9GMM2RN6oWu5q0eL9q8deqzd5AXM1iN3C20zSlSrIzBdZJvezzDYzueDUA7mgO+2M+VUTzY1mkBkrSlJdFC/b0DC8iWJc2GGUpu7YmabFDYYxA0Xtr45rDx8xnisA6odl8XLWxWrxIQjqCjdNZyxPP5iPAroB1UzK/bpEUzl+3Vi8zXP6CDOH0F2BiOsHZBIDHmwZlYWTl341WzS6tj+1OuHxTObsMu9UKZmp/CcxjZntshE6S4QIBUQKl2Dwkw46NptzIFvJNZmvWJDJsf1A/I8fWw/gnOXqpQZryimgZQr08cPYH4L9Qt29Irx82JxoKqxb4/vogW2rkeH0AmM7ylOmxY38BWkwjHTgPAOiMbrE9el+sTreUtebzjUvM/x2taCtIVear9XM8UJcf1Kzo4hJDlz9sBhtK0chSmvJZaYaPxqpDSLP8iaBAHqDDDifzkdXeHIHVcGksFKrXJTLo6JBmma40mxh5szllqGlFnevRjJWlHshHVTdeKx2AI+pU8Bg67LNhKyvCTjOxQ/OOa07kiH+mufwYzWQp5QzvvDwapc5a06VJLImxz1LNsHM0/HQt6Z9IpQfkk0EN01m55crLKM2Y7QN46YrJBkwCmX3R5WjUA1zHR6fd6oVBl3tjcTQ0ETDADNahSxNI+Qeoy+H5bCvUVam2shUgN1WUBDW+fbY7PpeCNbRJVZ6/zdNqH99bVmCkfe/aWEykstxqtPguBGnQbHYfnX8H5t+g9yZtZYfv4wfETJ6CTbs0tWOYt6juyKM4bMTtGMGNoCEfgd6qZfnmBjClMhi5ldVqT2QDmrIPGfUg0KeEE4mVPQ5BsdH2i72xSDonj9BVw3B/QM3eI8gXNOw79K/earHf1MR0Xv50vqt0/YJ6T32+Et2RGFLspJpeKkQFPWH0bHlPFx6O1mFFGBm5iFemXe3G3JUxm2bOfB0N2I50rkOyqsPfgtlb0mlPt/g2//rNCBYGDRuZwqy8MFQ7n4T0cEbTDf8/bs8FuH++Hz4AAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/daf23c051d1970bd74a5bdb9fe7de872/5f2c3/thumbnail.png","srcSet":"/static/daf23c051d1970bd74a5bdb9fe7de872/90cd3/thumbnail.png 100w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/614dc/thumbnail.png 200w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/5f2c3/thumbnail.png 400w","sizes":"(min-width: 400px) 400px, 100vw"},"sources":[{"srcSet":"/static/daf23c051d1970bd74a5bdb9fe7de872/e64f1/thumbnail.webp 100w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/8b00d/thumbnail.webp 200w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/9c0a1/thumbnail.webp 400w","type":"image/webp","sizes":"(min-width: 400px) 400px, 100vw"}]},"width":400,"height":400}},"publicURL":"/static/daf23c051d1970bd74a5bdb9fe7de872/thumbnail.png"}}}}]}},"pageContext":{"slug":"/SpringSecurity2_2/","series":[{"slug":"/SpringSecurity2_1/","title":"Spring Security OAuth2.0 개념 파악하기","num":1,"current":false},{"slug":"/SpringSecurity2_2/","title":"Spring Security OAuth2.0 Client","num":2,"current":true}],"lastmod":"2023.02.13.","prev":{"fields":{"slug":"/SpringSecurity2_1/"},"frontmatter":{"title":"Spring Security OAuth2.0 개념 파악하기","date":"2023.02.06.","update":"2023.02.07.","category":["Spring"],"tags":["Spring"],"summary":["Spring Security 라이브러리 뜯어보며 알아보자"]}},"next":{"fields":{"slug":"/gatsbyBlog_1/"},"frontmatter":{"title":"Gatsby Blog Theme 제작기 1 (Gatsby & GraphQL)","date":"2023.07.24.","update":"2023.07.30.","category":["Gatsby"],"tags":["React","Gatsby"],"summary":["Gatsby, GraphQL에 대해 정리한다."]}}}},"staticQueryHashes":["427104293"],"slicesMap":{}}