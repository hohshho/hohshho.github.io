{"componentChunkName":"component---src-templates-post-tsx","path":"/logstashAndQuery/","result":{"data":{"site":{"siteMetadata":{"title":"Just Keep Going","description":"Ian's Archive","siteUrl":"https://hohshho.github.io"}},"allMarkdownRemark":{"edges":[{"node":{"id":"22b47ada-a97c-567d-9897-5e596a2515b8","html":"<h1 id=\"1-out-of-memory-발생\" style=\"position:relative;\"><a href=\"#1-out-of-memory-%EB%B0%9C%EC%83%9D\" aria-label=\"1 out of memory 발생 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. out of memory 발생</h1>\n<p>RDB -> elastic search에 적재를 하는데 데이터가 커서 그런지 Out of memory 발생!</p>\n<p>Docker-compose.yml의 메모리의 크기를 증가시켰다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"39771836247681550000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`services:\n  setup:\n    profiles:\n      - setup\n    build:\n      context: setup/\n      args:\n        ELASTIC_VERSION: \\${ELASTIC_VERSION}\n    init: true\n    volumes:\n      - ./setup/entrypoint.sh:/entrypoint.sh:ro,Z\n      - ./setup/lib.sh:/lib.sh:ro,Z\n      - ./setup/roles:/roles:ro,Z\n    environment:\n      ELASTIC_PASSWORD: \\${ELASTIC_PASSWORD:-}\n      LOGSTASH_INTERNAL_PASSWORD: \\${LOGSTASH_INTERNAL_PASSWORD:-}\n      KIBANA_SYSTEM_PASSWORD: \\${KIBANA_SYSTEM_PASSWORD:-}\n      METRICBEAT_INTERNAL_PASSWORD: \\${METRICBEAT_INTERNAL_PASSWORD:-}\n      FILEBEAT_INTERNAL_PASSWORD: \\${FILEBEAT_INTERNAL_PASSWORD:-}\n      HEARTBEAT_INTERNAL_PASSWORD: \\${HEARTBEAT_INTERNAL_PASSWORD:-}\n      MONITORING_INTERNAL_PASSWORD: \\${MONITORING_INTERNAL_PASSWORD:-}\n      BEATS_SYSTEM_PASSWORD: \\${BEATS_SYSTEM_PASSWORD:-}\n    networks:\n      - elk\n    depends_on:\n      - elasticsearch\n      - kibana\n      - logstash\n  elasticsearch:\n    build:\n      context: elasticsearch/\n      args:\n        ELASTIC_VERSION: \\${ELASTIC_VERSION}\n    volumes:\n      - ./elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro,Z\n      - elasticsearch:/usr/share/elasticsearch/data:Z\n    ports:\n      - 9200:9200\n      - 9300:9300\n    environment:\n      node.name: elasticsearch\n      ES_JAVA_OPTS: -Xms8g -Xmx8g\n    build:\n      context: logstash/\n      args:\n        ELASTIC_VERSION: \\${ELASTIC_VERSION}\n    volumes:\n      - ./logstash/config/logstash.yml:/usr/share/logstash/config/logstash.yml:ro,Z\n      - ./logstash/pipeline:/usr/share/logstash/pipeline:ro,Z\n      - ./logstash/config/pipelinse.yml:/usr/share/logstash/config/pipelines.yml:ro,Z\n      - ./logstash/input:/usr/share/logstash/input:ro,Z\n      - ./logstash/config/postgresql-42.7.2.jar:/usr/share/logstash/logstash-core/lib/jars/postgresql-42.7.2.jar\n      - ./logstash/state:/usr/share/logstash/state:rw,Z\n    ports:\n      - 5044:5044\n      - 50000:50000/tcp\n      - 50000:50000/udp\n      - 9600:9600\n    environment:\n      LS_JAVA_OPTS: -Xms20g -Xmx20g\n      LOGSTASH_INTERNAL_PASSWORD: \\${LOGSTASH_INTERNAL_PASSWORD:-}\n    deploy:\n      resources:\n        limits:\n          memory: 24G\n          cpus: '8.0'\n        reservations:\n          memory: 16G\n          cpus: '4.0'\n    networks:\n      - elk\n    depends_on:\n      - elasticsearch\n    restart: unless-stopped\n\n  kibana:\n    build:\n      context: kibana/\n      args:\n        ELASTIC_VERSION: \\${ELASTIC_VERSION}\n    volumes:\n      - ./kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml:ro,Z\n    ports:\n      - 5601:5601\n    environment:\n      KIBANA_SYSTEM_PASSWORD: \\${KIBANA_SYSTEM_PASSWORD:-}\n      NODE_OPTIONS: --max-old-space-size=2048\n    networks:\n      - elk\n    depends_on:\n      - elasticsearch\n    restart: unless-stopped\n\nnetworks:\n  elk:\n    driver: bridge\n\nvolumes:\n  elasticsearch:`, `39771836247681550000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"json\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">services:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  setup:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    profiles:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - setup</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    build:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      context: setup/</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      args:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        ELASTIC_VERSION: ${</span><span class=\"mtk14\">ELASTIC_VERSION</span><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    init: </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    volumes:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - ./setup/entrypoint.sh:/entrypoint.sh:ro,Z</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - ./setup/lib.sh:/lib.sh:ro,Z</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - ./setup/roles:/roles:ro,Z</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    environment:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      ELASTIC_PASSWORD: ${</span><span class=\"mtk14\">ELASTIC_PASSWORD</span><span class=\"mtk1\">:</span><span class=\"mtk14\">-</span><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"16\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      LOGSTASH_INTERNAL_PASSWORD: ${</span><span class=\"mtk14\">LOGSTASH_INTERNAL_PASSWORD</span><span class=\"mtk1\">:</span><span class=\"mtk14\">-</span><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"17\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      KIBANA_SYSTEM_PASSWORD: ${</span><span class=\"mtk14\">KIBANA_SYSTEM_PASSWORD</span><span class=\"mtk1\">:</span><span class=\"mtk14\">-</span><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"18\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      METRICBEAT_INTERNAL_PASSWORD: ${</span><span class=\"mtk14\">METRICBEAT_INTERNAL_PASSWORD</span><span class=\"mtk1\">:</span><span class=\"mtk14\">-</span><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"19\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      FILEBEAT_INTERNAL_PASSWORD: ${</span><span class=\"mtk14\">FILEBEAT_INTERNAL_PASSWORD</span><span class=\"mtk1\">:</span><span class=\"mtk14\">-</span><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"20\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      HEARTBEAT_INTERNAL_PASSWORD: ${</span><span class=\"mtk14\">HEARTBEAT_INTERNAL_PASSWORD</span><span class=\"mtk1\">:</span><span class=\"mtk14\">-</span><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"21\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      MONITORING_INTERNAL_PASSWORD: ${</span><span class=\"mtk14\">MONITORING_INTERNAL_PASSWORD</span><span class=\"mtk1\">:</span><span class=\"mtk14\">-</span><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"22\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      BEATS_SYSTEM_PASSWORD: ${</span><span class=\"mtk14\">BEATS_SYSTEM_PASSWORD</span><span class=\"mtk1\">:</span><span class=\"mtk14\">-</span><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"23\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    networks:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"24\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - elk</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"25\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    depends_on:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"26\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - elasticsearch</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"27\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - kibana</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"28\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - logstash</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"29\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  elasticsearch:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"30\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    build:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"31\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      context: elasticsearch/</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"32\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      args:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"33\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        ELASTIC_VERSION: ${</span><span class=\"mtk14\">ELASTIC_VERSION</span><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"34\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    volumes:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"35\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - ./elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro,Z</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"36\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - elasticsearch:/usr/share/elasticsearch/data:Z</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"37\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    ports:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"38\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk7\">9200</span><span class=\"mtk1\">:</span><span class=\"mtk7\">9200</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"39\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk7\">9300</span><span class=\"mtk1\">:</span><span class=\"mtk7\">9300</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"40\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    environment:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"41\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      node.name: elasticsearch</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"42\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      ES_JAVA_OPTS: -Xms</span><span class=\"mtk7\">8</span><span class=\"mtk1\">g -Xmx</span><span class=\"mtk7\">8</span><span class=\"mtk1\">g</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"43\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    build:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"44\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      context: logstash/</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"45\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      args:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"46\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        ELASTIC_VERSION: ${</span><span class=\"mtk14\">ELASTIC_VERSION</span><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"47\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    volumes:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"48\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - ./logstash/config/logstash.yml:/usr/share/logstash/config/logstash.yml:ro,Z</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"49\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - ./logstash/pipeline:/usr/share/logstash/pipeline:ro,Z</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"50\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - ./logstash/config/pipelinse.yml:/usr/share/logstash/config/pipelines.yml:ro,Z</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"51\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - ./logstash/input:/usr/share/logstash/input:ro,Z</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"52\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - ./logstash/config/postgresql</span><span class=\"mtk7\">-42.7</span><span class=\"mtk1\">.</span><span class=\"mtk7\">2</span><span class=\"mtk1\">.jar:/usr/share/logstash/logstash-core/lib/jars/postgresql</span><span class=\"mtk7\">-42.7</span><span class=\"mtk1\">.</span><span class=\"mtk7\">2</span><span class=\"mtk1\">.jar</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"53\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - ./logstash/state:/usr/share/logstash/state:rw,Z</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"54\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    ports:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"55\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk7\">5044</span><span class=\"mtk1\">:</span><span class=\"mtk7\">5044</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"56\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk7\">50000</span><span class=\"mtk1\">:</span><span class=\"mtk7\">50000</span><span class=\"mtk1\">/tcp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"57\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk7\">50000</span><span class=\"mtk1\">:</span><span class=\"mtk7\">50000</span><span class=\"mtk1\">/udp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"58\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk7\">9600</span><span class=\"mtk1\">:</span><span class=\"mtk7\">9600</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"59\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    environment:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"60\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      LS_JAVA_OPTS: -Xms</span><span class=\"mtk7\">20</span><span class=\"mtk1\">g -Xmx</span><span class=\"mtk7\">20</span><span class=\"mtk1\">g</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"61\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      LOGSTASH_INTERNAL_PASSWORD: ${</span><span class=\"mtk14\">LOGSTASH_INTERNAL_PASSWORD</span><span class=\"mtk1\">:</span><span class=\"mtk14\">-</span><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"62\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    deploy:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"63\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      resources:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"64\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        limits:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"65\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          memory: </span><span class=\"mtk7\">24</span><span class=\"mtk1\">G</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"66\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          cpus: &#39;</span><span class=\"mtk7\">8.0</span><span class=\"mtk1\">&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"67\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        reservations:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"68\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          memory: </span><span class=\"mtk7\">16</span><span class=\"mtk1\">G</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"69\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          cpus: &#39;</span><span class=\"mtk7\">4.0</span><span class=\"mtk1\">&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"70\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    networks:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"71\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - elk</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"72\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    depends_on:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"73\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - elasticsearch</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"74\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    restart: unless-stopped</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"75\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"76\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  kibana:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"77\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    build:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"78\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      context: kibana/</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"79\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      args:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"80\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        ELASTIC_VERSION: ${</span><span class=\"mtk14\">ELASTIC_VERSION</span><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"81\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    volumes:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"82\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - ./kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml:ro,Z</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"83\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    ports:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"84\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk7\">5601</span><span class=\"mtk1\">:</span><span class=\"mtk7\">5601</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"85\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    environment:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"86\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      KIBANA_SYSTEM_PASSWORD: ${</span><span class=\"mtk14\">KIBANA_SYSTEM_PASSWORD</span><span class=\"mtk1\">:</span><span class=\"mtk14\">-</span><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"87\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      NODE_OPTIONS: --max-old-space-size=</span><span class=\"mtk7\">2048</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"88\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    networks:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"89\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - elk</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"90\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    depends_on:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"91\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      - elasticsearch</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"92\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    restart: unless-stopped</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"93\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"94\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">networks:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"95\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  elk:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"96\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    driver: bridge</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"97\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"98\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">volumes:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"99\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  elasticsearch:</span></span></span></code></pre>\n<ul>\n<li>주의 사항으로는 logstash 만 메모리를 올리는게 아니라 Elastic search도 함께 메모리를 증가시켜줘야 한다.</li>\n<li><strong>environment 섹션: 컨테이너 내부 환경변수 설정</strong>\n<ul>\n<li>LS_JAVA_OPTS: -Xms20g -Xmx20g\n<ul>\n<li><strong>무엇을 하는가?</strong>: Logstash는 Java로 만들어진 애플리케이션(JVM 위에서 동작)입니다. 이 설정은 Logstash가 사용하는 <strong>JVM의 힙(Heap) 메모리 크기를 지정</strong></li>\n<li>-Xms20g: <strong>최소 힙 메모리</strong></li>\n<li>-Xmx20g: <strong>최대 힙 메모리</strong></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>deploy 섹션: 컨테이너 외부 자원 할당 (Docker에게 지시)</strong>\n<ul>\n<li>이 컨테이너에 얼마만큼의 <strong>호스트 머신 자원(CPU, Memory)을 할당할지</strong> 지시합니다.</li>\n<li>Memory(16G ~ 24G)와 CPU(4.0 ~ 8.0) 할당</li>\n</ul>\n</li>\n</ul>\n<p><strong>컨테이너 메모리 한도 (24GB) > JVM 최대 힙 크기 (20GB)</strong></p>\n<p>이렇게 힙 크기 + 여유 공간으로 설정해야, Logstash가 힙을 20GB까지 다 사용하더라도 컨테이너가 갑자기 종료되는 것을 막을 수 있다.</p>\n<h1 id=\"2-jdbc로-적재-시-너무-느린-속도\" style=\"position:relative;\"><a href=\"#2-jdbc%EB%A1%9C-%EC%A0%81%EC%9E%AC-%EC%8B%9C-%EB%84%88%EB%AC%B4-%EB%8A%90%EB%A6%B0-%EC%86%8D%EB%8F%84\" aria-label=\"2 jdbc로 적재 시 너무 느린 속도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. JDBC로 적재 시 너무 느린 속도</h1>\n<ul>\n<li>적재를 할 때 테이블에 count()함수를 실행 후, 쿼리문을 통해 데이터를 가져와 적재하는 방식\n<ul>\n<li>view 테이블이라 한테이블은 적재가 불가능한 상황 (3700만건)</li>\n<li>나머지 2테이블(1100만건, 600만건) → <strong>소요시간 2시간</strong></li>\n</ul>\n</li>\n<li>너무 느리니 csv로 시도\n<ul>\n<li>python코드로 DB → csv : 가장 오래걸린 테이블 15분</li>\n<li>csv → logstash 적재 : 25분</li>\n<li><strong>약 40분</strong></li>\n</ul>\n</li>\n<li>최적화 : 오래걸린다고 생각한 (postgrsql 공간함수)를 view 테이블에서 사용하지 말고 미리 계산해 넣어주자\n<ul>\n<li>python코드로 DB → csv : 12분</li>\n<li>csv → logstash 적재 : 25분</li>\n<li><strong>약 35분</strong>\n<ul>\n<li>DB → csv가 미세하게 빨라졌다</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"3-테이블-동기화-중-pnu컬럼-뒤에-4자리-숫자-버림-처리\" style=\"position:relative;\"><a href=\"#3-%ED%85%8C%EC%9D%B4%EB%B8%94-%EB%8F%99%EA%B8%B0%ED%99%94-%EC%A4%91-pnu%EC%BB%AC%EB%9F%BC-%EB%92%A4%EC%97%90-4%EC%9E%90%EB%A6%AC-%EC%88%AB%EC%9E%90-%EB%B2%84%EB%A6%BC-%EC%B2%98%EB%A6%AC\" aria-label=\"3 테이블 동기화 중 pnu컬럼 뒤에 4자리 숫자 버림 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 테이블 동기화 중 pnu컬럼 뒤에 4자리 숫자 버림 처리</h1>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"53616701051232890000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`input {\n  file {\n    path => &quot;/usr/share/logstash/input/elk_jibun_address_view_export.csv&quot;\n    start_position => &quot;beginning&quot;\n    sincedb_path => &quot;/usr/share/logstash/state/.sincedb_elk_jibun_address&quot;\n    codec => &quot;plain&quot;\n  }\n}\n\nfilter {\n  csv {\n    separator => &quot;,&quot;\n    skip_header => true\n    columns => [\n      &quot;jibun_address&quot;, &quot;x&quot;, &quot;y&quot;, &quot;pnu&quot;\n    ]\n  }\n  mutate {\n    convert => { &quot;x&quot; => &quot;float&quot; }\n    convert => { &quot;y&quot; => &quot;float&quot; }\n    convert => { &quot;pnu&quot; => &quot;string&quot; }\n    strip => [&quot;jibun_address&quot;]\n  }\n  ruby {\n    code => &quot;event.set('location', [event.get('x'), event.get('y')])&quot;\n  }\n}\n\noutput {\n  elasticsearch {\n    hosts => [&quot;http://192.168.50.248:9200&quot;]\n    user => &quot;elastic&quot;\n    password => &quot;\\${LOGSTASH_INTERNAL_PASSWORD}&quot;\n    index => &quot;elk_jibun_address&quot;\n    document_id => &quot;%{pnu}&quot;\n    manage_template => true\n    template_name => &quot;elk_jibun_address_template&quot;\n    template => &quot;/usr/share/logstash/pipeline/jibun_address_template.json&quot;\n    template_overwrite => true\n  }\n  # 진행 상황을 점(.)으로 확인\n  stdout {\n    codec => dots\n  }\n}`, `53616701051232890000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"json\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">input {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk14\">file</span><span class=\"mtk1\"> </span><span class=\"mtk14\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">path</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;/usr/share/logstash/input/elk_jibun_address_view_export.csv&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">start_position</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;beginning&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">sincedb_path</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;/usr/share/logstash/state/.sincedb_elk_jibun_address&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">codec</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;plain&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">filter {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk14\">csv</span><span class=\"mtk1\"> </span><span class=\"mtk14\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">separator</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;,&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">skip_header</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">columns</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">[</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">&quot;jibun_address&quot;</span><span class=\"mtk14\">,</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;x&quot;</span><span class=\"mtk14\">,</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;y&quot;</span><span class=\"mtk14\">,</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;pnu&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"16\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"17\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"18\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  mutate {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"19\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">convert</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">{</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;x&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;float&quot;</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"20\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    convert =&gt; { </span><span class=\"mtk12\">&quot;y&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;float&quot;</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"21\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    convert =&gt; { </span><span class=\"mtk12\">&quot;pnu&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;string&quot;</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"22\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    strip =&gt; [</span><span class=\"mtk8\">&quot;jibun_address&quot;</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"23\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"24\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  ruby {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"25\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">code</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;event.set(&#39;location&#39;, [event.get(&#39;x&#39;), event.get(&#39;y&#39;)])&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"26\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"27\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"28\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"29\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">output {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"30\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk14\">elasticsearch</span><span class=\"mtk1\"> </span><span class=\"mtk14\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"31\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">hosts</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">[</span><span class=\"mtk12\">&quot;http://192.168.50.248:9200&quot;</span><span class=\"mtk14\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"32\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">user</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;elastic&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"33\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">password</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;${LOGSTASH_INTERNAL_PASSWORD}&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"34\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">index</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;elk_jibun_address&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"35\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">document_id</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;%{pnu}&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"36\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">manage_template</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"37\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">template_name</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;elk_jibun_address_template&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"38\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">template</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;/usr/share/logstash/pipeline/jibun_address_template.json&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"39\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">template_overwrite</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"40\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"41\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  # 진행 상황을 점(.)으로 확인</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"42\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  stdout {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"43\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">codec</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">dots</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"44\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"45\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<table>\n<thead>\n<tr>\n<th><strong>구분</strong></th>\n<th><strong>convert에 명시하지 않았을 때 (암시적 처리)</strong></th>\n<th><strong>convert에 명시했을 때 (명시적 처리)</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Logstash</strong></td>\n<td>pnu를 “숫자처럼 생긴 문자열”로 간주. JSON 생성 시 <strong>따옴표 없이 숫자처럼</strong> 보낼 위험이 있음. (일부 버전이나 환경에서)</td>\n<td>pnu를 “반드시 문자열”로 확정. JSON 생성 시 <strong>따옴표를 붙여서</strong> 보냄.</td>\n</tr>\n<tr>\n<td><strong>Elasticsearch</strong></td>\n<td>따옴표 없는 긴 숫자를 받고 <strong>long 타입으로 추측</strong>. 이 과정에서 <strong>정밀도 손실 발생 (뒷자리 0000)</strong>.</td>\n<td>따옴표 있는 문자열을 받고 <strong>keyword 타입으로 정확히 인식</strong>. 데이터 손실 없음.</td>\n</tr>\n<tr>\n<td><strong>결과</strong></td>\n<td><strong>데이터 손상 발생</strong></td>\n<td><strong>데이터 무결성 보장</strong></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"4-이름-검색-n-gram-tokenizer\" style=\"position:relative;\"><a href=\"#4-%EC%9D%B4%EB%A6%84-%EA%B2%80%EC%83%89-n-gram-tokenizer\" aria-label=\"4 이름 검색 n gram tokenizer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 이름 검색 (N gram tokenizer)</h1>\n<p>“특정 단어들만 입력하더라도 검색이 되야한다.”</p>\n<p>찾아보니 한국어 형태소 분석을 위한 nori가 있고, 토큰화 하는 n-gram, Edge n-gram이 있는데</p>\n<p>일단 문자 단위로 토큰화(n-gram)하고 추후 개선하기로 하였다.</p>\n<p>output을 작성할 때 elastic search에 template_name, template을 지정해주면 된다.</p>\n<p>template에 어떻게 tokenizer할 지 설정한다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"30536539980488643000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`input {\n  file {\n    path           => &quot;/usr/share/logstash/input/elk_local_data_view_export.csv&quot;\n    start_position => &quot;beginning&quot;\n    sincedb_path   => &quot;/usr/share/logstash/state/.sincedb_elk_local_data&quot;\n    codec          => &quot;plain&quot;\n  }\n}\n\nfilter {\n  csv {\n    separator   => &quot;,&quot;\n    skip_header => true\n    columns     => [\n      &quot;id&quot;,\n      &quot;type&quot;,\n      &quot;type_name&quot;,\n      &quot;name&quot;,\n      &quot;x&quot;,\n      &quot;y&quot;,\n      &quot;table_name&quot;,\n      &quot;geom&quot;\n    ]\n  }\n\n  mutate {\n    convert => { &quot;x&quot; => &quot;float&quot; }\n    convert => { &quot;y&quot; => &quot;float&quot; }\n    strip   => [\n      &quot;id&quot;,\n      &quot;type&quot;,\n      &quot;type_name&quot;,\n      &quot;name&quot;,\n      &quot;table_name&quot;,\n      &quot;geom&quot;\n    ]\n  }\n\n  if [x] and [y] {\n    ruby {\n      code => 'event.set(&quot;location&quot;, [event.get(&quot;x&quot;), event.get(&quot;y&quot;)])'\n    }\n  }\n}\n\noutput {\n  elasticsearch {\n    hosts              => [&quot;http://192.168.50.248:9200&quot;]\n    user               => &quot;elastic&quot;\n    password           => &quot;\\${LOGSTASH_INTERNAL_PASSWORD}&quot;\n    index              => &quot;elk_local_data&quot;\n    timeout            => 60\n    document_id        => &quot;%{id}&quot;\n    manage_template    => true\n    template_name      => &quot;elk_local_data_template&quot;\n    template           => &quot;/usr/share/logstash/pipeline/local_data_template.json&quot;\n    template_overwrite => true\n  }\n\n  stdout {\n    codec => dots\n  }\n\n  file {\n    path  => &quot;/usr/share/logstash/logs/elk_local_data_debug.log&quot;\n    codec => line { format => &quot;ELK_DEBUG: %{@timestamp} - %{mgt_no}&quot; }\n  }\n}`, `30536539980488643000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"json\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">input {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk14\">file</span><span class=\"mtk1\"> </span><span class=\"mtk14\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">path</span><span class=\"mtk1\">           </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;/usr/share/logstash/input/elk_local_data_view_export.csv&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">start_position</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;beginning&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">sincedb_path</span><span class=\"mtk1\">   </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;/usr/share/logstash/state/.sincedb_elk_local_data&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">codec</span><span class=\"mtk1\">          </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;plain&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">filter {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk14\">csv</span><span class=\"mtk1\"> </span><span class=\"mtk14\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">separator</span><span class=\"mtk1\">   </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;,&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">skip_header</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">columns</span><span class=\"mtk1\">     </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">[</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">&quot;id&quot;</span><span class=\"mtk14\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"16\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">&quot;type&quot;</span><span class=\"mtk14\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"17\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">&quot;type_name&quot;</span><span class=\"mtk14\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"18\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">&quot;name&quot;</span><span class=\"mtk14\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"19\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">&quot;x&quot;</span><span class=\"mtk14\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"20\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">&quot;y&quot;</span><span class=\"mtk14\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"21\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">&quot;table_name&quot;</span><span class=\"mtk14\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"22\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">&quot;geom&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"23\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"24\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"25\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"26\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  mutate {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"27\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">convert</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">{</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;x&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;float&quot;</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"28\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    convert =&gt; { </span><span class=\"mtk12\">&quot;y&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;float&quot;</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"29\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    strip   =&gt; [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"30\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk8\">&quot;id&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"31\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk8\">&quot;type&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"32\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk8\">&quot;type_name&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"33\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk8\">&quot;name&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"34\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk8\">&quot;table_name&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"35\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk8\">&quot;geom&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"36\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"37\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"38\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"39\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  if [</span><span class=\"mtk14\">x</span><span class=\"mtk1\">] and [</span><span class=\"mtk14\">y</span><span class=\"mtk1\">] {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"40\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">ruby</span><span class=\"mtk1\"> </span><span class=\"mtk14\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"41\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk14\">code</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">&#39;event.set(</span><span class=\"mtk12\">&quot;location&quot;</span><span class=\"mtk14\">,</span><span class=\"mtk1\"> </span><span class=\"mtk14\">[event.get(</span><span class=\"mtk12\">&quot;x&quot;</span><span class=\"mtk14\">),</span><span class=\"mtk1\"> </span><span class=\"mtk14\">event.get(</span><span class=\"mtk12\">&quot;y&quot;</span><span class=\"mtk14\">)])&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"42\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"43\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"44\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"45\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"46\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">output {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"47\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk14\">elasticsearch</span><span class=\"mtk1\"> </span><span class=\"mtk14\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"48\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">hosts</span><span class=\"mtk1\">              </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">[</span><span class=\"mtk12\">&quot;http://192.168.50.248:9200&quot;</span><span class=\"mtk14\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"49\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">user</span><span class=\"mtk1\">               </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;elastic&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"50\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">password</span><span class=\"mtk1\">           </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;${LOGSTASH_INTERNAL_PASSWORD}&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"51\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">index</span><span class=\"mtk1\">              </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;elk_local_data&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"52\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">timeout</span><span class=\"mtk1\">            </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">60</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"53\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">document_id</span><span class=\"mtk1\">        </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;%{id}&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"54\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">manage_template</span><span class=\"mtk1\">    </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"55\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">template_name</span><span class=\"mtk1\">      </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;elk_local_data_template&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"56\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">template</span><span class=\"mtk1\">           </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;/usr/share/logstash/pipeline/local_data_template.json&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"57\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">template_overwrite</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"58\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"59\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"60\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  stdout {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"61\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">codec</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">dots</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"62\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"63\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"64\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  file {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"65\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">path</span><span class=\"mtk1\">  </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;/usr/share/logstash/logs/elk_local_data_debug.log&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"66\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk14\">codec</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk14\">line</span><span class=\"mtk1\"> </span><span class=\"mtk14\">{</span><span class=\"mtk1\"> </span><span class=\"mtk14\">format</span><span class=\"mtk1\"> </span><span class=\"mtk14\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;ELK_DEBUG: %{@timestamp} - %{mgt_no}&quot;</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"67\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"68\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"72565513787182300000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`{\n  &quot;index_patterns&quot;: [&quot;elk_local_data*&quot;],\n  &quot;template&quot;: {\n    &quot;settings&quot;: {\n      &quot;index.max_ngram_diff&quot;: 10,\n      &quot;analysis&quot;: {\n        &quot;analyzer&quot;: {\n          &quot;korean_ngram_analyzer&quot;: {\n            &quot;tokenizer&quot;: &quot;korean_ngram_tokenizer&quot;\n          }\n        },\n        &quot;tokenizer&quot;: {\n          &quot;korean_ngram_tokenizer&quot;: {\n            &quot;type&quot;: &quot;ngram&quot;,\n            &quot;min_gram&quot;: 2,\n            &quot;max_gram&quot;: 10,\n            &quot;token_chars&quot;: [&quot;letter&quot;, &quot;digit&quot;]\n          }\n        }\n      }\n    },\n    &quot;mappings&quot;: {\n      &quot;properties&quot;: {\n        &quot;id&quot;: { &quot;type&quot;: &quot;keyword&quot; },\n        &quot;type&quot;: { &quot;type&quot;: &quot;keyword&quot; },\n        &quot;type_name&quot;: {\n          &quot;type&quot;: &quot;text&quot;,\n          &quot;fields&quot;: {\n            &quot;keyword&quot;: {\n              &quot;type&quot;: &quot;keyword&quot;\n            }\n          }\n        },\n        &quot;name&quot;: {\n          &quot;type&quot;: &quot;text&quot;,\n          &quot;fields&quot;: {\n            &quot;ngram&quot;: {\n              &quot;type&quot;: &quot;text&quot;,\n              &quot;analyzer&quot;: &quot;korean_ngram_analyzer&quot;\n            },\n            &quot;keyword&quot;: {\n              &quot;type&quot;: &quot;keyword&quot;\n            }\n          }\n        },\n        &quot;x&quot;: { &quot;type&quot;: &quot;float&quot; },\n        &quot;y&quot;: { &quot;type&quot;: &quot;float&quot; },\n        &quot;location&quot;: { &quot;type&quot;: &quot;geo_point&quot; },\n        &quot;table_name&quot;: { &quot;type&quot;: &quot;keyword&quot; },\n        &quot;geom&quot;: {\n          &quot;type&quot;: &quot;keyword&quot;,\n          &quot;index&quot;: false\n        }\n      }\n    }\n  }\n}`, `72565513787182300000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"json\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk12\">&quot;index_patterns&quot;</span><span class=\"mtk1\">: [</span><span class=\"mtk8\">&quot;elk_local_data*&quot;</span><span class=\"mtk1\">],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk12\">&quot;template&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">&quot;settings&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">&quot;index.max_ngram_diff&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk7\">10</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">&quot;analysis&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;analyzer&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">&quot;korean_ngram_analyzer&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">&quot;tokenizer&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;korean_ngram_tokenizer&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;tokenizer&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">&quot;korean_ngram_tokenizer&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">&quot;type&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;ngram&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">&quot;min_gram&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk7\">2</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"16\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">&quot;max_gram&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk7\">10</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"17\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">&quot;token_chars&quot;</span><span class=\"mtk1\">: [</span><span class=\"mtk8\">&quot;letter&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;digit&quot;</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"18\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"19\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"20\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"21\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"22\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">&quot;mappings&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"23\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">&quot;properties&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"24\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;id&quot;</span><span class=\"mtk1\">: { </span><span class=\"mtk12\">&quot;type&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;keyword&quot;</span><span class=\"mtk1\"> },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"25\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;type&quot;</span><span class=\"mtk1\">: { </span><span class=\"mtk12\">&quot;type&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;keyword&quot;</span><span class=\"mtk1\"> },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"26\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;type_name&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"27\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">&quot;type&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;text&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"28\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">&quot;fields&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"29\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">&quot;keyword&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"30\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk12\">&quot;type&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;keyword&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"31\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"32\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"33\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"34\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;name&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"35\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">&quot;type&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;text&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"36\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">&quot;fields&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"37\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">&quot;ngram&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"38\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk12\">&quot;type&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;text&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"39\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk12\">&quot;analyzer&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;korean_ngram_analyzer&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"40\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"41\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">&quot;keyword&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"42\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk12\">&quot;type&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;keyword&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"43\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"44\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"45\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"46\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;x&quot;</span><span class=\"mtk1\">: { </span><span class=\"mtk12\">&quot;type&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;float&quot;</span><span class=\"mtk1\"> },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"47\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;y&quot;</span><span class=\"mtk1\">: { </span><span class=\"mtk12\">&quot;type&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;float&quot;</span><span class=\"mtk1\"> },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"48\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;location&quot;</span><span class=\"mtk1\">: { </span><span class=\"mtk12\">&quot;type&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;geo_point&quot;</span><span class=\"mtk1\"> },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"49\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;table_name&quot;</span><span class=\"mtk1\">: { </span><span class=\"mtk12\">&quot;type&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;keyword&quot;</span><span class=\"mtk1\"> },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"50\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;geom&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"51\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">&quot;type&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;keyword&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"52\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">&quot;index&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk4\">false</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"53\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"54\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"55\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"56\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"57\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h1 id=\"5-지도-화면-내-중심과-가까운-순으로-검색\" style=\"position:relative;\"><a href=\"#5-%EC%A7%80%EB%8F%84-%ED%99%94%EB%A9%B4-%EB%82%B4-%EC%A4%91%EC%8B%AC%EA%B3%BC-%EA%B0%80%EA%B9%8C%EC%9A%B4-%EC%88%9C%EC%9C%BC%EB%A1%9C-%EA%B2%80%EC%83%89\" aria-label=\"5 지도 화면 내 중심과 가까운 순으로 검색 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 지도 화면 내 중심과 가까운 순으로 검색</h1>\n<p>이거 때문에 고생 좀 했다.</p>\n<p>이 기능은 사용자가 지도를 움직일 때마다 보이는 영역 안에서, 입력한 키워드와 일치하면서 지도 중심에서 가까운 장소를 순서대로 보여줘야 했다.</p>\n<p>고생 좀 한 이유는 텍스트 관련성 점수와 거리 점수라는 두가지 요소를 어떻게 자연스럽게 조합해 결과를 가져와야 했기 때문이다.</p>\n<p>예시는 다음과 같다. 사용자가 지도 중심을 ‘강남역’ 근처에 두고 ‘스타벅스’를 검색했다고 가정하자.</p>\n<p>다음과 같은 점수 계산 로직에 의해 강남역이 안떴다.</p>\n<p>텍스트 검색 * 거리 점수 계산 이렇게 점수가 매겨지는데 이 곱하기가 문제였다.</p>\n<ul>\n<li>A 매장: 강남역에서 3km 떨어진, 화면에 보이는 스타벅스\n<ul>\n<li>텍스트 점수: 15.0</li>\n<li>거리 점수: 0.01</li>\n<li>최종 점수: 15.0 * 0.01 = 0.15점</li>\n</ul>\n</li>\n<li>B 매장: 강남역에서 5km 떨어진, 화면에 보이는 스타벅스\n<ul>\n<li>텍스트 점수: 15.0</li>\n<li>거리 점수: 0.0001</li>\n<li>최종 점수: 15.0 * 0.0001 = 0.0015점</li>\n</ul>\n</li>\n</ul>\n<p>이런 느낌으로 이러한 현상을 ‘점수 소멸’ 현상이라고 한다.</p>\n<p>이 문제를 해결하기 위해 buildAddressDslQuery 코드는 접근 방식을 완전히 바꿨다. 점수 섞지말고 각자 할일만 하게</p>\n<ul>\n<li>filter (선별 담당): “일단 지도 화면 안에 있는 애들만 가져온다.”\n<ul>\n<li>geoBoundingBox 쿼리가 가장 먼저 동작</li>\n<li>이 쿼리는 점수 계산 x -> 오직 “이 장소가 현재 보이는 지도 사각형 영역 안에 있는가, 없는가?”만 판단해서 결과 후보군을 먼저 걸러낸다.</li>\n<li>이제 검색 대상은 사용자가 보고 있는 지도 화면 안으로 한정</li>\n</ul>\n</li>\n<li>must (점수 계산 담당): “후보들 중에서 ‘스타벅스’를 찾고 점수를 매긴다.”\n<ul>\n<li>filter를 통과한 ‘지도 화면 내의 장소들’ 중에서 multiMatchQuery가 ‘스타벅스’라는 키워드를 검색</li>\n<li>이때 계산되는 점수는 오직 순수한 텍스트 관련성 점수 -> 거리 요소가 점수 계산에 전혀 개입하지 않으므로, ‘점수 소멸’ 현상이 원천적으로 발생하지 않는다.</li>\n</ul>\n</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"98985791698176540000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`    private Query buildAddressDslQuery(List<String> fields, String keyword, BoundsDto bounds, Double centerLat, Double centerLon, int maxResults) {\n        // 원본 필드와 .ngram 필드를 모두 검색하도록 필드 목록을 동적으로 생성\n        List<String> searchFields = fields.stream()\n                .flatMap(field -> List.of(field + &quot;^3&quot;, field + &quot;.ngram&quot;).stream())\n                .collect(Collectors.toList());\n\n        NativeQueryBuilder nativeQueryBuilder = new NativeQueryBuilder();\n        nativeQueryBuilder.withMaxResults(maxResults);\n\n        nativeQueryBuilder.withQuery(q -> {\n            BoolQuery.Builder boolQueryBuilder = new BoolQuery.Builder();\n\n            boolQueryBuilder.must(m -> m\n                    .multiMatch(mm -> mm\n                            .query(keyword)\n                            .fields(searchFields)\n                            .operator(Operator.And)\n                    )\n            );\n\n            if (bounds != null) {\n                boolQueryBuilder.filter(f -> f\n                        .geoBoundingBox(gbb -> gbb\n                                .field(&quot;location&quot;)\n                                .boundingBox(bb -> bb\n                                        .tlbr(b -> b\n                                                .topLeft(g -> g.latlon(ll -> ll.lat(bounds.getMaxLat()).lon(bounds.getMinLon())))\n                                                .bottomRight(g -> g.latlon(ll -> ll.lat(bounds.getMinLat()).lon(bounds.getMaxLon())))\n                                        )\n                                )\n                        )\n                );\n            }\n\n            return q.bool(boolQueryBuilder.build());\n        });\n\n        if ((keyword == null || keyword.trim().isEmpty()) && centerLat != null && centerLon != null) {\n            SortOptions sortOptions = SortOptions.of(s -> s\n                    .geoDistance(gds -> gds\n                            .field(&quot;location&quot;)\n                            .location(GeoLocation.of(gl -> gl.latlon(ll -> ll.lat(centerLat).lon(centerLon))))\n                            .order(SortOrder.Asc)\n                    )\n            );\n            nativeQueryBuilder.withSort(sortOptions);\n        }\n\n        return nativeQueryBuilder.build();\n    }`, `98985791698176540000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Query</span><span class=\"mtk1\"> </span><span class=\"mtk11\">buildAddressDslQuery</span><span class=\"mtk1\">(</span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;String&gt; fields, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> keyword, </span><span class=\"mtk10\">BoundsDto</span><span class=\"mtk1\"> bounds, </span><span class=\"mtk10\">Double</span><span class=\"mtk1\"> centerLat, </span><span class=\"mtk10\">Double</span><span class=\"mtk1\"> centerLon, </span><span class=\"mtk10\">int</span><span class=\"mtk1\"> maxResults) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// 원본 필드와 .ngram 필드를 모두 검색하도록 필드 목록을 동적으로 생성</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">searchFields</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">fields</span><span class=\"mtk1\">.</span><span class=\"mtk11\">stream</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">flatMap</span><span class=\"mtk1\">(field </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">List</span><span class=\"mtk1\">.</span><span class=\"mtk11\">of</span><span class=\"mtk1\">(field + </span><span class=\"mtk8\">&quot;^3&quot;</span><span class=\"mtk1\">, field + </span><span class=\"mtk8\">&quot;.ngram&quot;</span><span class=\"mtk1\">).</span><span class=\"mtk11\">stream</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">collect</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Collectors</span><span class=\"mtk1\">.</span><span class=\"mtk11\">toList</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">NativeQueryBuilder</span><span class=\"mtk1\"> </span><span class=\"mtk12\">nativeQueryBuilder</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">NativeQueryBuilder</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">nativeQueryBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">withMaxResults</span><span class=\"mtk1\">(maxResults);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">nativeQueryBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">withQuery</span><span class=\"mtk1\">(q </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">BoolQuery</span><span class=\"mtk1\">.</span><span class=\"mtk10\">Builder</span><span class=\"mtk1\"> </span><span class=\"mtk12\">boolQueryBuilder</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> BoolQuery.</span><span class=\"mtk11\">Builder</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">boolQueryBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">must</span><span class=\"mtk1\">(m </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> m</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                    .</span><span class=\"mtk11\">multiMatch</span><span class=\"mtk1\">(mm </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> mm</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                            .</span><span class=\"mtk11\">query</span><span class=\"mtk1\">(keyword)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"16\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                            .</span><span class=\"mtk11\">fields</span><span class=\"mtk1\">(searchFields)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"17\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                            .</span><span class=\"mtk11\">operator</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Operator</span><span class=\"mtk1\">.</span><span class=\"mtk12\">And</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"18\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"19\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"20\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"21\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (bounds != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"22\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">boolQueryBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">filter</span><span class=\"mtk1\">(f </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> f</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"23\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">geoBoundingBox</span><span class=\"mtk1\">(gbb </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> gbb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"24\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                .</span><span class=\"mtk11\">field</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;location&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"25\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                .</span><span class=\"mtk11\">boundingBox</span><span class=\"mtk1\">(bb </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> bb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"26\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                        .</span><span class=\"mtk11\">tlbr</span><span class=\"mtk1\">(b </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> b</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"27\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                                .</span><span class=\"mtk11\">topLeft</span><span class=\"mtk1\">(g </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">g</span><span class=\"mtk1\">.</span><span class=\"mtk11\">latlon</span><span class=\"mtk1\">(ll </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ll</span><span class=\"mtk1\">.</span><span class=\"mtk11\">lat</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bounds</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMaxLat</span><span class=\"mtk1\">()).</span><span class=\"mtk11\">lon</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bounds</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMinLon</span><span class=\"mtk1\">())))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"28\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                                .</span><span class=\"mtk11\">bottomRight</span><span class=\"mtk1\">(g </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">g</span><span class=\"mtk1\">.</span><span class=\"mtk11\">latlon</span><span class=\"mtk1\">(ll </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ll</span><span class=\"mtk1\">.</span><span class=\"mtk11\">lat</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bounds</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMinLat</span><span class=\"mtk1\">()).</span><span class=\"mtk11\">lon</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bounds</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMaxLon</span><span class=\"mtk1\">())))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"29\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                        )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"30\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"31\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"32\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"33\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"34\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"35\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">q</span><span class=\"mtk1\">.</span><span class=\"mtk11\">bool</span><span class=\"mtk1\">(</span><span class=\"mtk12\">boolQueryBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">build</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"36\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"37\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"38\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> ((keyword == </span><span class=\"mtk4\">null</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">keyword</span><span class=\"mtk1\">.</span><span class=\"mtk11\">trim</span><span class=\"mtk1\">().</span><span class=\"mtk11\">isEmpty</span><span class=\"mtk1\">()) &amp;&amp; centerLat != </span><span class=\"mtk4\">null</span><span class=\"mtk1\"> &amp;&amp; centerLon != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"39\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">SortOptions</span><span class=\"mtk1\"> </span><span class=\"mtk12\">sortOptions</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">SortOptions</span><span class=\"mtk1\">.</span><span class=\"mtk11\">of</span><span class=\"mtk1\">(s </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> s</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"40\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                    .</span><span class=\"mtk11\">geoDistance</span><span class=\"mtk1\">(gds </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> gds</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"41\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                            .</span><span class=\"mtk11\">field</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;location&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"42\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                            .</span><span class=\"mtk11\">location</span><span class=\"mtk1\">(</span><span class=\"mtk12\">GeoLocation</span><span class=\"mtk1\">.</span><span class=\"mtk11\">of</span><span class=\"mtk1\">(gl </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">gl</span><span class=\"mtk1\">.</span><span class=\"mtk11\">latlon</span><span class=\"mtk1\">(ll </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ll</span><span class=\"mtk1\">.</span><span class=\"mtk11\">lat</span><span class=\"mtk1\">(centerLat).</span><span class=\"mtk11\">lon</span><span class=\"mtk1\">(centerLon))))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"43\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                            .</span><span class=\"mtk11\">order</span><span class=\"mtk1\">(</span><span class=\"mtk12\">SortOrder</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Asc</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"44\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"45\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"46\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">nativeQueryBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">withSort</span><span class=\"mtk1\">(sortOptions);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"47\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"48\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"49\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">nativeQueryBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"50\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>먼저 범위를 좁히고(filter), 그 안에서 검색한다(must)는 방법으로 해결했다.</p>\n<p>점수 가지고 AI랑 삽질하다가 잘 안되서 관점을 바꿔봤더니 해결 (한번에 좀 알려주지 ㅜ)</p>\n<hr>\n<h1 id=\"6-특정-필드를-가진-데이터는-범위-검색-x-상위-노출-그-외-필드들은-범위-검색-o\" style=\"position:relative;\"><a href=\"#6-%ED%8A%B9%EC%A0%95-%ED%95%84%EB%93%9C%EB%A5%BC-%EA%B0%80%EC%A7%84-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%8A%94-%EB%B2%94%EC%9C%84-%EA%B2%80%EC%83%89-x-%EC%83%81%EC%9C%84-%EB%85%B8%EC%B6%9C-%EA%B7%B8-%EC%99%B8-%ED%95%84%EB%93%9C%EB%93%A4%EC%9D%80-%EB%B2%94%EC%9C%84-%EA%B2%80%EC%83%89-o\" aria-label=\"6 특정 필드를 가진 데이터는 범위 검색 x 상위 노출 그 외 필드들은 범위 검색 o permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. 특정 필드를 가진 데이터는 범위 검색 x 상위 노출, 그 외 필드들은 범위 검색 o</h1>\n<p>이전 문제들을 해결하고 데이터 적재 작업을 계속하는데 기능 요구사항이 자꾸 날라왔다…</p>\n<p>심지어 까다로운 요구사항 ㅡㅡ</p>\n<p>“사용자가 서울에서 ‘불국사’를 검색해도, 경주에 있는 불국사가 검색 결과에 나와야 합니다. 하지만 동네 빵집은 지금 보고 있는 지도 화면 안에서만 찾아야 하고요. 아, 그리고 불국사 같은 유명한 장소는 점수도 더 높게 쳐 상위에 노출되게 해주세요”</p>\n<p>쿼리 핵심은 핵심은 “OR” 조건 bool 쿼리를 중첩해서 사용하면 문제 해결!</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"44334437971152530000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`{\n  &quot;size&quot;: 1000,\n  &quot;query&quot;: {\n    &quot;function_score&quot;: {\n      &quot;query&quot;: {\n        &quot;bool&quot;: {\n          &quot;must&quot;: [\n            {\n              &quot;multi_match&quot;: {\n                &quot;query&quot;: &quot;불국사&quot;,\n                &quot;fields&quot;: [&quot;name^3&quot;, &quot;name.ngram&quot;],\n                &quot;operator&quot;: &quot;AND&quot;\n              }\n            }\n          ],\n          &quot;filter&quot;: [\n            {\n              &quot;bool&quot;: {\n                &quot;should&quot;: [\n                  {\n                    &quot;terms&quot;: {\n                      &quot;type_name.keyword&quot;: [\n                        &quot;행정기관&quot;,\n                        &quot;사찰&quot;,\n                        &quot;대형유명유적&quot;,\n                        &quot;미술관&quot;,\n                        &quot;재래시장&quot;,\n                        &quot;산림욕장&quot;,\n                        &quot;계곡&quot;,\n                        &quot;박물관&quot;,\n                        &quot;빌라&quot;,\n                        &quot;아파트&quot;,\n                        &quot;초중고&quot;,\n                        &quot;대학교&quot;\n                      ]\n                    }\n                  },\n                  {\n                    &quot;bool&quot;: {\n                      &quot;must_not&quot;: [\n                        {\n                          &quot;terms&quot;: {\n                            &quot;type_name.keyword&quot;: [\n                              &quot;행정기관&quot;,\n                              &quot;사찰&quot;,\n                              &quot;대형유명유적&quot;,\n                              &quot;미술관&quot;,\n                              &quot;재래시장&quot;,\n                              &quot;산림욕장&quot;,\n                              &quot;계곡&quot;,\n                              &quot;박물관&quot;,\n                              &quot;빌라&quot;,\n                              &quot;아파트&quot;,\n                              &quot;초중고&quot;,\n                              &quot;대학교&quot;\n                            ]\n                          }\n                        }\n                      ],\n                      &quot;filter&quot;: [\n                        {\n                          &quot;geo_bounding_box&quot;: {\n                            &quot;location&quot;: {\n                              &quot;top_left&quot;: {\n                                &quot;lat&quot;: 37.6,\n                                &quot;lon&quot;: 126.8\n                              },\n                              &quot;bottom_right&quot;: {\n                                &quot;lat&quot;: 37.4,\n                                &quot;lon&quot;: 127.1\n                              }\n                            }\n                          }\n                        }\n                      ]\n                    }\n                  }\n                ],\n                &quot;minimum_should_match&quot;: &quot;1&quot;\n              }\n            }\n          ]\n        }\n      },\n      &quot;functions&quot;: [\n        {\n          &quot;filter&quot;: {\n            &quot;terms&quot;: {\n              &quot;type_name.keyword&quot;: [\n                &quot;행정기관&quot;,\n                &quot;사찰&quot;,\n                &quot;대형유명유적&quot;,\n                &quot;미술관&quot;,\n                &quot;재래시장&quot;,\n                &quot;산림욕장&quot;,\n                &quot;계곡&quot;,\n                &quot;박물관&quot;,\n                &quot;빌라&quot;,\n                &quot;아파트&quot;,\n                &quot;초중고&quot;,\n                &quot;대학교&quot;\n              ]\n            }\n          },\n          &quot;weight&quot;: 1.2\n        }\n      ],\n      &quot;boost_mode&quot;: &quot;multiply&quot;\n    }\n  }\n}`, `44334437971152530000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"json\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk12\">&quot;size&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk7\">1000</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk12\">&quot;query&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">&quot;function_score&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">&quot;query&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;bool&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">&quot;must&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk12\">&quot;multi_match&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">&quot;query&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;불국사&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">&quot;fields&quot;</span><span class=\"mtk1\">: [</span><span class=\"mtk8\">&quot;name^3&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;name.ngram&quot;</span><span class=\"mtk1\">],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">&quot;operator&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;AND&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          ],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"16\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">&quot;filter&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"17\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"18\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk12\">&quot;bool&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"19\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">&quot;should&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"20\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                  {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"21\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">&quot;terms&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"22\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                      </span><span class=\"mtk12\">&quot;type_name.keyword&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"23\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk8\">&quot;행정기관&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"24\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk8\">&quot;사찰&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"25\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk8\">&quot;대형유명유적&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"26\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk8\">&quot;미술관&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"27\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk8\">&quot;재래시장&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"28\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk8\">&quot;산림욕장&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"29\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk8\">&quot;계곡&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"30\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk8\">&quot;박물관&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"31\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk8\">&quot;빌라&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"32\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk8\">&quot;아파트&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"33\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk8\">&quot;초중고&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"34\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk8\">&quot;대학교&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"35\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                      ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"36\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"37\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                  },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"38\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                  {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"39\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">&quot;bool&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"40\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                      </span><span class=\"mtk12\">&quot;must_not&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"41\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"42\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                          </span><span class=\"mtk12\">&quot;terms&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"43\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                            </span><span class=\"mtk12\">&quot;type_name.keyword&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"44\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                              </span><span class=\"mtk8\">&quot;행정기관&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"45\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                              </span><span class=\"mtk8\">&quot;사찰&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"46\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                              </span><span class=\"mtk8\">&quot;대형유명유적&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"47\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                              </span><span class=\"mtk8\">&quot;미술관&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"48\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                              </span><span class=\"mtk8\">&quot;재래시장&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"49\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                              </span><span class=\"mtk8\">&quot;산림욕장&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"50\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                              </span><span class=\"mtk8\">&quot;계곡&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"51\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                              </span><span class=\"mtk8\">&quot;박물관&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"52\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                              </span><span class=\"mtk8\">&quot;빌라&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"53\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                              </span><span class=\"mtk8\">&quot;아파트&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"54\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                              </span><span class=\"mtk8\">&quot;초중고&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"55\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                              </span><span class=\"mtk8\">&quot;대학교&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"56\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                            ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"57\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                          }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"58\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"59\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                      ],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"60\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                      </span><span class=\"mtk12\">&quot;filter&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"61\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"62\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                          </span><span class=\"mtk12\">&quot;geo_bounding_box&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"63\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                            </span><span class=\"mtk12\">&quot;location&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"64\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                              </span><span class=\"mtk12\">&quot;top_left&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"65\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                </span><span class=\"mtk12\">&quot;lat&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk7\">37.6</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"66\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                </span><span class=\"mtk12\">&quot;lon&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk7\">126.8</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"67\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                              },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"68\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                              </span><span class=\"mtk12\">&quot;bottom_right&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"69\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                </span><span class=\"mtk12\">&quot;lat&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk7\">37.4</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"70\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                </span><span class=\"mtk12\">&quot;lon&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk7\">127.1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"71\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                              }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"72\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"73\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                          }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"74\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"75\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                      ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"76\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"77\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"78\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                ],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"79\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">&quot;minimum_should_match&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;1&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"80\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"81\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"82\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"83\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"84\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"85\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">&quot;functions&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"86\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"87\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">&quot;filter&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"88\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">&quot;terms&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"89\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk12\">&quot;type_name.keyword&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"90\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk8\">&quot;행정기관&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"91\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk8\">&quot;사찰&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"92\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk8\">&quot;대형유명유적&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"93\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk8\">&quot;미술관&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"94\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk8\">&quot;재래시장&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"95\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk8\">&quot;산림욕장&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"96\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk8\">&quot;계곡&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"97\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk8\">&quot;박물관&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"98\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk8\">&quot;빌라&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"99\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk8\">&quot;아파트&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"100\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk8\">&quot;초중고&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"101\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk8\">&quot;대학교&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"102\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"103\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"104\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"105\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">&quot;weight&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk7\">1.2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"106\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"107\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      ],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"108\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">&quot;boost_mode&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;multiply&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"109\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"110\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"111\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>논리는 이렇다</p>\n<p>검색 결과에 포함될 조건 = (A: 중요 장소 목록에 포함되거나) OR (B: 중요 장소 목록에 없으면서 지도 범위 안에 있거나)</p>\n<p>minimum_should_match: “1”: 이게 바로 “OR” 스위치다. should 배열 안에 있는 조건들 중 하나만 맞아도 통과시켜 준다.</p>\n<p>첫 번째 should: type_name이 내가 지정한 중요 목록(‘대학교’, ‘박물관’ 등)에 포함되는지 확인한다. 여기에 해당하면 바로 통과다.</p>\n<p>두 번째 should: “목록에 속하지 않으면, 구역 안에 있니?” must_not으로 목록이 아니라는 걸 먼저 확인하고, geo_bounding_box 필터로 현재 지도 범위 안에 있는지 확인한다. 이 두 조건을 모두 만족해야 통과다.</p>\n<p>이렇게 filter로 대상을 걸러낸 후에, function_score의 functions 파트가 목록을 찾아내내 weight: 1.2로 점수를 20% 향상시켜 준다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"43222604819729080000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`private Query buildAddressDslQuery(List<String> fields, String keyword, BoundsDto bounds, Double centerLat, Double centerLon, int maxResults) {\n        // 원본 필드와 .ngram 필드를 모두 검색하도록 필드 목록을 동적으로 생성\n        List<String> searchFields = fields.stream()\n                .flatMap(field -> List.of(field + &quot;^3&quot;, field + &quot;.ngram&quot;).stream())\n                .collect(Collectors.toList());\n\n        // 점수를 높여주고, 범위 검색에서 제외할 type_name 목록\n        List<String> boostedTypes = List.of(\n                &quot;행정기관&quot;, &quot;사찰&quot;, &quot;대형유명유적&quot;, &quot;미술관&quot;, &quot;재래시장&quot;,\n                &quot;산림욕장&quot;, &quot;계곡&quot;, &quot;박물관&quot;, &quot;빌라&quot;, &quot;아파트&quot;, &quot;초중고&quot;, &quot;대학교&quot;\n        );\n\n        NativeQueryBuilder nativeQueryBuilder = new NativeQueryBuilder();\n        nativeQueryBuilder.withMaxResults(maxResults);\n\n        // 헬퍼 메서드에 boostedTypes 리스트를 전달\n        BoolQuery coreQuery = createQueryForFunctionScore(searchFields, keyword, bounds, boostedTypes);\n\n        // List<String>을 List<FieldValue>로 변환 (function_score 용)\n        List<FieldValue> boostedTypeValues = boostedTypes.stream()\n                .map(FieldValue::of)\n                .collect(Collectors.toList());\n\n        // function_score 쿼리를 사용하여 점수 조작\n        nativeQueryBuilder.withQuery(q -> q\n                .functionScore(fs -> fs\n                        .query(queryBuilder -> queryBuilder.bool(coreQuery))\n                        // 점수 조작 함수 (이 로직은 그대로 유지)\n                        .functions(f -> f\n                                .filter(filterQuery -> filterQuery\n                                        .terms(t -> t\n                                                .field(&quot;type_name.keyword&quot;)\n                                                .terms(tq -> tq.value(boostedTypeValues))\n                                        )\n                                )\n                                .weight(1.2)\n                        )\n                        .boostMode(FunctionBoostMode.Multiply)\n                )\n        );\n\n        return nativeQueryBuilder.build();\n    }\n\n    // createQueryForFunctionScore 메서드\n    private BoolQuery createQueryForFunctionScore(List<String> searchFields, String keyword, BoundsDto bounds, List<String> boostedTypes) {\n        BoolQuery.Builder boolQueryBuilder = new BoolQuery.Builder();\n\n        // 1. must: 키워드 조건은 항상 필수\n        boolQueryBuilder.must(m -> m\n                .multiMatch(mm -> mm\n                        .query(keyword)\n                        .fields(searchFields)\n                        .operator(Operator.And)\n                )\n        );\n\n        // 2. bounds가 null이면 필터링 로직을 적용하지 않는다.\n        if (bounds == null) {\n            return boolQueryBuilder.build();\n        }\n\n        // List<String>을 List<FieldValue>로 변환 (bool 쿼리용)\n        List<FieldValue> boostedTypeValues = boostedTypes.stream()\n                .map(FieldValue::of)\n                .collect(Collectors.toList());\n\n        // 3. filter: 조건부 범위 검색 로직을 적용\n        boolQueryBuilder.filter(f -> f\n                .bool(b -> b\n                        // 아래 should 조건 중 하나만 만족하면 된다.\n                        .should(s -> s // 조건 1: boostedTypes에 포함되는 경우 (범위 필터 없음)\n                                .terms(t -> t\n                                        .field(&quot;type_name.keyword&quot;)\n                                        .terms(tq -> tq.value(boostedTypeValues))\n                                )\n                        )\n                        .should(s -> s // 조건 2: boostedTypes에 포함되지 않으면서 AND 범위 내에 있는 경우\n                                .bool(b2 -> b2\n                                        // 조건 2-1: boostedTypes에 포함되지 않아야 함\n                                        .mustNot(mn -> mn\n                                                .terms(t -> t\n                                                        .field(&quot;type_name.keyword&quot;)\n                                                        .terms(tq -> tq.value(boostedTypeValues))\n                                                )\n                                        )\n                                        // 조건 2-2: 지도 범위 내에 있어야 함\n                                        .filter(f2 -> f2\n                                                .geoBoundingBox(gbb -> gbb\n                                                        .field(&quot;location&quot;)\n                                                        .boundingBox(bb -> bb\n                                                                .tlbr(b3 -> b3\n                                                                        .topLeft(g -> g.latlon(ll -> ll.lat(bounds.getMaxLat()).lon(bounds.getMinLon())))\n                                                                        .bottomRight(g -> g.latlon(ll -> ll.lat(bounds.getMinLat()).lon(bounds.getMaxLon())))\n                                                                )\n                                                        )\n                                                )\n                                        )\n                                )\n                        )\n                        // should 절 중 최소 하나는 만족해야 함을 의미 (OR 조건)\n                        .minimumShouldMatch(&quot;1&quot;)\n                )\n        );\n\n        return boolQueryBuilder.build();\n    }`, `43222604819729080000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Query</span><span class=\"mtk1\"> </span><span class=\"mtk11\">buildAddressDslQuery</span><span class=\"mtk1\">(</span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;String&gt; fields, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> keyword, </span><span class=\"mtk10\">BoundsDto</span><span class=\"mtk1\"> bounds, </span><span class=\"mtk10\">Double</span><span class=\"mtk1\"> centerLat, </span><span class=\"mtk10\">Double</span><span class=\"mtk1\"> centerLon, </span><span class=\"mtk10\">int</span><span class=\"mtk1\"> maxResults) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// 원본 필드와 .ngram 필드를 모두 검색하도록 필드 목록을 동적으로 생성</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">searchFields</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">fields</span><span class=\"mtk1\">.</span><span class=\"mtk11\">stream</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">flatMap</span><span class=\"mtk1\">(field </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">List</span><span class=\"mtk1\">.</span><span class=\"mtk11\">of</span><span class=\"mtk1\">(field + </span><span class=\"mtk8\">&quot;^3&quot;</span><span class=\"mtk1\">, field + </span><span class=\"mtk8\">&quot;.ngram&quot;</span><span class=\"mtk1\">).</span><span class=\"mtk11\">stream</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">collect</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Collectors</span><span class=\"mtk1\">.</span><span class=\"mtk11\">toList</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// 점수를 높여주고, 범위 검색에서 제외할 type_name 목록</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">boostedTypes</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">List</span><span class=\"mtk1\">.</span><span class=\"mtk11\">of</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk8\">&quot;행정기관&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;사찰&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;대형유명유적&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;미술관&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;재래시장&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk8\">&quot;산림욕장&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;계곡&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;박물관&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;빌라&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;아파트&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;초중고&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;대학교&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">NativeQueryBuilder</span><span class=\"mtk1\"> </span><span class=\"mtk12\">nativeQueryBuilder</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">NativeQueryBuilder</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">nativeQueryBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">withMaxResults</span><span class=\"mtk1\">(maxResults);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"16\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// 헬퍼 메서드에 boostedTypes 리스트를 전달</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"17\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">BoolQuery</span><span class=\"mtk1\"> </span><span class=\"mtk12\">coreQuery</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">createQueryForFunctionScore</span><span class=\"mtk1\">(searchFields, keyword, bounds, boostedTypes);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"18\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"19\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// List&lt;String&gt;을 List&lt;FieldValue&gt;로 변환 (function_score 용)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"20\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">FieldValue</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">boostedTypeValues</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">boostedTypes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">stream</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"21\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">map</span><span class=\"mtk1\">(FieldValue</span><span class=\"mtk15\">::</span><span class=\"mtk1\">of)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"22\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">collect</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Collectors</span><span class=\"mtk1\">.</span><span class=\"mtk11\">toList</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"23\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"24\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// function_score 쿼리를 사용하여 점수 조작</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"25\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">nativeQueryBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">withQuery</span><span class=\"mtk1\">(q </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> q</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"26\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">functionScore</span><span class=\"mtk1\">(fs </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> fs</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"27\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">query</span><span class=\"mtk1\">(queryBuilder </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">queryBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">bool</span><span class=\"mtk1\">(coreQuery))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"28\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk3\">// 점수 조작 함수 (이 로직은 그대로 유지)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"29\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">functions</span><span class=\"mtk1\">(f </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> f</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"30\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                .</span><span class=\"mtk11\">filter</span><span class=\"mtk1\">(filterQuery </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> filterQuery</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"31\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                        .</span><span class=\"mtk11\">terms</span><span class=\"mtk1\">(t </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> t</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"32\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                                .</span><span class=\"mtk11\">field</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;type_name.keyword&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"33\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                                .</span><span class=\"mtk11\">terms</span><span class=\"mtk1\">(tq </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tq</span><span class=\"mtk1\">.</span><span class=\"mtk11\">value</span><span class=\"mtk1\">(boostedTypeValues))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"34\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                        )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"35\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"36\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                .</span><span class=\"mtk11\">weight</span><span class=\"mtk1\">(</span><span class=\"mtk7\">1.2</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"37\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"38\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">boostMode</span><span class=\"mtk1\">(</span><span class=\"mtk12\">FunctionBoostMode</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Multiply</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"39\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"40\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"41\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"42\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">nativeQueryBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"43\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"44\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"45\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// createQueryForFunctionScore 메서드</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"46\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">BoolQuery</span><span class=\"mtk1\"> </span><span class=\"mtk11\">createQueryForFunctionScore</span><span class=\"mtk1\">(</span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;String&gt; searchFields, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> keyword, </span><span class=\"mtk10\">BoundsDto</span><span class=\"mtk1\"> bounds, </span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;String&gt; boostedTypes) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"47\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">BoolQuery</span><span class=\"mtk1\">.</span><span class=\"mtk10\">Builder</span><span class=\"mtk1\"> </span><span class=\"mtk12\">boolQueryBuilder</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> BoolQuery.</span><span class=\"mtk11\">Builder</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"48\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"49\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// 1. must: 키워드 조건은 항상 필수</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"50\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">boolQueryBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">must</span><span class=\"mtk1\">(m </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> m</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"51\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">multiMatch</span><span class=\"mtk1\">(mm </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> mm</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"52\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">query</span><span class=\"mtk1\">(keyword)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"53\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">fields</span><span class=\"mtk1\">(searchFields)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"54\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">operator</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Operator</span><span class=\"mtk1\">.</span><span class=\"mtk12\">And</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"55\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"56\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"57\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"58\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// 2. bounds가 null이면 필터링 로직을 적용하지 않는다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"59\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (bounds == </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"60\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">boolQueryBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"61\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"62\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"63\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// List&lt;String&gt;을 List&lt;FieldValue&gt;로 변환 (bool 쿼리용)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"64\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">FieldValue</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">boostedTypeValues</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">boostedTypes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">stream</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"65\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">map</span><span class=\"mtk1\">(FieldValue</span><span class=\"mtk15\">::</span><span class=\"mtk1\">of)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"66\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">collect</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Collectors</span><span class=\"mtk1\">.</span><span class=\"mtk11\">toList</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"67\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"68\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// 3. filter: 조건부 범위 검색 로직을 적용</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"69\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">boolQueryBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">filter</span><span class=\"mtk1\">(f </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> f</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"70\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">bool</span><span class=\"mtk1\">(b </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> b</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"71\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk3\">// 아래 should 조건 중 하나만 만족하면 된다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"72\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">should</span><span class=\"mtk1\">(s </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> s </span><span class=\"mtk3\">// 조건 1: boostedTypes에 포함되는 경우 (범위 필터 없음)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"73\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                .</span><span class=\"mtk11\">terms</span><span class=\"mtk1\">(t </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> t</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"74\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                        .</span><span class=\"mtk11\">field</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;type_name.keyword&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"75\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                        .</span><span class=\"mtk11\">terms</span><span class=\"mtk1\">(tq </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tq</span><span class=\"mtk1\">.</span><span class=\"mtk11\">value</span><span class=\"mtk1\">(boostedTypeValues))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"76\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"77\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"78\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">should</span><span class=\"mtk1\">(s </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> s </span><span class=\"mtk3\">// 조건 2: boostedTypes에 포함되지 않으면서 AND 범위 내에 있는 경우</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"79\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                .</span><span class=\"mtk11\">bool</span><span class=\"mtk1\">(b2 </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> b2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"80\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                        </span><span class=\"mtk3\">// 조건 2-1: boostedTypes에 포함되지 않아야 함</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"81\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                        .</span><span class=\"mtk11\">mustNot</span><span class=\"mtk1\">(mn </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> mn</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"82\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                                .</span><span class=\"mtk11\">terms</span><span class=\"mtk1\">(t </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> t</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"83\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                                        .</span><span class=\"mtk11\">field</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;type_name.keyword&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"84\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                                        .</span><span class=\"mtk11\">terms</span><span class=\"mtk1\">(tq </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tq</span><span class=\"mtk1\">.</span><span class=\"mtk11\">value</span><span class=\"mtk1\">(boostedTypeValues))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"85\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                                )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"86\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                        )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"87\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                        </span><span class=\"mtk3\">// 조건 2-2: 지도 범위 내에 있어야 함</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"88\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                        .</span><span class=\"mtk11\">filter</span><span class=\"mtk1\">(f2 </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> f2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"89\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                                .</span><span class=\"mtk11\">geoBoundingBox</span><span class=\"mtk1\">(gbb </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> gbb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"90\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                                        .</span><span class=\"mtk11\">field</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;location&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"91\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                                        .</span><span class=\"mtk11\">boundingBox</span><span class=\"mtk1\">(bb </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> bb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"92\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                                                .</span><span class=\"mtk11\">tlbr</span><span class=\"mtk1\">(b3 </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> b3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"93\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                                                        .</span><span class=\"mtk11\">topLeft</span><span class=\"mtk1\">(g </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">g</span><span class=\"mtk1\">.</span><span class=\"mtk11\">latlon</span><span class=\"mtk1\">(ll </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ll</span><span class=\"mtk1\">.</span><span class=\"mtk11\">lat</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bounds</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMaxLat</span><span class=\"mtk1\">()).</span><span class=\"mtk11\">lon</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bounds</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMinLon</span><span class=\"mtk1\">())))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"94\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                                                        .</span><span class=\"mtk11\">bottomRight</span><span class=\"mtk1\">(g </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">g</span><span class=\"mtk1\">.</span><span class=\"mtk11\">latlon</span><span class=\"mtk1\">(ll </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ll</span><span class=\"mtk1\">.</span><span class=\"mtk11\">lat</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bounds</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMinLat</span><span class=\"mtk1\">()).</span><span class=\"mtk11\">lon</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bounds</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMaxLon</span><span class=\"mtk1\">())))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"95\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                                                )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"96\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                                        )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"97\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                                )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"98\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                        )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"99\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"100\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"101\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk3\">// should 절 중 최소 하나는 만족해야 함을 의미 (OR 조건)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"102\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">minimumShouldMatch</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;1&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"103\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"104\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"105\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"106\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">boolQueryBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"107\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>코드를 보면, 복잡한 필터링 로직을 createQueryForFunctionScore라는 헬퍼 메서드로 분리했다.</p>\n<p>이 메서드가 바로 위 JSON에서 봤던 까다로운 filter 부분을 전담해서 만들어준다.</p>\n<p>그리고 buildAddressDslQuery는 이 메서드가 만들어준 핵심 쿼리(coreQuery)를 받아서 function_score로 한번 더 감싸 점수를 조작하는 역할을 한다.</p>\n<hr>\n<h1 id=\"문제-해결-후기\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0-%ED%9B%84%EA%B8%B0\" aria-label=\"문제 해결 후기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 해결 후기</h1>\n<p>갑작스럽게 우리 부서의 데이터를 기반으로 API를 만들어 외부에 제공한다는 임무가 떨어졌다.</p>\n<p>거기다 해당 기능은 전담해 검색 퀄리티를 계속 향상시켜야 한다.</p>\n<p>복잡하기로 악명 높은 Elasticsearch의 DSL Query는 Gemini에게 시키면 뚝딱 만들어줬다.</p>\n<p>multi_match에 bool 쿼리를 섞고, function_score로 가중치를 주는 것까지, 그럴듯한 쿼리가 순식간에 완성됐다. 일단 기능은 돌아갔다.</p>\n<p>결국 AI가 짜준 쿼리를 보며 “대충 잘 나오는 것 같으니 넘어가자”라고 넘어갔는데 잘 알지못하니 불안한 마음이 생겼다.</p>\n<p>DSL Query 작성하는 부분은 AI도움을 받는다고 쳐도 어느정도 쿼리 튜닝이 되야하는데 쿼리가 너무 익숙치 않았다.</p>\n<p>일단, 앞으로 구현할 기능들이 남아서 책도 한권사고 패스트캠퍼스 강의 구매까지 했다.</p>\n<p>Elasticsearch 빨리 배우고, 제대로 업무에 적용해야겠다.</p>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h1>\n<p><a href=\"https://esbook.kimjmin.net/06-text-analysis/6.6-token-filter/6.6.4-ngram-edge-ngram-shingle\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">6.6.4 NGram, Edge NGram, Shingle - elk가이드북</a><br>\n<a href=\"https://www.elastic.co/docs/reference/text-analysis/analysis-ngram-tokenizer\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">N-gram tokenizer - elk doc</a><br>\n<a href=\"https://programming-tree.tistory.com/146\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">[Elasticsearch 적용기] #2 Elasticsearch 검색 정확도 높이기: Nori와 Edge n-gram을 활용한 검색 최적화 - chaewonni</a></p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .mtk1 { color: #D4D4D4; }\n  .default-dark .mtk14 { color: #F44747; }\n  .default-dark .mtk4 { color: #569CD6; }\n  .default-dark .mtk7 { color: #B5CEA8; }\n  .default-dark .mtk12 { color: #9CDCFE; }\n  .default-dark .mtk8 { color: #CE9178; }\n  .default-dark .mtk10 { color: #4EC9B0; }\n  .default-dark .mtk11 { color: #DCDCAA; }\n  .default-dark .mtk3 { color: #6A9955; }\n  .default-dark .mtk15 { color: #C586C0; }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","tableOfContents":"<ul>\n<li><a href=\"#1-out-of-memory-%EB%B0%9C%EC%83%9D\">1. out of memory 발생</a></li>\n<li><a href=\"#2-jdbc%EB%A1%9C-%EC%A0%81%EC%9E%AC-%EC%8B%9C-%EB%84%88%EB%AC%B4-%EB%8A%90%EB%A6%B0-%EC%86%8D%EB%8F%84\">2. JDBC로 적재 시 너무 느린 속도</a></li>\n<li><a href=\"#3-%ED%85%8C%EC%9D%B4%EB%B8%94-%EB%8F%99%EA%B8%B0%ED%99%94-%EC%A4%91-pnu%EC%BB%AC%EB%9F%BC-%EB%92%A4%EC%97%90-4%EC%9E%90%EB%A6%AC-%EC%88%AB%EC%9E%90-%EB%B2%84%EB%A6%BC-%EC%B2%98%EB%A6%AC\">3. 테이블 동기화 중 pnu컬럼 뒤에 4자리 숫자 버림 처리</a></li>\n<li><a href=\"#4-%EC%9D%B4%EB%A6%84-%EA%B2%80%EC%83%89-n-gram-tokenizer\">4. 이름 검색 (N gram tokenizer)</a></li>\n<li><a href=\"#5-%EC%A7%80%EB%8F%84-%ED%99%94%EB%A9%B4-%EB%82%B4-%EC%A4%91%EC%8B%AC%EA%B3%BC-%EA%B0%80%EA%B9%8C%EC%9A%B4-%EC%88%9C%EC%9C%BC%EB%A1%9C-%EA%B2%80%EC%83%89\">5. 지도 화면 내 중심과 가까운 순으로 검색</a></li>\n<li><a href=\"#6-%ED%8A%B9%EC%A0%95-%ED%95%84%EB%93%9C%EB%A5%BC-%EA%B0%80%EC%A7%84-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%8A%94-%EB%B2%94%EC%9C%84-%EA%B2%80%EC%83%89-x-%EC%83%81%EC%9C%84-%EB%85%B8%EC%B6%9C-%EA%B7%B8-%EC%99%B8-%ED%95%84%EB%93%9C%EB%93%A4%EC%9D%80-%EB%B2%94%EC%9C%84-%EA%B2%80%EC%83%89-o\">6. 특정 필드를 가진 데이터는 범위 검색 x 상위 노출, 그 외 필드들은 범위 검색 o</a></li>\n<li><a href=\"#%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0-%ED%9B%84%EA%B8%B0\">문제 해결 후기</a></li>\n<li><a href=\"#reference\">Reference</a></li>\n</ul>","frontmatter":{"title":"Logstash를 활용하며 생긴 문제 해결과정","summary":["Logstash를 활용하며 생긴 문제 해결 과정과 Query 튜닝과정을 정리한다."],"date":"2025.09.16.","category":["ELK"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABqklEQVR42o2Tz2vTYBzG97fowdMQBsrYEA9eHPSyHdxJ3VmEgechwi4DwYtHGcJAcEzIlDGUtrAWWVltBoPmIjLXuOZHLW1SYtssed+PpFlm1lnoA2/g/eZ9P3me9/tmgpSklNEjmaReCMbVRGrXgBH6Lfw/JwgZDmphr44QPglehgLfdjizHELLHQWMl0u/SV9bBnUKYawjRYC/f5Pgx8q/zzY9+otvaM+9wvuoxkUhLwOFiCOtv37Jw8ws8+93KZq/QXr82rmOnZ/G9ftEq9xmi7WpB6gvNpJcVx1eALc+MP3kKXc/HbJVj+IELNyfYfL2De583mTT0umYFtcy97i1/ZavLfvc4JDDZNoKznj+/YhnR3vkzJNBLf8lz/yjx2RyCtuWTq/TYUl5x+JBjlXtG+n9Q02JuxyNqB1+r0fHdVMti9Xtdi8SBVIMBf4PMDy/IhVVpVqtomkaRt3g5/ExpmlSqVSon56Oc20uO/E8j2w2S7lcplgsoigKtVqNQqFAqVS6cnYjgYls28YwDBqNBrqu4zjOwGG73cZ13fgnGMfhOBoFi4B/AeZ5NPy4FleyAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/550453d38d1c75694a0ab3984eb8d9a1/ccf95/thumbnail.png","srcSet":"/static/550453d38d1c75694a0ab3984eb8d9a1/ba754/thumbnail.png 483w,\n/static/550453d38d1c75694a0ab3984eb8d9a1/b4d90/thumbnail.png 966w,\n/static/550453d38d1c75694a0ab3984eb8d9a1/ccf95/thumbnail.png 1932w","sizes":"(min-width: 1932px) 1932px, 100vw"},"sources":[{"srcSet":"/static/550453d38d1c75694a0ab3984eb8d9a1/da43d/thumbnail.webp 483w,\n/static/550453d38d1c75694a0ab3984eb8d9a1/026bc/thumbnail.webp 966w,\n/static/550453d38d1c75694a0ab3984eb8d9a1/99b19/thumbnail.webp 1932w","type":"image/webp","sizes":"(min-width: 1932px) 1932px, 100vw"}]},"width":1932,"height":1108}},"publicURL":"/static/550453d38d1c75694a0ab3984eb8d9a1/thumbnail.png"}}}}]}},"pageContext":{"slug":"/logstashAndQuery/","series":[],"lastmod":"2025.09.16."}},"staticQueryHashes":["2383754777"],"slicesMap":{}}