{"componentChunkName":"component---src-templates-post-tsx","path":"/SpringCloudGateway/","result":{"data":{"site":{"siteMetadata":{"title":"Just Keep Going","description":"Ian's Archive","siteUrl":"https://hohshho.github.io"}},"allMarkdownRemark":{"edges":[{"node":{"id":"d6f4330e-16f7-5f00-9107-220ae5fd645b","html":"<p>데이터 플랫폼을 개발하며 인증과 인가 기능이 필요했다.</p>\n<p>Next.js로 구성된 프론트엔드와 여러 Spring API 서버로 나뉘어 있었고, 인증은 스프링 시큐리티의 세션 방식을 사용했다.</p>\n<p>문제는 ‘인가’였는데 관리자가 사용자의 역할(Role)에 따라 접근 가능한 URL 패턴을 동적으로 설정하고, 이를 기반으로 API 요청을 제어하는 유연한 인가 정책이 필요했다.</p>\n<p>자연스럽게 API Gateway의 필요성을 느끼게 되었고, 최종적으로 Spring Cloud Gateway를 선택하게 되었다.</p>\n<p>이 글에서는 API Gateway의 역할부터 시작해, Spring Cloud Gateway를 도입하고 시스템에 맞는 커스텀 인가 로직을 어떻게 구현했는지 그 과정을 공유한다.</p>\n<h1 id=\"1-api-gateway-주요-기능\" style=\"position:relative;\"><a href=\"#1-api-gateway-%EC%A3%BC%EC%9A%94-%EA%B8%B0%EB%8A%A5\" aria-label=\"1 api gateway 주요 기능 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. API Gateway 주요 기능</h1>\n<p>마이크로서비스 아키텍처(MSA)에서 API Gateway는 시스템의 ‘대문’ 역할을 수행한다. 클라이언트의 모든 요청을 단일 진입점(Single Entry Point)에서 받아 처리하며, 다음과 같은 핵심 기능을 담당한다.</p>\n<ul>\n<li>인증과 인가: 모든 요청에 대해 공통 인증/인가 로직을 적용</li>\n<li>API 라우팅: 요청 경로, 헤더 등을 분석하여 가장 적절한 마이크로서비스로 요청을 전달</li>\n<li>QoS (Quality of Service): Rate Limiting(요청 수 제한), 서킷 브레이커 등을 통해 서비스의 안정성과 품질을 관리</li>\n<li>로깅 및 모니터링: 모든 트래픽이 게이트웨이를 통과하므로, 중앙에서 로그를 수집하고 요청을 모니터링하기 용이</li>\n</ul>\n<h1 id=\"2-api-gateway-구축-방법\" style=\"position:relative;\"><a href=\"#2-api-gateway-%EA%B5%AC%EC%B6%95-%EB%B0%A9%EB%B2%95\" aria-label=\"2 api gateway 구축 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. API Gateway 구축 방법</h1>\n<ul>\n<li>상용 솔루션 사용: 검증된 성능과 다양한 기능을 제공하지만, 라이선스 비용이 발생하고 커스터마이징에 제약</li>\n<li>오픈소스 솔루션 사용: 저렴한 비용으로 강력한 기능을 활용할 수 있지만, 기술 지원이 부족하거나 특정 요구사항을 반영하기 어려울 수 있다.</li>\n<li>오픈소스 기반으로 직접 개발: 우리 환경에 최적화된 게이트웨이를 구축할 수 있지만, 개발 및 유지보수 비용이 높고 경험 부족으로 인한 시행착오를 겪을 수 있다.</li>\n</ul>\n<p>Spring 생태계와의 높은 통합성, 유연한 커스터마이징 가능성을 고려하여 Spring Cloud Gateway를 기반으로 직접 개발하는 방식을 선택</p>\n<h1 id=\"3-spring-cloud-gateway\" style=\"position:relative;\"><a href=\"#3-spring-cloud-gateway\" aria-label=\"3 spring cloud gateway permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Spring Cloud Gateway</h1>\n<p>Spring Cloud Gateway는 Spring 생태계 위에서 동작하는 API Gateway 프로젝트</p>\n<ul>\n<li>Spring 생테계를 기반으로 하는 API Gateway를 제공해주는 프로젝트</li>\n<li>Netty 기반의 비동기(Asynchronous) 요청 처리 제공</li>\n<li>Spring에서 제공하는 다양한 Component를 조합하여 효율적인 개발이 가능</li>\n<li>security, monitoring/metrics등과 같은 공통 관심사 처리</li>\n</ul>\n<h1 id=\"31-spring-cloud-gateway-동작-순서\" style=\"position:relative;\"><a href=\"#31-spring-cloud-gateway-%EB%8F%99%EC%9E%91-%EC%88%9C%EC%84%9C\" aria-label=\"31 spring cloud gateway 동작 순서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.1 Spring Cloud Gateway 동작 순서</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 449px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/76630ff7703608c4128cfec9171d5383/46d70/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 138.03680981595093%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACFElEQVR42qWVB6vDMAyE8///XUtp6d57712VT3DFlCSv5hmEY8c+n06ynFhGez6f9ng83O73u5vGeS1Jm2Tzbrez0+lkh8PBzuezG+PtdmvX6zUOkA0A0NbrtbXbbZvNZj6+XC5uUYC3282ZwGi/39t8PndgxpvNJh/w9Xq5Lmgm3QCEJRvpAaOXSdNvAytBIxhg0+nUGQhQPXpKR2mJHY/Hj4GDNwmD4XBozWbTOp2OTSYTG4/Htlwu/RAOAITTafR4onHYAHWGSgkWoh0njUYjP4hgdLtdGwwGtlgs3BTtTMDwNNxjDrbFYtFqtZrV63UrFApWqVSs1Wr5GuxnQNgBCEMk6PV6PgcYbOmZlwS5gLiOZgoGEVbasFbBIGB/MlRPQNAMlnwTGDFFOwDTbksm4Gq1cvG1mTGgmFImLblTXdbVw/jHRrmIBIDyLzdtvn8CQOrgpqLOHGC6gqRYlMv9ft91JLokOhKoEbQol2EFQ/UY69BUjH+KclgPlTZhcWUtbmcV2UxARReXKRi4Sy7ivtj+lDZhUADlqpVKJSuXy9ZoNKxarX4qdpSGzOmqERxYcg1JdMawjGKI4JhuhHTUO8O/zDxkkyqzjA0AKJn5DyvSRa9guF4SOCAnhdVYBpDShODoW2/N93ole+YjpWuHfuhJr0oT/eqFzyj1T1HG3fBf1EOvXOTaEVn6sDhEAf6nvQF80YPJYQ1vagAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/76630ff7703608c4128cfec9171d5383/a81b5/1.webp 163w,\n/static/76630ff7703608c4128cfec9171d5383/da3ef/1.webp 325w,\n/static/76630ff7703608c4128cfec9171d5383/b1433/1.webp 449w\"\n              sizes=\"(max-width: 449px) 100vw, 449px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/76630ff7703608c4128cfec9171d5383/5e043/1.png 163w,\n/static/76630ff7703608c4128cfec9171d5383/e5cc6/1.png 325w,\n/static/76630ff7703608c4128cfec9171d5383/46d70/1.png 449w\"\n            sizes=\"(max-width: 449px) 100vw, 449px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/76630ff7703608c4128cfec9171d5383/46d70/1.png\"\n            alt=\"1\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ul>\n<li>Client가 Spring Cloud Gateway로 요청</li>\n<li>Gateway Handler Mapping은 요청이 사전 정의된 라우팅 규칙(Route)과 일치하는지 확인</li>\n<li>일치하는 규칙이 있다면, 요청을 Gateway Web Handler로 전달</li>\n<li>Gateway Web Handler는 해당 요청에 적용될 필터 체인(Filter Chain)을 통해 요청을 처리. 필터들은 요청을 수정하거나, 인증/인가를 수행하고, 최종적으로 다운스트림 서비스로 요청을 프록시</li>\n</ul>\n<h1 id=\"32-spring-cloud-gateway-장-단점\" style=\"position:relative;\"><a href=\"#32-spring-cloud-gateway-%EC%9E%A5-%EB%8B%A8%EC%A0%90\" aria-label=\"32 spring cloud gateway 장 단점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.2 Spring Cloud Gateway 장, 단점</h1>\n<ul>\n<li>장점\n<ul>\n<li>라이선스 투자비용 없음</li>\n<li>WebFlux기반의 Non-Blocking 방식으로 빠른 응답 속도 확보</li>\n<li>Spring에서 제공하는 다양한 서비스와 조합 가능</li>\n<li>요청을 다른 서버로 라우팅시키는 부분을 간단한 yaml 파일로 완성할 수 있음</li>\n<li>라우티 전/후에 손쉽게 부가 기능을 추가할 수 있음(GatewayFilter를 등록할 수 있고, 이미 많은 필터를 제공해주고 있음)\n<ul>\n<li>ex) 헤더 추가 필터, RateLimit 필터 등</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>단점\n<ul>\n<li>서비스 구현에서 다양한 테스트 및 문제 해결을 통한 최적화 필요</li>\n<li>GUI기반에 관리 기능 미제공</li>\n<li>추가 기능의 구현을 WebFlux 기반(리액티브)으로 작성해야 하므로 어려울 수 있음</li>\n<li>라우팅 대상 서버가 많아진다면 관리가 어려울 수 있음</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"5-구현\" style=\"position:relative;\"><a href=\"#5-%EA%B5%AC%ED%98%84\" aria-label=\"5 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 구현</h1>\n<h1 id=\"41-yml-파일-작성\" style=\"position:relative;\"><a href=\"#41-yml-%ED%8C%8C%EC%9D%BC-%EC%9E%91%EC%84%B1\" aria-label=\"41 yml 파일 작성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.1 yml 파일 작성</h1>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"29470197621073280000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"복사 되었습니다!\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`spring:\r\n  # Redis 및 세션 설정\r\n  data:\r\n    redis:\r\n      host: 192.168.50.248\r\n      port: 6379\r\n      password: # password\r\n\r\n  # Spring Cloud Gateway 설정\r\n  cloud:\r\n    gateway:\r\n      server:\r\n        webflux:\r\n          # ==================================\r\n          # 1. 라우팅 규칙 (Routing Rules)\r\n          # ==================================\r\n          routes:\r\n            # mng-service route\r\n            - id: mng-service-route\r\n              uri: http://localhost:8090\r\n              predicates:\r\n                - Path=/dataplatform/mng/**\r\n              filters:\r\n                - AuthorizationFilter\r\n\r\n            # clct-service route\r\n            - id: clct-service-route\r\n              uri: http://localhost:8085\r\n              predicates:\r\n                - Path=/dataplatform/clct/**\r\n              filters:\r\n                - AuthorizationFilter\r\n\r\n            # geoserver route\r\n            - id: geoserver-route\r\n              uri: http://localhost:8200\r\n              predicates:\r\n                - Path=/dataplatform/geoserver/**\r\n              filters:\r\n                # /dataplatform/geoserver 라는 경로 세그먼트 2개를 제거하고 전달\r\n                - StripPrefix=2\r\n                # filters:\r\n                # - AuthorizationFilter # TODO: GeoServer는 자체 인증/인가를 사용하거나 공개될 수 있으므로, 적용 여부 결정해야 함\r\n\r\n            # api server route\r\n            - id: apiserver-route\r\n              uri: http://localhost:8200\r\n              predicates:\r\n                - Path=/dataplatform/api/**\r\n              filters:\r\n                # /dataplatform/geoserver 라는 경로 세그먼트 2개를 제거하고 전달\r\n                - StripPrefix=2\r\n                # filters:\r\n                # - AuthorizationFilter # TODO: GeoServer는 자체 인증/인가를 사용하거나 공개될 수 있으므로, 적용 여부 결정해야 함\r\n\r\n\r\n          # ==================================\r\n          # 전역 CORS 설정 (Global CORS)\r\n          # ==================================\r\n          globalcors:\r\n            cors-configurations:\r\n              '[/**]': # 모든 경로(/**)에 대해 적용\r\n                allowed-origins:\r\n                  - &quot;http://localhost:3000&quot; # 프론트엔드 개발 서버 주소\r\n                #              - &quot;https://your-frontend-domain.com&quot; # 실제 서비스 도메인\r\n                allowed-methods:\r\n                  - &quot;GET&quot;\r\n                  - &quot;POST&quot;\r\n                  - &quot;PUT&quot;\r\n                  - &quot;DELETE&quot;\r\n                  - &quot;OPTIONS&quot;\r\n                  - &quot;PATCH&quot;\r\n                allowed-headers: &quot;*&quot;\r\n                allow-credentials: true`, `29470197621073280000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                복사<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"yml\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">spring</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Redis 및 세션 설정</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">data</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">redis</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">host</span><span class=\"mtk1\">: </span><span class=\"mtk7\">192.168.50.248</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">port</span><span class=\"mtk1\">: </span><span class=\"mtk7\">6379</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">password</span><span class=\"mtk1\">: </span><span class=\"mtk3\"># password</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Spring Cloud Gateway 설정</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">cloud</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">gateway</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">server</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">webflux</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk3\"># ==================================</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk3\"># 1. 라우팅 규칙 (Routing Rules)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"16\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk3\"># ==================================</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"17\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">routes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"18\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\"># mng-service route</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"19\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            - </span><span class=\"mtk4\">id</span><span class=\"mtk1\">: </span><span class=\"mtk8\">mng-service-route</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"20\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk4\">uri</span><span class=\"mtk1\">: </span><span class=\"mtk8\">http://localhost:8090</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"21\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk4\">predicates</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"22\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                - </span><span class=\"mtk8\">Path=/dataplatform/mng/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"23\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk4\">filters</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"24\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                - </span><span class=\"mtk8\">AuthorizationFilter</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"25\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"26\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\"># clct-service route</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"27\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            - </span><span class=\"mtk4\">id</span><span class=\"mtk1\">: </span><span class=\"mtk8\">clct-service-route</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"28\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk4\">uri</span><span class=\"mtk1\">: </span><span class=\"mtk8\">http://localhost:8085</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"29\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk4\">predicates</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"30\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                - </span><span class=\"mtk8\">Path=/dataplatform/clct/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"31\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk4\">filters</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"32\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                - </span><span class=\"mtk8\">AuthorizationFilter</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"33\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"34\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\"># geoserver route</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"35\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            - </span><span class=\"mtk4\">id</span><span class=\"mtk1\">: </span><span class=\"mtk8\">geoserver-route</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"36\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk4\">uri</span><span class=\"mtk1\">: </span><span class=\"mtk8\">http://localhost:8200</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"37\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk4\">predicates</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"38\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                - </span><span class=\"mtk8\">Path=/dataplatform/geoserver/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"39\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk4\">filters</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"40\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\"># /dataplatform/geoserver 라는 경로 세그먼트 2개를 제거하고 전달</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"41\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                - </span><span class=\"mtk8\">StripPrefix=2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"42\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\"># filters:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"43\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\"># - AuthorizationFilter # TODO: GeoServer는 자체 인증/인가를 사용하거나 공개될 수 있으므로, 적용 여부 결정해야 함</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"44\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"45\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\"># api server route</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"46\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            - </span><span class=\"mtk4\">id</span><span class=\"mtk1\">: </span><span class=\"mtk8\">apiserver-route</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"47\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk4\">uri</span><span class=\"mtk1\">: </span><span class=\"mtk8\">http://localhost:8200</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"48\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk4\">predicates</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"49\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                - </span><span class=\"mtk8\">Path=/dataplatform/api/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"50\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk4\">filters</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"51\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\"># /dataplatform/geoserver 라는 경로 세그먼트 2개를 제거하고 전달</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"52\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                - </span><span class=\"mtk8\">StripPrefix=2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"53\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\"># filters:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"54\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\"># - AuthorizationFilter # TODO: GeoServer는 자체 인증/인가를 사용하거나 공개될 수 있으므로, 적용 여부 결정해야 함</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"55\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"56\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"57\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk3\"># ==================================</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"58\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk3\"># 전역 CORS 설정 (Global CORS)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"59\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk3\"># ==================================</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"60\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">globalcors</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"61\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk4\">cors-configurations</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"62\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk8\">&#39;[/**]&#39;</span><span class=\"mtk1\">: </span><span class=\"mtk3\"># 모든 경로(/**)에 대해 적용</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"63\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk4\">allowed-origins</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"64\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                  - </span><span class=\"mtk8\">&quot;http://localhost:3000&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk3\"># 프론트엔드 개발 서버 주소</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"65\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\">#              - &quot;https://your-frontend-domain.com&quot; # 실제 서비스 도메인</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"66\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk4\">allowed-methods</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"67\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                  - </span><span class=\"mtk8\">&quot;GET&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"68\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                  - </span><span class=\"mtk8\">&quot;POST&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"69\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                  - </span><span class=\"mtk8\">&quot;PUT&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"70\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                  - </span><span class=\"mtk8\">&quot;DELETE&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"71\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                  - </span><span class=\"mtk8\">&quot;OPTIONS&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"72\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                  - </span><span class=\"mtk8\">&quot;PATCH&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"73\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk4\">allowed-headers</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;*&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"74\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk4\">allow-credentials</span><span class=\"mtk1\">: </span><span class=\"mtk4\">true</span></span></span></code></pre>\n<p>먼저 게이트웨이의 핵심인 라우팅 규칙을 정의</p>\n<p>Spring Cloud Gateway에는 크게 3가지 구성요소가 존재</p>\n<p>Route란?</p>\n<ul>\n<li>고유ID, 목적지 URI, Predicate, Filter로 구성된 구성요소.</li>\n<li>GATEWAY로 요청된 URI의 조건이 참일 경우, 매핑된 해당 경로로 매칭</li>\n</ul>\n<p>Predicate란?</p>\n<ul>\n<li>주어진 요청이 주어진 조건을 충족하는지 테스트하는 구성요소</li>\n<li>각 요청 경로에 대해 충족하게 되는 경우 하나 이상의 조건자를 정의</li>\n<li>만약 Predicate에 매칭되지 않는다면 HTTP 404 not found를 응답</li>\n<li>ex) Path, Cookie, Header, IP 등등</li>\n</ul>\n<p>Filter란?</p>\n<ul>\n<li>GATEWAY 기준으로 들어오는 요청 및 나가는 응답에 대하여 수정을 가능하게 해주는 구성요소</li>\n<li>Request/Response 에 대한 수정(Header 추가)</li>\n<li>적절한 요청인지 검사 및 응답 거부</li>\n<li>인증, 로깅 등과 같은 공통관심사 해결</li>\n</ul>\n<h1 id=\"42-인가-로직-코드-작성\" style=\"position:relative;\"><a href=\"#42-%EC%9D%B8%EA%B0%80-%EB%A1%9C%EC%A7%81-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1\" aria-label=\"42 인가 로직 코드 작성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.2 인가 로직 코드 작성</h1>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"78618820159269400000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"복사 되었습니다!\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`package com.egis.dataplatformgateway.filter;\r\n\r\nimport com.fasterxml.jackson.core.type.TypeReference;\r\nimport com.fasterxml.jackson.databind.ObjectMapper;\r\nimport lombok.extern.slf4j.Slf4j;\r\nimport org.springframework.beans.factory.annotation.Value;\r\nimport org.springframework.cloud.gateway.filter.GatewayFilter;\r\nimport org.springframework.cloud.gateway.filter.GatewayFilterChain;\r\nimport org.springframework.cloud.gateway.filter.factory.AbstractGatewayFilterFactory;\r\nimport org.springframework.core.Ordered;\r\nimport org.springframework.core.io.buffer.DataBuffer;\r\nimport org.springframework.data.redis.core.ReactiveRedisTemplate;\r\nimport org.springframework.http.HttpCookie;\r\nimport org.springframework.http.HttpMethod;\r\nimport org.springframework.http.HttpStatus;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.http.server.reactive.ServerHttpRequest;\r\nimport org.springframework.http.server.reactive.ServerHttpResponse;\r\nimport org.springframework.stereotype.Component;\r\nimport org.springframework.util.AntPathMatcher;\r\nimport org.springframework.util.CollectionUtils;\r\nimport org.springframework.util.StringUtils;\r\nimport org.springframework.web.server.ServerWebExchange;\r\nimport reactor.core.publisher.Flux;\r\nimport reactor.core.publisher.Mono;\r\n\r\nimport java.util.Collections;\r\nimport java.util.List;\r\nimport java.util.Map;\r\nimport java.util.Set;\r\nimport java.util.stream.Collectors;\r\n\r\n@Component\r\n@Slf4j\r\npublic class AuthorizationFilter extends AbstractGatewayFilterFactory<AuthorizationFilter.Config> implements Ordered {\r\n\r\n    // 공개 경로 패턴 목록\r\n    private static final List<String> PUBLIC_PATTERNS = List.of(\r\n            &quot;/dataplatform/mng/user/**&quot;,\r\n            // ...\r\n    );\r\n\r\n    private final AntPathMatcher pathMatcher;\r\n    private final ReactiveRedisTemplate<String, String> redisTemplate;\r\n    private final ObjectMapper objectMapper;\r\n    private final String activeProfile;\r\n\r\n    public AuthorizationFilter(ReactiveRedisTemplate<String, String> redisTemplate,\r\n                               ObjectMapper objectMapper,\r\n                               @Value(&quot;\\${spring.profiles.active}&quot;) String activeProfile) {\r\n        super(Config.class);\r\n        this.redisTemplate = redisTemplate;\r\n        this.objectMapper = objectMapper;\r\n        this.activeProfile = activeProfile;\r\n        this.pathMatcher = new AntPathMatcher();\r\n    }\r\n\r\n    @Override\r\n    public GatewayFilter apply(Config config) {\r\n        return (exchange, chain) -> {\r\n            ServerHttpRequest request = exchange.getRequest();\r\n            String path = request.getURI().getPath();\r\n\r\n            // Preflight 요청(OPTIONS)을 게이트웨이에서 직접 처리하고 즉시 성공 응답을 보냄\r\n            if (request.getMethod() == HttpMethod.OPTIONS) {\r\n                ServerHttpResponse response = exchange.getResponse();\r\n                response.setStatusCode(HttpStatus.OK);\r\n                return response.setComplete();\r\n            }\r\n\r\n            if (isPublicPath(path)) {\r\n                return chain.filter(exchange);\r\n            }\r\n\r\n            HttpCookie sessionCookie = request.getCookies().getFirst(&quot;SESSION&quot;);\r\n            if (sessionCookie == null) {\r\n                return unauthorizedResponse(exchange, &quot;인증 정보가 없습니다.&quot;);\r\n            }\r\n\r\n            String redisSessionKey = activeProfile + &quot;:sessions:&quot; + sessionCookie.getValue();\r\n\r\n            return redisTemplate.opsForHash().entries(redisSessionKey)\r\n                    .collectMap(entry -> entry.getKey().toString(), entry -> entry.getValue().toString())\r\n                    .flatMap(sessionData -> {\r\n                        if (sessionData.isEmpty()) {\r\n                            return unauthorizedResponse(exchange, &quot;세션이 만료되었거나 유효하지 않습니다.&quot;);\r\n                        }\r\n                        // JSON 문자열로 저장된 값을 원래의 String 값으로 변환\r\n                        String userId = convertJsonToString(sessionData.get(&quot;sessionAttr:ENCRYPTED_USER_ID&quot;));\r\n                        List<String> roles = convertJsonToList(sessionData.get(&quot;sessionAttr:ROLES&quot;));\r\n\r\n                        if (!StringUtils.hasText(userId) || CollectionUtils.isEmpty(roles)) {\r\n                            log.warn(&quot;세션에 필수 정보 누락. UserID: {}, Roles: {}&quot;, userId, roles);\r\n                            return unauthorizedResponse(exchange, &quot;세션 정보가 올바르지 않습니다.&quot;);\r\n                        }\r\n\r\n                        return checkPermissions(exchange, chain, path, userId, roles);\r\n                    });\r\n        };\r\n    }\r\n\r\n    private String convertJsonToString(String jsonString) {\r\n        if (jsonString == null || jsonString.isEmpty()) {\r\n            return null;\r\n        }\r\n        try {\r\n            return objectMapper.readValue(jsonString, String.class);\r\n        } catch (Exception e) {\r\n            log.error(&quot;Redis 데이터(JSON)를 String으로 변환하는데 실패했습니다. Data: {}&quot;, jsonString, e);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    private List<String> convertJsonToList(String jsonString) {\r\n        if (jsonString == null || jsonString.isEmpty()) {\r\n            return Collections.emptyList();\r\n        }\r\n        try {\r\n            return objectMapper.readValue(jsonString, new TypeReference<List<String>>() {});\r\n        } catch (Exception e) {\r\n            log.error(&quot;Redis 데이터(JSON)를 List<String>으로 변환하는데 실패했습니다. Data: {}&quot;, jsonString, e);\r\n            return Collections.emptyList();\r\n        }\r\n    }\r\n\r\n    private Mono<Void> checkPermissions(ServerWebExchange exchange, GatewayFilterChain chain, String path, String userId, List<String> roles) {\r\n        Mono<Set<String>> authoritiesMono = Flux.fromIterable(roles)\r\n                .map(role -> role.startsWith(&quot;ROLE_&quot;) ? role.substring(5).toLowerCase() : role.toLowerCase())\r\n                .flatMap(role -> redisTemplate.opsForHash().get(AUTH_URL_KEY, role))\r\n                .cast(String.class)\r\n                .map(this::convertJsonToList)\r\n                .flatMap(Flux::fromIterable)\r\n                .collect(Collectors.toSet());\r\n\r\n        return authoritiesMono.flatMap(allPermissions -> {\r\n            if (allPermissions.isEmpty()) {\r\n                log.warn(&quot;인가 규칙 없음: User [{}], Roles {}에 대한 권한 정보가 Redis에 없습니다.&quot;, userId, roles);\r\n                return forbiddenResponse(exchange, &quot;접근 권한이 설정되지 않았습니다.&quot;);\r\n            }\r\n\r\n            if (hasPermission(path, allPermissions)) {\r\n                log.info(&quot;인가 성공: User [{}], Roles {}, Path {}&quot;, userId, roles, path);\r\n                ServerHttpRequest mutatedRequest = exchange.getRequest().mutate()\r\n                        .header(&quot;X-User-Id&quot;, userId)\r\n                        .header(&quot;X-User-Roles&quot;, String.join(&quot;,&quot;, roles))\r\n                        .build();\r\n                return chain.filter(exchange.mutate().request(mutatedRequest).build());\r\n            } else {\r\n                log.warn(&quot;인가 최종 실패: User [{}], Roles {}, Path {}. Accessible Patterns: {}&quot;, userId, roles, path, allPermissions);\r\n                return forbiddenResponse(exchange, &quot;접근 권한이 없습니다.&quot;);\r\n            }\r\n        });\r\n    }\r\n\r\n    @Override\r\n    public int getOrder() {\r\n        return -1;\r\n    }\r\n\r\n    private boolean isPublicPath(String path) {\r\n        return PUBLIC_PATTERNS.stream().anyMatch(pattern -> pathMatcher.match(pattern, path));\r\n    }\r\n\r\n    private boolean hasPermission(String requestPath, Set<String> accessibleUrlPatterns) {\r\n        log.info(&quot;===== [권한 검사] 요청 경로: '{}'&quot;, requestPath);\r\n        for (String pattern : accessibleUrlPatterns) {\r\n            if (pathMatcher.match(pattern, requestPath)) {\r\n                log.info(&quot;=====>> [권한 검사] 성공! 패턴: '{}'&quot;, pattern);\r\n                return true;\r\n            }\r\n        }\r\n        log.warn(&quot;=====>> [권한 검사] 실패. 어떤 패턴과도 일치하지 않음.&quot;);\r\n        return false;\r\n    }\r\n\r\n    private Mono<Void> unauthorizedResponse(ServerWebExchange exchange, String message) {\r\n        return createErrorResponse(exchange, HttpStatus.UNAUTHORIZED, message);\r\n    }\r\n\r\n    private Mono<Void> forbiddenResponse(ServerWebExchange exchange, String message) {\r\n        return createErrorResponse(exchange, HttpStatus.FORBIDDEN, message);\r\n    }\r\n\r\n    private Mono<Void> createErrorResponse(ServerWebExchange exchange, HttpStatus status, String message) {\r\n        ServerHttpResponse response = exchange.getResponse();\r\n        response.setStatusCode(status);\r\n        response.getHeaders().setContentType(MediaType.APPLICATION_JSON);\r\n        Map<String, String> errorBody = Map.of(&quot;status&quot;, String.valueOf(status.value()), &quot;message&quot;, message);\r\n        try {\r\n            byte[] bytes = objectMapper.writeValueAsBytes(errorBody);\r\n            DataBuffer buffer = response.bufferFactory().wrap(bytes);\r\n            return response.writeWith(Mono.just(buffer));\r\n        } catch (Exception e) {\r\n            log.error(&quot;오류 응답 생성 실패&quot;, e);\r\n            // 오류 응답 생성에 실패하면 최소한 상태 코드라도 보내도록 처리\r\n            return response.setComplete();\r\n        }\r\n    }\r\n\r\n    public static class Config {}\r\n}`, `78618820159269400000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                복사<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">package</span><span class=\"mtk1\"> com.egis.dataplatformgateway.filter;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> com.fasterxml.jackson.core.type.TypeReference;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> com.fasterxml.jackson.databind.ObjectMapper;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> lombok.extern.slf4j.Slf4j;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.beans.factory.annotation.Value;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.cloud.gateway.filter.GatewayFilter;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.cloud.gateway.filter.factory.AbstractGatewayFilterFactory;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.core.Ordered;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.core.io.buffer.DataBuffer;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.data.redis.core.ReactiveRedisTemplate;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.http.HttpCookie;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.http.HttpMethod;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.http.HttpStatus;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"16\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.http.MediaType;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"17\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.http.server.reactive.ServerHttpRequest;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"18\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.http.server.reactive.ServerHttpResponse;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"19\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.stereotype.Component;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"20\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.util.AntPathMatcher;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"21\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.util.CollectionUtils;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"22\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.util.StringUtils;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"23\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> org.springframework.web.server.ServerWebExchange;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"24\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> reactor.core.publisher.Flux;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"25\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> reactor.core.publisher.Mono;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"26\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"27\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.util.Collections;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"28\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.util.List;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"29\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.util.Map;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"30\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.util.Set;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"31\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.util.stream.Collectors;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"32\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"33\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Component</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"34\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Slf4j</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"35\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">AuthorizationFilter</span><span class=\"mtk1\"> </span><span class=\"mtk4\">extends</span><span class=\"mtk1\"> </span><span class=\"mtk10\">AbstractGatewayFilterFactory</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">AuthorizationFilter</span><span class=\"mtk1\">.</span><span class=\"mtk10\">Config</span><span class=\"mtk1\">&gt; </span><span class=\"mtk4\">implements</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Ordered</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"36\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"37\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// 공개 경로 패턴 목록</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"38\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">PUBLIC_PATTERNS</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">List</span><span class=\"mtk1\">.</span><span class=\"mtk11\">of</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"39\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk8\">&quot;/dataplatform/mng/user/**&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"40\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"41\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"42\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"43\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">AntPathMatcher</span><span class=\"mtk1\"> </span><span class=\"mtk12\">pathMatcher</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"44\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ReactiveRedisTemplate</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">redisTemplate</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"45\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ObjectMapper</span><span class=\"mtk1\"> </span><span class=\"mtk12\">objectMapper</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"46\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">activeProfile</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"47\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"48\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">AuthorizationFilter</span><span class=\"mtk1\">(</span><span class=\"mtk10\">ReactiveRedisTemplate</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">redisTemplate</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"49\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                               </span><span class=\"mtk10\">ObjectMapper</span><span class=\"mtk1\"> </span><span class=\"mtk12\">objectMapper</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"50\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                               @</span><span class=\"mtk10\">Value</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;${spring.profiles.active}&quot;</span><span class=\"mtk1\">) </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">activeProfile</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"51\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">super</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Config</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"52\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">redisTemplate</span><span class=\"mtk1\"> = redisTemplate;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"53\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">objectMapper</span><span class=\"mtk1\"> = objectMapper;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"54\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">activeProfile</span><span class=\"mtk1\"> = activeProfile;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"55\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">pathMatcher</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">AntPathMatcher</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"56\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"57\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"58\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"59\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">GatewayFilter</span><span class=\"mtk1\"> </span><span class=\"mtk11\">apply</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Config</span><span class=\"mtk1\"> </span><span class=\"mtk12\">config</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"60\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> (exchange, chain) </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"61\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">ServerHttpRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">request</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">exchange</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getRequest</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"62\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">path</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">request</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getURI</span><span class=\"mtk1\">().</span><span class=\"mtk11\">getPath</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"63\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"64\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Preflight 요청(OPTIONS)을 게이트웨이에서 직접 처리하고 즉시 성공 응답을 보냄</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"65\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">request</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMethod</span><span class=\"mtk1\">() == </span><span class=\"mtk12\">HttpMethod</span><span class=\"mtk1\">.</span><span class=\"mtk12\">OPTIONS</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"66\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk10\">ServerHttpResponse</span><span class=\"mtk1\"> </span><span class=\"mtk12\">response</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">exchange</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getResponse</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"67\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">response</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setStatusCode</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpStatus</span><span class=\"mtk1\">.</span><span class=\"mtk12\">OK</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"68\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">response</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setComplete</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"69\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"70\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"71\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk11\">isPublicPath</span><span class=\"mtk1\">(path)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"72\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">chain</span><span class=\"mtk1\">.</span><span class=\"mtk11\">filter</span><span class=\"mtk1\">(exchange);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"73\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"74\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"75\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">HttpCookie</span><span class=\"mtk1\"> </span><span class=\"mtk12\">sessionCookie</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">request</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getCookies</span><span class=\"mtk1\">().</span><span class=\"mtk11\">getFirst</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;SESSION&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"76\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (sessionCookie == </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"77\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">unauthorizedResponse</span><span class=\"mtk1\">(exchange, </span><span class=\"mtk8\">&quot;인증 정보가 없습니다.&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"78\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"79\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"80\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">redisSessionKey</span><span class=\"mtk1\"> = activeProfile + </span><span class=\"mtk8\">&quot;:sessions:&quot;</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">sessionCookie</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getValue</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"81\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"82\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">redisTemplate</span><span class=\"mtk1\">.</span><span class=\"mtk11\">opsForHash</span><span class=\"mtk1\">().</span><span class=\"mtk11\">entries</span><span class=\"mtk1\">(redisSessionKey)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"83\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                    .</span><span class=\"mtk11\">collectMap</span><span class=\"mtk1\">(entry </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">entry</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getKey</span><span class=\"mtk1\">().</span><span class=\"mtk11\">toString</span><span class=\"mtk1\">(), entry </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">entry</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getValue</span><span class=\"mtk1\">().</span><span class=\"mtk11\">toString</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"84\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                    .</span><span class=\"mtk11\">flatMap</span><span class=\"mtk1\">(sessionData </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"85\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">sessionData</span><span class=\"mtk1\">.</span><span class=\"mtk11\">isEmpty</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"86\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">unauthorizedResponse</span><span class=\"mtk1\">(exchange, </span><span class=\"mtk8\">&quot;세션이 만료되었거나 유효하지 않습니다.&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"87\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"88\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk3\">// JSON 문자열로 저장된 값을 원래의 String 값으로 변환</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"89\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">userId</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">convertJsonToString</span><span class=\"mtk1\">(</span><span class=\"mtk12\">sessionData</span><span class=\"mtk1\">.</span><span class=\"mtk11\">get</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;sessionAttr:ENCRYPTED_USER_ID&quot;</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"90\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">roles</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">convertJsonToList</span><span class=\"mtk1\">(</span><span class=\"mtk12\">sessionData</span><span class=\"mtk1\">.</span><span class=\"mtk11\">get</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;sessionAttr:ROLES&quot;</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"91\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"92\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (!</span><span class=\"mtk12\">StringUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">hasText</span><span class=\"mtk1\">(userId) || </span><span class=\"mtk12\">CollectionUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">isEmpty</span><span class=\"mtk1\">(roles)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"93\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                            </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warn</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;세션에 필수 정보 누락. UserID: {}, Roles: {}&quot;</span><span class=\"mtk1\">, userId, roles);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"94\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">unauthorizedResponse</span><span class=\"mtk1\">(exchange, </span><span class=\"mtk8\">&quot;세션 정보가 올바르지 않습니다.&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"95\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"96\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"97\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">checkPermissions</span><span class=\"mtk1\">(exchange, chain, path, userId, roles);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"98\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                    });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"99\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        };</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"100\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"101\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"102\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk11\">convertJsonToString</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">jsonString</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"103\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (jsonString == </span><span class=\"mtk4\">null</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">jsonString</span><span class=\"mtk1\">.</span><span class=\"mtk11\">isEmpty</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"104\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">null</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"105\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"106\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"107\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">objectMapper</span><span class=\"mtk1\">.</span><span class=\"mtk11\">readValue</span><span class=\"mtk1\">(jsonString, </span><span class=\"mtk12\">String</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"108\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">Exception</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"109\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">error</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Redis 데이터(JSON)를 String으로 변환하는데 실패했습니다. Data: {}&quot;</span><span class=\"mtk1\">, jsonString, e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"110\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">null</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"111\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"112\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"113\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"114\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">&gt; </span><span class=\"mtk11\">convertJsonToList</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">jsonString</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"115\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (jsonString == </span><span class=\"mtk4\">null</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">jsonString</span><span class=\"mtk1\">.</span><span class=\"mtk11\">isEmpty</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"116\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Collections</span><span class=\"mtk1\">.</span><span class=\"mtk11\">emptyList</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"117\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"118\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"119\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">objectMapper</span><span class=\"mtk1\">.</span><span class=\"mtk11\">readValue</span><span class=\"mtk1\">(jsonString, </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">TypeReference</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">&gt;&gt;() {});</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"120\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">Exception</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"121\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">error</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Redis 데이터(JSON)를 List&lt;String&gt;으로 변환하는데 실패했습니다. Data: {}&quot;</span><span class=\"mtk1\">, jsonString, e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"122\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Collections</span><span class=\"mtk1\">.</span><span class=\"mtk11\">emptyList</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"123\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"124\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"125\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"126\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Mono</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Void</span><span class=\"mtk1\">&gt; </span><span class=\"mtk11\">checkPermissions</span><span class=\"mtk1\">(</span><span class=\"mtk10\">ServerWebExchange</span><span class=\"mtk1\"> </span><span class=\"mtk12\">exchange</span><span class=\"mtk1\">, </span><span class=\"mtk10\">GatewayFilterChain</span><span class=\"mtk1\"> </span><span class=\"mtk12\">chain</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">path</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">userId</span><span class=\"mtk1\">, </span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">roles</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"127\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Mono</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Set</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">&gt;&gt; </span><span class=\"mtk12\">authoritiesMono</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Flux</span><span class=\"mtk1\">.</span><span class=\"mtk11\">fromIterable</span><span class=\"mtk1\">(roles)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"128\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">map</span><span class=\"mtk1\">(role </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">role</span><span class=\"mtk1\">.</span><span class=\"mtk11\">startsWith</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;ROLE_&quot;</span><span class=\"mtk1\">) </span><span class=\"mtk15\">?</span><span class=\"mtk1\"> </span><span class=\"mtk12\">role</span><span class=\"mtk1\">.</span><span class=\"mtk11\">substring</span><span class=\"mtk1\">(</span><span class=\"mtk7\">5</span><span class=\"mtk1\">).</span><span class=\"mtk11\">toLowerCase</span><span class=\"mtk1\">() </span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">role</span><span class=\"mtk1\">.</span><span class=\"mtk11\">toLowerCase</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"129\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">flatMap</span><span class=\"mtk1\">(role </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">redisTemplate</span><span class=\"mtk1\">.</span><span class=\"mtk11\">opsForHash</span><span class=\"mtk1\">().</span><span class=\"mtk11\">get</span><span class=\"mtk1\">(AUTH_URL_KEY, role))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"130\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">cast</span><span class=\"mtk1\">(</span><span class=\"mtk12\">String</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"131\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">map</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk15\">::</span><span class=\"mtk1\">convertJsonToList)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"132\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">flatMap</span><span class=\"mtk1\">(Flux</span><span class=\"mtk15\">::</span><span class=\"mtk1\">fromIterable)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"133\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">collect</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Collectors</span><span class=\"mtk1\">.</span><span class=\"mtk11\">toSet</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"134\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"135\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authoritiesMono</span><span class=\"mtk1\">.</span><span class=\"mtk11\">flatMap</span><span class=\"mtk1\">(allPermissions </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"136\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">allPermissions</span><span class=\"mtk1\">.</span><span class=\"mtk11\">isEmpty</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"137\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warn</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;인가 규칙 없음: User [{}], Roles {}에 대한 권한 정보가 Redis에 없습니다.&quot;</span><span class=\"mtk1\">, userId, roles);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"138\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">forbiddenResponse</span><span class=\"mtk1\">(exchange, </span><span class=\"mtk8\">&quot;접근 권한이 설정되지 않았습니다.&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"139\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"140\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"141\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk11\">hasPermission</span><span class=\"mtk1\">(path, allPermissions)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"142\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;인가 성공: User [{}], Roles {}, Path {}&quot;</span><span class=\"mtk1\">, userId, roles, path);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"143\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk10\">ServerHttpRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">mutatedRequest</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">exchange</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getRequest</span><span class=\"mtk1\">().</span><span class=\"mtk11\">mutate</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"144\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">header</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;X-User-Id&quot;</span><span class=\"mtk1\">, userId)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"145\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">header</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;X-User-Roles&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">String</span><span class=\"mtk1\">.</span><span class=\"mtk11\">join</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;,&quot;</span><span class=\"mtk1\">, roles))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"146\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"147\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">chain</span><span class=\"mtk1\">.</span><span class=\"mtk11\">filter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">exchange</span><span class=\"mtk1\">.</span><span class=\"mtk11\">mutate</span><span class=\"mtk1\">().</span><span class=\"mtk11\">request</span><span class=\"mtk1\">(mutatedRequest).</span><span class=\"mtk11\">build</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"148\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"149\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warn</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;인가 최종 실패: User [{}], Roles {}, Path {}. Accessible Patterns: {}&quot;</span><span class=\"mtk1\">, userId, roles, path, allPermissions);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"150\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">forbiddenResponse</span><span class=\"mtk1\">(exchange, </span><span class=\"mtk8\">&quot;접근 권한이 없습니다.&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"151\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"152\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"153\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"154\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"155\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"156\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">int</span><span class=\"mtk1\"> </span><span class=\"mtk11\">getOrder</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"157\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> -</span><span class=\"mtk7\">1</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"158\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"159\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"160\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">boolean</span><span class=\"mtk1\"> </span><span class=\"mtk11\">isPublicPath</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">path</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"161\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">PUBLIC_PATTERNS</span><span class=\"mtk1\">.</span><span class=\"mtk11\">stream</span><span class=\"mtk1\">().</span><span class=\"mtk11\">anyMatch</span><span class=\"mtk1\">(pattern </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">pathMatcher</span><span class=\"mtk1\">.</span><span class=\"mtk11\">match</span><span class=\"mtk1\">(pattern, path));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"162\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"163\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"164\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">boolean</span><span class=\"mtk1\"> </span><span class=\"mtk11\">hasPermission</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">requestPath</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Set</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">accessibleUrlPatterns</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"165\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;===== [권한 검사] 요청 경로: &#39;{}&#39;&quot;</span><span class=\"mtk1\">, requestPath);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"166\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">pattern</span><span class=\"mtk1\"> </span><span class=\"mtk15\">:</span><span class=\"mtk1\"> accessibleUrlPatterns) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"167\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">pathMatcher</span><span class=\"mtk1\">.</span><span class=\"mtk11\">match</span><span class=\"mtk1\">(pattern, requestPath)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"168\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;=====&gt;&gt; [권한 검사] 성공! 패턴: &#39;{}&#39;&quot;</span><span class=\"mtk1\">, pattern);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"169\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"170\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"171\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"172\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warn</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;=====&gt;&gt; [권한 검사] 실패. 어떤 패턴과도 일치하지 않음.&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"173\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">false</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"174\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"175\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"176\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Mono</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Void</span><span class=\"mtk1\">&gt; </span><span class=\"mtk11\">unauthorizedResponse</span><span class=\"mtk1\">(</span><span class=\"mtk10\">ServerWebExchange</span><span class=\"mtk1\"> </span><span class=\"mtk12\">exchange</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">message</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"177\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">createErrorResponse</span><span class=\"mtk1\">(exchange, </span><span class=\"mtk12\">HttpStatus</span><span class=\"mtk1\">.</span><span class=\"mtk12\">UNAUTHORIZED</span><span class=\"mtk1\">, message);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"178\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"179\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"180\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Mono</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Void</span><span class=\"mtk1\">&gt; </span><span class=\"mtk11\">forbiddenResponse</span><span class=\"mtk1\">(</span><span class=\"mtk10\">ServerWebExchange</span><span class=\"mtk1\"> </span><span class=\"mtk12\">exchange</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">message</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"181\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">createErrorResponse</span><span class=\"mtk1\">(exchange, </span><span class=\"mtk12\">HttpStatus</span><span class=\"mtk1\">.</span><span class=\"mtk12\">FORBIDDEN</span><span class=\"mtk1\">, message);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"182\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"183\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"184\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Mono</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Void</span><span class=\"mtk1\">&gt; </span><span class=\"mtk11\">createErrorResponse</span><span class=\"mtk1\">(</span><span class=\"mtk10\">ServerWebExchange</span><span class=\"mtk1\"> </span><span class=\"mtk12\">exchange</span><span class=\"mtk1\">, </span><span class=\"mtk10\">HttpStatus</span><span class=\"mtk1\"> </span><span class=\"mtk12\">status</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">message</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"185\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">ServerHttpResponse</span><span class=\"mtk1\"> </span><span class=\"mtk12\">response</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">exchange</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getResponse</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"186\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">response</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setStatusCode</span><span class=\"mtk1\">(status);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"187\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">response</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getHeaders</span><span class=\"mtk1\">().</span><span class=\"mtk11\">setContentType</span><span class=\"mtk1\">(</span><span class=\"mtk12\">MediaType</span><span class=\"mtk1\">.</span><span class=\"mtk12\">APPLICATION_JSON</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"188\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">errorBody</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Map</span><span class=\"mtk1\">.</span><span class=\"mtk11\">of</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;status&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">String</span><span class=\"mtk1\">.</span><span class=\"mtk11\">valueOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">status</span><span class=\"mtk1\">.</span><span class=\"mtk11\">value</span><span class=\"mtk1\">()), </span><span class=\"mtk8\">&quot;message&quot;</span><span class=\"mtk1\">, message);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"189\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"190\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">byte</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">objectMapper</span><span class=\"mtk1\">.</span><span class=\"mtk11\">writeValueAsBytes</span><span class=\"mtk1\">(errorBody);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"191\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">DataBuffer</span><span class=\"mtk1\"> </span><span class=\"mtk12\">buffer</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">response</span><span class=\"mtk1\">.</span><span class=\"mtk11\">bufferFactory</span><span class=\"mtk1\">().</span><span class=\"mtk11\">wrap</span><span class=\"mtk1\">(bytes);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"192\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">response</span><span class=\"mtk1\">.</span><span class=\"mtk11\">writeWith</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Mono</span><span class=\"mtk1\">.</span><span class=\"mtk11\">just</span><span class=\"mtk1\">(buffer));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"193\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">Exception</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"194\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">error</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;오류 응답 생성 실패&quot;</span><span class=\"mtk1\">, e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"195\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// 오류 응답 생성에 실패하면 최소한 상태 코드라도 보내도록 처리</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"196\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">response</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setComplete</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"197\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"198\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"199\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"200\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Config</span><span class=\"mtk1\"> {}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"201\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>로직은 다음과 같다</p>\n<ul>\n<li>공개 경로 확인: 로그인 페이지처럼 누구나 접근 가능해야 하는 경로는 PUBLIC_PATTERNS에 등록하여 먼저 통과</li>\n<li>세션 검증: 요청 쿠키에서 SESSION ID를 추출하여 Redis에 해당 세션이 존재하는지 확인</li>\n<li>사용자 정보 추출: Redis에 저장된 세션 데이터에서 사용자 ID와 역할(Role) 목록을 가져온다. (Spring Session Redis는 세션 속성을 JSON 문자열로 저장하므로, ObjectMapper를 이용한 변환이 필요)</li>\n<li>권한 정보 조회: 사용자의 역할들을 기반으로, 접근 가능한 URL 패턴 목록을 Redis에서 조회 (예: AUTH_URL_KEY 라는 해시 키 아래에 admin: [“/dataplatform/mng/**”] 와 같이 저장)</li>\n<li>권한 검증: 조회된 URL 패턴 목록과 현재 요청 경로를 AntPathMatcher로 비교하여 접근 가능 여부를 판단</li>\n<li>요청 변조 및 전달: 인가에 성공하면, 다운스트림 서비스들이 사용자 정보를 활용할 수 있도록 요청 헤더에 X-User-Id 와 X-User-Roles를 추가한 뒤 필터 체인의 다음 단계로 전달</li>\n</ul>\n<h1 id=\"6-마치며\" style=\"position:relative;\"><a href=\"#6-%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"6 마치며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. 마치며</h1>\n<p>Spring Cloud Gateway를 이용해 API 서버 앞단에서 공통 인가 로직을 처리함으로써, 각 마이크로서비스는 비즈니스 로직에만 집중할 수 있는 환경을 만들었다.</p>\n<p>Redis에 역할별 URL 패턴을 저장함으로써, 관리 페이지에서 권한을 변경하면 애플리케이션 재배포 없이도 즉시 인가 정책이 반영되는 유연성도 확보 가능해졌다.</p>\n<p>물론 권한 없는 사용자가 애초에 특정 페이지에 접근하지 못하도록 프론트엔드 단에서도 제어가 필요했습니다.</p>\n<p>이는 Next.js의 middleware.ts에서 쿠키의 세션 정보를 인증 서버로 보내 권한을 확인하고, 페이지 접근을 제어하는 방식으로 보완했다.</p>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h1>\n<p><a href=\"https://docs.spring.io/spring-cloud-gateway/reference/spring-cloud-gateway-server-webmvc/how-it-works.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Cloud Gateway docs</a><br>\n<a href=\"https://mangkyu.tistory.com/230\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">[Spring] Spring Cloud Gateway(스프링 클라우드 게이트웨이) 공식 문서 간단히 살펴보기 및 리서치 후기 - 망나니개발자</a><br>\n<a href=\"https://s-core.co.kr/insight/view/spring-cloud-gateway-%EA%B8%B0%EB%B0%98%EC%9D%98-api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4-%EA%B5%AC%EC%B6%95/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Cloud Gateway 기반의 API 게이트웨이 구축 - 에스코어</a><br>\n<a href=\"https://bcho.tistory.com/1005\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">MSA 아키텍쳐 구현을 위한 API 게이트웨이의 이해 #1</a><br>\n<a href=\"https://saramin.github.io/2022-01-20-spring-cloud-gateway-api-gateway/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SPRING CLOUD GATEWAY를 이용한 API GATEWAY 구축기</a></p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .mtk4 { color: #569CD6; }\n  .default-dark .mtk1 { color: #D4D4D4; }\n  .default-dark .mtk3 { color: #6A9955; }\n  .default-dark .mtk7 { color: #B5CEA8; }\n  .default-dark .mtk8 { color: #CE9178; }\n  .default-dark .mtk10 { color: #4EC9B0; }\n  .default-dark .mtk12 { color: #9CDCFE; }\n  .default-dark .mtk11 { color: #DCDCAA; }\n  .default-dark .mtk15 { color: #C586C0; }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","tableOfContents":"<ul>\n<li><a href=\"#1-api-gateway-%EC%A3%BC%EC%9A%94-%EA%B8%B0%EB%8A%A5\">1. API Gateway 주요 기능</a></li>\n<li><a href=\"#2-api-gateway-%EA%B5%AC%EC%B6%95-%EB%B0%A9%EB%B2%95\">2. API Gateway 구축 방법</a></li>\n<li><a href=\"#3-spring-cloud-gateway\">3. Spring Cloud Gateway</a></li>\n<li><a href=\"#31-spring-cloud-gateway-%EB%8F%99%EC%9E%91-%EC%88%9C%EC%84%9C\">3.1 Spring Cloud Gateway 동작 순서</a></li>\n<li><a href=\"#32-spring-cloud-gateway-%EC%9E%A5-%EB%8B%A8%EC%A0%90\">3.2 Spring Cloud Gateway 장, 단점</a></li>\n<li><a href=\"#5-%EA%B5%AC%ED%98%84\">5. 구현</a></li>\n<li><a href=\"#41-yml-%ED%8C%8C%EC%9D%BC-%EC%9E%91%EC%84%B1\">4.1 yml 파일 작성</a></li>\n<li><a href=\"#42-%EC%9D%B8%EA%B0%80-%EB%A1%9C%EC%A7%81-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1\">4.2 인가 로직 코드 작성</a></li>\n<li><a href=\"#6-%EB%A7%88%EC%B9%98%EB%A9%B0\">6. 마치며</a></li>\n<li><a href=\"#reference\">Reference</a></li>\n</ul>","frontmatter":{"title":"Spring Cloud Gateway 도입과 인가로직 적용하기","summary":["스프링 클라우드 게이트웨이 개념, 인가 기능 구현방법 정리"],"date":"2025.08.25.","update":"2025.08.25.","category":["Spring"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADbklEQVR42nVUSWgUQRTtROOGoiJxS6aqe2ZU0INKRFBQRLx4VYSIuB4iioqamV5mknTE5SYeBDF4EATB5GTArN09PZmMUckkKlFEL3pyP3hRQZMp3+9Jtz0hafjU76r/339/qZKkKZ8QUgVJ8C9JFeZdPs90+byy/bBdaH9GMM2RN6oWu5q0eL9q8deqzd5AXM1iN3C20zSlSrIzBdZJvezzDYzueDUA7mgO+2M+VUTzY1mkBkrSlJdFC/b0DC8iWJc2GGUpu7YmabFDYYxA0Xtr45rDx8xnisA6odl8XLWxWrxIQjqCjdNZyxPP5iPAroB1UzK/bpEUzl+3Vi8zXP6CDOH0F2BiOsHZBIDHmwZlYWTl341WzS6tj+1OuHxTObsMu9UKZmp/CcxjZntshE6S4QIBUQKl2Dwkw46NptzIFvJNZmvWJDJsf1A/I8fWw/gnOXqpQZryimgZQr08cPYH4L9Qt29Irx82JxoKqxb4/vogW2rkeH0AmM7ylOmxY38BWkwjHTgPAOiMbrE9el+sTreUtebzjUvM/x2taCtIVear9XM8UJcf1Kzo4hJDlz9sBhtK0chSmvJZaYaPxqpDSLP8iaBAHqDDDifzkdXeHIHVcGksFKrXJTLo6JBmma40mxh5szllqGlFnevRjJWlHshHVTdeKx2AI+pU8Bg67LNhKyvCTjOxQ/OOa07kiH+mufwYzWQp5QzvvDwapc5a06VJLImxz1LNsHM0/HQt6Z9IpQfkk0EN01m55crLKM2Y7QN46YrJBkwCmX3R5WjUA1zHR6fd6oVBl3tjcTQ0ETDADNahSxNI+Qeoy+H5bCvUVam2shUgN1WUBDW+fbY7PpeCNbRJVZ6/zdNqH99bVmCkfe/aWEykstxqtPguBGnQbHYfnX8H5t+g9yZtZYfv4wfETJ6CTbs0tWOYt6juyKM4bMTtGMGNoCEfgd6qZfnmBjClMhi5ldVqT2QDmrIPGfUg0KeEE4mVPQ5BsdH2i72xSDonj9BVw3B/QM3eI8gXNOw79K/earHf1MR0Xv50vqt0/YJ6T32+Et2RGFLspJpeKkQFPWH0bHlPFx6O1mFFGBm5iFemXe3G3JUxm2bOfB0N2I50rkOyqsPfgtlb0mlPt/g2//rNCBYGDRuZwqy8MFQ7n4T0cEbTDf8/bs8FuH++Hz4AAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/daf23c051d1970bd74a5bdb9fe7de872/5f2c3/thumbnail.png","srcSet":"/static/daf23c051d1970bd74a5bdb9fe7de872/90cd3/thumbnail.png 100w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/614dc/thumbnail.png 200w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/5f2c3/thumbnail.png 400w","sizes":"(min-width: 400px) 400px, 100vw"},"sources":[{"srcSet":"/static/daf23c051d1970bd74a5bdb9fe7de872/e64f1/thumbnail.webp 100w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/8b00d/thumbnail.webp 200w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/9c0a1/thumbnail.webp 400w","type":"image/webp","sizes":"(min-width: 400px) 400px, 100vw"}]},"width":400,"height":400}},"publicURL":"/static/daf23c051d1970bd74a5bdb9fe7de872/thumbnail.png"}}}}]}},"pageContext":{"slug":"/SpringCloudGateway/","series":[],"lastmod":"2025.08.25.","prev":{"fields":{"slug":"/spark/"},"frontmatter":{"title":"데이터 플랫폼, Apache Spark 도입을 보류한 이유","date":"2025.07.25.","update":"2025.07.25.","category":["Engineering"],"tags":["Engineering"],"summary":["이 글은 Spark를 왜 고려했고, 어떤 장점을 확인했으며, 그럼에도 불구하고 왜 도입을 보류했는지에 대한 기술적 의사결정 과정을 기록"]}},"next":{"fields":{"slug":"/elk/"},"frontmatter":{"title":"ELK Stack 정리 (개념부터 데이터 적재, 쿼리)","date":"2025.08.28.","update":"2025.08.28.","category":["ELK"],"tags":["ELK"],"summary":["ELK Stack 경험을 정리"]}}}},"staticQueryHashes":["427104293"],"slicesMap":{}}