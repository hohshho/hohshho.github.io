{"componentChunkName":"component---src-templates-post-tsx","path":"/SpringSecurity2_2/","result":{"data":{"site":{"siteMetadata":{"title":"Just Keep Going","description":"Ian's Archive","siteUrl":"https://hohshho.github.io"}},"allMarkdownRemark":{"edges":[{"node":{"id":"a360e1a0-de11-5e01-83f0-5b8ceb849e81","html":"<h1 id=\"oauth-20-client\" style=\"position:relative;\"><a href=\"#oauth-20-client\" aria-label=\"oauth 20 client permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Client</h1>\n<blockquote>\n<p>OAuth 2.0 인가 프레임워크의 역할 중 인가 서버 및 리소스 서버와의 통신을 담당하는 클라이언트의 기능을 필터 기반으로 구현한 모듈</p>\n</blockquote>\n<h2 id=\"oauth-20-login-api\" style=\"position:relative;\"><a href=\"#oauth-20-login-api\" aria-label=\"oauth 20 login api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Login API</h2>\n<blockquote>\n<p>어플리케이션 사용자를 외부 OAuth2.0 Provider나 OpenID Connect 1.0 Provider 계정으로 로그인 할 수 있는 기능 제공</p>\n</blockquote>\n<ul>\n<li>권한 부여 유형 중 Authorization Code 방식을 사용</li>\n</ul>\n<h2 id=\"oauth-20-client-api\" style=\"position:relative;\"><a href=\"#oauth-20-client-api\" aria-label=\"oauth 20 client api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Client API</h2>\n<blockquote>\n<p>인가 서버의 권한 부여 유형에 따른 엔드 포인트와 직접 통신할 수 있는 API 제공</p>\n</blockquote>\n<ul>\n<li>권한 부여 종류\n<ul>\n<li>Client Credentials</li>\n<li>Resource Owner Password Credentials</li>\n<li>Refresh Token</li>\n</ul>\n</li>\n<li>리소스 서버와 연동해서 Token을 가지고 원하는 데이터를 가지고 오는 기능 구현 가능</li>\n</ul>\n<h2 id=\"oauth-20-client-fundamentals\" style=\"position:relative;\"><a href=\"#oauth-20-client-fundamentals\" aria-label=\"oauth 20 client fundamentals permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Client Fundamentals</h2>\n<h3 id=\"client-권한-설정-과정\" style=\"position:relative;\"><a href=\"#client-%EA%B6%8C%ED%95%9C-%EC%84%A4%EC%A0%95-%EA%B3%BC%EC%A0%95\" aria-label=\"client 권한 설정 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Client 권한 설정 과정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cbde6a9309f7bf21c52c3a027af50f95/5b5fb/clientRegistrationFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.901840490797547%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABBElEQVR42o2QXWvCMBiF/f+72n9awQup2lGVKtIqrk1J+rXUmFZ9RoKDyW4MJLl53/OccyYAxhjatqUsS4QQNE1D13Vcr1e01nydTuSHA0VRwGj5UJa39ILptZ/71prb7eakmLjHLaVpynQ6JQgCdrudFx/HEWstdhi4GIPWPdgLgTS8Z5ZGKW9AKfUs6ChZlrFarYjjmP1+7wfP5zN1VaFKgel7XjleMM9zoihiNpsRzueEYcjxePQRt+s12+WCJI49xFUzOMfD4H937/f7s6BbTJKE5WLBZxR5pw7Sdx2VKGjaFvmIJ6Wkrmvf82/X/xw6qpKSrYu72VAKQf+I+Jf+SuQf2K7H/KjYTbsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/cbde6a9309f7bf21c52c3a027af50f95/a81b5/clientRegistrationFlow.webp 163w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/da3ef/clientRegistrationFlow.webp 325w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/309d5/clientRegistrationFlow.webp 650w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/78344/clientRegistrationFlow.webp 975w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/bdb72/clientRegistrationFlow.webp 1300w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/61647/clientRegistrationFlow.webp 2128w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/cbde6a9309f7bf21c52c3a027af50f95/5e043/clientRegistrationFlow.png 163w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/e5cc6/clientRegistrationFlow.png 325w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/663f3/clientRegistrationFlow.png 650w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/d880f/clientRegistrationFlow.png 975w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/4c573/clientRegistrationFlow.png 1300w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/5b5fb/clientRegistrationFlow.png 2128w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/cbde6a9309f7bf21c52c3a027af50f95/663f3/clientRegistrationFlow.png\"\n            alt=\"clientRegistrationFlow\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol>\n<li>application.yml에 환경 설정 파일에 <strong>클라이언트, 인가서버 엔드포인트 설정</strong></li>\n<li>환경설정에 있는 정보가 <strong>OAuth2ClientProperties</strong>의 각 속성에 바인딩</li>\n<li><strong>ClientRegistration</strong>클래스에 인가서버로 권한부여 요청을 하기 위한 OAuth2ClientProperties가 저장된다.</li>\n<li>OAuth2Client는 ClientRegistration을 참조해 권한 요청을 위한 매개변수를 구성하고 인가 서버와 통신한다.</li>\n</ol>\n<h3 id=\"client-registration-초기화-과정\" style=\"position:relative;\"><a href=\"#client-registration-%EC%B4%88%EA%B8%B0%ED%99%94-%EA%B3%BC%EC%A0%95\" aria-label=\"client registration 초기화 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Client Registration 초기화 과정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e2f5840818896506175f626938ab6203/5e566/clientRegistraionConfigFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.44171779141104%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACCUlEQVR42oVS22oTURSd/9AnqZCClDa2ttIWEQRftJLGGqy0hTaC9VkQKfgHBZ99kKJv6q/kSgK5BzuZWyYzmVtmcl+yd8wgVeiBxdkc2GuvtfYRFFVDqVzBr0sRkiRDlmUoigpZVmCaXdi2DcuyYdsOg2rX7aHfH/wXgmVZyGazyGQySKVSSKfTXOfzeei6zoQE13XhOERowfd9TKdTTCYzUD2H0O12Ua1WUSgUkMvlmLxYLKLRaKDX64HOrHnC93VHUFUVnU4HoiiyOiKVJAn0TsNIHcUwr13HhmMY8CwLjmNzr2EYME0To9EIAtmq1+uo1WqsrFQqMWG73YaiKGi1WuEASVagah3IkgpFVqEbJtsPggDj8XhmmWxRU6VS4Saa5nk9jEZDTKYTVqVpGt+G7UO3A2iGC930oHd9znUeDVumsImwXC6zImocDgbh5MAP0O/3w/u6HAUioKVQdqTkx/efODg8wsnpG0by7SmOkq9xcHyCw+Mk48PZxz/bRbjdkJAkk10ipIDPzz/hxsItLN5dRmRlCYtry4hElxj0dvP2Ah48ehySXFXMCunLpDMZiOIlLr5+w86TZ4jH9/A09hyxvZfYTewj9mIfu4TEK+zEE3j3/gzD4fAfUsHzPDSbTVZoWxY+f7nA+uoGtja2sfo31rcRXdtE9N4mIndWcH/rIWd6lfA3HIL10vTJbM0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e2f5840818896506175f626938ab6203/a81b5/clientRegistraionConfigFlow.webp 163w,\n/static/e2f5840818896506175f626938ab6203/da3ef/clientRegistraionConfigFlow.webp 325w,\n/static/e2f5840818896506175f626938ab6203/309d5/clientRegistraionConfigFlow.webp 650w,\n/static/e2f5840818896506175f626938ab6203/78344/clientRegistraionConfigFlow.webp 975w,\n/static/e2f5840818896506175f626938ab6203/bdb72/clientRegistraionConfigFlow.webp 1300w,\n/static/e2f5840818896506175f626938ab6203/3c634/clientRegistraionConfigFlow.webp 2614w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e2f5840818896506175f626938ab6203/5e043/clientRegistraionConfigFlow.png 163w,\n/static/e2f5840818896506175f626938ab6203/e5cc6/clientRegistraionConfigFlow.png 325w,\n/static/e2f5840818896506175f626938ab6203/663f3/clientRegistraionConfigFlow.png 650w,\n/static/e2f5840818896506175f626938ab6203/d880f/clientRegistraionConfigFlow.png 975w,\n/static/e2f5840818896506175f626938ab6203/4c573/clientRegistraionConfigFlow.png 1300w,\n/static/e2f5840818896506175f626938ab6203/5e566/clientRegistraionConfigFlow.png 2614w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e2f5840818896506175f626938ab6203/663f3/clientRegistraionConfigFlow.png\"\n            alt=\"clientRegistraionConfigFlow\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol>\n<li>\n<p><strong>OAuth2ClientRegistrationRepositoryConfiguration</strong>에서<br>\n<strong>OAuth2ClientPropertiesRegistrationAdapter의 getClientRegistration함수</strong>를 실행</p>\n<ul>\n<li>(ClientRegistrationRepository 빈이 존재하지 않을 경우 실행)</li>\n</ul>\n</li>\n<li>\n<p>getClientRegistration 함수 내에서 ClientRegistrations객체의<br>\nfromIssuerLocation가 실행되는데 application.yml에 issuer-uri의 OIDC, AUTH 경로에 요청해 필요한 메타데이터 값을 가져온다</p>\n</li>\n</ol>\n<p>요약</p>\n<ul>\n<li>Client Registration은 인가 서버에 요청해 메타 데이터값을 가져오는데 yml 설정으로 값을 수동으로 지정해 줄 수 있다.</li>\n<li>ClientRepository를 @Bean으로 등록해 yml 설정 없이 코드로 설정 가능</li>\n</ul>\n<h4 id=\"clientregistration-상세-값\" style=\"position:relative;\"><a href=\"#clientregistration-%EC%83%81%EC%84%B8-%EA%B0%92\" aria-label=\"clientregistration 상세 값 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ClientRegistration 상세 값</h4>\n<table>\n<thead>\n<tr>\n<th>title</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>registrationId</td>\n<td>ClientRegistration을 식별할 수 있는 유니크한 ID.</td>\n</tr>\n<tr>\n<td>clientId</td>\n<td>클라이언트 식별자.</td>\n</tr>\n<tr>\n<td>clientSecret</td>\n<td>클라이언트 secret.</td>\n</tr>\n<tr>\n<td>clientAuthenticationMethod</td>\n<td>provider에서 클라이언트를 인증 시 사용 메소드 <br> basic, post, none (public 클라이언트).</td>\n</tr>\n<tr>\n<td>authorizationGrantType</td>\n<td>네 가지 권한 부여 타입 정의 <br>(authorization_code, implicit, client_credentials, password)</td>\n</tr>\n<tr>\n<td>redirectUriTemplate</td>\n<td>클라이언트에 등록한 리다이렉트 URL<br> 사용자의 인증으로 클라이언트에 접근 권한을 부여하고 나면, 인가 서버가 이 URL로 최종 사용자의 브라우저를 리다이렉트</td>\n</tr>\n<tr>\n<td>Scopes</td>\n<td>인가 요청 플로우에서 클라이언트가 요청한 openid, 이메일, 프로필 등의 scope.</td>\n</tr>\n<tr>\n<td>clientName</td>\n<td>클라이언트를 나타내는 이름</td>\n</tr>\n<tr>\n<td>authorizationUri</td>\n<td>인가 서버의 인가 엔드포인트 URI.</td>\n</tr>\n<tr>\n<td>tokenUri</td>\n<td>인가 서버의 토큰 엔드포인트 URI.</td>\n</tr>\n<tr>\n<td>jwkSetUri</td>\n<td>인가 서버에서 JSON 웹 키 (JWK) 셋을 가져올 때 사용할 URI. 이 키 셋엔 ID 토큰의 JSON Web Signature (JWS) 를 검증할 때 사용할 암호키가 있으며, UserInfo 응답을 검증할 때도 사용할 수 있다.</td>\n</tr>\n<tr>\n<td>configurationMetadata</td>\n<td>OpenID Provider 설정 정보로서 application.properties 에 spring.security.oauth2.client.provider.[providerId].issuerUri를 설정했을 때만 사용할 수 있다.</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"client-repository\" style=\"position:relative;\"><a href=\"#client-repository\" aria-label=\"client repository permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Client Repository</h3>\n<blockquote>\n<p>OAuth2.0 &#x26; OpenID Connect1.0의 ClientRegistration 저장소 역할</p>\n</blockquote>\n<ul>\n<li>인가 서버에 일차적으로 저장된 클라이언트 등록 정보의 일부를 검색하는 기능 제공</li>\n<li>자동 설정을 사용하면 ClientRegistrationRepository도 ApplicationContext내 @Bean으로 등록하므로 필요하면 원하는 곳에 의존성 주입이 가능<br>\n-> 등록된 클라이언트 정보를 가져올 수 있다.</li>\n</ul>\n<h3 id=\"자동-설정에-의한-초기화-과정\" style=\"position:relative;\"><a href=\"#%EC%9E%90%EB%8F%99-%EC%84%A4%EC%A0%95%EC%97%90-%EC%9D%98%ED%95%9C-%EC%B4%88%EA%B8%B0%ED%99%94-%EA%B3%BC%EC%A0%95\" aria-label=\"자동 설정에 의한 초기화 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>자동 설정에 의한 초기화 과정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4311375beda5f3951a43df59bf897719/ff716/AutoconfigInitialize.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.05521472392638%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACPklEQVR42mWS3W4SQRiGezHGxENb6S8Fys8uLLsEa+JBrcULMMYzjcem1RaoTVuPbWy19MDegZpovAbLPwsrUGAXaIEVgdd8X4W2cZJ3vpnJzJN35p2xak1HTs0jpxbw8ySO+EkcmVQaak5FvV5Hr9eDaZrodDr/ZLLa7Q5arfZINDfN3xijA4aho9ls4pemIZVKoVgqoVKtoqbrDOt2uxgMgMFgcE1X23BtrNfrw6jX2U2lUkEul2NphQLK5TK63T/48f0bImur2ApHsb6+gVev17ERjmB39y22d3YRjkTx+ctXBrNDXdcZlk6nWaenp+z47OyMNx0c7MNmGYfX4cT8vB1z83bMWm2YnJnD5PQsbty8hZeraxfAfr+PWq3GkFKphGKxyONqtXoJ/BiDwzaHoCzD55Ug+iR4RB+cbgFuwQvL1Ayim28ugXSYQKqqIpvNolAojFxeAA9ht84gIPkhCr4RzL7gwoLLg/E7kwhHNi+A9JAEoTCSySRXmpOGwPf7H+CwTiMoSRBFLwTvdeCEZQqR6BUguRk6zOfzXCkYegJqe3vv4LbboIgy3B4BLo/AQILR+PaEhUNiIHXn5+cMHV6ZYJlMhh23Wi3Ejo6geAUs3l2ELCuQ/AokWYGPa4BD2tre+R9ILhOJBMPo6pqmoWOaOD7+hKX79xAKPcKDhyEsr4SwtLyCQHARz56/4PDa7fYlkL4OLTYaDQ6IUicZhsGbYrFDuJwL8CtB+JUAuyJZbQ48fvJ09LEJ+BdNP7Lh98+FLgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4311375beda5f3951a43df59bf897719/a81b5/AutoconfigInitialize.webp 163w,\n/static/4311375beda5f3951a43df59bf897719/da3ef/AutoconfigInitialize.webp 325w,\n/static/4311375beda5f3951a43df59bf897719/309d5/AutoconfigInitialize.webp 650w,\n/static/4311375beda5f3951a43df59bf897719/78344/AutoconfigInitialize.webp 975w,\n/static/4311375beda5f3951a43df59bf897719/bdb72/AutoconfigInitialize.webp 1300w,\n/static/4311375beda5f3951a43df59bf897719/5dad4/AutoconfigInitialize.webp 2578w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4311375beda5f3951a43df59bf897719/5e043/AutoconfigInitialize.png 163w,\n/static/4311375beda5f3951a43df59bf897719/e5cc6/AutoconfigInitialize.png 325w,\n/static/4311375beda5f3951a43df59bf897719/663f3/AutoconfigInitialize.png 650w,\n/static/4311375beda5f3951a43df59bf897719/d880f/AutoconfigInitialize.png 975w,\n/static/4311375beda5f3951a43df59bf897719/4c573/AutoconfigInitialize.png 1300w,\n/static/4311375beda5f3951a43df59bf897719/ff716/AutoconfigInitialize.png 2578w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4311375beda5f3951a43df59bf897719/663f3/AutoconfigInitialize.png\"\n            alt=\"AutoconfigInitialize\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol>\n<li>\n<p>OAuth2ImportSelector에서 설정 클래스에 따라 class load</p>\n</li>\n<li>\n<p>위 이미지 와 같이 로드되고 <strong>OAuth2ClientWebMvcSecurityConfiguration</strong>에서 2개의 클래스 로드</p>\n</li>\n<li>\n<p>DefaultOAuth2AuthorizedClientManager는 실제 권한 부여 요청에 따라 작업을 담당하는 클래스</p>\n</li>\n<li>\n<p>HandlerMethodArgumentResolver 는 웹 mvc관련 클래스</p>\n</li>\n</ol>\n<p>DefaultOAuth2AuthorizedClientManager가 실제 권한 부여 작업 담당 클래스로 중요!</p>\n<p>Bean 등록 과정</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/7f319/OAuth2ClientAutoConfiguration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.21472392638037%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB5ElEQVR42m1TzW7aQBj0k+RStUI0jdqofYFUakPCjafg7dreQ4NvnBECbAM2MXi9BgO2CzZ/U82GRVTqJ412vfvteGbWNmQ0hwgjzOMFZrMYUSgRTgLIQED4U6yWKxRFgTwvkCQpptMpwjBEmqYoii02m1ztaxjH4xEEH/5kGSzLgu04sG0bzmAA5zQnkRAhut0uer0e+n1LrVuWDSkjbLdbHA4HGACw3++x2WzUwnK5PGO1WmERx5hMJhBCII5jhSAI1BpH9vAsBbGUQk34v9IvIVGWZapXSgnf95VqnqN97lOlMRwO0e/3X63atnozSXQUBIvNJI6iCKPRCJ7nKWIq06rX6zUMSmbjfD5HkiRKhSZh6Tn3O53Oa7aOg8FgoMD+yz5D28rz/LxxCVqkCmZIJ67rKoUEVdHybrdTUJfCQ5xQLkHr7Xb7fJuc8zCtjj0P/ssLPG8M1/VUPMySoxZkXFqjGgZM6xqMg2sjd4Sn309omiZM8xlm8xmm2Tw9m2i1WkrEmZBkSu3JKj+X8Xis1DH0Xz9/oPzuLb58usXnm2vcXpfx8X0ZH0pl3JRKeHN1hcr9/b+ErHWaYrlYYCYlpBDqr2DwjUYDle/fUKvVUK1W8VB5OKGC6uMjvt7doV6v4y8UTxoaUaweHQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/a81b5/OAuth2ClientAutoConfiguration.webp 163w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/da3ef/OAuth2ClientAutoConfiguration.webp 325w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/309d5/OAuth2ClientAutoConfiguration.webp 650w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/78344/OAuth2ClientAutoConfiguration.webp 975w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/bdb72/OAuth2ClientAutoConfiguration.webp 1300w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/507e6/OAuth2ClientAutoConfiguration.webp 2498w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/5e043/OAuth2ClientAutoConfiguration.png 163w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/e5cc6/OAuth2ClientAutoConfiguration.png 325w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/663f3/OAuth2ClientAutoConfiguration.png 650w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/d880f/OAuth2ClientAutoConfiguration.png 975w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/4c573/OAuth2ClientAutoConfiguration.png 1300w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/7f319/OAuth2ClientAutoConfiguration.png 2498w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/663f3/OAuth2ClientAutoConfiguration.png\"\n            alt=\"OAuth2ClientAutoConfiguration\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>OAuth2ClientRegistrationRepositoryConfiguration은 위에서 살펴본 부분이고</p>\n<p>OAuth2WebSecurityConfiguration을 살펴보면 InMemoryOAuth2AuthorizedClientService에서 OAuth2AuthorizedClient를 관리 한다</p>\n<p><strong>OAuth2AuthorizedClient</strong>는 인가서버로 부터 권한 부여가 되면 승인된 정보들이 저장되는데 <strong>Client정보, accessToken, refreshToken, 사용자 정보 같은 것들이 저장되고 이 객체를 Spring MVC에서 참조해 사용</strong></p>\n<h2 id=\"oauth-20-client---oauth2login\" style=\"position:relative;\"><a href=\"#oauth-20-client---oauth2login\" aria-label=\"oauth 20 client   oauth2login permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Client - oauth2Login()</h2>\n<blockquote>\n<p>OAuth2.0 Client Module을 통해서 클라이언트가 인가 서버로 부터 권한 부여 받고, 사용자 인증 처리, 권한 체크까지 인증 처리</p>\n</blockquote>\n<p>oauth2.0 config 설정을 통해 http.oauth2Login()이 실행이 되면</p>\n<p>Form방식과 동일하게 OAuth2LoginConfigurer클래스가 init, configure 함수를 초기화 한다.</p>\n<p>init함수부터 먼저 살펴보면</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b2be3b00365ba169ba5ecade1eaaddbe/912ae/OAuth2.0LoginApiInit.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.282208588957054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACv0lEQVR42nWS60uTYRjG/VuCCDrYAREP29zmsqg0tdrBtc2ZdiSPFX0KKjrQtw6fKzqpEEX/QlHbCjrQ2mzvuzZft3cbqDu5CbbtF++jJgTdcD3XxcPzXNynunRSRZ1LkFDmiM0qqOkMhWKRxWyWYrHI0tIS3z5/5pM/gD8QwBfQ+CMffH7e+3yC3759hxyNUqlWqVtZWRGf5+fnkWSZjwE/AZ+P4I8fZDIZIpKE23aETpOZA5YOjGYLpva9goU2W9i2Yyd3791Hi7pyuUyhUCStpoSpmkqTSiTJpDMUi0uk0hn67b10t1vYb9mLwWjGYDShbzPRqm8TvHV7PffuP1gzXC5Tq0Hl929qtZrQGlerVfEgl89zefw8J90eBr0DeDxenC4PfU4XfcdduDz9dHX38uTJ040Mc7kcyWQSWZaJRCJIkiRK1e7i8TjDZ07itVoZcjhx2xxY7evow+Zw0nm4m4kLl6hUKtSlUiny+bwYQDab/YvFxUXKpRJJNc3Rnk4OGvV0mNppM5rRGYw0tepobtXTojOwu6ERl7t/1TAcDrOwsCDS1Updj3WdzeVEhgN2O06HE5ujD6vNwVGrTaD3yDEOHOpifOLiqmGpVBIZxWUZJRplNioTl6Q1HWVOUbh59QqXhke4PDbOxMgYIyOjDI+OCYyOTTAwOMTTZ89Xe6gdhUKBeCzGbCxG7NcvorIsWJmNE575yXF7L11mM/ssHZjWJq2VraHN1E79rt3cun1nw3B5eZl8oUBSVVEUhblEQrDW20RSxdpzkH0tzZh0BppbdDS16mlsbmFPQyMNjU1s2ryFa9dvbBhqZc+EQsyEwwSDQb58+YrW21AoxPdgkDevX/JqaprpqWkmp6aYFDzNi8lV/fDRY/z+wIahJEUYPT3I8NApTgyewN3vxeMdEPt29tx5sVb/Du1/8QevydHMsCUDyAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b2be3b00365ba169ba5ecade1eaaddbe/a81b5/OAuth2.0LoginApiInit.webp 163w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/da3ef/OAuth2.0LoginApiInit.webp 325w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/309d5/OAuth2.0LoginApiInit.webp 650w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/78344/OAuth2.0LoginApiInit.webp 975w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/bdb72/OAuth2.0LoginApiInit.webp 1300w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/84941/OAuth2.0LoginApiInit.webp 2472w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b2be3b00365ba169ba5ecade1eaaddbe/5e043/OAuth2.0LoginApiInit.png 163w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/e5cc6/OAuth2.0LoginApiInit.png 325w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/663f3/OAuth2.0LoginApiInit.png 650w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/d880f/OAuth2.0LoginApiInit.png 975w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/4c573/OAuth2.0LoginApiInit.png 1300w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/912ae/OAuth2.0LoginApiInit.png 2472w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b2be3b00365ba169ba5ecade1eaaddbe/663f3/OAuth2.0LoginApiInit.png\"\n            alt=\"OAuth2 0LoginApiInit\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol>\n<li>\n<p>OAuth2LoginAuthenticationFilter 인증 필터가 생성되는데 설정한 경로로 요청이 오면 Authorization Code Grant Type 방식에서 code를 가지고 AccessToken을 발급하는 단계를 담당한다.<br>\n(default : /login/oauth2/code/*)</p>\n</li>\n<li>\n<p>OAuth2LoginAuthenticationProvider 는 실제로 OAuth2.0 인가서버와 통신하는 기능을 담당한다.</p>\n</li>\n<li>\n<p>OidcAuthorizationCodeAuthenticationProvider 는 OpenID 프로토콜을 통해 사용자 정보를 가져온다.</p>\n</li>\n<li>\n<p>DefaultLoginPageGeneratingFilter는 실제 로그인 페이지가 필요한데 해당 페이지를 생성해 주는 기능 담당</p>\n</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/51c36e5f5079e8d277daef951fcc1af3/b5b51/LoginApiConfigure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.987730061349694%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACCElEQVR42oWSbWvTUBiG+3NEEJl2bjVJuzZt0yTrnPgyZagI4sQfoYjbmhaZ4FfFP+Imto1TYX7fl1HQvjvbbV3jVpZeck730oHDBy7uh3Ny7uc+hwSatTr1SpVGtUbz1ybNzd/s7e+zf4jse70BQ+tnEegDx/T7Et/3OTg4QNT29jbr6+tsbGzgeZ5cE3vim38R4IwSxqK63S6lUolKpSIT/K8CIpsvJg7j+/JwuVym0WhQq9WkVqtV6vU63a7H7m5X4nl/ZOKjG52ZUJhubW2xs7NDq9Wi3W7LvtPpyL2+L55HxOmfTri35/Ft1eVL0eWr+5lV1yVfdCkICkUKxSIflpf5lM/LXmi+UJC90Hy+wMrKR9bWvg/esFypMnMtyVRM50bCwI7F0aM6kViciSP0OOFoDDUSRdEiKGqYq2qYsZBCSNG4OHKZ+w8e0uv1BoY3p01m7BS3rTR3LJsZ0yaZTJFIWSRTFoYp1JQkDJPo0LBYPClNHz2eOzGcmrKZnTa5ZaW5btmkrUlSpo1xiDDRE4ZUQXxoWMqyiUR15p48HRj++FlGj2lMTiiY6gSGFiGqhtEUTU4OqRrjisroWOgUwSvjjARHuRQc49z5C9ydvTcwbLXbvFnK8cpxWMrmeC1wcjgZhwUny2Imy6KTJSPI5o5ZyDi8nF9kfiHDs+cvePvuvfx1/gJwHJ/PawhF5gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/51c36e5f5079e8d277daef951fcc1af3/a81b5/LoginApiConfigure.webp 163w,\n/static/51c36e5f5079e8d277daef951fcc1af3/da3ef/LoginApiConfigure.webp 325w,\n/static/51c36e5f5079e8d277daef951fcc1af3/309d5/LoginApiConfigure.webp 650w,\n/static/51c36e5f5079e8d277daef951fcc1af3/78344/LoginApiConfigure.webp 975w,\n/static/51c36e5f5079e8d277daef951fcc1af3/bdb72/LoginApiConfigure.webp 1300w,\n/static/51c36e5f5079e8d277daef951fcc1af3/4836c/LoginApiConfigure.webp 2608w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/51c36e5f5079e8d277daef951fcc1af3/5e043/LoginApiConfigure.png 163w,\n/static/51c36e5f5079e8d277daef951fcc1af3/e5cc6/LoginApiConfigure.png 325w,\n/static/51c36e5f5079e8d277daef951fcc1af3/663f3/LoginApiConfigure.png 650w,\n/static/51c36e5f5079e8d277daef951fcc1af3/d880f/LoginApiConfigure.png 975w,\n/static/51c36e5f5079e8d277daef951fcc1af3/4c573/LoginApiConfigure.png 1300w,\n/static/51c36e5f5079e8d277daef951fcc1af3/b5b51/LoginApiConfigure.png 2608w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/51c36e5f5079e8d277daef951fcc1af3/663f3/LoginApiConfigure.png\"\n            alt=\"LoginApiConfigure\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>configure함수를 살펴보면 OAuth2AuthorizationRequestRedirectFilter가 생성되는데 해당 필터는 Authorization Code Grant Type 방식에서 code를 발급해주는 기능 담당</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/316c06e55e75e4427c13d5d37c83353c/78929/LoginApiConfigurerConfig.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.987730061349694%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACnElEQVR42l2TS08TURSA+1dMjEujAtY+plBKOzMdKw+NCppoghZoowt3EjVRU2iL7tTEmGhYuDJABWPURONKFATdaCUGaijTJ48FbWkL9DNzJUS9yZd7T+6ZL3PPPdeU1dNk9JQgm82TzS1TKm1QLleoViv8WtT5Fv9JfG5ezCura2xubrKxURE5f1OpVDDVAIP/R61Wo1bb5s27Dzx6MsLw0+c8fPyMnwuLYn97e/uffCM2MBlBtVoln8+zvLwsyOVy6LpOKpUSZLNZ1tbW0Jd00um0wMhZWVkRrK6uUiqVhHhXuJhMsrS0RDKZJJXSWUgsCJGxnpv7QTqT2YlTZDMZMRvSRCLB/Py8WAvhr8QC0cEQd6ND3IlEGQxHCA0MEhoMc/PWbe7df0Bpo8zw40dEQiHCkSgD4Qjh6BD9128w++WrEG3tlMA0NfWRZksDitRIo9WO2WLDbLVjsUkcrGugreM46+sFzp87S319HVa7g8NHrJgtVvbs3cfI6JgQlctlUXfTzOxn2pUW2jUfsqzSIsu43B6aWzzi486usxSKRQKBXhSlibYOjaPHZFrbVZqcFl7FRoTQqPHW1hammZlpfO4mTqgaXlnF5ZFxtnhwuWXsUiOnO89QKBTp6/HjcTfia1OE0BBb7Q28jP35w2Kx+OfIs7PTtMouTnp9tKoamqwKPIqKTXJwqqtLCAN9fpqdTciqF4+ioGoaDWYzL8YnhMi4ZdE209OfUCQLstOFQ3Ig2R1INgmbXeJAXR2t7R2sFwr4L3bT7LTj9cl4NQ+K5uZQ/X4mRkeF0Ggfo1tM8fh3rgR7uHLpMn3BID2BIP7eAL19Qbov+Lnaf41KtcqPeJzXr98wFhsnFhvn7bv3TE5Okcvndx+CceTfHsqScE++rBYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/316c06e55e75e4427c13d5d37c83353c/a81b5/LoginApiConfigurerConfig.webp 163w,\n/static/316c06e55e75e4427c13d5d37c83353c/da3ef/LoginApiConfigurerConfig.webp 325w,\n/static/316c06e55e75e4427c13d5d37c83353c/309d5/LoginApiConfigurerConfig.webp 650w,\n/static/316c06e55e75e4427c13d5d37c83353c/78344/LoginApiConfigurerConfig.webp 975w,\n/static/316c06e55e75e4427c13d5d37c83353c/bdb72/LoginApiConfigurerConfig.webp 1300w,\n/static/316c06e55e75e4427c13d5d37c83353c/8beca/LoginApiConfigurerConfig.webp 2546w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/316c06e55e75e4427c13d5d37c83353c/5e043/LoginApiConfigurerConfig.png 163w,\n/static/316c06e55e75e4427c13d5d37c83353c/e5cc6/LoginApiConfigurerConfig.png 325w,\n/static/316c06e55e75e4427c13d5d37c83353c/663f3/LoginApiConfigurerConfig.png 650w,\n/static/316c06e55e75e4427c13d5d37c83353c/d880f/LoginApiConfigurerConfig.png 975w,\n/static/316c06e55e75e4427c13d5d37c83353c/4c573/LoginApiConfigurerConfig.png 1300w,\n/static/316c06e55e75e4427c13d5d37c83353c/78929/LoginApiConfigurerConfig.png 2546w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/316c06e55e75e4427c13d5d37c83353c/663f3/LoginApiConfigurerConfig.png\"\n            alt=\"LoginApiConfigurerConfig\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>마지막으로 Configurer가 가지고 있는 속성파일을 보면 4개의 Config를 가지고 있다</p>\n<ol>\n<li>\n<p>AuthorizationEndpointConfig : code 발급 요청 시 설정 파일</p>\n</li>\n<li>\n<p>RedirectionEndpointConfig : 인가서버에서 클라이언트에게 코드를 발급하기 위해 redirect하는데 이 정보를 관리</p>\n</li>\n<li>\n<p>TokenEndpointConfig : AccessToken을 요청할 때 인가 서버에 요청하는데 이 때 사용되는 속성</p>\n</li>\n<li>\n<p>UserInfoEndpointConfig : AccessToken을 가지고 인가서버에서 User정보를 가지고 올 때 관련된 url나 설정 된 정보를 가지고 있는 config</p>\n</li>\n</ol>\n<h3 id=\"authorization-code---주요-클래스\" style=\"position:relative;\"><a href=\"#authorization-code---%EC%A3%BC%EC%9A%94-%ED%81%B4%EB%9E%98%EC%8A%A4\" aria-label=\"authorization code   주요 클래스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authorization Code - 주요 클래스</h3>\n<h4 id=\"1-oauth2authorizationrequestredirectfilter\" style=\"position:relative;\"><a href=\"#1-oauth2authorizationrequestredirectfilter\" aria-label=\"1 oauth2authorizationrequestredirectfilter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1) OAuth2AuthorizationRequestRedirectFilter</h4>\n<p>-> 권한 코드 부여 흐름 시작<br>\n-> 해당 필터의 동작 조건 : AuthorizationRequestMatcher : /oauth2/authorization/{registrationId}*<br>\n-> AuthorizationEndpointConfig. authorizationRequestBaseUri 를 통해 재정의 가능</p>\n<h4 id=\"2-defaultoauth2authorizationrequestresolver\" style=\"position:relative;\"><a href=\"#2-defaultoauth2authorizationrequestresolver\" aria-label=\"2 defaultoauth2authorizationrequestresolver permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2) DefaultOAuth2AuthorizationRequestResolver</h4>\n<ul>\n<li>웹 요청에 대하여 <strong>OAuth2AuthorizationRequest 객체</strong> 생성</li>\n<li>/oauth2/authorization/{registrationId} 와 일치하는지 확인해서 일치하면 registrationId를 추출하고 이를 사용해서 ClientRegistration을 가져와 OAuth2AuthorizationRequest 빌드</li>\n</ul>\n<h4 id=\"3-oauth2authorizationrequest\" style=\"position:relative;\"><a href=\"#3-oauth2authorizationrequest\" aria-label=\"3 oauth2authorizationrequest permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3) OAuth2AuthorizationRequest</h4>\n<ul>\n<li>토큰 엔드포인트 요청 파라미터를 담은 객체로서 인가 응답을 연계하고 검증할 때 사용<br>\n(임시 코드를 받기위한 서버의 엔드 포인트)</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/29ad66c67fa073d7914b84a4e9fe0e2b/248ff/OAuth2AuthorizationRequest.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.96932515337423%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3UlEQVR42nWRa07DMBCEc7HGj33aTUC0UIS4/zkG2Y4UQsOPT7Na2eP1znRfBY9a8FkW3LyAVcFuf1AEyjt56JwzLiEdmF4XxtdqePcrVnMUdZAa2LwjGyFlzDEduMT0bFic8VgURQyBqb/aJpi3w/1yeJ7kP6aXSrgXgbEiCXeyDo1MiERdz753arhWwuNqEFGwKbIKyFptIFVIcZAJAhHmuJnOadffNMO3hfC9et/hR6lYzIehNzPbGL3GIZi8BxW33lSdcasMVwW16WRoYkEiQSTu9dhpPARyFtIPrH75uRxbsUgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/29ad66c67fa073d7914b84a4e9fe0e2b/a81b5/OAuth2AuthorizationRequest.webp 163w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/da3ef/OAuth2AuthorizationRequest.webp 325w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/309d5/OAuth2AuthorizationRequest.webp 650w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/78344/OAuth2AuthorizationRequest.webp 975w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/bdb72/OAuth2AuthorizationRequest.webp 1300w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/fe44d/OAuth2AuthorizationRequest.webp 2254w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/29ad66c67fa073d7914b84a4e9fe0e2b/5e043/OAuth2AuthorizationRequest.png 163w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/e5cc6/OAuth2AuthorizationRequest.png 325w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/663f3/OAuth2AuthorizationRequest.png 650w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/d880f/OAuth2AuthorizationRequest.png 975w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/4c573/OAuth2AuthorizationRequest.png 1300w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/248ff/OAuth2AuthorizationRequest.png 2254w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/29ad66c67fa073d7914b84a4e9fe0e2b/663f3/OAuth2AuthorizationRequest.png\"\n            alt=\"OAuth2AuthorizationRequest\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h4 id=\"4-oauth2authorizationrequestrepository\" style=\"position:relative;\"><a href=\"#4-oauth2authorizationrequestrepository\" aria-label=\"4 oauth2authorizationrequestrepository permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4) OAuth2AuthorizationRequestRepository</h4>\n<ul>\n<li>인가 요청을 시작한 시점부터 인가 요청을 받는 시점까지 (리다이렉트) OAuth2AuthorizationRequest 유지</li>\n</ul>\n<h3 id=\"authorization-code-grant-type---get-code\" style=\"position:relative;\"><a href=\"#authorization-code-grant-type---get-code\" aria-label=\"authorization code grant type   get code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authorization Code Grant Type - get code</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1e9b26d94d0f831a9d50a3887ee907ec/ea3e4/AuthorizationFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.828220858895705%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACOUlEQVR42m2SyWrbUBSG9U6F7puYpKs+T8kyTQe6KnTTdylpd6EttiEpnmTNsiQrkizJtubhK7pJoIUeOFzO4ecfDlcKg4hgrRAoKkfTpA4CqqKgqiqKshJvlpdkRU1R1sTHEj/O8HcHttEBL0jZDnNSsM9KpL7roCyhqqh2EUWSUBQF5UD0SJxmJaYXYLk+unOPtvGxvBB9M8wBhhug2lsOWYEEkKQprudRNQ1rVWV2e4s8mzG/u0WRZXx/i22ZyPIK13XQNY1fP3/w/ds108kYx7bp6ej7Dom+HzjxPIcvnz/x8f0HLq8uubx6w9W7t7y+uGA8mdK1Lfs0JcuO6LrOZDplPB4znkwwDENw9H2P1A2RAcPQeHV+ysnolBdnI07ORoxenvPs+XO+Xl8LTN20NF1Psj9iWRaaprHZbMiyjKeSDvsDlmkShSGL33eo6zWKqqIOLcsYmorn32M6vmjDDbG9e+FysVhg2zZBEIhO0xTJ9baouomimciagWnZQtk0TeFC1Q2WsoK8VlgrKrKislqrAmeaBtvtlul0ys3NjXArHfOKJK+J85pdVlO3PUWeU9c1bdtQ1B1J0bHPa5KsJikadtnD/un+vu8LtyIyf1X/CIjjWEQe4gwxDoe9EPgfNgxDVqsV8/kc13WRhr1ooHsEPZAcaNtW/MkwioiiSAjt4photxP7gXS4naIo4qaO4/zr8KkGN2VZik+d5znOxmY5n7FcLoUTWZaFaNM0wtVw84FwSPQHhgcocTrDwm0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1e9b26d94d0f831a9d50a3887ee907ec/a81b5/AuthorizationFlow.webp 163w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/da3ef/AuthorizationFlow.webp 325w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/309d5/AuthorizationFlow.webp 650w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/78344/AuthorizationFlow.webp 975w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/bdb72/AuthorizationFlow.webp 1300w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/da511/AuthorizationFlow.webp 2514w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1e9b26d94d0f831a9d50a3887ee907ec/5e043/AuthorizationFlow.png 163w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/e5cc6/AuthorizationFlow.png 325w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/663f3/AuthorizationFlow.png 650w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/d880f/AuthorizationFlow.png 975w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/4c573/AuthorizationFlow.png 1300w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/ea3e4/AuthorizationFlow.png 2514w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1e9b26d94d0f831a9d50a3887ee907ec/663f3/AuthorizationFlow.png\"\n            alt=\"AuthorizationFlow\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol>\n<li>\n<p>oauth2/authorization/{registrationId}로 request 요청이 오면 <strong>OAuth2AuthorizationRequestRedirectFilter</strong>가 받고 DefaultOAuth2AuthorizationRequestResolver가 요청 정보와 가지고 있는 requestMatcher값을 비교</p>\n</li>\n<li>\n<p>값이 동일하면 /login/oauth2/code/{registrationId} 경로를 생성 하면서 OAuth2AutorizationRequest객체 생성</p>\n</li>\n<li>\n<p>OAuth2AutorizationRequest 객체를 세션에 저장<br>\n(세션을 사용하지 않을 경우 쿠키에 저장해서 참조하도록 repository 객체 재정의 가능)</p>\n</li>\n<li>\n<p>인가서버에서 검증 후 code와 state값을 담아 반환한다.</p>\n<ul>\n<li>1번에서 값이 동일하지 않을경우 AuthenticationEntryPoint에 설정된 Url로 이동 ()</li>\n</ul>\n</li>\n</ol>\n<p>요약하면 Authorization Code Grant Type 첫번째 code를 받는 기능을 담당하는 Filter가<br>\n<strong>OAuth2AuthorizationRequestRedirectFilter</strong></p>\n<h3 id=\"authorization-accesstoken-주요-클래스\" style=\"position:relative;\"><a href=\"#authorization-accesstoken-%EC%A3%BC%EC%9A%94-%ED%81%B4%EB%9E%98%EC%8A%A4\" aria-label=\"authorization accesstoken 주요 클래스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authorization AccessToken 주요 클래스</h3>\n<h4 id=\"1-oauth2loginauthenticationfilter\" style=\"position:relative;\"><a href=\"#1-oauth2loginauthenticationfilter\" aria-label=\"1 oauth2loginauthenticationfilter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1) OAuth2LoginAuthenticationFilter</h4>\n<ul>\n<li>인가서버로부터 리다이렉트 되면서 전달된 code 를 인가서버의 Access Token 으로 교환</li>\n<li>Access Token 이 저장된 OAuth2LoginAuthenticationToken을 AuthenticationManager에 위임하여 UserInfo 정보를 요청해서 최종 사용자에 로그인</li>\n<li>OAuth2AuthorizedClientRepository를 사용하여 OAuth2AuthorizedClient 를 저장한다.</li>\n<li>인증에 성공 시 OAuth2AuthenticationToken 이 생성, SecurityContext에 저장되며 인증 처리를 완료</li>\n<li>/login/oauth2/code/*로 url이 매핑된다</li>\n</ul>\n<h4 id=\"2-oauth2loginauthenticationprovider\" style=\"position:relative;\"><a href=\"#2-oauth2loginauthenticationprovider\" aria-label=\"2 oauth2loginauthenticationprovider permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2) OAuth2LoginAuthenticationProvider</h4>\n<ul>\n<li>Access Token 으로 교환하고 이 토큰을 사용하여 UserInfo 처리를 담당</li>\n<li>Scope 에 openid 유,무에 따라 OAuth처리 Provider, OpenId처리 Provider 호출</li>\n</ul>\n<h4 id=\"3-oauth2authorizationcodeauthenticationprovider\" style=\"position:relative;\"><a href=\"#3-oauth2authorizationcodeauthenticationprovider\" aria-label=\"3 oauth2authorizationcodeauthenticationprovider permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3) OAuth2AuthorizationCodeAuthenticationProvider</h4>\n<ul>\n<li>권한 코드 부여 흐름을 처리하는 AuthenticationProvider</li>\n<li>인가서버에 Authorization Code 와 AccessToken 의 교환을 담당하는 클래스</li>\n</ul>\n<h4 id=\"4-oidcauthorizationcodeauthenticationprovider\" style=\"position:relative;\"><a href=\"#4-oidcauthorizationcodeauthenticationprovider\" aria-label=\"4 oidcauthorizationcodeauthenticationprovider permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4) OidcAuthorizationCodeAuthenticationProvider</h4>\n<ul>\n<li>OpenID Connect Core 1.0 권한 코드 부여 흐름을 처리하는 AuthenticationProvider 이며 요청 Scope 에 openid 가 존재할 경우 실행</li>\n</ul>\n<h4 id=\"5-defaultauthorizationcodetokenresponseclient\" style=\"position:relative;\"><a href=\"#5-defaultauthorizationcodetokenresponseclient\" aria-label=\"5 defaultauthorizationcodetokenresponseclient permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5) DefaultAuthorizationCodeTokenResponseClient</h4>\n<ul>\n<li>인가서버의 token 엔드 포인트로 통신을 담당하며 AccessToken 을 받은 후 OAuth2AccessTokenResponse 에 저장하고 반환한다</li>\n</ul>\n<h3 id=\"authorization-code-grant-type---get-accesstoken\" style=\"position:relative;\"><a href=\"#authorization-code-grant-type---get-accesstoken\" aria-label=\"authorization code grant type   get accesstoken permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authorization Code Grant Type - get AccessToken</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c87dd2a73622aa1c29b0013bc9e3e2a1/fa34b/AccessTokenFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.21472392638037%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACeklEQVR42j2Sa2sTQRSG86cUQQQpWPWbUP0p/gUR/Wq1pX6xKFgQalvxiraKbZqUWppks2nuu9ndbDZN9pZks242j8yUOvByZmfePfOcM5MZuh6DaUyYzpkDpmlQKBRQlDLFYolSSSGKpsCcNImZpwliJMmMNE2Zz+dSYv73b0zGD0MGa2sMHj7kvKzy+OkTrl69wsKtRa5dv8Hi7Ttkj4ts/iqwvrXHm4/7fMqp6B2DWq2GqqqUyyqtVovJZEJmHEV4Gxu4jx6ROn2WV1+wsHCTe0tLLN69y9KD+5yqNfZLOgeKzu+STrbcwTAtcrlDdnd3yefzNJtNoigic4l8OYIgwLZtLMvCtCzsXu+inGnEOPSZjIL/vna7jaZpdDod6Z9Op2Q8z8O2LCqKgmEYuK4rT7voYZF6vUGz2aJQLJLLH5E/OqJSOZNJhK9arUqJxJJQnCRq932f4XCI4zj0+316XZOO1uLc6RH4HqPR6L/CMJSEwmuaJt1uV/6fJAmZOI4lmdhsNBoYRgfLGfDuZ4HXnw5Z/5jlrG3h9GxqtbqkEl5BKPxCgk7XdXkxGVG3KFv0o6aqdNoturbD3mGBH/kS3w5OOWvqjMdjgjCUXkHnC/m+/Ba3rSiKnMuEsulxzDSakM4S5umMWTRmlsTMkimTwGfkunjuEMs00bU2/X5PxmajTqVS5uTkREJleucufTfACye44UTGcRQzCEYMvBEDf0R/6GN2HTSji25YVJsammlTUCqU1Cqa2cN2zvEF4cb3Pyxv7rO6neX5+wPWPx+TL9ZY2TqQa5dxdeeQV1+Oefs1z8p2jrUPOV7u5FjbyfFsM0u21JLP6R+//g+gfYgljAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c87dd2a73622aa1c29b0013bc9e3e2a1/a81b5/AccessTokenFlow.webp 163w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/da3ef/AccessTokenFlow.webp 325w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/309d5/AccessTokenFlow.webp 650w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/78344/AccessTokenFlow.webp 975w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/bdb72/AccessTokenFlow.webp 1300w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/237f9/AccessTokenFlow.webp 2524w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c87dd2a73622aa1c29b0013bc9e3e2a1/5e043/AccessTokenFlow.png 163w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/e5cc6/AccessTokenFlow.png 325w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/663f3/AccessTokenFlow.png 650w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/d880f/AccessTokenFlow.png 975w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/4c573/AccessTokenFlow.png 1300w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/fa34b/AccessTokenFlow.png 2524w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c87dd2a73622aa1c29b0013bc9e3e2a1/663f3/AccessTokenFlow.png\"\n            alt=\"AccessTokenFlow\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol>\n<li>code를 받아오면 <strong>OAuth2LoginAuthenticationFilter</strong> 실행</li>\n<li>OAuth2AuthorizationRequest(세션에 저장 된), OAuth2AccessTokenResponse(인가 서버로 부터 받은)를 가진 OAuth2LoginTuthenticationToken을 저장</li>\n<li><strong>OAuth2LoginAuthenticationProvider</strong>에서 AccessToken을 가져옴(/token)</li>\n<li>가져온 OAuth2AuthorizationCodeAuthentication Token을 사용해 <strong>DefaultOAuth2UserService</strong>에서 인가서버로 부터 사용자 정보를 가져온다.</li>\n</ol>\n<p>추가로</p>\n<ul>\n<li>\n<p>Code 가지고 있는 객체는 RequestEntity<OAuth2AuthorizationRequest></p>\n</li>\n<li>\n<p>AccessToken가지고 있는 객체는 ResponseEntity<OAuth2AccessTokenResponse></p>\n</li>\n</ul>\n<h3 id=\"oauth2userservice\" style=\"position:relative;\"><a href=\"#oauth2userservice\" aria-label=\"oauth2userservice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2UserService</h3>\n<blockquote>\n<p>AccessToken을 사용해 리소스 소유자의 정보를 가져오며 OAuth2User타입의 객체를 리턴한다.</p>\n</blockquote>\n<ul>\n<li>구현체는 <strong>DefaultOAuth2UserService와 OidcUserService</strong>가 있다.</li>\n</ul>\n<h4 id=\"defaultoauth2userservice\" style=\"position:relative;\"><a href=\"#defaultoauth2userservice\" aria-label=\"defaultoauth2userservice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DefaultOAuth2UserService</h4>\n<blockquote>\n<p>표준 OAuth2.0 Provider를 지원하는 구현체</p>\n</blockquote>\n<ul>\n<li>OAuth2User 반환\n<ul>\n<li>OAuth2.0 Provider에 연결된 사용자 주체</li>\n<li>사용자 인증정보를 가지고 있다 (name, email, phone number, address)</li>\n<li>기본 구현체는 <strong>DefaultOAuth2User</strong>이며 Authentication principal에 저장</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"oidcuserservice\" style=\"position:relative;\"><a href=\"#oidcuserservice\" aria-label=\"oidcuserservice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OidcUserService</h4>\n<blockquote>\n<p>OpenID Connect 1.0 Provider를 지원하는 구현체</p>\n</blockquote>\n<ul>\n<li>OidcUserRequest의 ID Token을 통해 인증처리, 필요 시 DefaultOAuth2UserService 사용</li>\n<li>OidcUser타입 반환\n<ul>\n<li>최종 사용자의 인증 정보인 Claims을 포함</li>\n<li>기본 구현체는 <strong>DefaultOidcUser</strong> 이며 인증 이후 Authentication principal에 저장</li>\n<li>ID토큰은 개인키로 서명이 되어있기 때문에 정해진 알고리즘을 통해 검증하고 Oidc 객체를 생성해야 한다.</li>\n</ul>\n</li>\n</ul>\n<!-- TODO: Flow나중에 정리 OAuth2 로그인 구현 - Oauth 2.0 User 모델 소개(1) 10분 경-->\n<p>여기까진 Login 과정으로 SecurityConfig에</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"84496755110701450000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`    @Bean\n    SecurityFilterChain oauth2SecurityFilterChain(HttpSecurity http) throws Exception {\n        http.authorizeRequests((requests) -> requests.anyRequest().authenticated());\n        http.oauth2Login(Customizer.withDefaults());\n        return http.build();\n    }`, `84496755110701450000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">SecurityFilterChain</span><span class=\"mtk1\"> </span><span class=\"mtk11\">oauth2SecurityFilterChain</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpSecurity</span><span class=\"mtk1\"> http) throws Exception {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorizeRequests</span><span class=\"mtk1\">((requests) </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">requests</span><span class=\"mtk1\">.</span><span class=\"mtk11\">anyRequest</span><span class=\"mtk1\">().</span><span class=\"mtk11\">authenticated</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">oauth2Login</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Customizer</span><span class=\"mtk1\">.</span><span class=\"mtk11\">withDefaults</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>으로 실행된다</p>\n<h3 id=\"openid-logout\" style=\"position:relative;\"><a href=\"#openid-logout\" aria-label=\"openid logout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OpenID Logout</h3>\n<ul>\n<li>클라이언트는 로그아웃 엔드포인트를 사용하여 웹 브라우저에 대한 세션과 쿠키를 지운다.</li>\n<li>클라이언트 로그아웃 성공 후 OidcClientInitiatedLogoutSuccessHandler 를 호출하여 OpenID Provider 세션 로그아웃 요청</li>\n<li>OpenID Provider 로그아웃이 성공하면 지정된 위치로 리다이렉트 한다</li>\n<li>로그아웃 엔드 포인트는 end_session_endpoint 로 정의되어 있다</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"87343687480152850000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@Configuration(proxyBeanMethods = false)\npublic class OAuth2ClientConfig {\n\n    @Autowired\n    private ClientRegistrationRepository clientRegistrationRepository;\n\n    @Bean\n    SecurityFilterChain oauth2SecurityFilterChain(HttpSecurity http) throws Exception {\n        http.authorizeRequests((requests) -> requests.anyRequest().authenticated());\n        http.oauth2Login(Customizer.withDefaults());\n        http.logout()\n                .logoutSuccessHandler(oidcLogoutSuccessHandler())\n                .invalidateHttpSession(true)\n                .clearAuthentication(true)\n                .deleteCookies(&quot;JSESSIONID&quot;);\n\n        return http.build();\n    }\n\n    private OidcClientInitiatedLogoutSuccessHandler oidcLogoutSuccessHandler() {\n        OidcClientInitiatedLogoutSuccessHandler successHandler = new OidcClientInitiatedLogoutSuccessHandler(clientRegistrationRepository);\n        successHandler.setPostLogoutRedirectUri(&quot;http://localhost:8081/login&quot;);\n        return successHandler;\n    }\n}`, `87343687480152850000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Configuration</span><span class=\"mtk1\">(proxyBeanMethods = </span><span class=\"mtk4\">false</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2ClientConfig</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Autowired</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ClientRegistrationRepository</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistrationRepository</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">SecurityFilterChain</span><span class=\"mtk1\"> </span><span class=\"mtk11\">oauth2SecurityFilterChain</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpSecurity</span><span class=\"mtk1\"> </span><span class=\"mtk12\">http</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Exception</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorizeRequests</span><span class=\"mtk1\">((requests) </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">requests</span><span class=\"mtk1\">.</span><span class=\"mtk11\">anyRequest</span><span class=\"mtk1\">().</span><span class=\"mtk11\">authenticated</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">oauth2Login</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Customizer</span><span class=\"mtk1\">.</span><span class=\"mtk11\">withDefaults</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">logout</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">logoutSuccessHandler</span><span class=\"mtk1\">(</span><span class=\"mtk11\">oidcLogoutSuccessHandler</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">invalidateHttpSession</span><span class=\"mtk1\">(</span><span class=\"mtk4\">true</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">clearAuthentication</span><span class=\"mtk1\">(</span><span class=\"mtk4\">true</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">deleteCookies</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;JSESSIONID&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OidcClientInitiatedLogoutSuccessHandler</span><span class=\"mtk1\"> </span><span class=\"mtk11\">oidcLogoutSuccessHandler</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OidcClientInitiatedLogoutSuccessHandler</span><span class=\"mtk1\"> </span><span class=\"mtk12\">successHandler</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">OidcClientInitiatedLogoutSuccessHandler</span><span class=\"mtk1\">(clientRegistrationRepository);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">successHandler</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setPostLogoutRedirectUri</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;http://localhost:8081/login&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> successHandler;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h3 id=\"mvc에서-인증-객체-참조-방법\" style=\"position:relative;\"><a href=\"#mvc%EC%97%90%EC%84%9C-%EC%9D%B8%EC%A6%9D-%EA%B0%9D%EC%B2%B4-%EC%B0%B8%EC%A1%B0-%EB%B0%A9%EB%B2%95\" aria-label=\"mvc에서 인증 객체 참조 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MVC에서 인증 객체 참조 방법</h3>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"42514460301027434000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`    // 1.Authentication 객체로 전달 받기\n    @GetMapping(&quot;/user&quot;)\n    public OAuth2User user(Authentication authentication){\n        OAuth2User oAuth2User = (OAuth2User)authentication.getPrincipal();\n\n        // 2. ContextHolder에서 꺼내오기\n        OAuth2AuthenticationToken oAuth2AuthenticationToken = (OAuth2AuthenticationToken) SecurityContextHolder.getContext().getAuthentication();\n        OAuth2User oAuth2User2 = oAuth2AuthenticationToken.getPrincipal();\n        System.out.println(&quot;oAuth2User = &quot; + oAuth2User);\n        System.out.println(&quot;oAuth2User2 = &quot; + oAuth2User2);\n        return oAuth2User;\n    }\n\n    // 3. AuthenticationPrincipal 어노테이션 사용\n    @GetMapping(&quot;/oauth2User&quot;)\n    public OAuth2User oauth2User(@AuthenticationPrincipal OAuth2User oAuth2User){\n        System.out.println(&quot;oAuth2User = &quot; + oAuth2User);\n        return oAuth2User;\n    }\n\n    @GetMapping(&quot;/oidcUser&quot;)\n    public OidcUser oidcUser(@AuthenticationPrincipal OidcUser oidcUser){\n        System.out.println(&quot;oidcUser = &quot; + oidcUser);\n        return oidcUser;\n    }`, `42514460301027434000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// 1.Authentication 객체로 전달 받기</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">GetMapping</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/user&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2User</span><span class=\"mtk1\"> </span><span class=\"mtk11\">user</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Authentication</span><span class=\"mtk1\"> authentication){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2User</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2User</span><span class=\"mtk1\"> = (OAuth2User)</span><span class=\"mtk12\">authentication</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getPrincipal</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// 2. ContextHolder에서 꺼내오기</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2AuthenticationToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthenticationToken</span><span class=\"mtk1\"> = (OAuth2AuthenticationToken) </span><span class=\"mtk12\">SecurityContextHolder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getContext</span><span class=\"mtk1\">().</span><span class=\"mtk11\">getAuthentication</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2User</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2User2</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2AuthenticationToken</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getPrincipal</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;oAuth2User = &quot;</span><span class=\"mtk1\"> + oAuth2User);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;oAuth2User2 = &quot;</span><span class=\"mtk1\"> + oAuth2User2);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> oAuth2User;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// 3. AuthenticationPrincipal 어노테이션 사용</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">GetMapping</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/oauth2User&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2User</span><span class=\"mtk1\"> </span><span class=\"mtk11\">oauth2User</span><span class=\"mtk1\">(@</span><span class=\"mtk10\">AuthenticationPrincipal</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2User</span><span class=\"mtk1\"> oAuth2User){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;oAuth2User = &quot;</span><span class=\"mtk1\"> + oAuth2User);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> oAuth2User;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">GetMapping</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/oidcUser&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OidcUser</span><span class=\"mtk1\"> </span><span class=\"mtk11\">oidcUser</span><span class=\"mtk1\">(@</span><span class=\"mtk10\">AuthenticationPrincipal</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OidcUser</span><span class=\"mtk1\"> oidcUser){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;oidcUser = &quot;</span><span class=\"mtk1\"> + oidcUser);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> oidcUser;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<h3 id=\"oauth2-custom\" style=\"position:relative;\"><a href=\"#oauth2-custom\" aria-label=\"oauth2 custom permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2 Custom</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2393551ef5697134cc345fe5c421cd12/13ce4/oauth2configurer.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.380368098159508%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzUlEQVR42j3OyW3DQBAFUaVjDsnpdRZLzj+sMriIhzp14+G/zJ2wlWmFOY3x+TD/3rQ+aWGMdKIP+viljYmas20bIkqtQpW7KqzrykvUka0w5YdmSrZ5YWOSrZPeSE9aDtI7YYa7nvc+38/fvtcLrDeYdUHrjkeeHUusOrofKbrvmAd+d6w8gKvCsiyUUi5Q98KQhVAh2qD1QWTHLXEJQhJXx9XIcKJ1IhsWgaqxlnJiD/hdaFKxSCLvleJ4jRPVqmjd8IjzdoAq+kBf8B9Gy54D/fMsNwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/2393551ef5697134cc345fe5c421cd12/a81b5/oauth2configurer.webp 163w,\n/static/2393551ef5697134cc345fe5c421cd12/da3ef/oauth2configurer.webp 325w,\n/static/2393551ef5697134cc345fe5c421cd12/309d5/oauth2configurer.webp 650w,\n/static/2393551ef5697134cc345fe5c421cd12/78344/oauth2configurer.webp 975w,\n/static/2393551ef5697134cc345fe5c421cd12/bdb72/oauth2configurer.webp 1300w,\n/static/2393551ef5697134cc345fe5c421cd12/30e03/oauth2configurer.webp 2006w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/2393551ef5697134cc345fe5c421cd12/5e043/oauth2configurer.png 163w,\n/static/2393551ef5697134cc345fe5c421cd12/e5cc6/oauth2configurer.png 325w,\n/static/2393551ef5697134cc345fe5c421cd12/663f3/oauth2configurer.png 650w,\n/static/2393551ef5697134cc345fe5c421cd12/d880f/oauth2configurer.png 975w,\n/static/2393551ef5697134cc345fe5c421cd12/4c573/oauth2configurer.png 1300w,\n/static/2393551ef5697134cc345fe5c421cd12/13ce4/oauth2configurer.png 2006w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/2393551ef5697134cc345fe5c421cd12/663f3/oauth2configurer.png\"\n            alt=\"oauth2configurer\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>oauth2LoginConfig 설정 클래스를 살펴보면 4개의 하위 config설정 클래스가 있다.</p>\n<p>이 설정 클래스들의 값을 변경하면 requestMatcher가 요청을 처리할 url경로를 변경할 수 있다.</p>\n<h4 id=\"authorizationbaseurl--redirectionbaseurl-변경\" style=\"position:relative;\"><a href=\"#authorizationbaseurl--redirectionbaseurl-%EB%B3%80%EA%B2%BD\" aria-label=\"authorizationbaseurl  redirectionbaseurl 변경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AuthorizationBaseUrl &#x26; RedirectionBaseUrl 변경</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d9e49f1066248f14055a6f339b0c9d78/88eef/AuthorizationBaseUrlRedirectionBaseUrl.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.288343558282207%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA5klEQVR42pVQ2Y6EMAzj/3+QJ4ZjYFrRcrdQYIpXDjval9VKG8lVqsR2kmSeZ+R5jrIsURSF5FmWwVqLYRhQFQWqNEWZpqgeDyilsCwL2rYVTvV8QmmN67rASEIImKYJFP6A/23bpOEdNkTTIvY9onNCJLz36PseRinM1uI6jluQha7roLUW97quYYzBOI5CEgPvMS2LgNPR7DgObCEgjCPgHOD9Lbiuq4hwXQrSlQbOObDG1YzWaF8vyVk/zxMxxhucGD+R8KFb0zRyP96OhH8F7/e5IR86cU1OyCn2ff/uu37FX/EF7sfORfs+e6MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d9e49f1066248f14055a6f339b0c9d78/a81b5/AuthorizationBaseUrlRedirectionBaseUrl.webp 163w,\n/static/d9e49f1066248f14055a6f339b0c9d78/da3ef/AuthorizationBaseUrlRedirectionBaseUrl.webp 325w,\n/static/d9e49f1066248f14055a6f339b0c9d78/309d5/AuthorizationBaseUrlRedirectionBaseUrl.webp 650w,\n/static/d9e49f1066248f14055a6f339b0c9d78/78344/AuthorizationBaseUrlRedirectionBaseUrl.webp 975w,\n/static/d9e49f1066248f14055a6f339b0c9d78/bdb72/AuthorizationBaseUrlRedirectionBaseUrl.webp 1300w,\n/static/d9e49f1066248f14055a6f339b0c9d78/27ba4/AuthorizationBaseUrlRedirectionBaseUrl.webp 2528w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d9e49f1066248f14055a6f339b0c9d78/5e043/AuthorizationBaseUrlRedirectionBaseUrl.png 163w,\n/static/d9e49f1066248f14055a6f339b0c9d78/e5cc6/AuthorizationBaseUrlRedirectionBaseUrl.png 325w,\n/static/d9e49f1066248f14055a6f339b0c9d78/663f3/AuthorizationBaseUrlRedirectionBaseUrl.png 650w,\n/static/d9e49f1066248f14055a6f339b0c9d78/d880f/AuthorizationBaseUrlRedirectionBaseUrl.png 975w,\n/static/d9e49f1066248f14055a6f339b0c9d78/4c573/AuthorizationBaseUrlRedirectionBaseUrl.png 1300w,\n/static/d9e49f1066248f14055a6f339b0c9d78/88eef/AuthorizationBaseUrlRedirectionBaseUrl.png 2528w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d9e49f1066248f14055a6f339b0c9d78/663f3/AuthorizationBaseUrlRedirectionBaseUrl.png\"\n            alt=\"AuthorizationBaseUrlRedirectionBaseUrl\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Authorization Code Grant Type 로그인 과정에서</p>\n<p>code를 받아올 때 사용하는 base url과 code를 받아온 후 App으로 리다이렉트 해주는 redirection base url을 변경 할 수 있다.</p>\n<ol>\n<li>config 설정 파일에 oauth2LoginConfig 설정 변경, yml파일에 등록한 client redirect-uri 변경</li>\n</ol>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"67009032925962410000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`// application.yml\nredirect-uri: http://localhost:8081/login/v1/oauth2/code/keycloak\n\n// Config\n        http\n                .oauth2Login(oauth2 -> oauth2\n                        .loginPage(&quot;/login&quot;)\n//                        .loginProcessingUrl(&quot;/login/v1/oauth2/code/*&quot;)\n                        .authorizationEndpoint(authorizationEndpointConfig ->\n                                authorizationEndpointConfig.baseUri(&quot;/oauth2/v1/authorization&quot;))\n                        .redirectionEndpoint(redirectionEndpointConfig ->\n                                redirectionEndpointConfig.baseUri(&quot;/login/v1/oauth2/code/*&quot;))\n                );`, `67009032925962410000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// application.yml</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">redirect-uri</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> http</span><span class=\"mtk15\">:</span><span class=\"mtk3\">//localhost:8081/login/v1/oauth2/code/keycloak</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// Config</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        http</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">oauth2Login</span><span class=\"mtk1\">(oauth2 </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> oauth2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">loginPage</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/login&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//                        .loginProcessingUrl(&quot;/login/v1/oauth2/code/*&quot;)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">authorizationEndpoint</span><span class=\"mtk1\">(authorizationEndpointConfig </span><span class=\"mtk4\">-&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                </span><span class=\"mtk12\">authorizationEndpointConfig</span><span class=\"mtk1\">.</span><span class=\"mtk11\">baseUri</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/oauth2/v1/authorization&quot;</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">redirectionEndpoint</span><span class=\"mtk1\">(redirectionEndpointConfig </span><span class=\"mtk4\">-&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                </span><span class=\"mtk12\">redirectionEndpointConfig</span><span class=\"mtk1\">.</span><span class=\"mtk11\">baseUri</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/login/v1/oauth2/code/*&quot;</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                );</span></span></span></code></pre>\n<ol start=\"2\">\n<li>인가 서버의 valid post logout redirect url 설정 추가</li>\n</ol>\n<h4 id=\"pcke-사용\" style=\"position:relative;\"><a href=\"#pcke-%EC%82%AC%EC%9A%A9\" aria-label=\"pcke 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PCKE 사용</h4>\n<p>pcke방식 grant type을 설정하려면 Code Challenge를 암호화 해서 사용해야 하는데 OAuth2AuthorizationRequestResolver를 상속받은 구현체를 만들어 resolve함수를 custom 해야한다.</p>\n<p>resolve 로직을 간단히 요약하면 request 요청에 registrationId를 <strong>keycloakWithPKCE</strong>(yml 파일에서 해당 이름으로 매칭 시켜 놓음) 값이 있을 경우에 대한 분기처리를 한다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"5463108915389325000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`// config\n    @Bean\n    SecurityFilterChain oauth2SecurityFilterChain(HttpSecurity http) throws Exception {\n        http.authorizeRequests((requests) -> requests.antMatchers(&quot;/home&quot;).permitAll()\n                .anyRequest().authenticated());\n        http.oauth2Login(authLogin ->\n                authLogin.authorizationEndpoint(authEndpoint ->\n                        authEndpoint.authorizationRequestResolver(customOAuth2AuthenticationRequestResolver())));\n        http.logout().logoutSuccessUrl(&quot;/home&quot;);\n\n        return http.build();\n    }\n\n    private OAuth2AuthorizationRequestResolver customOAuth2AuthenticationRequestResolver() {\n        return new CustomOAuth2AuthorizationRequestResolver(clientRegistrationRepository, &quot;/oauth2/authorization&quot;);\n    }\n\n// CustomOAuth2AuthorizationRequestResolver\npublic class CustomOAuth2AuthorizationRequestResolver implements OAuth2AuthorizationRequestResolver {\n    ...\n\n    public CustomOAuth2AuthorizationRequestResolver(ClientRegistrationRepository clientRegistrationRepository, String authorizationRequestBaseUri) {\n\n        this.clientRegistrationRepository = clientRegistrationRepository;\n        this.authorizationRequestMatcher = new AntPathRequestMatcher(\n                authorizationRequestBaseUri + &quot;/{&quot; + REGISTRATION_ID_URI_VARIABLE_NAME + &quot;}&quot;);\n\n        defaultResolver = new DefaultOAuth2AuthorizationRequestResolver(clientRegistrationRepository, authorizationRequestBaseUri);\n    }\n\n    @Override\n    public OAuth2AuthorizationRequest resolve(HttpServletRequest request) {\n        String registrationId = resolveRegistrationId(request);\n        if (registrationId == null) {\n            return null;\n        }\n        ClientRegistration clientRegistration = clientRegistrationRepository.findByRegistrationId(registrationId);\n        if(registrationId.equals(&quot;keycloakWithPKCE&quot;)){\n            OAuth2AuthorizationRequest oAuth2AuthorizationRequest = defaultResolver.resolve(request);\n            return customResolve(oAuth2AuthorizationRequest, clientRegistration);\n\n        }\n        return defaultResolver.resolve(request);\n    }\n\n    @Override\n    public OAuth2AuthorizationRequest resolve(HttpServletRequest request, String clientRegistrationId) {\n        ClientRegistration clientRegistration = clientRegistrationRepository.findByRegistrationId(clientRegistrationId);\n        if(clientRegistrationId.equals(&quot;keycloakWithPKCE&quot;)){\n            OAuth2AuthorizationRequest oAuth2AuthorizationRequest = defaultResolver.resolve(request);\n            return customResolve(oAuth2AuthorizationRequest, clientRegistration);\n        }\n        return defaultResolver.resolve(request,clientRegistrationId);\n    }\n    private OAuth2AuthorizationRequest customResolve(OAuth2AuthorizationRequest authorizationRequest, ClientRegistration clientRegistration) {\n\n        Map<String,Object> extraParam = new HashMap<>();\n        extraParam.put(&quot;customName1&quot;,&quot;customValue1&quot;);\n        extraParam.put(&quot;customName2&quot;,&quot;customValue2&quot;);\n        extraParam.put(&quot;customName3&quot;,&quot;customValue3&quot;);\n\n        OAuth2AuthorizationRequest.Builder builder = OAuth2AuthorizationRequest\n                .from(authorizationRequest)\n                .additionalParameters(extraParam)\n                ;\n        DEFAULT_PKCE_APPLIER.accept(builder);\n\n        return builder.build();\n    }\n    ...\n}`, `5463108915389325000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// config</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">SecurityFilterChain</span><span class=\"mtk1\"> </span><span class=\"mtk11\">oauth2SecurityFilterChain</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpSecurity</span><span class=\"mtk1\"> http) throws Exception {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorizeRequests</span><span class=\"mtk1\">((requests) </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">requests</span><span class=\"mtk1\">.</span><span class=\"mtk11\">antMatchers</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/home&quot;</span><span class=\"mtk1\">).</span><span class=\"mtk11\">permitAll</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">anyRequest</span><span class=\"mtk1\">().</span><span class=\"mtk11\">authenticated</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">oauth2Login</span><span class=\"mtk1\">(authLogin </span><span class=\"mtk4\">-&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">authLogin</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorizationEndpoint</span><span class=\"mtk1\">(authEndpoint </span><span class=\"mtk4\">-&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk12\">authEndpoint</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorizationRequestResolver</span><span class=\"mtk1\">(</span><span class=\"mtk11\">customOAuth2AuthenticationRequestResolver</span><span class=\"mtk1\">())));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">logout</span><span class=\"mtk1\">().</span><span class=\"mtk11\">logoutSuccessUrl</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/home&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizationRequestResolver</span><span class=\"mtk1\"> </span><span class=\"mtk11\">customOAuth2AuthenticationRequestResolver</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">CustomOAuth2AuthorizationRequestResolver</span><span class=\"mtk1\">(clientRegistrationRepository, </span><span class=\"mtk8\">&quot;/oauth2/authorization&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// CustomOAuth2AuthorizationRequestResolver</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">CustomOAuth2AuthorizationRequestResolver</span><span class=\"mtk1\"> </span><span class=\"mtk4\">implements</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizationRequestResolver</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">CustomOAuth2AuthorizationRequestResolver</span><span class=\"mtk1\">(</span><span class=\"mtk10\">ClientRegistrationRepository</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistrationRepository</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizationRequestBaseUri</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">clientRegistrationRepository</span><span class=\"mtk1\"> = clientRegistrationRepository;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">authorizationRequestMatcher</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">AntPathRequestMatcher</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                authorizationRequestBaseUri + </span><span class=\"mtk8\">&quot;/{&quot;</span><span class=\"mtk1\"> + REGISTRATION_ID_URI_VARIABLE_NAME + </span><span class=\"mtk8\">&quot;}&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        defaultResolver = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DefaultOAuth2AuthorizationRequestResolver</span><span class=\"mtk1\">(clientRegistrationRepository, authorizationRequestBaseUri);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizationRequest</span><span class=\"mtk1\"> </span><span class=\"mtk11\">resolve</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpServletRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">request</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">registrationId</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">resolveRegistrationId</span><span class=\"mtk1\">(request);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (registrationId == </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">null</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">ClientRegistration</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistration</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">clientRegistrationRepository</span><span class=\"mtk1\">.</span><span class=\"mtk11\">findByRegistrationId</span><span class=\"mtk1\">(registrationId);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\">(</span><span class=\"mtk12\">registrationId</span><span class=\"mtk1\">.</span><span class=\"mtk11\">equals</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;keycloakWithPKCE&quot;</span><span class=\"mtk1\">)){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2AuthorizationRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthorizationRequest</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">defaultResolver</span><span class=\"mtk1\">.</span><span class=\"mtk11\">resolve</span><span class=\"mtk1\">(request);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">customResolve</span><span class=\"mtk1\">(oAuth2AuthorizationRequest, clientRegistration);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">defaultResolver</span><span class=\"mtk1\">.</span><span class=\"mtk11\">resolve</span><span class=\"mtk1\">(request);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizationRequest</span><span class=\"mtk1\"> </span><span class=\"mtk11\">resolve</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpServletRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">request</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistrationId</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">ClientRegistration</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistration</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">clientRegistrationRepository</span><span class=\"mtk1\">.</span><span class=\"mtk11\">findByRegistrationId</span><span class=\"mtk1\">(clientRegistrationId);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\">(</span><span class=\"mtk12\">clientRegistrationId</span><span class=\"mtk1\">.</span><span class=\"mtk11\">equals</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;keycloakWithPKCE&quot;</span><span class=\"mtk1\">)){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2AuthorizationRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthorizationRequest</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">defaultResolver</span><span class=\"mtk1\">.</span><span class=\"mtk11\">resolve</span><span class=\"mtk1\">(request);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">customResolve</span><span class=\"mtk1\">(oAuth2AuthorizationRequest, clientRegistration);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">defaultResolver</span><span class=\"mtk1\">.</span><span class=\"mtk11\">resolve</span><span class=\"mtk1\">(request,clientRegistrationId);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizationRequest</span><span class=\"mtk1\"> </span><span class=\"mtk11\">customResolve</span><span class=\"mtk1\">(</span><span class=\"mtk10\">OAuth2AuthorizationRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizationRequest</span><span class=\"mtk1\">, </span><span class=\"mtk10\">ClientRegistration</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistration</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">,</span><span class=\"mtk10\">Object</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">extraParam</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">HashMap</span><span class=\"mtk1\">&lt;&gt;();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">extraParam</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;customName1&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;customValue1&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">extraParam</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;customName2&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;customValue2&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">extraParam</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;customName3&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;customValue3&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2AuthorizationRequest</span><span class=\"mtk1\">.</span><span class=\"mtk10\">Builder</span><span class=\"mtk1\"> </span><span class=\"mtk12\">builder</span><span class=\"mtk1\"> = </span><span class=\"mtk10\">OAuth2AuthorizationRequest</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">from</span><span class=\"mtk1\">(authorizationRequest)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">additionalParameters</span><span class=\"mtk1\">(extraParam)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                ;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">DEFAULT_PKCE_APPLIER</span><span class=\"mtk1\">.</span><span class=\"mtk11\">accept</span><span class=\"mtk1\">(builder);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">builder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h2 id=\"oauth-20-client---oauth2client\" style=\"position:relative;\"><a href=\"#oauth-20-client---oauth2client\" aria-label=\"oauth 20 client   oauth2client permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Client - oauth2Client()</h2>\n<ul>\n<li>OAuth2AuthorizedClient 는 인가받은 클라이언트를 의미하는 클래스</li>\n<li>OAuth2AuthorizedClient 는 AccessToken 과 RefreshToken 을 ClientRegistration (클라이언트)와 권한을 부여한 최종 사용자인 Principal과 함께 묶는다.</li>\n<li>OAuth2AuthorizedClient 의 AccessToken 을 사용해서 리소스 서버의 자원에 접근, 인가서버와의 통신으로 토큰을 검증</li>\n</ul>\n<!-- TODO: 이거 어떤거 말하는지 확인해야 함\nOAuth2.0 Login() 인증, 인가 포함\nOAuth2.0 Client() 인가처리는 가능하지만 최종 사용자의 인증은 처리 x -->\n<h3 id=\"oauth20-client-주요-클래스\" style=\"position:relative;\"><a href=\"#oauth20-client-%EC%A3%BC%EC%9A%94-%ED%81%B4%EB%9E%98%EC%8A%A4\" aria-label=\"oauth20 client 주요 클래스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2.0 Client 주요 클래스</h3>\n<h4 id=\"authorizationcodegrantconfigurer\" style=\"position:relative;\"><a href=\"#authorizationcodegrantconfigurer\" aria-label=\"authorizationcodegrantconfigurer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AuthorizationCodeGrantConfigurer</h4>\n<blockquote>\n<p>해당 클래스는 위에서 코드를 받아오기 위한 3개의 클래스를 생성하고, 추가로 accessToken을 받아오기 위한 <strong>OAuth2AuthorizationCodeGrantFilter</strong>도 생성</p>\n</blockquote>\n<h4 id=\"oauth2authorizedclientrepository\" style=\"position:relative;\"><a href=\"#oauth2authorizedclientrepository\" aria-label=\"oauth2authorizedclientrepository permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2AuthorizedClientRepository</h4>\n<blockquote>\n<p>다른 웹 요청이 와도 동일한 OAuth2AuthorizedClient 를 유지하는 역할</p>\n</blockquote>\n<h4 id=\"oauth2authorizedclientservice\" style=\"position:relative;\"><a href=\"#oauth2authorizedclientservice\" aria-label=\"oauth2authorizedclientservice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2AuthorizedClientService</h4>\n<blockquote>\n<p>OAuth2AuthorizedClientService 는 어플리케이션 레벨에서 OAuth2AuthorizedClient 를 관리(저장, 조회, 삭제 )</p>\n</blockquote>\n<h4 id=\"oauth2authorizedclientmanager\" style=\"position:relative;\"><a href=\"#oauth2authorizedclientmanager\" aria-label=\"oauth2authorizedclientmanager permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2AuthorizedClientManager</h4>\n<blockquote>\n<p>OAuth2AuthorizedClient 를 전반적으로 관리하는 인터페이스</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/989b9/OAuth2AuthorizedClientManagerStructure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.46625766871166%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB60lEQVR42nWSX2/aMBTF8/2/x962ag/rXiYVhkoFiD9lEEgCTmggJslSIAlQCAm/ze6E9rBZOjrX9r3Hx9c2ttst/xqD+ZrPTYuvbYf79oz7lsN9y+JLR/AS7XTO9R91Bv8Z/dmau8aYj7VnPtWH3H3/ofHhWw8RJDqnul65/gUt+Pb2xvF45HQ63XC5XN7PLwuoLjqxLE63ovJSsF6vmc/nCCE027bN+XzGmEwmtFotms0mT09Pmh3bYb8/cC4KlIZCURTkxyNFVemrBkFAu93WUPUKyowRx7E+ZTgc3uB5Hsq5SlCskB8OhIsFO1eQzGd4QiDDkCzPSbOMPM8pqwpjPB7T7/dvYip2XVe3QUqpEUlJLCUr10VYFsK2sS0L6ftso4gkDAnDULfKUNY7nQ6NRoPHx0fNo9GIzWaD4zhMbYvFxCTodfF7XQbdLiPTxBUCfzxiORgwe37Gsu13Qd/3dT+WyyWrIEDNkyTRm6vVEmfmsJSS0HV5VSKOw0sQcDideE1Tku2WOEnY7XaUZYlhmqZ2Va/XqdVqPDw80Ov1SNOUmeMQTKfEloVnmjhC4C0WvAyHJNMpgVr3PLI0Jcuyd0EVKHdqQz2OYtW3/X5PFEVsoojdH1bz1+QnGynZSqk5jqLbt6t+P8ovxQbgqPmlWJsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/a81b5/OAuth2AuthorizedClientManagerStructure.webp 163w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/da3ef/OAuth2AuthorizedClientManagerStructure.webp 325w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/309d5/OAuth2AuthorizedClientManagerStructure.webp 650w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/78344/OAuth2AuthorizedClientManagerStructure.webp 975w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/bdb72/OAuth2AuthorizedClientManagerStructure.webp 1300w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/45e15/OAuth2AuthorizedClientManagerStructure.webp 2588w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/5e043/OAuth2AuthorizedClientManagerStructure.png 163w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/e5cc6/OAuth2AuthorizedClientManagerStructure.png 325w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/663f3/OAuth2AuthorizedClientManagerStructure.png 650w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/d880f/OAuth2AuthorizedClientManagerStructure.png 975w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/4c573/OAuth2AuthorizedClientManagerStructure.png 1300w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/989b9/OAuth2AuthorizedClientManagerStructure.png 2588w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/663f3/OAuth2AuthorizedClientManagerStructure.png\"\n            alt=\"OAuth2AuthorizedClientManagerStructure\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ul>\n<li>Client Credentials Flow, Resource Owner Password Flow, Refresh Token Flow 3개의 권한 부여 방식 사용</li>\n<li>OAuth2AuthorizedClientService 나 OAuth2AuthorizedClientRepository 에 OAuth2AuthorizedClient 저장을 위임한 후 OAuth2AuthorizedClient 최종 반환</li>\n<li>HttpServletRequest는 DefaultOAuth2AuthorizedClientManager 클래스가 처리</li>\n<li>데몬, 백그라운드 실행 시 AuthorizedClientServiceOAuth2AuthorizedClientManager 클래스가 처리</li>\n</ul>\n<h3 id=\"oauth2-client---resource-owner-password-flow\" style=\"position:relative;\"><a href=\"#oauth2-client---resource-owner-password-flow\" aria-label=\"oauth2 client   resource owner password flow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2 client - Resource Owner Password Flow</h3>\n<h4 id=\"인증-처리\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9D-%EC%B2%98%EB%A6%AC\" aria-label=\"인증 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증 처리</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/818fe/ResourceOwnerPasswordFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.828220858895705%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACDUlEQVR42n2SUW/SUBzF+7lMdPFhMTHRj+CDb34ufdIl+oJGsmmMc8JooQPGcLRxpYUCLbRrWQul7c/cKyrGxZOc3N7k3nPPv+cok+kMZ+RyZdm4kyn+fEEURURRTJqmrNdrySxdsUlSNkmyZcom3e6zjM0ml+eUmetimSbj8ZjpdMrFxQW1Wk1SCAsUZcnS9wkdh9AeEto24XhEOHG5dhwCzyeKY7IsQ4mWS1ZZRl4UBEEgRS3LwrZtVqsVvzAwDE5VFbXZpKE10Vot+d3UdVRVpdVsyvtKZF0x77S5tockN0tmnsfIcfB9n7Is+R/KovjNYrsqeDMwDQhDaTmOYzn+fD5nsVgQhiGhcO4v8MKY+fUSL4iZR8tbH1GEC6EuIEIYDodyZEEhliQ3kl1jyId6h+pxk8NaG609oJy44LowmfxkGKL88f/veOKxXc5mM3q9HpbtsLlZgqZSahp0O6Dr4Dg7gjsCuyi2e/Xc5HnlC6+qdV5W69TPLsmCBYhA12vJMs//FhTI85zD6nteHxxQqVQ4PDri5OSE1vk33n2q87nR4c3HBi/efuW4bRLEifxNhmnKu8quO4EkTXn29AkP9va4v7/Pnbv3ePjoMaendc70FsbgkobepWdYaN1L+oPvMkQhKnt4W1K+58luqapGQ1XRdR3TNOn3+7KPsgmjEUPrCsMYyABlbcqSH+caL8owDssWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/a81b5/ResourceOwnerPasswordFlow.webp 163w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/da3ef/ResourceOwnerPasswordFlow.webp 325w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/309d5/ResourceOwnerPasswordFlow.webp 650w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/78344/ResourceOwnerPasswordFlow.webp 975w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/bdb72/ResourceOwnerPasswordFlow.webp 1300w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/3a126/ResourceOwnerPasswordFlow.webp 2616w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/5e043/ResourceOwnerPasswordFlow.png 163w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/e5cc6/ResourceOwnerPasswordFlow.png 325w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/663f3/ResourceOwnerPasswordFlow.png 650w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/d880f/ResourceOwnerPasswordFlow.png 975w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/4c573/ResourceOwnerPasswordFlow.png 1300w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/818fe/ResourceOwnerPasswordFlow.png 2616w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/663f3/ResourceOwnerPasswordFlow.png\"\n            alt=\"ResourceOwnerPasswordFlow\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Resource Owner Password 인증을 살펴보면</p>\n<ol>\n<li>\n<p>인증하는데 필요한 요청 정보를 <strong>OAuth2AuthorizeRequest</strong>에 담아 ClientManager로 보낸다.</p>\n</li>\n<li>\n<p>OAuth2AuthorizedClient 객체가 있는지 확인</p>\n</li>\n<li>\n<p>OAuth2AuthorizedClient가 없을 경우 OAuth2AutorizationContext객체를 생성해 <strong>PasswordOAuth2AuthorizedClientProvider 전달하고 클라이언트 인가 처리</strong></p>\n</li>\n<li>\n<p>AccessToken과 RefreshToken 로직 분기 처리 후 필요 시 인가 서버로 <strong>DefaultPasswordTokenResponseClient</strong>클래스를 사용해 처리</p>\n</li>\n</ol>\n<h4 id=\"인가처리\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EA%B0%80%EC%B2%98%EB%A6%AC\" aria-label=\"인가처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인가처리</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a40c5f428b7f514365c30a795950de4a/ae5c4/restAuthorizationFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.828220858895705%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACCElEQVR42pWSTU8TURSG56+4YKlRqLFIxSiRunCDujaRmPhT1I3GvcEopaCUDwPqgGFoaBQxtDMtNVNaTLUdWmkCTIW2Q9uZx9ypkmr8fJMnOffcuSfnvHOknV2TXbPMwcHBIc1mE9M03bher/9w9zssq4Vk2za23aTRaLiIYtvb26R0HcPIu2fHcf4OLUm0SVwIfcrlCUdeE197f5j7k8Q3YhLRkPRqTiYwHCA4OsbwSJCZmVmy+SIzyjKryYzboRipUqm4sWVZlMtlyqbpxmJCUSibzVIqlZBu3hjE291N77k+enrPMnDlKrnNz0RWYiRTGzjiQbNBqbTF/v6+W6RQKLiPq9Uae3tfqNVqrue7OztIg9ev0ek5wSlfD8e7PFzwX2Qlvs7ziMqSmiYWjTIvy0xNP2NyapoXsoyu6ywtKkyEJngwNMTo2BjjoRDpTAZJll8SCAwTCAZ5+OgxoYlJkht5RmYjxNKb3L5ziy6Ph/P9fvr6/XT7znD33n0uD1ziaOcxTp724vX1cKSjgydPx9t/Ssv8arXKeiqFoiyhagk0NYaqaSTW1g7JGwbLb9+woCyghBdRwmHkuXkMw0ASRguEsULFYpHo6ipxTUWLRV2//kfSzwlhekLPEFlReaclMct7OI5Na19biDX53kg7Ii/9aqcyuS3U1EeSHwpUrPq3/L91+BVNTA14Co0BgQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a40c5f428b7f514365c30a795950de4a/a81b5/restAuthorizationFlow.webp 163w,\n/static/a40c5f428b7f514365c30a795950de4a/da3ef/restAuthorizationFlow.webp 325w,\n/static/a40c5f428b7f514365c30a795950de4a/309d5/restAuthorizationFlow.webp 650w,\n/static/a40c5f428b7f514365c30a795950de4a/78344/restAuthorizationFlow.webp 975w,\n/static/a40c5f428b7f514365c30a795950de4a/bdb72/restAuthorizationFlow.webp 1300w,\n/static/a40c5f428b7f514365c30a795950de4a/35f29/restAuthorizationFlow.webp 2622w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a40c5f428b7f514365c30a795950de4a/5e043/restAuthorizationFlow.png 163w,\n/static/a40c5f428b7f514365c30a795950de4a/e5cc6/restAuthorizationFlow.png 325w,\n/static/a40c5f428b7f514365c30a795950de4a/663f3/restAuthorizationFlow.png 650w,\n/static/a40c5f428b7f514365c30a795950de4a/d880f/restAuthorizationFlow.png 975w,\n/static/a40c5f428b7f514365c30a795950de4a/4c573/restAuthorizationFlow.png 1300w,\n/static/a40c5f428b7f514365c30a795950de4a/ae5c4/restAuthorizationFlow.png 2622w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a40c5f428b7f514365c30a795950de4a/663f3/restAuthorizationFlow.png\"\n            alt=\"restAuthorizationFlow\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>인증 처리가 끝나면 위와 같이 AccessToken을 사용해 사용자 정보를 가져올 수 있다.</p>\n<h4 id=\"구현\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%ED%98%84\" aria-label=\"구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>구현</h4>\n<ul>\n<li>인증 처리를 하기 위해선 username과 password를 처리하는 기능이 필요해 <strong>contextAttributesMapper</strong>를 구현해 OAuth2AutorizedClientManager에 등록시켜야 한다.</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"93064132718716080000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`// OAuth2ClientConfig\n    @Bean\n    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n        http.authorizeRequests(authRequest -> authRequest\n                .antMatchers(&quot;/&quot;,&quot;/oauth2Login&quot;,&quot;/client&quot;).permitAll()\n                .anyRequest().authenticated());\n        http\n//                .oauth2Login(Customizer.withDefaults())\n                .oauth2Client(Customizer.withDefaults());\n        return http.build();\n    }\n\n// AppConfig\n@Configuration\npublic class AppConfig {\n\n    @Bean\n    public DefaultOAuth2AuthorizedClientManager authorizedClientManager(ClientRegistrationRepository clientRegistrationRepository,\n                                                                        OAuth2AuthorizedClientRepository authorizedClientRepository) {\n\n        OAuth2AuthorizedClientProvider authorizedClientProvider =\n                OAuth2AuthorizedClientProviderBuilder.builder()\n                        .authorizationCode()\n                        .clientCredentials()\n                        .password(passwordGrantBuilder -> {\n                            passwordGrantBuilder.clockSkew(Duration.ofSeconds(3600));\n                        })\n                        .refreshToken(refreshTokenGrantBuilder -> refreshTokenGrantBuilder.clockSkew(Duration.ofSeconds(3600)))\n                        .build();\n\n        DefaultOAuth2AuthorizedClientManager authorizedClientManager =\n                new DefaultOAuth2AuthorizedClientManager(\n                        clientRegistrationRepository, authorizedClientRepository);\n        authorizedClientManager.setAuthorizedClientProvider(authorizedClientProvider);\n        authorizedClientManager.setContextAttributesMapper(contextAttributesMapper());\n\n        return authorizedClientManager;\n    }\n\n    private Function<OAuth2AuthorizeRequest, Map<String, Object>> contextAttributesMapper() {\n        return authorizeRequest -> {\n            Map<String, Object> contextAttributes = Collections.emptyMap();\n            HttpServletRequest servletRequest = authorizeRequest.getAttribute(HttpServletRequest.class.getName());\n\n            String username = servletRequest.getParameter(OAuth2ParameterNames.USERNAME);\n            String password = servletRequest.getParameter(OAuth2ParameterNames.PASSWORD);\n\n            if (StringUtils.hasText(username) && StringUtils.hasText(password)) {\n                contextAttributes = new HashMap<>();\n\n                // \\`PasswordOAuth2AuthorizedClientProvider\\` requires both attributes\n                contextAttributes.put(OAuth2AuthorizationContext.USERNAME_ATTRIBUTE_NAME, username);\n                contextAttributes.put(OAuth2AuthorizationContext.PASSWORD_ATTRIBUTE_NAME, password);\n            }\n            return contextAttributes;\n        };\n    }\n}`, `93064132718716080000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// OAuth2ClientConfig</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">SecurityFilterChain</span><span class=\"mtk1\"> </span><span class=\"mtk11\">securityFilterChain</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpSecurity</span><span class=\"mtk1\"> http) throws Exception {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorizeRequests</span><span class=\"mtk1\">(authRequest </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> authRequest</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">antMatchers</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;/oauth2Login&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;/client&quot;</span><span class=\"mtk1\">).</span><span class=\"mtk11\">permitAll</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">anyRequest</span><span class=\"mtk1\">().</span><span class=\"mtk11\">authenticated</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        http</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//                .oauth2Login(Customizer.withDefaults())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">oauth2Client</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Customizer</span><span class=\"mtk1\">.</span><span class=\"mtk11\">withDefaults</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// AppConfig</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Configuration</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">AppConfig</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">DefaultOAuth2AuthorizedClientManager</span><span class=\"mtk1\"> </span><span class=\"mtk11\">authorizedClientManager</span><span class=\"mtk1\">(</span><span class=\"mtk10\">ClientRegistrationRepository</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistrationRepository</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                                                        </span><span class=\"mtk10\">OAuth2AuthorizedClientRepository</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizedClientRepository</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2AuthorizedClientProvider</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizedClientProvider</span><span class=\"mtk1\"> =</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">OAuth2AuthorizedClientProviderBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">builder</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">authorizationCode</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">clientCredentials</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">password</span><span class=\"mtk1\">(passwordGrantBuilder </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                            </span><span class=\"mtk12\">passwordGrantBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">clockSkew</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Duration</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ofSeconds</span><span class=\"mtk1\">(</span><span class=\"mtk7\">3600</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">refreshToken</span><span class=\"mtk1\">(refreshTokenGrantBuilder </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">refreshTokenGrantBuilder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">clockSkew</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Duration</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ofSeconds</span><span class=\"mtk1\">(</span><span class=\"mtk7\">3600</span><span class=\"mtk1\">)))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">DefaultOAuth2AuthorizedClientManager</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizedClientManager</span><span class=\"mtk1\"> =</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DefaultOAuth2AuthorizedClientManager</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        clientRegistrationRepository, authorizedClientRepository);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">authorizedClientManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setAuthorizedClientProvider</span><span class=\"mtk1\">(authorizedClientProvider);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">authorizedClientManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setContextAttributesMapper</span><span class=\"mtk1\">(</span><span class=\"mtk11\">contextAttributesMapper</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> authorizedClientManager;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Function</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">OAuth2AuthorizeRequest</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Object</span><span class=\"mtk1\">&gt;&gt; </span><span class=\"mtk11\">contextAttributesMapper</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> authorizeRequest </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Object</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">contextAttributes</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Collections</span><span class=\"mtk1\">.</span><span class=\"mtk11\">emptyMap</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">HttpServletRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletRequest</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">authorizeRequest</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getAttribute</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">username</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">servletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getParameter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">OAuth2ParameterNames</span><span class=\"mtk1\">.</span><span class=\"mtk12\">USERNAME</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">password</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">servletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getParameter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">OAuth2ParameterNames</span><span class=\"mtk1\">.</span><span class=\"mtk12\">PASSWORD</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">StringUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">hasText</span><span class=\"mtk1\">(username) &amp;&amp; </span><span class=\"mtk12\">StringUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">hasText</span><span class=\"mtk1\">(password)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                contextAttributes = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">HashMap</span><span class=\"mtk1\">&lt;&gt;();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\">// `PasswordOAuth2AuthorizedClientProvider` requires both attributes</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">contextAttributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk12\">OAuth2AuthorizationContext</span><span class=\"mtk1\">.</span><span class=\"mtk12\">USERNAME_ATTRIBUTE_NAME</span><span class=\"mtk1\">, username);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">contextAttributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk12\">OAuth2AuthorizationContext</span><span class=\"mtk1\">.</span><span class=\"mtk12\">PASSWORD_ATTRIBUTE_NAME</span><span class=\"mtk1\">, password);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> contextAttributes;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        };</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>코드를 간략히 설명하면</p>\n<ol>\n<li>\n<p><strong>DefaultOAuth2AutorizedClientManager</strong> 객체 생성</p>\n</li>\n<li>\n<p>setAuthorizedClientProvider 함수로 Provider 등록</p>\n</li>\n<li>\n<p>parameter 처리 부분이 있는 contextAttributesMapper 함수를 등록한다.</p>\n</li>\n</ol>\n<p>DefaultOAuth2AuthorizedClientManager 객체를 통해 동작 확인 가능</p>\n<p>Config 설정은 끝이고</p>\n<p>실제 로그인 기능을 구현하기 위해서 Controller 구현해야 한다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"22031293606564905000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@Controller\npublic class LoginController {\n\n    @Autowired\n    DefaultOAuth2AuthorizedClientManager authorizedClientManager;\n\n    @Autowired\n    OAuth2AuthorizedClientRepository authorizedClientRepository;\n\n    private Duration clockSkew = Duration.ofSeconds(3600);\n\n    private Clock clock = Clock.systemUTC();\n\n    @GetMapping(&quot;/oauth2Login&quot;)\n    public String oauth2Login(Model model, HttpServletResponse servletResponse, HttpServletRequest servletRequest) throws IOException {\n\n        Authentication principal = SecurityContextHolder.getContext().getAuthentication();\n\n        if (principal == null) {\n            principal = new AnonymousAuthenticationToken(&quot;anonymous&quot;,&quot;anonymousUser&quot;, AuthorityUtils.createAuthorityList(&quot;ROLE_ANONYMOUS&quot;));\n        }\n\n        OAuth2AuthorizeRequest authorizeRequest = OAuth2AuthorizeRequest\n                .withClientRegistrationId(&quot;keycloak&quot;)\n                .principal(principal)\n                .attribute(HttpServletRequest.class.getName(), servletRequest)\n                .attribute(HttpServletResponse.class.getName(), servletResponse)\n                .build();\n\n        OAuth2AuthorizationSuccessHandler authorizationSuccessHandler = (authorizedClient, authentication, attributes) ->\n                authorizedClientRepository\n                        .saveAuthorizedClient(authorizedClient, authentication,\n                                (HttpServletRequest) attributes.get(HttpServletRequest.class.getName()),\n                                (HttpServletResponse) attributes.get(HttpServletResponse.class.getName()));\n        authorizedClientManager.setAuthorizationSuccessHandler(authorizationSuccessHandler);\n\n        OAuth2AuthorizedClient oAuth2AuthorizedClient = authorizedClientManager.authorize(authorizeRequest);\n\n        if (oAuth2AuthorizedClient != null && hasTokenExpired(oAuth2AuthorizedClient.getAccessToken())\n                && oAuth2AuthorizedClient.getRefreshToken() != null) {\n            ClientRegistration.withClientRegistration(oAuth2AuthorizedClient.getClientRegistration()).authorizationGrantType(AuthorizationGrantType.REFRESH_TOKEN);\n            oAuth2AuthorizedClient = authorizedClientManager.authorize(authorizeRequest);\n        }\n\n        if(oAuth2AuthorizedClient != null) {\n\n            ClientRegistration clientRegistration = oAuth2AuthorizedClient.getClientRegistration();\n            OAuth2AccessToken accessToken = oAuth2AuthorizedClient.getAccessToken();\n            OAuth2RefreshToken refreshToken = oAuth2AuthorizedClient.getRefreshToken();\n\n            OAuth2UserService oAuth2UserService = new DefaultOAuth2UserService();\n\n            // 사용자 정보 가져오는 함수\n            OAuth2User oauth2User = oAuth2UserService.loadUser(new OAuth2UserRequest(\n                    oAuth2AuthorizedClient.getClientRegistration(), accessToken));\n\n            // 권한 매핑\n            SimpleAuthorityMapper simpleAuthorityMapper = new SimpleAuthorityMapper();\n            simpleAuthorityMapper.setPrefix(&quot;&quot;); // SYSTEM_ 이런식으로 prefix 줄 수 있음\n            Collection<? extends GrantedAuthority> authorities = simpleAuthorityMapper.mapAuthorities(oauth2User.getAuthorities());\n            OAuth2AuthenticationToken oAuth2AuthenticationToken = new OAuth2AuthenticationToken(oauth2User, authorities, clientRegistration.getRegistrationId());\n\n            SecurityContext context = SecurityContextHolder.createEmptyContext();\n            context.setAuthentication(oAuth2AuthenticationToken);\n            SecurityContextHolder.setContext(context);\n\n            authorizationSuccessHandler.onAuthorizationSuccess(oAuth2AuthorizedClient, oAuth2AuthenticationToken, createAttributes(servletRequest, servletResponse));\n            model.addAttribute(&quot;oAuth2AuthenticationToken&quot;,oAuth2AuthenticationToken);\n        }\n\n        return &quot;home&quot;;\n    }\n\n    private static Map<String, Object> createAttributes(HttpServletRequest servletRequest, HttpServletResponse servletResponse) {\n        Map<String, Object> attributes = new HashMap<>();\n        attributes.put(HttpServletRequest.class.getName(), servletRequest);\n        attributes.put(HttpServletResponse.class.getName(), servletResponse);\n        return attributes;\n    }\n\n    @GetMapping(&quot;/logout&quot;)\n    public String logout(HttpServletRequest servletRequest, HttpServletResponse servletResponse, Authentication authentication){\n        SecurityContextLogoutHandler logoutHandler = new SecurityContextLogoutHandler();\n        logoutHandler.logout(servletRequest, servletResponse, authentication);\n        return &quot;index&quot;;\n    }\n\n    private boolean hasTokenExpired(OAuth2Token token) {\n        return this.clock.instant().isAfter(token.getExpiresAt().minus(this.clockSkew));\n    }\n}`, `22031293606564905000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Controller</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">LoginController</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Autowired</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">DefaultOAuth2AuthorizedClientManager</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizedClientManager</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Autowired</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">OAuth2AuthorizedClientRepository</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizedClientRepository</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Duration</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clockSkew</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Duration</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ofSeconds</span><span class=\"mtk1\">(</span><span class=\"mtk7\">3600</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Clock</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clock</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Clock</span><span class=\"mtk1\">.</span><span class=\"mtk11\">systemUTC</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">GetMapping</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/oauth2Login&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk11\">oauth2Login</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Model</span><span class=\"mtk1\"> </span><span class=\"mtk12\">model</span><span class=\"mtk1\">, </span><span class=\"mtk10\">HttpServletResponse</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletResponse</span><span class=\"mtk1\">, </span><span class=\"mtk10\">HttpServletRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletRequest</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">IOException</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Authentication</span><span class=\"mtk1\"> </span><span class=\"mtk12\">principal</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">SecurityContextHolder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getContext</span><span class=\"mtk1\">().</span><span class=\"mtk11\">getAuthentication</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (principal == </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            principal = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">AnonymousAuthenticationToken</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;anonymous&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;anonymousUser&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">AuthorityUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">createAuthorityList</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;ROLE_ANONYMOUS&quot;</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2AuthorizeRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizeRequest</span><span class=\"mtk1\"> = </span><span class=\"mtk10\">OAuth2AuthorizeRequest</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">withClientRegistrationId</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;keycloak&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">principal</span><span class=\"mtk1\">(principal)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">attribute</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">(), servletRequest)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">attribute</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletResponse</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">(), servletResponse)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2AuthorizationSuccessHandler</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizationSuccessHandler</span><span class=\"mtk1\"> = (authorizedClient, authentication, attributes) </span><span class=\"mtk4\">-&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                authorizedClientRepository</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">saveAuthorizedClient</span><span class=\"mtk1\">(authorizedClient, authentication,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                (HttpServletRequest) </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">get</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">()),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                (HttpServletResponse) </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">get</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletResponse</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">()));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">authorizedClientManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setAuthorizationSuccessHandler</span><span class=\"mtk1\">(authorizationSuccessHandler);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2AuthorizedClient</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">authorizedClientManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorize</span><span class=\"mtk1\">(authorizeRequest);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (oAuth2AuthorizedClient != </span><span class=\"mtk4\">null</span><span class=\"mtk1\"> &amp;&amp; </span><span class=\"mtk11\">hasTokenExpired</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getAccessToken</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                &amp;&amp; </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getRefreshToken</span><span class=\"mtk1\">() != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">ClientRegistration</span><span class=\"mtk1\">.</span><span class=\"mtk11\">withClientRegistration</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getClientRegistration</span><span class=\"mtk1\">()).</span><span class=\"mtk11\">authorizationGrantType</span><span class=\"mtk1\">(</span><span class=\"mtk12\">AuthorizationGrantType</span><span class=\"mtk1\">.</span><span class=\"mtk12\">REFRESH_TOKEN</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            oAuth2AuthorizedClient = </span><span class=\"mtk12\">authorizedClientManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorize</span><span class=\"mtk1\">(authorizeRequest);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\">(oAuth2AuthorizedClient != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">ClientRegistration</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistration</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getClientRegistration</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2AccessToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">accessToken</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getAccessToken</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2RefreshToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">refreshToken</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getRefreshToken</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2UserService</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2UserService</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DefaultOAuth2UserService</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// 사용자 정보 가져오는 함수</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2User</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oauth2User</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2UserService</span><span class=\"mtk1\">.</span><span class=\"mtk11\">loadUser</span><span class=\"mtk1\">(</span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">OAuth2UserRequest</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getClientRegistration</span><span class=\"mtk1\">(), accessToken));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// 권한 매핑</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">SimpleAuthorityMapper</span><span class=\"mtk1\"> </span><span class=\"mtk12\">simpleAuthorityMapper</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">SimpleAuthorityMapper</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">simpleAuthorityMapper</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setPrefix</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">); </span><span class=\"mtk3\">// SYSTEM_ 이런식으로 prefix 줄 수 있음</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">Collection</span><span class=\"mtk1\">&lt;</span><span class=\"mtk4\">?</span><span class=\"mtk1\"> </span><span class=\"mtk4\">extends</span><span class=\"mtk1\"> </span><span class=\"mtk10\">GrantedAuthority</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">authorities</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">simpleAuthorityMapper</span><span class=\"mtk1\">.</span><span class=\"mtk11\">mapAuthorities</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oauth2User</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getAuthorities</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2AuthenticationToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthenticationToken</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">OAuth2AuthenticationToken</span><span class=\"mtk1\">(oauth2User, authorities, </span><span class=\"mtk12\">clientRegistration</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getRegistrationId</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">SecurityContext</span><span class=\"mtk1\"> </span><span class=\"mtk12\">context</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">SecurityContextHolder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">createEmptyContext</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">context</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setAuthentication</span><span class=\"mtk1\">(oAuth2AuthenticationToken);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">SecurityContextHolder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setContext</span><span class=\"mtk1\">(context);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">authorizationSuccessHandler</span><span class=\"mtk1\">.</span><span class=\"mtk11\">onAuthorizationSuccess</span><span class=\"mtk1\">(oAuth2AuthorizedClient, oAuth2AuthenticationToken, </span><span class=\"mtk11\">createAttributes</span><span class=\"mtk1\">(servletRequest, servletResponse));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">model</span><span class=\"mtk1\">.</span><span class=\"mtk11\">addAttribute</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;oAuth2AuthenticationToken&quot;</span><span class=\"mtk1\">,oAuth2AuthenticationToken);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;home&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Object</span><span class=\"mtk1\">&gt; </span><span class=\"mtk11\">createAttributes</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpServletRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletRequest</span><span class=\"mtk1\">, </span><span class=\"mtk10\">HttpServletResponse</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletResponse</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Object</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">HashMap</span><span class=\"mtk1\">&lt;&gt;();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">(), servletRequest);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletResponse</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">(), servletResponse);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> attributes;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">GetMapping</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/logout&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk11\">logout</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpServletRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletRequest</span><span class=\"mtk1\">, </span><span class=\"mtk10\">HttpServletResponse</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletResponse</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Authentication</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authentication</span><span class=\"mtk1\">){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">SecurityContextLogoutHandler</span><span class=\"mtk1\"> </span><span class=\"mtk12\">logoutHandler</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">SecurityContextLogoutHandler</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">logoutHandler</span><span class=\"mtk1\">.</span><span class=\"mtk11\">logout</span><span class=\"mtk1\">(servletRequest, servletResponse, authentication);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;index&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">boolean</span><span class=\"mtk1\"> </span><span class=\"mtk11\">hasTokenExpired</span><span class=\"mtk1\">(</span><span class=\"mtk10\">OAuth2Token</span><span class=\"mtk1\"> </span><span class=\"mtk12\">token</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">clock</span><span class=\"mtk1\">.</span><span class=\"mtk11\">instant</span><span class=\"mtk1\">().</span><span class=\"mtk11\">isAfter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getExpiresAt</span><span class=\"mtk1\">().</span><span class=\"mtk11\">minus</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">clockSkew</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h3 id=\"client-credentials-refresh-token\" style=\"position:relative;\"><a href=\"#client-credentials-refresh-token\" aria-label=\"client credentials refresh token permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Client Credentials, Refresh Token</h3>\n<p>Credentials는 Resource Owner Password Flow 로직과 대부분 유사한데</p>\n<p>권한 부여에 따른 처리 하는 클래스들이 차이가 난다.</p>\n<p>해당 부분의 Config를 수정하면서 구현</p>\n<p>Refresh Token은 위에 적용이 되어있는데 App Config와 controller에 처리하는 부분을 추가하면 된다.</p>\n<h3 id=\"custom-login-filter\" style=\"position:relative;\"><a href=\"#custom-login-filter\" aria-label=\"custom login filter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Custom Login Filter</h3>\n<p>이전까지 과정은 Client Manager를 이용해 Spring MVC에서 Login Controller에서 인가처리를 했는데</p>\n<p>Spring Security에서 지원하는 Filter 기반으로 적용이 가능</p>\n<p>인가 처리 로직은 이전과 동일하고 Config 설정에서 Filter 등록을 한다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"5365453469273751000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@Configuration(proxyBeanMethods = false)\npublic class OAuth2ClientConfig {\n\n    @Autowired\n    private DefaultOAuth2AuthorizedClientManager authorizedClientManager;\n\n    @Autowired\n    private OAuth2AuthorizedClientRepository authorizedClientRepository;\n\n    @Bean\n    SecurityFilterChain oauth2SecurityFilterChain(HttpSecurity http) throws Exception {\n                http.authorizeRequests((requests) -> requests.antMatchers(&quot;/&quot;,&quot;/oauth2Login&quot;,&quot;/logout&quot;).permitAll().anyRequest().authenticated());\n        http\n//                .oauth2Login().and()\n                .oauth2Client()\n                .and()\n                .addFilterBefore(customOAuth2LoginAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class)\n        ;\n        return http.build();\n    }\n\n    public CustomOAuth2LoginAuthenticationFilter customOAuth2LoginAuthenticationFilter() throws Exception {\n        CustomOAuth2LoginAuthenticationFilter customOAuth2LoginAuthenticationFilter =\n                new CustomOAuth2LoginAuthenticationFilter(authorizedClientManager,authorizedClientRepository);\n        customOAuth2LoginAuthenticationFilter.setAuthenticationSuccessHandler((request, response, authentication) -> {\n            response.sendRedirect(&quot;/home&quot;);\n        });\n        return customOAuth2LoginAuthenticationFilter;\n    }`, `5365453469273751000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Configuration</span><span class=\"mtk1\">(proxyBeanMethods = </span><span class=\"mtk4\">false</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2ClientConfig</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Autowired</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">DefaultOAuth2AuthorizedClientManager</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizedClientManager</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Autowired</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizedClientRepository</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizedClientRepository</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">SecurityFilterChain</span><span class=\"mtk1\"> </span><span class=\"mtk11\">oauth2SecurityFilterChain</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpSecurity</span><span class=\"mtk1\"> </span><span class=\"mtk12\">http</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Exception</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorizeRequests</span><span class=\"mtk1\">((requests) </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">requests</span><span class=\"mtk1\">.</span><span class=\"mtk11\">antMatchers</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;/oauth2Login&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;/logout&quot;</span><span class=\"mtk1\">).</span><span class=\"mtk11\">permitAll</span><span class=\"mtk1\">().</span><span class=\"mtk11\">anyRequest</span><span class=\"mtk1\">().</span><span class=\"mtk11\">authenticated</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        http</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//                .oauth2Login().and()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">oauth2Client</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">and</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">addFilterBefore</span><span class=\"mtk1\">(</span><span class=\"mtk11\">customOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\">(), </span><span class=\"mtk12\">UsernamePasswordAuthenticationFilter</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        ;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">http</span><span class=\"mtk1\">.</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">CustomOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\"> </span><span class=\"mtk11\">customOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\">() </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Exception</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">CustomOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\"> </span><span class=\"mtk12\">customOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\"> =</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">CustomOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\">(authorizedClientManager,authorizedClientRepository);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">customOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setAuthenticationSuccessHandler</span><span class=\"mtk1\">((request, response, authentication) </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">response</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sendRedirect</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/home&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> customOAuth2LoginAuthenticationFilter;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>customOAuth2LoginAuthenticationFilter 설정을 살펴보면</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"16634477642884925000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`public class CustomOAuth2LoginAuthenticationFilter extends AbstractAuthenticationProcessingFilter {\n\n    public static final String DEFAULT_FILTER_PROCESSES_URI = &quot;/oauth2Login/**&quot;;\n    private OAuth2AuthorizedClientRepository authorizedClientRepository;\n    private DefaultOAuth2AuthorizedClientManager oAuth2AuthorizedClientManager;\n    private OAuth2AuthorizationSuccessHandler authorizationSuccessHandler;\n\n    private OAuth2AuthorizationFailureHandler authorizationFailureHandler;\n\n    private Duration clockSkew = Duration.ofSeconds(3600);\n\n    private Clock clock = Clock.systemUTC();\n\n    public CustomOAuth2LoginAuthenticationFilter(DefaultOAuth2AuthorizedClientManager oAuth2AuthorizedClientManager, OAuth2AuthorizedClientRepository oAuth2AuthorizedClientRepository) {\n        super(DEFAULT_FILTER_PROCESSES_URI);\n        this.oAuth2AuthorizedClientManager = oAuth2AuthorizedClientManager;\n        this.authorizedClientRepository = oAuth2AuthorizedClientRepository;\n\n        this.authorizationSuccessHandler = (authorizedClient, authentication, attributes) ->\n                authorizedClientRepository\n                        .saveAuthorizedClient(authorizedClient, authentication,\n                                (HttpServletRequest) attributes.get(HttpServletRequest.class.getName()),\n                                (HttpServletResponse) attributes.get(HttpServletResponse.class.getName()));\n        this.oAuth2AuthorizedClientManager.setAuthorizationSuccessHandler(authorizationSuccessHandler);\n    }\n\n    @Override\n    public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response) throws AuthenticationException, IOException, ServletException {\n\n        Authentication principal = SecurityContextHolder.getContext().getAuthentication();\n\n        if (principal == null) {\n            principal = new AnonymousAuthenticationToken(&quot;anonymous&quot;, &quot;anonymousUser&quot;, AuthorityUtils.createAuthorityList(&quot;ROLE_ANONYMOUS&quot;));\n        }\n\n        OAuth2AuthorizeRequest authorizeRequest = OAuth2AuthorizeRequest\n                .withClientRegistrationId(&quot;keycloak&quot;)\n                .principal(principal)\n                .attribute(HttpServletRequest.class.getName(), request)\n                .attribute(HttpServletResponse.class.getName(), response)\n                .build();\n\n        OAuth2AuthorizedClient oAuth2AuthorizedClient = oAuth2AuthorizedClientManager.authorize(authorizeRequest);\n\n        if (oAuth2AuthorizedClient != null && hasTokenExpired(oAuth2AuthorizedClient.getAccessToken())\n                && oAuth2AuthorizedClient.getRefreshToken() != null) {\n            ClientRegistration.withClientRegistration(oAuth2AuthorizedClient.getClientRegistration()).authorizationGrantType(AuthorizationGrantType.REFRESH_TOKEN);\n            oAuth2AuthorizedClient = oAuth2AuthorizedClientManager.authorize(authorizeRequest);\n        }\n\n        if (oAuth2AuthorizedClient != null) {\n            ClientRegistration clientRegistration = oAuth2AuthorizedClient.getClientRegistration();\n            OAuth2AccessToken accessToken = oAuth2AuthorizedClient.getAccessToken();\n            OAuth2RefreshToken refreshToken = oAuth2AuthorizedClient.getRefreshToken();\n\n            OAuth2UserService oAuth2UserService = new DefaultOAuth2UserService();\n            OAuth2User oauth2User = oAuth2UserService.loadUser(new OAuth2UserRequest(\n                    oAuth2AuthorizedClient.getClientRegistration(), accessToken));\n\n            SimpleAuthorityMapper simpleAuthorityMapper = new SimpleAuthorityMapper();\n            Collection<? extends GrantedAuthority> authorities = simpleAuthorityMapper.mapAuthorities(oauth2User.getAuthorities());\n            OAuth2AuthenticationToken oAuth2AuthenticationToken = new OAuth2AuthenticationToken(oauth2User, authorities, clientRegistration.getRegistrationId());\n\n            // 인증 받은 사용자를 저장해줘야 한다.\n            authorizationSuccessHandler.onAuthorizationSuccess(oAuth2AuthorizedClient, oAuth2AuthenticationToken, createAttributes(request, response));\n\n            return oAuth2AuthenticationToken;\n        }\n\n        return null;\n\n    }\n\n    private static Map<String, Object> createAttributes(HttpServletRequest servletRequest, HttpServletResponse servletResponse) {\n        Map<String, Object> attributes = new HashMap<>();\n        attributes.put(HttpServletRequest.class.getName(), servletRequest);\n        attributes.put(HttpServletResponse.class.getName(), servletResponse);\n        return attributes;\n    }\n\n    private boolean hasTokenExpired(OAuth2Token token) {\n        return this.clock.instant().isAfter(token.getExpiresAt().minus(this.clockSkew));\n    }\n}`, `16634477642884925000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">CustomOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\"> </span><span class=\"mtk4\">extends</span><span class=\"mtk1\"> </span><span class=\"mtk10\">AbstractAuthenticationProcessingFilter</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">DEFAULT_FILTER_PROCESSES_URI</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;/oauth2Login/**&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizedClientRepository</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizedClientRepository</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">DefaultOAuth2AuthorizedClientManager</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthorizedClientManager</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizationSuccessHandler</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizationSuccessHandler</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">OAuth2AuthorizationFailureHandler</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizationFailureHandler</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Duration</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clockSkew</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Duration</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ofSeconds</span><span class=\"mtk1\">(</span><span class=\"mtk7\">3600</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Clock</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clock</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Clock</span><span class=\"mtk1\">.</span><span class=\"mtk11\">systemUTC</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">CustomOAuth2LoginAuthenticationFilter</span><span class=\"mtk1\">(</span><span class=\"mtk10\">DefaultOAuth2AuthorizedClientManager</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthorizedClientManager</span><span class=\"mtk1\">, </span><span class=\"mtk10\">OAuth2AuthorizedClientRepository</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthorizedClientRepository</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">super</span><span class=\"mtk1\">(DEFAULT_FILTER_PROCESSES_URI);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">oAuth2AuthorizedClientManager</span><span class=\"mtk1\"> = oAuth2AuthorizedClientManager;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">authorizedClientRepository</span><span class=\"mtk1\"> = oAuth2AuthorizedClientRepository;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">authorizationSuccessHandler</span><span class=\"mtk1\"> = (authorizedClient, authentication, attributes) </span><span class=\"mtk4\">-&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                authorizedClientRepository</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        .</span><span class=\"mtk11\">saveAuthorizedClient</span><span class=\"mtk1\">(authorizedClient, authentication,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                (HttpServletRequest) </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">get</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">()),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                (HttpServletResponse) </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">get</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletResponse</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">()));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">oAuth2AuthorizedClientManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setAuthorizationSuccessHandler</span><span class=\"mtk1\">(authorizationSuccessHandler);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Authentication</span><span class=\"mtk1\"> </span><span class=\"mtk11\">attemptAuthentication</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpServletRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">request</span><span class=\"mtk1\">, </span><span class=\"mtk10\">HttpServletResponse</span><span class=\"mtk1\"> </span><span class=\"mtk12\">response</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">AuthenticationException</span><span class=\"mtk1\">, </span><span class=\"mtk10\">IOException</span><span class=\"mtk1\">, </span><span class=\"mtk10\">ServletException</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Authentication</span><span class=\"mtk1\"> </span><span class=\"mtk12\">principal</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">SecurityContextHolder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getContext</span><span class=\"mtk1\">().</span><span class=\"mtk11\">getAuthentication</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (principal == </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            principal = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">AnonymousAuthenticationToken</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;anonymous&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;anonymousUser&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">AuthorityUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">createAuthorityList</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;ROLE_ANONYMOUS&quot;</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2AuthorizeRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">authorizeRequest</span><span class=\"mtk1\"> = </span><span class=\"mtk10\">OAuth2AuthorizeRequest</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">withClientRegistrationId</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;keycloak&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">principal</span><span class=\"mtk1\">(principal)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">attribute</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">(), request)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">attribute</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletResponse</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">(), response)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">build</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">OAuth2AuthorizedClient</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2AuthorizedClientManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorize</span><span class=\"mtk1\">(authorizeRequest);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (oAuth2AuthorizedClient != </span><span class=\"mtk4\">null</span><span class=\"mtk1\"> &amp;&amp; </span><span class=\"mtk11\">hasTokenExpired</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getAccessToken</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                &amp;&amp; </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getRefreshToken</span><span class=\"mtk1\">() != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">ClientRegistration</span><span class=\"mtk1\">.</span><span class=\"mtk11\">withClientRegistration</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getClientRegistration</span><span class=\"mtk1\">()).</span><span class=\"mtk11\">authorizationGrantType</span><span class=\"mtk1\">(</span><span class=\"mtk12\">AuthorizationGrantType</span><span class=\"mtk1\">.</span><span class=\"mtk12\">REFRESH_TOKEN</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            oAuth2AuthorizedClient = </span><span class=\"mtk12\">oAuth2AuthorizedClientManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">authorize</span><span class=\"mtk1\">(authorizeRequest);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (oAuth2AuthorizedClient != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">ClientRegistration</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientRegistration</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getClientRegistration</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2AccessToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">accessToken</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getAccessToken</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2RefreshToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">refreshToken</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getRefreshToken</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2UserService</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2UserService</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DefaultOAuth2UserService</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2User</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oauth2User</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oAuth2UserService</span><span class=\"mtk1\">.</span><span class=\"mtk11\">loadUser</span><span class=\"mtk1\">(</span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">OAuth2UserRequest</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">oAuth2AuthorizedClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getClientRegistration</span><span class=\"mtk1\">(), accessToken));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">SimpleAuthorityMapper</span><span class=\"mtk1\"> </span><span class=\"mtk12\">simpleAuthorityMapper</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">SimpleAuthorityMapper</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">Collection</span><span class=\"mtk1\">&lt;</span><span class=\"mtk4\">?</span><span class=\"mtk1\"> </span><span class=\"mtk4\">extends</span><span class=\"mtk1\"> </span><span class=\"mtk10\">GrantedAuthority</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">authorities</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">simpleAuthorityMapper</span><span class=\"mtk1\">.</span><span class=\"mtk11\">mapAuthorities</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oauth2User</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getAuthorities</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">OAuth2AuthenticationToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oAuth2AuthenticationToken</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">OAuth2AuthenticationToken</span><span class=\"mtk1\">(oauth2User, authorities, </span><span class=\"mtk12\">clientRegistration</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getRegistrationId</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// 인증 받은 사용자를 저장해줘야 한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">authorizationSuccessHandler</span><span class=\"mtk1\">.</span><span class=\"mtk11\">onAuthorizationSuccess</span><span class=\"mtk1\">(oAuth2AuthorizedClient, oAuth2AuthenticationToken, </span><span class=\"mtk11\">createAttributes</span><span class=\"mtk1\">(request, response));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> oAuth2AuthenticationToken;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">null</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Object</span><span class=\"mtk1\">&gt; </span><span class=\"mtk11\">createAttributes</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpServletRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletRequest</span><span class=\"mtk1\">, </span><span class=\"mtk10\">HttpServletResponse</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletResponse</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Object</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">HashMap</span><span class=\"mtk1\">&lt;&gt;();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletRequest</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">(), servletRequest);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">attributes</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpServletResponse</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getName</span><span class=\"mtk1\">(), servletResponse);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> attributes;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">boolean</span><span class=\"mtk1\"> </span><span class=\"mtk11\">hasTokenExpired</span><span class=\"mtk1\">(</span><span class=\"mtk10\">OAuth2Token</span><span class=\"mtk1\"> </span><span class=\"mtk12\">token</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">clock</span><span class=\"mtk1\">.</span><span class=\"mtk11\">instant</span><span class=\"mtk1\">().</span><span class=\"mtk11\">isAfter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getExpiresAt</span><span class=\"mtk1\">().</span><span class=\"mtk11\">minus</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">clockSkew</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>코드 설명을 간략히 하면</p>\n<ol>\n<li>CustomOAuth2LoginAuthenticationFilter 생성자 내부에서 default url설정을 해 어떤 경로로 들어오면 filter처리를 할 지 등록시켜 준다.<br>\n(AbstractAuthenticationProcessingFilter 생성자에서 url 등록)</li>\n<li>config설정을 보면 UsernamePasswordAuthenticationFilter 앞에 Filter가 동작하도록 설정해서 MVC Controller에서 처리하는 부분과 다르게 SecurityContextHolder안에 Token이 존재하지 않아 principal이 null일 경우 AnonymousAuthenticationToken을 만들어주는 로직이 필요</li>\n<li>나머지는 위에 MVC 처리 부분과 동일하다</li>\n</ol>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h1>\n<ul>\n<li><a href=\"https://www.inflearn.com/course/%EC%A0%95%EC%88%98%EC%9B%90-%EC%8A%A4%ED%94%84%EB%A7%81-%EC%8B%9C%ED%81%90%EB%A6%AC%ED%8B%B0/dashboard\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">스프링 시큐리티 OAuth2 - Spring Boot 기반으로 개발하는 Spring Security OAuth2</a></li>\n</ul>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .mtk1 { color: #D4D4D4; }\n  .default-dark .mtk10 { color: #4EC9B0; }\n  .default-dark .mtk11 { color: #DCDCAA; }\n  .default-dark .mtk12 { color: #9CDCFE; }\n  .default-dark .mtk4 { color: #569CD6; }\n  .default-dark .mtk15 { color: #C586C0; }\n  .default-dark .mtk8 { color: #CE9178; }\n  .default-dark .mtk3 { color: #6A9955; }\n  .default-dark .mtk7 { color: #B5CEA8; }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#oauth-20-client\">OAuth 2.0 Client</a></p>\n<ul>\n<li>\n<p><a href=\"#oauth-20-login-api\">OAuth 2.0 Login API</a></p>\n</li>\n<li>\n<p><a href=\"#oauth-20-client-api\">OAuth 2.0 Client API</a></p>\n</li>\n<li>\n<p><a href=\"#oauth-20-client-fundamentals\">OAuth 2.0 Client Fundamentals</a></p>\n<ul>\n<li><a href=\"#client-%EA%B6%8C%ED%95%9C-%EC%84%A4%EC%A0%95-%EA%B3%BC%EC%A0%95\">Client 권한 설정 과정</a></li>\n<li><a href=\"#client-registration-%EC%B4%88%EA%B8%B0%ED%99%94-%EA%B3%BC%EC%A0%95\">Client Registration 초기화 과정</a></li>\n<li><a href=\"#client-repository\">Client Repository</a></li>\n<li><a href=\"#%EC%9E%90%EB%8F%99-%EC%84%A4%EC%A0%95%EC%97%90-%EC%9D%98%ED%95%9C-%EC%B4%88%EA%B8%B0%ED%99%94-%EA%B3%BC%EC%A0%95\">자동 설정에 의한 초기화 과정</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#oauth-20-client---oauth2login\">OAuth 2.0 Client - oauth2Login()</a></p>\n<ul>\n<li><a href=\"#authorization-code---%EC%A3%BC%EC%9A%94-%ED%81%B4%EB%9E%98%EC%8A%A4\">Authorization Code - 주요 클래스</a></li>\n<li><a href=\"#authorization-code-grant-type---get-code\">Authorization Code Grant Type - get code</a></li>\n<li><a href=\"#authorization-accesstoken-%EC%A3%BC%EC%9A%94-%ED%81%B4%EB%9E%98%EC%8A%A4\">Authorization AccessToken 주요 클래스</a></li>\n<li><a href=\"#authorization-code-grant-type---get-accesstoken\">Authorization Code Grant Type - get AccessToken</a></li>\n<li><a href=\"#oauth2userservice\">OAuth2UserService</a></li>\n<li><a href=\"#openid-logout\">OpenID Logout</a></li>\n<li><a href=\"#mvc%EC%97%90%EC%84%9C-%EC%9D%B8%EC%A6%9D-%EA%B0%9D%EC%B2%B4-%EC%B0%B8%EC%A1%B0-%EB%B0%A9%EB%B2%95\">MVC에서 인증 객체 참조 방법</a></li>\n<li><a href=\"#oauth2-custom\">OAuth2 Custom</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#oauth-20-client---oauth2client\">OAuth 2.0 Client - oauth2Client()</a></p>\n<ul>\n<li><a href=\"#oauth20-client-%EC%A3%BC%EC%9A%94-%ED%81%B4%EB%9E%98%EC%8A%A4\">OAuth2.0 Client 주요 클래스</a></li>\n<li><a href=\"#oauth2-client---resource-owner-password-flow\">OAuth2 client - Resource Owner Password Flow</a></li>\n<li><a href=\"#client-credentials-refresh-token\">Client Credentials, Refresh Token</a></li>\n<li><a href=\"#custom-login-filter\">Custom Login Filter</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#reference\">Reference</a></p>\n</li>\n</ul>","frontmatter":{"title":"Spring Security OAuth2.0 Client","summary":["Spring Security 라이브러리 뜯어보며 알아보자"],"date":"2023.02.08.","category":["Spring"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADlElEQVR42nVUTYgcRRTuza6JICoSQnR35r3qmVExEpCI6EFJ0JNHhQWDSMxFEREJY9frn9npRGO8KCKIoOLFg5DxoiIzu13V0z3jTMy6bn5MICiIt2AkQS+CujNbUt3TbWczFjy6qH7vq/e+974yjC1LKWNmsWXMFs8WW3u2+xf3bC+e+b6xzVfGtjTImDGmrcTJT51IVPaSgOM8AMEFXOIB/sgF9EjAu1an/NgkJLlcTQPMgOzV+Z1c4McU4oa/aqrGkCm3z5TbY6oxYEqfOREqK4C216uWXVlasAQ8W8T4D2y5VLO7ePHod6aiEMdc4AZJHHGJY23JXuCG3jdPmcru4mUrgBMUQsMa3HurUazfFvM73RjPNb81FRf4D0ncJIlq8t0kkRpPQGHkfcOUE+Nf1MEDFMLjboQPpNlNiLW78EGSWQqmeJrZSO/tEHU2SalLQ3MzvRTO2ivwoI614oW7nRifzvnjYfl+J2J/6kCusxA4bgxNpQM10CSrv7nEqyRQ8hAP+xHenMW/9QPc4fTxmRzQ66OryeYBbNhdHGvySWCfJLzsBPCE1YF9dlSt+adrt2UU6c76hXHyIjxIonJ7AuhE+MXSKVPzNXJjHFHIXsnGYtqc+tH+uSSuXdtlC/OehLIQnrMG5fmEQwpxLR0LU/N1TDu0WsasHxlzes60TzIJOjsNOOHdCvCg24G70qayQzyqlQwdYEtcSzOEK440dxebdcPgR0aSHQ/wMBfsUPbPjfB5PZNpyV388o0zFcUDFFMElKhBA2WKoKD8Kg/gk8xBV+P12Is5h16fNd88X9XdFKl2NcD+uVzTEyCnfecukniSBLTrK7tvyZs6KFepi/U8BVfCPidiY5LwhxcyLKpHZ2YL8yEu8H2SeI0kfqQ7qy/78HvjpoQ/iR6X+GTetUnZn564UFVeD2W9gwdsAS+QhM+4xJ+5gN9JQECi8mje6fwRwZdI4OfXjUHaJajYITtLAdZtCWeWholq1i3JmiRKe3WTFluLs1qiPMD7aAWfIgnLFMKV19rl6nWPQ8bREVla4O1ayeuz9VQ18EtiEn/T5fIQr1KI17Rqjp+rqsYAf61/ncrvhqnINb1cqlkCv7JjHL++XlFHV021NGSJNU+b6tiaqZw4UdJJKyjPZ0383wc213eEj5CEd0hCTAJ/IqkNYlvA23aXPZxVVoyZutRWJ2XMvNeu7dBWfOpz9WxZ/wJwOf3zP7mVigAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/daf23c051d1970bd74a5bdb9fe7de872/5f2c3/thumbnail.png","srcSet":"/static/daf23c051d1970bd74a5bdb9fe7de872/90cd3/thumbnail.png 100w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/614dc/thumbnail.png 200w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/5f2c3/thumbnail.png 400w","sizes":"(min-width: 400px) 400px, 100vw"},"sources":[{"srcSet":"/static/daf23c051d1970bd74a5bdb9fe7de872/e64f1/thumbnail.webp 100w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/8b00d/thumbnail.webp 200w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/9c0a1/thumbnail.webp 400w","type":"image/webp","sizes":"(min-width: 400px) 400px, 100vw"}]},"width":400,"height":400}},"publicURL":"/static/daf23c051d1970bd74a5bdb9fe7de872/thumbnail.png"}}}}]}},"pageContext":{"slug":"/SpringSecurity2_2/","series":[{"slug":"/SpringSecurity2_1/","title":"Spring Security OAuth2.0 개념 파악하기","num":1},{"slug":"/SpringSecurity2_2/","title":"Spring Security OAuth2.0 Client","num":2}],"lastmod":"2023.02.13."}},"staticQueryHashes":["2383754777"],"slicesMap":{}}