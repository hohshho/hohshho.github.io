{"componentChunkName":"component---src-templates-post-tsx","path":"/SpringDB_2/","result":{"data":{"site":{"siteMetadata":{"title":"Just Keep Going","description":"Ian's Archive","siteUrl":"https://hohshho.github.io"}},"allMarkdownRemark":{"edges":[{"node":{"id":"decd3716-f762-5725-b6bf-3c87443ae639","html":"<p>SQL Mapper 주요 기능</p>\n<ul>\n<li>SQL결과를 객체로 편리하게 매핑</li>\n<li>JDBC를 사용할 때 발생하는 여러 중복을 제거</li>\n</ul>\n<p>ORM의 주요 기능</p>\n<ul>\n<li>기본적인 SQL은 JPA가 대신 작성하고 처리</li>\n<li>JPA는 자바 진영의 ORM표준, Hibernete는 JPA에서 가장 많이 사용하는 구현체</li>\n<li>스프링 데이터 JPA, QueryDSL은 JPA를 더 편리하게 사용하게 도와주는 프로젝트</li>\n</ul>\n<hr>\n<h1 id=\"1-jdbctemplate\" style=\"position:relative;\"><a href=\"#1-jdbctemplate\" aria-label=\"1 jdbctemplate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. JdbcTemplate</h1>\n<p>JdbcTemplate은 JDBC를 매우 편리하게 사용할 수 있게 도와준다.</p>\n<p>JdbcTemplate은 템플릿 콜백 패턴을 사용해서, JDBC를 직접 사용할 때 발생하는 대부분의 반복 작업을 대신 처리해준다.</p>\n<ul>\n<li>커넥션 획득</li>\n<li>statement 를 준비하고 실행</li>\n<li>결과를 반복하도록 루프를 실행</li>\n<li>커넥션 종료, statement , resultset 종료</li>\n<li>트랜잭션 다루기 위한 커넥션 동기화</li>\n<li>예외 발생시 스프링 예외 변환기 실행</li>\n</ul>\n<p>개발자는 SQL을 작성하고, 전달할 파리미터를 정의하고, 응답 값을 매핑하기만 하면 된다.</p>\n<p>하지만 동적 SQL을 해결하기 어렵다는 단점이 있다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"48501877087959474000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@Slf4j\n@Repository\npublic class JdbcTemplateItemRepositoryV1 implements ItemRepository {\n    private final JdbcTemplate template;\n    public JdbcTemplateItemRepositoryV1(DataSource dataSource) {\n        this.template = new JdbcTemplate(dataSource);\n    }\n\n    @Override\n    public Item save(Item item) {\n        String sql = &quot;insert into item (item_name, price, quantity) values ( ?, ?, ?)&quot;;\n        KeyHolder keyHolder = new GeneratedKeyHolder();\n        template.update(connection -> {\n            //자동 증가 키\n            PreparedStatement ps = connection.prepareStatement(sql, new String[]\n                    {&quot;id&quot;});\n            ps.setString(1, item.getItemName());\n            ps.setInt(2, item.getPrice());\n            ps.setInt(3, item.getQuantity());\n            return ps;\n        }, keyHolder);\n\n        long key = keyHolder.getKey().longValue();\n        item.setId(key);\n\n        return item;\n    }\n\n    @Override\n    public void update(Long itemId, ItemUpdateDto updateParam) {\n        String sql = &quot;update item set item_name=?, price=?, quantity=? where id =?&quot;;\n        template.update(sql,\n                updateParam.getItemName(),\n                updateParam.getPrice(),\n                updateParam.getQuantity(),\n                itemId);\n    }\n\n    @Override\n    public Optional<Item> findById(Long id) {\n        String sql = &quot;select id, item_name, price, quantity from item where id = ?&quot;;\n        try {\n            Item item = template.queryForObject(sql, itemRowMapper(), id);\n            return Optional.of(item);\n        } catch (EmptyResultDataAccessException e) {\n            return Optional.empty();\n        }\n    }\n\n    @Override\n    public List<Item> findAll(ItemSearchCond cond) {\n        String itemName = cond.getItemName();\n        Integer maxPrice = cond.getMaxPrice();\n        String sql = &quot;select id, item_name, price, quantity from item&quot;;\n        //동적 쿼리\n        if (StringUtils.hasText(itemName) || maxPrice != null) {\n            sql += &quot; where&quot;;\n        }\n        boolean andFlag = false;\n        List<Object> param = new ArrayList<>();\n        if (StringUtils.hasText(itemName)) {\n            sql += &quot; item_name like concat('%',?,'%')&quot;;\n            param.add(itemName);\n            andFlag = true;\n        }\n        if (maxPrice != null) {\n            if (andFlag) {\n                sql += &quot; and&quot;;\n            }\n            sql += &quot; price <= ?&quot;;\n            param.add(maxPrice);\n        }\n        log.info(&quot;sql={}&quot;, sql);\n        return template.query(sql, itemRowMapper(), param.toArray());\n    }\n\n    private RowMapper<Item> itemRowMapper() {\n        return (rs, rowNum) -> {\n            Item item = new Item();\n            item.setId(rs.getLong(&quot;id&quot;));\n            item.setItemName(rs.getString(&quot;item_name&quot;));\n            item.setPrice(rs.getInt(&quot;price&quot;));\n            item.setQuantity(rs.getInt(&quot;quantity&quot;));\n            return item;\n        };\n    }\n\n}`, `48501877087959474000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Slf4j</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Repository</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">JdbcTemplateItemRepositoryV1</span><span class=\"mtk1\"> </span><span class=\"mtk4\">implements</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ItemRepository</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">JdbcTemplate</span><span class=\"mtk1\"> </span><span class=\"mtk12\">template</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">JdbcTemplateItemRepositoryV1</span><span class=\"mtk1\">(</span><span class=\"mtk10\">DataSource</span><span class=\"mtk1\"> </span><span class=\"mtk12\">dataSource</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">template</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">JdbcTemplate</span><span class=\"mtk1\">(dataSource);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Item</span><span class=\"mtk1\"> </span><span class=\"mtk11\">save</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Item</span><span class=\"mtk1\"> </span><span class=\"mtk12\">item</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">sql</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;insert into item (item_name, price, quantity) values ( ?, ?, ?)&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">KeyHolder</span><span class=\"mtk1\"> </span><span class=\"mtk12\">keyHolder</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">GeneratedKeyHolder</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">template</span><span class=\"mtk1\">.</span><span class=\"mtk11\">update</span><span class=\"mtk1\">(connection </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">//자동 증가 키</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">PreparedStatement</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ps</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">connection</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prepareStatement</span><span class=\"mtk1\">(sql, </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\">[]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    {</span><span class=\"mtk8\">&quot;id&quot;</span><span class=\"mtk1\">});</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">ps</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setString</span><span class=\"mtk1\">(</span><span class=\"mtk7\">1</span><span class=\"mtk1\">, </span><span class=\"mtk12\">item</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getItemName</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">ps</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setInt</span><span class=\"mtk1\">(</span><span class=\"mtk7\">2</span><span class=\"mtk1\">, </span><span class=\"mtk12\">item</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getPrice</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">ps</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setInt</span><span class=\"mtk1\">(</span><span class=\"mtk7\">3</span><span class=\"mtk1\">, </span><span class=\"mtk12\">item</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getQuantity</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> ps;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }, keyHolder);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">long</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">keyHolder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getKey</span><span class=\"mtk1\">().</span><span class=\"mtk11\">longValue</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">item</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setId</span><span class=\"mtk1\">(key);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> item;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">update</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Long</span><span class=\"mtk1\"> </span><span class=\"mtk12\">itemId</span><span class=\"mtk1\">, </span><span class=\"mtk10\">ItemUpdateDto</span><span class=\"mtk1\"> </span><span class=\"mtk12\">updateParam</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">sql</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;update item set item_name=?, price=?, quantity=? where id =?&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">template</span><span class=\"mtk1\">.</span><span class=\"mtk11\">update</span><span class=\"mtk1\">(sql,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">updateParam</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getItemName</span><span class=\"mtk1\">(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">updateParam</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getPrice</span><span class=\"mtk1\">(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">updateParam</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getQuantity</span><span class=\"mtk1\">(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                itemId);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Optional</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Item</span><span class=\"mtk1\">&gt; </span><span class=\"mtk11\">findById</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Long</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">sql</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;select id, item_name, price, quantity from item where id = ?&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">Item</span><span class=\"mtk1\"> </span><span class=\"mtk12\">item</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">template</span><span class=\"mtk1\">.</span><span class=\"mtk11\">queryForObject</span><span class=\"mtk1\">(sql, </span><span class=\"mtk11\">itemRowMapper</span><span class=\"mtk1\">(), id);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Optional</span><span class=\"mtk1\">.</span><span class=\"mtk11\">of</span><span class=\"mtk1\">(item);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">EmptyResultDataAccessException</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Optional</span><span class=\"mtk1\">.</span><span class=\"mtk11\">empty</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Item</span><span class=\"mtk1\">&gt; </span><span class=\"mtk11\">findAll</span><span class=\"mtk1\">(</span><span class=\"mtk10\">ItemSearchCond</span><span class=\"mtk1\"> </span><span class=\"mtk12\">cond</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">itemName</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">cond</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getItemName</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Integer</span><span class=\"mtk1\"> </span><span class=\"mtk12\">maxPrice</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">cond</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMaxPrice</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">sql</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;select id, item_name, price, quantity from item&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//동적 쿼리</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">StringUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">hasText</span><span class=\"mtk1\">(itemName) || maxPrice != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            sql += </span><span class=\"mtk8\">&quot; where&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">boolean</span><span class=\"mtk1\"> </span><span class=\"mtk12\">andFlag</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">false</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Object</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">param</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ArrayList</span><span class=\"mtk1\">&lt;&gt;();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">StringUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">hasText</span><span class=\"mtk1\">(itemName)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            sql += </span><span class=\"mtk8\">&quot; item_name like concat(&#39;%&#39;,?,&#39;%&#39;)&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">param</span><span class=\"mtk1\">.</span><span class=\"mtk11\">add</span><span class=\"mtk1\">(itemName);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            andFlag = </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (maxPrice != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (andFlag) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                sql += </span><span class=\"mtk8\">&quot; and&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            sql += </span><span class=\"mtk8\">&quot; price &lt;= ?&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">param</span><span class=\"mtk1\">.</span><span class=\"mtk11\">add</span><span class=\"mtk1\">(maxPrice);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;sql={}&quot;</span><span class=\"mtk1\">, sql);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">template</span><span class=\"mtk1\">.</span><span class=\"mtk11\">query</span><span class=\"mtk1\">(sql, </span><span class=\"mtk11\">itemRowMapper</span><span class=\"mtk1\">(), </span><span class=\"mtk12\">param</span><span class=\"mtk1\">.</span><span class=\"mtk11\">toArray</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">RowMapper</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Item</span><span class=\"mtk1\">&gt; </span><span class=\"mtk11\">itemRowMapper</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> (rs, rowNum) </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">Item</span><span class=\"mtk1\"> </span><span class=\"mtk12\">item</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Item</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">item</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setId</span><span class=\"mtk1\">(</span><span class=\"mtk12\">rs</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getLong</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;id&quot;</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">item</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setItemName</span><span class=\"mtk1\">(</span><span class=\"mtk12\">rs</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getString</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;item_name&quot;</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">item</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setPrice</span><span class=\"mtk1\">(</span><span class=\"mtk12\">rs</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getInt</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;price&quot;</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">item</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setQuantity</span><span class=\"mtk1\">(</span><span class=\"mtk12\">rs</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getInt</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;quantity&quot;</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> item;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        };</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<ul>\n<li>JDBCTemplate은 DataSource가 필요하다</li>\n<li>dataSource를 의존관계 주입을 받고 생성자 내부에서 JdbcTemplate를 생성한다.</li>\n<li>관례상 이 방법을 많이 사용</li>\n</ul>\n<p>template.update()</p>\n<ul>\n<li>데이터를 변경할 때 사용한다.</li>\n<li>INSERT , UPDATE , DELETE SQL에 사용한다.</li>\n<li>template.update() 의 반환 값은 int 인데, 영향 받은 로우 수를 반환한다</li>\n</ul>\n<p>template.queryForObject()</p>\n<ul>\n<li>결과 로우가 하나일 때 사용한다.</li>\n<li>RowMapper 는 데이터베이스의 반환 결과인 ResultSet 을 객체로 변환한다.</li>\n</ul>\n<p>template.query()</p>\n<ul>\n<li>결과가 하나 이상일 때 사용한다.</li>\n<li>마찬가지로 RowMapper 는 데이터베이스의 반환 결과인 ResultSet 을 객체로 변환한다.</li>\n</ul>\n<h4 id=\"동적-쿼리-문제\" style=\"position:relative;\"><a href=\"#%EB%8F%99%EC%A0%81-%EC%BF%BC%EB%A6%AC-%EB%AC%B8%EC%A0%9C\" aria-label=\"동적 쿼리 문제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>동적 쿼리 문제</h4>\n<p>동적 쿼리가 언듯보면 쉬워 보이지만, 막상 개발해보면 다양한 상황</p>\n<p>어떤 경우엔 where넣고, 어떤 경우엔 and 넣는지 모두 계산해야 한다.</p>\n<h4 id=\"db-접근-설정\" style=\"position:relative;\"><a href=\"#db-%EC%A0%91%EA%B7%BC-%EC%84%A4%EC%A0%95\" aria-label=\"db 접근 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DB 접근 설정</h4>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"14940581233747685000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`spring.profiles.active=local\nspring.datasource.url=jdbc:h2:tcp://localhost/~/test\nspring.datasource.username=sa`, `14940581233747685000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">spring</span><span class=\"mtk1\">.</span><span class=\"mtk12\">profiles</span><span class=\"mtk1\">.</span><span class=\"mtk12\">active</span><span class=\"mtk1\">=local</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">spring</span><span class=\"mtk1\">.</span><span class=\"mtk12\">datasource</span><span class=\"mtk1\">.</span><span class=\"mtk12\">url</span><span class=\"mtk1\">=jdbc</span><span class=\"mtk15\">:</span><span class=\"mtk1\">h2</span><span class=\"mtk15\">:</span><span class=\"mtk1\">tcp</span><span class=\"mtk15\">:</span><span class=\"mtk3\">//localhost/~/test</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">spring</span><span class=\"mtk1\">.</span><span class=\"mtk12\">datasource</span><span class=\"mtk1\">.</span><span class=\"mtk12\">username</span><span class=\"mtk1\">=sa</span></span></span></code></pre>\n<p><code>src/main/resources/application.properties</code>에 다음과 같이 설정하면 스프링 부트가 해당 설정을 사용해 커넥션 풀과 DataSource, 트랜잭션 매니저를 스프링 빈으로 자동 등록</p>\n<h4 id=\"jdbc-template---이름-지정-바인딩\" style=\"position:relative;\"><a href=\"#jdbc-template---%EC%9D%B4%EB%A6%84-%EC%A7%80%EC%A0%95-%EB%B0%94%EC%9D%B8%EB%94%A9\" aria-label=\"jdbc template   이름 지정 바인딩 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JDBC Template - 이름 지정 바인딩</h4>\n<p>JdbcTemplate을 기본으로 사용하면 파라미터를 순서대로 바인딩 한다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"85816913919837550000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`String sql = &quot;update item set item_name=?, price=?, quantity=? where id=?&quot;;\ntemplate.update(sql,\n \t  itemName,\n \t  price,\n \t  quantity,\n \t  itemId);`, `85816913919837550000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">sql</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;update item set item_name=?, price=?, quantity=? where id=?&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">template</span><span class=\"mtk1\">.</span><span class=\"mtk11\">update</span><span class=\"mtk1\">(sql,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> \t  itemName,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> \t  price,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> \t  quantity,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> \t  itemId);</span></span></span></code></pre>\n<p>순서가 맞춰서 바인딩 되기 때문에 코드를 잘못 작성할 경우 큰 문제</p>\n<p>=> <code>JdbcTemplate</code>는 이런 문제를 보완하기 위해 <code>NamedParameterJdbcTemplate</code>라는 <strong>이름 지정해서 파라미터를 바인딩하는 기능</strong> 제공</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"80670990936681610000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@Slf4j\n@Repository\npublic class JdbcTemplateItemRepositoryV2 implements ItemRepository {\n\n    private final NamedParameterJdbcTemplate template;\n\n    public JdbcTemplateItemRepositoryV2(DataSource dataSource) {\n        this.template = new NamedParameterJdbcTemplate(dataSource);\n    }\n\n    @Override\n    public Item save(Item item) {\n        String sql = &quot;insert into item (item_name, price, quantity) &quot; +\n                &quot;values (:itemName, :price, :quantity)&quot;;\n        SqlParameterSource param = new BeanPropertySqlParameterSource(item);\n        KeyHolder keyHolder = new GeneratedKeyHolder();\n        template.update(sql, param, keyHolder);\n        Long key = keyHolder.getKey().longValue();\n        item.setId(key);\n        return item;\n    }\n\n    ...\n}`, `80670990936681610000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Slf4j</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Repository</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">JdbcTemplateItemRepositoryV2</span><span class=\"mtk1\"> </span><span class=\"mtk4\">implements</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ItemRepository</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">NamedParameterJdbcTemplate</span><span class=\"mtk1\"> </span><span class=\"mtk12\">template</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">JdbcTemplateItemRepositoryV2</span><span class=\"mtk1\">(</span><span class=\"mtk10\">DataSource</span><span class=\"mtk1\"> </span><span class=\"mtk12\">dataSource</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">template</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">NamedParameterJdbcTemplate</span><span class=\"mtk1\">(dataSource);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Item</span><span class=\"mtk1\"> </span><span class=\"mtk11\">save</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Item</span><span class=\"mtk1\"> </span><span class=\"mtk12\">item</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">sql</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;insert into item (item_name, price, quantity) &quot;</span><span class=\"mtk1\"> +</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk8\">&quot;values (:itemName, :price, :quantity)&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">SqlParameterSource</span><span class=\"mtk1\"> </span><span class=\"mtk12\">param</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">BeanPropertySqlParameterSource</span><span class=\"mtk1\">(item);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">KeyHolder</span><span class=\"mtk1\"> </span><span class=\"mtk12\">keyHolder</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">GeneratedKeyHolder</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">template</span><span class=\"mtk1\">.</span><span class=\"mtk11\">update</span><span class=\"mtk1\">(sql, param, keyHolder);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Long</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">keyHolder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getKey</span><span class=\"mtk1\">().</span><span class=\"mtk11\">longValue</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">item</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setId</span><span class=\"mtk1\">(key);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> item;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>다음과 같이 ? 대신에 <code>:파라미터이름</code>을 받는다.</p>\n<h4 id=\"이름-지정-파라미터\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EB%A6%84-%EC%A7%80%EC%A0%95-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0\" aria-label=\"이름 지정 파라미터 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이름 지정 파라미터</h4>\n<p>파라미터를 전달하려면 Map 처럼 key , value 데이터 구조를 만들어서 전달해야 한다.</p>\n<p>자주 사용하는 파라미터의 종류는 크게 3가지가 있다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"31354061022337910000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`//단순히 Map 사용\nMap<String, Object> param = Map.of(&quot;id&quot;, id);\n\n// Map 과 유사한데, SQL 타입을 지정할 수 있는 등 SQL에 좀 더 특화된 기능을 제공\nSqlParameterSource param = new MapSqlParameterSource()\n \t  .addValue(&quot;itemName&quot;, updateParam.getItemName())\n\n// 는 자바 빈 프로퍼티 규약을 통해서 자동으로 파라미터 객체를 생성한다.\n//예) (\\`getXxx()\\` -> xxx, \\`getItemName()\\` -> itemName)\nSqlParameterSource param = new BeanPropertySqlParameterSource(item);`, `31354061022337910000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//단순히 Map 사용</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Object</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">param</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Map</span><span class=\"mtk1\">.</span><span class=\"mtk11\">of</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;id&quot;</span><span class=\"mtk1\">, id);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// Map 과 유사한데, SQL 타입을 지정할 수 있는 등 SQL에 좀 더 특화된 기능을 제공</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">SqlParameterSource</span><span class=\"mtk1\"> </span><span class=\"mtk12\">param</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MapSqlParameterSource</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> \t  .</span><span class=\"mtk11\">addValue</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;itemName&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">updateParam</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getItemName</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// 는 자바 빈 프로퍼티 규약을 통해서 자동으로 파라미터 객체를 생성한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//예) (`getXxx()` -&gt; xxx, `getItemName()` -&gt; itemName)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">SqlParameterSource</span><span class=\"mtk1\"> </span><span class=\"mtk12\">param</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">BeanPropertySqlParameterSource</span><span class=\"mtk1\">(item);</span></span></span></code></pre>\n<p><strong>BeanPropertyRowMapper</strong></p>\n<p>BeanPropertyRowMapper 는 ResultSet 의 결과를 받아서 자바빈 규약에 맞추어 데이터를 변환한다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"79067067274004320000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`private RowMapper<Item> itemRowMapper() {\n    return BeanPropertyRowMapper.newInstance(Item.class); //camel 변환 지원\n}`, `79067067274004320000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">RowMapper</span><span class=\"mtk1\">&lt;Item&gt; </span><span class=\"mtk11\">itemRowMapper</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">BeanPropertyRowMapper</span><span class=\"mtk1\">.</span><span class=\"mtk11\">newInstance</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Item</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">); </span><span class=\"mtk3\">//camel 변환 지원</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>BeanPropertyRowMapper 는 언더스코어 표기법을 카멜로 자동 변환해준다</p>\n<h4 id=\"jdbctemplate---simplejdbcinsert\" style=\"position:relative;\"><a href=\"#jdbctemplate---simplejdbcinsert\" aria-label=\"jdbctemplate   simplejdbcinsert permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JdbcTemplate - SimpleJdbcInsert</h4>\n<p>Jdbc Template는 InsertSQL을 직접 작성하지 않아도 되도록 <code>SimpleJdbcInsert</code>라는 편리한 기능 제공</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"60963332943712370000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@Slf4j\n@Repository\npublic class JdbcTemplateItemRepositoryV3 implements ItemRepository {\n\n    private final NamedParameterJdbcTemplate template;\n    private final SimpleJdbcInsert jdbcInsert;\n\n    public JdbcTemplateItemRepositoryV3(DataSource dataSource) {\n        this.template = new NamedParameterJdbcTemplate(dataSource);\n        this.jdbcInsert = new SimpleJdbcInsert(dataSource)\n                .withTableName(&quot;item&quot;)\n                .usingGeneratedKeyColumns(&quot;id&quot;);\n//                .usingColumns(&quot;item_name&quot;, &quot;price&quot;, &quot;quantity&quot;); //생략 가능\n    }\n\n    @Override\n    public Item save(Item item) {\n        SqlParameterSource param = new BeanPropertySqlParameterSource(item);\n        Number key = jdbcInsert.executeAndReturnKey(param);\n        item.setId(key.longValue());\n        return item;\n    }\n\n    ...\n\n}`, `60963332943712370000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Slf4j</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Repository</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">JdbcTemplateItemRepositoryV3</span><span class=\"mtk1\"> </span><span class=\"mtk4\">implements</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ItemRepository</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">NamedParameterJdbcTemplate</span><span class=\"mtk1\"> </span><span class=\"mtk12\">template</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">SimpleJdbcInsert</span><span class=\"mtk1\"> </span><span class=\"mtk12\">jdbcInsert</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">JdbcTemplateItemRepositoryV3</span><span class=\"mtk1\">(</span><span class=\"mtk10\">DataSource</span><span class=\"mtk1\"> </span><span class=\"mtk12\">dataSource</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">template</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">NamedParameterJdbcTemplate</span><span class=\"mtk1\">(dataSource);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">jdbcInsert</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">SimpleJdbcInsert</span><span class=\"mtk1\">(dataSource)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">withTableName</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;item&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">usingGeneratedKeyColumns</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;id&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//                .usingColumns(&quot;item_name&quot;, &quot;price&quot;, &quot;quantity&quot;); //생략 가능</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Item</span><span class=\"mtk1\"> </span><span class=\"mtk11\">save</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Item</span><span class=\"mtk1\"> </span><span class=\"mtk12\">item</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">SqlParameterSource</span><span class=\"mtk1\"> </span><span class=\"mtk12\">param</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">BeanPropertySqlParameterSource</span><span class=\"mtk1\">(item);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Number</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">jdbcInsert</span><span class=\"mtk1\">.</span><span class=\"mtk11\">executeAndReturnKey</span><span class=\"mtk1\">(param);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">item</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setId</span><span class=\"mtk1\">(</span><span class=\"mtk12\">key</span><span class=\"mtk1\">.</span><span class=\"mtk11\">longValue</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> item;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>SimpleJdbcInsert 는 생성 시점에 데이터베이스 테이블의 메타 데이터를 조회한다. 따라서 어떤 컬럼이\n있는지 확인 할 수 있으므로 usingColumns 을 생략할 수 있다.</p>\n<p>SQL을 실행하면 생성된 키 값을 반환해 편리하게 조회가 가능하다.</p>\n<h4 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h4>\n<p>JdbcTemplate이 제공하는 주요 기능은 다음과 같다.</p>\n<ul>\n<li>JdbcTemplate\n<ul>\n<li>순서 기반 파라미터 바인딩을 지원한다.</li>\n</ul>\n</li>\n<li>NamedParameterJdbcTemplate\n<ul>\n<li>이름 기반 파라미터 바인딩을 지원한다. (권장)</li>\n</ul>\n</li>\n<li>SimpleJdbcInsert\n<ul>\n<li>INSERT SQL을 편리하게 사용할 수 있다.</li>\n</ul>\n</li>\n<li>SimpleJdbcCall\n<ul>\n<li>스토어드 프로시저를 편리하게 호출할 수 있다</li>\n</ul>\n</li>\n</ul>\n<p>JdbcTemplate의 단점이 있는데, 바로 동적 쿼리 문제를 해결하지 못한다.</p>\n<p>SQL을 자바 코드로 작성하기 때문에 SQL라인이 코드를 넘어갈 때 마다 문자 더하기를 해줘야 한다.</p>\n<p>동적 쿼리 문제를 해결하면서 동시에 SQL을 편리하게 작성하는데 도와주는 기술이 <code>MyBatis </code></p>\n<h1 id=\"2-데이터-접근-기술---테스트\" style=\"position:relative;\"><a href=\"#2-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%91%EA%B7%BC-%EA%B8%B0%EC%88%A0---%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"2 데이터 접근 기술   테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 데이터 접근 기술 - 테스트</h1>\n<p>src/test/resources/application.properties에도 설정을 추가한다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"66914689410728730000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@SpringBootTest\nclass ItemRepositoryTest {}\n\n@Slf4j\n//@Import(MemoryConfig.class)\n//@Import(JdbcTemplateV1Config.class)\n//@Import(JdbcTemplateV2Config.class)\n@Import(JdbcTemplateV3Config.class)\n@SpringBootApplication(scanBasePackages = &quot;hello.itemservice.web&quot;)\npublic class ItemServiceApplication {}`, `66914689410728730000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">SpringBootTest</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ItemRepositoryTest</span><span class=\"mtk1\"> {}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Slf4j</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//@Import(MemoryConfig.class)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//@Import(JdbcTemplateV1Config.class)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//@Import(JdbcTemplateV2Config.class)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Import</span><span class=\"mtk1\">(</span><span class=\"mtk12\">JdbcTemplateV3Config</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">SpringBootApplication</span><span class=\"mtk1\">(scanBasePackages = </span><span class=\"mtk8\">&quot;hello.itemservice.web&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ItemServiceApplication</span><span class=\"mtk1\"> {}</span></span></span></code></pre>\n<p><code>@SpringBootApplication</code>설정이 있으면 <code>@SpringBootApplication</code>을 찾아서 설정으로 사용한다.</p>\n<p>실제 DB를 연동해서 실행하면 기존 데이터가 테스트에 영향을 준다.</p>\n<p>이런 문제를 해결하려면 테스트를 다른 환경과 철저하게 분리해야 한다.</p>\n<p>가장 간단한 방법은 테스트 전용 데이터베이스를 별도로 운영하는 것이다.</p>\n<p>H2 데이터베이스를 용도에 따라 2가지로 구분하면 된다.</p>\n<ul>\n<li>jdbc:h2:tcp://localhost/~/test local에서 접근하는 서버 전용 데이터베이스</li>\n<li>jdbc:h2:tcp://localhost/~/testcase test 케이스에서 사용하는 전용 데이터베이스</li>\n</ul>\n<p>테스트에서 매우 중요한 원칙은 다음과 같다.</p>\n<p>테스트는 다른 테스트와 격리해야 한다.</p>\n<p>테스트는 반복해서 실행할 수 있어야 한다.</p>\n<p>테스트가 끝날 때 마다 추가한 데이터에 DELETE SQL 을 사용할 수도 있지만, 비정상적으로 종료됐을 때 DELETE SQL 을 호출하지 못할 수 도 있다.</p>\n<h4 id=\"테스트-데이터-롤백\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%A1%A4%EB%B0%B1\" aria-label=\"테스트 데이터 롤백 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테스트 데이터 롤백</h4>\n<p>테스트가 끝나고 나서 트랜잭션을 강제로 롤백해버리면 데이터가 깔끔하게 제거된다.</p>\n<p>DataSource와 TransactionManager는 스프링 부트가 자동으로 의존성 주입을 해준다.</p>\n<p>테스트를 하면서 데이터를 이미 저장했는데, 중간에 테스트가 실패해서 롤백을 호출하지 못해도 트랜잭션을 커밋하지 않았기 때문에 데이터베이스에 해당 데이터가 반영되지 않는다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"69714516641007740000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`    //트랜잭션 관련 코드\n    @Autowired\n    PlatformTransactionManager transactionManager;\n    TransactionStatus status;\n\n    @BeforeEach\n    void beforeEach() {\n        //트랜잭션 시작\n        status = transactionManager.getTransaction(new\n                DefaultTransactionDefinition());\n    }\n\n    @AfterEach\n    void afterEach() {\n        //MemoryItemRepository 의 경우 제한적으로 사용\n        if (itemRepository instanceof MemoryItemRepository) {\n            ((MemoryItemRepository) itemRepository).clearStore();\n        }\n        //트랜잭션 롤백\n        transactionManager.rollback(status);\n    }`, `69714516641007740000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//트랜잭션 관련 코드</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Autowired</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">PlatformTransactionManager</span><span class=\"mtk1\"> </span><span class=\"mtk12\">transactionManager</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">TransactionStatus</span><span class=\"mtk1\"> </span><span class=\"mtk12\">status</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">BeforeEach</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">beforeEach</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//트랜잭션 시작</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        status = </span><span class=\"mtk12\">transactionManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getTransaction</span><span class=\"mtk1\">(</span><span class=\"mtk15\">new</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk11\">DefaultTransactionDefinition</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">AfterEach</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">afterEach</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//MemoryItemRepository 의 경우 제한적으로 사용</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (itemRepository </span><span class=\"mtk4\">instanceof</span><span class=\"mtk1\"> MemoryItemRepository) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            ((MemoryItemRepository) itemRepository).</span><span class=\"mtk11\">clearStore</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//트랜잭션 롤백</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">transactionManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">rollback</span><span class=\"mtk1\">(status);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<hr>\n<h4 id=\"transactional\" style=\"position:relative;\"><a href=\"#transactional\" aria-label=\"transactional permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@Transactional</h4>\n<p><code>@Transactional</code>은 테스트에서 사용하면 특별하게 동작한다.</p>\n<p><code>@Transactional</code>이 테스트에 있으며 스프링은 테스트를 트랜잭션 안에서 실행하고, 테스트가 끝나면 트랜잭션을 <strong>자동으로 롤백</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b36cb2709e6ae3736f45efa4bd3ed0c8/5b89d/transactionalTest.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.32515337423312%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABpklEQVR42o2Tt44CQRBE9/OIiCEh4icg4INIyYmRCAAhQYD33ntbp9fSLIID7kbqndkxNVXVPd56vVar1VK73fb7arWqfr+v4/Eo2v1+13+bdz6fDaTX61mMRiPrB4OBbrebD3i9XnW5XMR+4iPgfr/XbDbTZDJRsVhUuVzWcDjUeDzWYrEQCqbTqbF389vt9jMgsgCEweFwMJkw4YLT6WQsWWO82WwsAGQO5ux1YwMEBMBXr2DlgLrdrgqFgkqlktmx2+20XC5t/RdDAOfzuQ/oQAEBFNmswwr5XL5arWyczWaVSqWUyWR8Xw2QQzRnODKR7DbBBED8dqywJpFIKBgMKhqNqtlsPgMiDcOdJEqnVqtZtmHLf71et+R0Oh2rjFgspnA4rEgkokql8kjKO8nUIYzwqtFoGAA9wTzn4vG4AoGAQqGQXf7VQ5eUd43M4mMul1MymVQ6nX728FuW3wFBAIsI9uEva4TPkMNI4d/VIbKYp/bw19UmgRWcI1hzBe/x4QdveCn5fN4SwRybKQ8u4kkC8tfb9mADAAfcTQ7wW3N+v8YPfZIlX9VBMyYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b36cb2709e6ae3736f45efa4bd3ed0c8/a81b5/transactionalTest.webp 163w,\n/static/b36cb2709e6ae3736f45efa4bd3ed0c8/da3ef/transactionalTest.webp 325w,\n/static/b36cb2709e6ae3736f45efa4bd3ed0c8/309d5/transactionalTest.webp 650w,\n/static/b36cb2709e6ae3736f45efa4bd3ed0c8/78344/transactionalTest.webp 975w,\n/static/b36cb2709e6ae3736f45efa4bd3ed0c8/bdb72/transactionalTest.webp 1300w,\n/static/b36cb2709e6ae3736f45efa4bd3ed0c8/3c106/transactionalTest.webp 1410w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b36cb2709e6ae3736f45efa4bd3ed0c8/5e043/transactionalTest.png 163w,\n/static/b36cb2709e6ae3736f45efa4bd3ed0c8/e5cc6/transactionalTest.png 325w,\n/static/b36cb2709e6ae3736f45efa4bd3ed0c8/663f3/transactionalTest.png 650w,\n/static/b36cb2709e6ae3736f45efa4bd3ed0c8/d880f/transactionalTest.png 975w,\n/static/b36cb2709e6ae3736f45efa4bd3ed0c8/4c573/transactionalTest.png 1300w,\n/static/b36cb2709e6ae3736f45efa4bd3ed0c8/5b89d/transactionalTest.png 1410w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b36cb2709e6ae3736f45efa4bd3ed0c8/663f3/transactionalTest.png\"\n            alt=\"transactionalTest\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ul>\n<li>테스트에 @Transactional 애노테이션이 테스트 메서드나 클래스에 있으면 먼저 트랜잭션을 시작한다</li>\n<li>@Transactional 이 테스트에 있으면 테스트가 끝날때 트랜잭션을 강제로 롤백한다</li>\n<li>테스트에서 트랜\n잭션을 실행하면 테스트 실행이 종료될 때 까지 테스트가 실행하는 모든 코드가 같은 트랜잭션 범위에 들어간다고\n이해 (추후 설명)</li>\n</ul>\n<h4 id=\"강제로-커밋하기---commit\" style=\"position:relative;\"><a href=\"#%EA%B0%95%EC%A0%9C%EB%A1%9C-%EC%BB%A4%EB%B0%8B%ED%95%98%EA%B8%B0---commit\" aria-label=\"강제로 커밋하기   commit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>강제로 커밋하기 - @Commit</h4>\n<p>정말 가끔은 데이터베이스에 데이터가 잘 보관되었는지 최종 결과를 눈으로 확인하고 싶을 때도 있다.\n@Commit 이나 @Rollback(value = false) 를 붙여주면 된다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"81762311257374030000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`//@Rollback(value = false)\n@Commit\n@Transactional\n@SpringBootTest\nclass ItemRepositoryTest {}`, `81762311257374030000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//@Rollback(value = false)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Commit</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Transactional</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">SpringBootTest</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ItemRepositoryTest</span><span class=\"mtk1\"> {}</span></span></span></code></pre>\n<hr>\n<h4 id=\"임베디드-모드-테스트\" style=\"position:relative;\"><a href=\"#%EC%9E%84%EB%B2%A0%EB%94%94%EB%93%9C-%EB%AA%A8%EB%93%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"임베디드 모드 테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>임베디드 모드 테스트</h4>\n<ul>\n<li>H2 데이터베이스는 자바로 개발되어 있고, JVM안에서 메모리 모드로 동작하는 특별한 기능을 제공</li>\n<li>애플리케이션을 실행할 때 H2 데이터베이스도 해당 JVM 메모리에 포함해서 함께 실행 가능</li>\n<li>애플리케이션이 종료되면 임베디드 모드로 동작하는 H2 데이터베이스도 함께 종료되고, 데이터도 모두 사라진다.</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"94942338030338690000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@Import(JdbcTemplateV3Config.class)\n@SpringBootApplication(scanBasePackages = &quot;hello.itemservice.web&quot;)\npublic class ItemServiceApplication {\n\tpublic static void main(String[] args) {\n\t\tSpringApplication.run(ItemServiceApplication.class, args);\n\t}\n\n\t@Bean\n\t@Profile(&quot;test&quot;) // 프로필이 test 인 경우에만 데이터소스를 스프링 빈으로 등록\n\tpublic DataSource dataSource() {\n\t\tlog.info(&quot;메모리 데이터베이스 초기화&quot;);\n\t\tDriverManagerDataSource dataSource = new DriverManagerDataSource();\n\t\tdataSource.setDriverClassName(&quot;org.h2.Driver&quot;);\n\t\tdataSource.setUrl(&quot;jdbc:h2:mem:db;DB_CLOSE_DELAY=-1&quot;);\n\t\tdataSource.setUsername(&quot;sa&quot;);\n\t\tdataSource.setPassword(&quot;&quot;);\n\t\treturn dataSource;\n\t}\n}`, `94942338030338690000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Import</span><span class=\"mtk1\">(</span><span class=\"mtk12\">JdbcTemplateV3Config</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">SpringBootApplication</span><span class=\"mtk1\">(scanBasePackages = </span><span class=\"mtk8\">&quot;hello.itemservice.web&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ItemServiceApplication</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">main</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">args</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk12\">SpringApplication</span><span class=\"mtk1\">.</span><span class=\"mtk11\">run</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ItemServiceApplication</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">, args);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t@</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t@</span><span class=\"mtk10\">Profile</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;test&quot;</span><span class=\"mtk1\">) </span><span class=\"mtk3\">// 프로필이 test 인 경우에만 데이터소스를 스프링 빈으로 등록</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">DataSource</span><span class=\"mtk1\"> </span><span class=\"mtk11\">dataSource</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;메모리 데이터베이스 초기화&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk10\">DriverManagerDataSource</span><span class=\"mtk1\"> </span><span class=\"mtk12\">dataSource</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DriverManagerDataSource</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk12\">dataSource</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setDriverClassName</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;org.h2.Driver&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk12\">dataSource</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setUrl</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;jdbc:h2:mem:db;DB_CLOSE_DELAY=-1&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk12\">dataSource</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setUsername</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;sa&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk12\">dataSource</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setPassword</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk15\">return</span><span class=\"mtk1\"> dataSource;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>jdbc:h2:mem:db : 이 부분이 중요하다. 데이터소스를 만들때 이렇게 적으면 임베디드 모드(메모리 모드)로 동작하는 H2 데이터베이스를 사용할 수 있다.</p>\n<p>DB_CLOSE_DELAY=-1 : 임베디드 모드에서는 데이터베이스 커넥션 연결이 모두 끊어지면 데이터베이스도 종료되는데, 그것을 방지하는 설정이다.</p>\n<p>스프링 부트는 SQL 스크립트를 실행해서 애플리케이션 로딩 시점에 데이터베이스를 초기화하는 기능을 제공한다.</p>\n<p>SQL을 작성하고 <code>src/test/resources/schema.sql</code>에 생성한다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"13710212770803065000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`drop table if exists item CASCADE;\ncreate table item\n(\n \tid bigint generated by default as identity,\n \titem_name varchar(10),\n \tprice integer,\n \tquantity integer,\n \tprimary key (id)\n);\n`, `13710212770803065000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"sql\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">drop</span><span class=\"mtk1\"> </span><span class=\"mtk4\">table</span><span class=\"mtk1\"> </span><span class=\"mtk4\">if</span><span class=\"mtk1\"> </span><span class=\"mtk4\">exists</span><span class=\"mtk1\"> item CASCADE;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">create</span><span class=\"mtk1\"> </span><span class=\"mtk4\">table</span><span class=\"mtk1\"> item</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> \tid </span><span class=\"mtk4\">bigint</span><span class=\"mtk1\"> </span><span class=\"mtk4\">generated</span><span class=\"mtk1\"> </span><span class=\"mtk4\">by</span><span class=\"mtk1\"> default </span><span class=\"mtk4\">as</span><span class=\"mtk1\"> </span><span class=\"mtk4\">identity</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> \titem_name </span><span class=\"mtk4\">varchar</span><span class=\"mtk1\">(</span><span class=\"mtk7\">10</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> \tprice </span><span class=\"mtk4\">integer</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> \tquantity </span><span class=\"mtk4\">integer</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> \t</span><span class=\"mtk4\">primary</span><span class=\"mtk1\"> </span><span class=\"mtk4\">key</span><span class=\"mtk1\"> (id)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span></code></pre>\n<p>스프링 부트는 데이터베이스에 대한 별다른 설정이 없으면 임베디드 데이터베이스를 사용</p>\n<p>메모리 DB용 데이터소스 설정과 아래의 application.properties의 데이터베이스 설정정보도 지워도 된다.</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">spring.datasource.url=jdbc:h2:tcp://localhost/~/testcase</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">spring.datasource.username=sa</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">jdbcTemplate sql log</span></span></code></pre>\n<p>이렇게 별다른 정보가 없으면 스프링 부트는 임베디드 모드로 접근하는 데이터소스(DataSource)를 만들어서 제공한다.</p>\n<h1 id=\"3-mybatis\" style=\"position:relative;\"><a href=\"#3-mybatis\" aria-label=\"3 mybatis permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. MyBatis</h1>\n<blockquote>\n<p>SQL Mapper</p>\n</blockquote>\n<ul>\n<li>JdbcTemplate와 비교해서 MyBatis의 가장 매력적인 점은 SQL을 XML에 편리하게 작성</li>\n<li>동적 쿼리를 매우 편리하게 작성</li>\n<li>JDBC는 스프링 내장 기능, 별도의 설정 없이 사용 가능</li>\n<li>MyBatis는 약간의 설정 필요</li>\n<li>스프링 부트가 버전관리해주는 공식 라이브러리가 아니라 버전을 따로 관리해야 한다.</li>\n<li><code>application.properties</code>은 main, test 모두 수정해야 한다.</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"62417737388426330000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`spring.profiles.active=local\nspring.datasource.url=jdbc:h2:tcp://localhost/~/test\nspring.datasource.username=sa\n\nlogging.level.org.springframework.jdbc=debug\n\n# MyBatis\nmybatis.type-aliases-package=hello.itemservice.domain\n# 언더바를 카멜로 자동 변경\nmybatis.configurationmap-underscore-to-camel-case=true\n# MyBatis에서 실행되는 쿼리 로그를 확인\nlogging.level.hello.itemservice.repository.mybatis=trace`, `62417737388426330000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"properties\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">spring.profiles.active</span><span class=\"mtk1\">=local</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">spring.datasource.url</span><span class=\"mtk1\">=jdbc:h2:tcp://localhost/~/test</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">spring.datasource.username</span><span class=\"mtk1\">=sa</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">logging.level.org.springframework.jdbc</span><span class=\"mtk1\">=debug</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># MyBatis</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">mybatis.type-aliases-package</span><span class=\"mtk1\">=hello.itemservice.domain</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># 언더바를 카멜로 자동 변경</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">mybatis.configurationmap-underscore-to-camel-case</span><span class=\"mtk1\">=true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># MyBatis에서 실행되는 쿼리 로그를 확인</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">logging.level.hello.itemservice.repository.mybatis</span><span class=\"mtk1\">=trace</span></span></span></code></pre>\n<p><code>mybatis.type-aliases-package</code></p>\n<ul>\n<li>타입 정보를 사용할 때는 패키지 이름을 적어야 하는데, 여기에 명시하면 패키지 이름 생략 가능</li>\n<li>지정한 패키지와 하위 패키지 자동으로 인식</li>\n<li>여러 위치 지정 시 <code>,</code>, <code>;</code>으로 구분</li>\n</ul>\n<hr>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"86413662224985950000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`package hello.itemservice.repository.mybatis;\n\n@Mapper\npublic interface ItemMapper {\n    void save(Item item);\n\n    void update(@Param(&quot;id&quot;) Long id, @Param (&quot;updateParam&quot;) ItemUpdateDto updateParam);\n\n    Optional<Item> findById(Long id);\n\n    List<Item> findAll(ItemSearchCond itemSearch);\n}`, `86413662224985950000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">package</span><span class=\"mtk1\"> hello.itemservice.repository.mybatis;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Mapper</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">interface</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ItemMapper</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">save</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Item</span><span class=\"mtk1\"> </span><span class=\"mtk12\">item</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">update</span><span class=\"mtk1\">(@</span><span class=\"mtk10\">Param</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;id&quot;</span><span class=\"mtk1\">) </span><span class=\"mtk10\">Long</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">, @</span><span class=\"mtk10\">Param</span><span class=\"mtk1\"> (</span><span class=\"mtk8\">&quot;updateParam&quot;</span><span class=\"mtk1\">) </span><span class=\"mtk10\">ItemUpdateDto</span><span class=\"mtk1\"> </span><span class=\"mtk12\">updateParam</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">Optional</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Item</span><span class=\"mtk1\">&gt; </span><span class=\"mtk11\">findById</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Long</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Item</span><span class=\"mtk1\">&gt; </span><span class=\"mtk11\">findAll</span><span class=\"mtk1\">(</span><span class=\"mtk10\">ItemSearchCond</span><span class=\"mtk1\"> </span><span class=\"mtk12\">itemSearch</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<ul>\n<li>마이바티스 매핑 XML을 호출해주는 매퍼 인터페이스</li>\n<li>@Mapper` 애노테이션을 붙여야 함</li>\n<li>이 인터페이스의 메서드를 호출하면 다음에 보이는 <code>xml</code> 의 해당 SQL을 실행하고 결과를 돌려준다.</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"71606337546442210000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`<!-- src/main/resources/hello/itemservice/repository/mybatis/ItemMapper.xml-->\n<?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?>\n<!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;\n        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;>\n<mapper namespace=&quot;hello.itemservice.repository.mybatis.ItemMapper&quot;>\n    <insert id=&quot;save&quot; useGeneratedKeys=&quot;true&quot; keyProperty=&quot;id&quot;>\n        insert into item (item_name, price, quantity)\n        values (#{itemName}, #{price}, #{quantity})\n    </insert>\n    <update id=&quot;update&quot;>\n        update item\n        set item_name=#{updateParam.itemName},\n            price=#{updateParam.price},\n            quantity=#{updateParam.quantity}\n        where id = #{id}\n    </update>\n    <select id=&quot;findById&quot; resultType=&quot;Item&quot;>\n        select id, item_name, price, quantity\n        from item\n        where id = #{id}\n    </select>\n    <select id=&quot;findAll&quot; resultType=&quot;Item&quot;>\n        select id, item_name, price, quantity\n        from item\n        <where>\n            <if test=&quot;itemName != null and itemName != ''&quot;>\n                and item_name like concat('%',#{itemName},'%')\n            </if>\n            <if test=&quot;maxPrice != null&quot;>\n                and price &lt;= #{maxPrice}\n            </if>\n        </where>\n    </select>\n</mapper>`, `71606337546442210000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"xml\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">&lt;!-- src/main/resources/hello/itemservice/repository/mybatis/ItemMapper.xml--&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;?</span><span class=\"mtk4\">xml</span><span class=\"mtk12\"> version</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;1.0&quot;</span><span class=\"mtk12\"> encoding</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;UTF-8&quot;</span><span class=\"mtk17\">?&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;!</span><span class=\"mtk4\">DOCTYPE</span><span class=\"mtk1\"> </span><span class=\"mtk4\">mapper</span><span class=\"mtk1\"> PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">mapper</span><span class=\"mtk1\"> </span><span class=\"mtk12\">namespace</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;hello.itemservice.repository.mybatis.ItemMapper&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">insert</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;save&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">useGeneratedKeys</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;true&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">keyProperty</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;id&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        insert into item (item_name, price, quantity)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        values (#{itemName}, #{price}, #{quantity})</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">insert</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">update</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;update&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        update item</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        set item_name=#{updateParam.itemName},</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            price=#{updateParam.price},</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            quantity=#{updateParam.quantity}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        where id = #{id}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">update</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">select</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;findById&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">resultType</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;Item&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        select id, item_name, price, quantity</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        from item</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        where id = #{id}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">select</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">select</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;findAll&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">resultType</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;Item&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        select id, item_name, price, quantity</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        from item</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">where</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">if</span><span class=\"mtk1\"> </span><span class=\"mtk12\">test</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;itemName != null and itemName != &#39;&#39;&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                and item_name like concat(&#39;%&#39;,#{itemName},&#39;%&#39;)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">if</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">if</span><span class=\"mtk1\"> </span><span class=\"mtk12\">test</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;maxPrice != null&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                and price </span><span class=\"mtk4\">&amp;lt;</span><span class=\"mtk1\">= #{maxPrice}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">if</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">where</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">select</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">mapper</span><span class=\"mtk17\">&gt;</span></span></span></code></pre>\n<ul>\n<li>xml은 <code>resources</code>아래 경로에 만들어준다.</li>\n<li>원래 resultType에 패키지 명 다 적어야 하는데 <code>mybatis.type-aliases-package</code>로 해결 (클래스 이름만 적어준다.)</li>\n<li><code>&#x3C;=</code>는 충돌이 일어나서 <code>&#x26;lt;=</code>로 적어준다.</li>\n<li>기본적으로 <code>mapper</code>와 <code>xml</code>의 경로를 맞춰준다. (패키지 경로 동일하게)</li>\n<li>xml원하는 위치에 두고 싶으면 <code>application.properties</code>에 다음과 같이 설정<br>\n=> <code>mybatis.mapper-locations=classpath:mapper/**/*.xml</code><br>\n=> 이렇게 하면 <code>resources/mapper</code> 를 포함한 그 하위 폴더에 있는 XML을 XML 매핑 파일로 인식<br>\n=> 테스트의 <code>application.properties</code> 파일도 함께 수정해야 테스트를 실행할 때 인식</li>\n</ul>\n<hr>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"5405561981252261000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`void save(Item item);\n\n<insert id=&quot;save&quot; useGeneratedKeys=&quot;true&quot; keyProperty=&quot;id&quot;>\n insert into item (item_name, price, quantity)\n values (#{itemName}, #{price}, #{quantity})\n</insert>`, `5405561981252261000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"xml\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">void save(Item item);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">insert</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;save&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">useGeneratedKeys</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;true&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">keyProperty</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;id&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> insert into item (item_name, price, quantity)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> values (#{itemName}, #{price}, #{quantity})</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">insert</span><span class=\"mtk17\">&gt;</span></span></span></code></pre>\n<p>insert</p>\n<ul>\n<li>파라미터는 <code>#{}</code> 문법을 사용 -> <code>PreparedStatement</code>를 사용, JDBC의 ? 치환이라 생각</li>\n<li>useGeneratedKeys<code>는 데이터베이스가 키를 생성해 주는</code>IDENTITY` 전략일 때 사용</li>\n<li><code>keyProperty</code> 는 생성되는 키의 속성 이름을 지정</li>\n</ul>\n<hr>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"61034740817305625000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`void update(@Param(&quot;id&quot;) Long id, @Param(&quot;updateParam&quot;) ItemUpdateDto\nupdateParam);\n\n<update id=&quot;update&quot;>\n update item\n set item_name=#{updateParam.itemName},\n price=#{updateParam.price},\n quantity=#{updateParam.quantity}\n where id = #{id}\n</update>`, `61034740817305625000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"xml\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">void update(@Param(&quot;id&quot;) Long id, @Param(&quot;updateParam&quot;) ItemUpdateDto</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">updateParam);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">update</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;update&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> update item</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> set item_name=#{updateParam.itemName},</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> price=#{updateParam.price},</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> quantity=#{updateParam.quantity}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> where id = #{id}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">update</span><span class=\"mtk17\">&gt;</span></span></span></code></pre>\n<p>update</p>\n<ul>\n<li>파라미터가 1개만 있으면\n<code>@Param</code> 을 지정하지 않아도 되지만, 파라미터가 2개 이상이면 <code>@Param</code> 으로 이름을 지정해서 파라미터를 구분</li>\n</ul>\n<hr>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"25014660594933910000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`Optional<Item> findById(Long id);\n\n<select id=&quot;findById&quot; resultType=&quot;Item&quot;>\n select id, item_name, price, quantity\n from item\n where id = #{id}\n</select>`, `25014660594933910000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"xml\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">Optional</span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">Item</span><span class=\"mtk17\">&gt;</span><span class=\"mtk1\"> findById(Long id);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">select</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;findById&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">resultType</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;Item&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> select id, item_name, price, quantity</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> from item</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> where id = #{id}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">select</span><span class=\"mtk17\">&gt;</span></span></span></code></pre>\n<p>select</p>\n<ul>\n<li><code>resultType</code> 은 반환 타입을 명시\n<ul>\n<li>앞서 application.properties 에 mybatis.type-aliasespackage=hello.itemservice.domain 속성을 지정해 모든 패키지 명을 다 적지는 않아도 된다.</li>\n<li>그렇지 않으면 모든 패키지 명을 다 적어야 한다.</li>\n</ul>\n</li>\n</ul>\n<hr>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"79498518616749280000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`List<Item> findAll(ItemSearchCond itemSearch);\n\n<select id=&quot;findAll&quot; resultType=&quot;Item&quot;>\n select id, item_name, price, quantity\n from item\n <where>\n <if test=&quot;itemName != null and itemName != ''&quot;>\n and item_name like concat('%',#{itemName},'%')\n </if>\n <if test=&quot;maxPrice != null&quot;>\n and price &lt;= #{maxPrice}\n </if>\n </where>\n</select>`, `79498518616749280000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"xml\" data-index=\"19\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">List</span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">Item</span><span class=\"mtk17\">&gt;</span><span class=\"mtk1\"> findAll(ItemSearchCond itemSearch);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">select</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;findAll&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">resultType</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;Item&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> select id, item_name, price, quantity</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> from item</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">where</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">if</span><span class=\"mtk1\"> </span><span class=\"mtk12\">test</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;itemName != null and itemName != &#39;&#39;&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> and item_name like concat(&#39;%&#39;,#{itemName},&#39;%&#39;)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">if</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">if</span><span class=\"mtk1\"> </span><span class=\"mtk12\">test</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;maxPrice != null&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> and price </span><span class=\"mtk4\">&amp;lt;</span><span class=\"mtk1\">= #{maxPrice}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">if</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">where</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">select</span><span class=\"mtk17\">&gt;</span></span></span></code></pre>\n<p>select all</p>\n<ul>\n<li><code>&#x3C;where></code> , <code>&#x3C;if></code> 같은 동적 쿼리 문법을 통해 편리한 동적 쿼리를 지원</li>\n<li><if>` 는 해당 조건이 만족하면 구문을 추가</li>\n<li><code>&#x3C;where></code> 은 적절하게 <code>where</code> 문장을 만들어준다.</li>\n<li>&#x3C; : &#x3C; / > : > / &#x26; : &#x26; 치환하여 사용</li>\n</ul>\n<hr>\n<p>치환하지 않고 사용하고 싶으면 XML CDATA사용한다.</p>\n<p>다만 이 구문 안에서는 XML TAG가 단순 문자로 인식하기 때문에 <code>&#x3C;if></code>, <code>&#x3C;where></code> 등이 적용되지 않는다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"86907509991997370000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`<select id=&quot;findAll&quot; resultType=&quot;Item&quot;>\n select id, item_name, price, quantity\n from item\n <where>\n <if test=&quot;itemName != null and itemName != ''&quot;>\n and item_name like concat('%',#{itemName},'%')\n </if>\n <if test=&quot;maxPrice != null&quot;>\n <![CDATA[\n and price <= #{maxPrice}\n ]]>\n </if>\n </where>\n</select>`, `86907509991997370000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"xml\" data-index=\"20\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">select</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;findAll&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">resultType</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;Item&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> select id, item_name, price, quantity</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> from item</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">where</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">if</span><span class=\"mtk1\"> </span><span class=\"mtk12\">test</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;itemName != null and itemName != &#39;&#39;&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> and item_name like concat(&#39;%&#39;,#{itemName},&#39;%&#39;)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">if</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">if</span><span class=\"mtk1\"> </span><span class=\"mtk12\">test</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;maxPrice != null&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk8\">&lt;![CDATA[</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\"> and price &lt;= #{maxPrice}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\"> ]]&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">if</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">where</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">select</span><span class=\"mtk17\">&gt;</span></span></span></code></pre>\n<hr>\n<p>Mapper가 있어도 Repository만들어서 사용</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/94ed5ed2bb4445c22bbd67834f499823/97912/mybatis.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.62576687116564%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABO0lEQVR42l2RW6+CQAyE9///Lx9IfCK+CASQm4KICioXkZ58TZaQ02Szt3Y6nTG3200cx5GiKOTxeMj9fpemaeT9fgsxz7M8n0/puk7P9u16vWpu27b6z/31eokB0PM8CYJALpeLRFEkSZJImqYruO/7+s6ZoizL1iaHw0HiONZGVVWJocP5fNYLO0zZAfx8PvL9fmUYBj0D8vv9lD3NT6eT7HY7cV1X6rpWlmZZFk0iGBkAgjeAaASDPM+lLMs1lzxqYc0bMrArIIuAbRiGOsbxeFQg/qZpUlasvu9XLQkksPWEkU2gCaCMwyLZBkWwYnRGgzG56G0NQhIDTQoZDxCr25bFdgrLykqx3+/V0FVDXAYZfXCbkenMfQu6jXEcVwNxHCLc0dNgBKA8Mob9oOOW1X+21gRriDXlD/jOsBXoIv6hAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/94ed5ed2bb4445c22bbd67834f499823/a81b5/mybatis.webp 163w,\n/static/94ed5ed2bb4445c22bbd67834f499823/da3ef/mybatis.webp 325w,\n/static/94ed5ed2bb4445c22bbd67834f499823/309d5/mybatis.webp 650w,\n/static/94ed5ed2bb4445c22bbd67834f499823/78344/mybatis.webp 975w,\n/static/94ed5ed2bb4445c22bbd67834f499823/bdb72/mybatis.webp 1300w,\n/static/94ed5ed2bb4445c22bbd67834f499823/29938/mybatis.webp 1738w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/94ed5ed2bb4445c22bbd67834f499823/5e043/mybatis.png 163w,\n/static/94ed5ed2bb4445c22bbd67834f499823/e5cc6/mybatis.png 325w,\n/static/94ed5ed2bb4445c22bbd67834f499823/663f3/mybatis.png 650w,\n/static/94ed5ed2bb4445c22bbd67834f499823/d880f/mybatis.png 975w,\n/static/94ed5ed2bb4445c22bbd67834f499823/4c573/mybatis.png 1300w,\n/static/94ed5ed2bb4445c22bbd67834f499823/97912/mybatis.png 1738w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/94ed5ed2bb4445c22bbd67834f499823/663f3/mybatis.png\"\n            alt=\"mybatis\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol>\n<li>애플리케이션 로딩 시점에 MyBatis 스프링 연동 모듈은 @Mapper 가 붙어있는 인터페이스를 조사한다.</li>\n<li>해당 인터페이스가 발견되면 동적 프록시 기술을 사용해서 ItemMapper 인터페이스의 구현체를 만든다.</li>\n<li>생성된 구현체를 스프링 빈으로 등록한다.</li>\n</ol>\n<p>매퍼 구현체</p>\n<ul>\n<li>마이바티스 스프링 연동 모듈이 만들어주는 ItemMapper 의 구현체 덕분에 인터페이스 만으로 편리하게 XML의 데이터를 찾아서 호출할 수 있다.</li>\n<li>원래 마이바티스를 사용하려면 더 번잡한 코드를 거쳐야 하는데, 이런 부분을 인터페이스 하나로 사용할 수 있다.</li>\n<li>매퍼 구현체는 예외 변환까지 처리해준다. MyBatis에서 발생한 예외를 스프링 예외 추상화인 DataAccessException 에 맞게 변환해서 반환해준다.</li>\n<li>JdbcTemplate이 제공하는 예외 변환 기능을 여기서\n도 제공한다고 이해하면 된다.</li>\n</ul>\n<p>정리</p>\n<ul>\n<li>매퍼 구현체 덕분에 마이바티스를 스프링에 편리하게 통합해서 사용할 수 있다.</li>\n<li>매퍼 구현체를 사용하면 스프링 예외 추상화도 함께 적용된다.</li>\n<li>마이바티스 스프링 연동 모듈이 많은 부분을 자동으로 설정해주는데, 데이터베이스 커넥션, 트랜잭션과 관련된 기능도 마이바티스와 함께 연동하고, 동기화해준다.</li>\n</ul>\n<hr>\n<h4 id=\"동적-쿼리\" style=\"position:relative;\"><a href=\"#%EB%8F%99%EC%A0%81-%EC%BF%BC%EB%A6%AC\" aria-label=\"동적 쿼리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>동적 쿼리</h4>\n<p>MyBatis의 동적 SQL기능</p>\n<ul>\n<li>if</li>\n<li>choose (when, otherwise)</li>\n<li>trim (where, set)</li>\n<li>foreach</li>\n</ul>\n<hr>\n<p>if문</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"43238216420104946000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`<select id=&quot;findActiveBlogWithTitleLike&quot; resultType=&quot;Blog&quot;>\nSELECT * FROM BLOG\nWHERE state = ‘ACTIVE’\n    <if test=&quot;title != null&quot;>\n    AND title like #{title}\n    </if>\n</select>`, `43238216420104946000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"xml\" data-index=\"21\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">select</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;findActiveBlogWithTitleLike&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">resultType</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;Blog&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">SELECT * FROM BLOG</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">WHERE state = ‘ACTIVE’</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">if</span><span class=\"mtk1\"> </span><span class=\"mtk12\">test</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;title != null&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    AND title like #{title}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">if</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">select</span><span class=\"mtk17\">&gt;</span></span></span></code></pre>\n<p>switch문</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"46113798337745250000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`<select id=&quot;findActiveBlogLike&quot; resultType=&quot;Blog&quot;>\nSELECT \\* FROM BLOG WHERE state = ‘ACTIVE’\n<choose>\n    <when test=&quot;title != null&quot;>\n    AND title like #{title}\n    </when>\n    <when test=&quot;author != null and author.name != null&quot;>\n    AND author_name like #{author.name}\n    </when>\n    <otherwise>\n    AND featured = 1\n    </otherwise>\n</choose>\n</select>`, `46113798337745250000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"xml\" data-index=\"22\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">select</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;findActiveBlogLike&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">resultType</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;Blog&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">SELECT \\* FROM BLOG WHERE state = ‘ACTIVE’</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">choose</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">when</span><span class=\"mtk1\"> </span><span class=\"mtk12\">test</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;title != null&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    AND title like #{title}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">when</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">when</span><span class=\"mtk1\"> </span><span class=\"mtk12\">test</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;author != null and author.name != null&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    AND author_name like #{author.name}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">when</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">otherwise</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    AND featured = 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">otherwise</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">choose</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">select</span><span class=\"mtk17\">&gt;</span></span></span></code></pre>\n<p><code>&#x3C;where></code> 사용</p>\n<p>&#x3C;where> 는 문장이 없으면 where 를 추가하지 않는다. 문장이 있으면 where 를 추가한다. 만약 and 가 먼저 시작 된다면 <strong>and를 지운다</strong></p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"24745621154759643000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`<select id=&quot;findActiveBlogLike&quot; resultType=&quot;Blog&quot;>\nSELECT * FROM BLOG\n    <where>\n        <if test=&quot;state != null&quot;>\n        state = #{state}\n        </if>\n        <if test=&quot;title != null&quot;>\n        AND title like #{title}\n        </if>\n        <if test=&quot;author != null and author.name != null&quot;>\n        AND author_name like #{author.name}\n        </if>\n    </where>\n</select>`, `24745621154759643000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"xml\" data-index=\"23\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">select</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;findActiveBlogLike&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">resultType</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;Blog&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">SELECT * FROM BLOG</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">where</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">if</span><span class=\"mtk1\"> </span><span class=\"mtk12\">test</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;state != null&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        state = #{state}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">if</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">if</span><span class=\"mtk1\"> </span><span class=\"mtk12\">test</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;title != null&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        AND title like #{title}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">if</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">if</span><span class=\"mtk1\"> </span><span class=\"mtk12\">test</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;author != null and author.name != null&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        AND author_name like #{author.name}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">if</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">where</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">select</span><span class=\"mtk17\">&gt;</span></span></span></code></pre>\n<p>foreach</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"76735443488924530000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`<select id=&quot;selectPostIn&quot; resultType=&quot;domain.blog.Post&quot;>\nSELECT *\nFROM POST P\n    <where>\n        <foreach item=&quot;item&quot; index=&quot;index&quot; collection=&quot;list&quot; open=&quot;ID in (&quot; separator=&quot;,&quot; close=&quot;)&quot; nullable=&quot;true&quot;>\n        #{item}\n        </foreach>\n    </where>\n</select>`, `76735443488924530000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"xml\" data-index=\"24\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">select</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;selectPostIn&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">resultType</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;domain.blog.Post&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">SELECT *</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">FROM POST P</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">where</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">foreach</span><span class=\"mtk1\"> </span><span class=\"mtk12\">item</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;item&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">index</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;index&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">collection</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;list&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">open</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;ID in (&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">separator</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;,&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">close</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;)&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">nullable</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;true&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        #{item}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">foreach</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">where</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">select</span><span class=\"mtk17\">&gt;</span></span></span></code></pre>\n<h4 id=\"기타-기능\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%ED%83%80-%EA%B8%B0%EB%8A%A5\" aria-label=\"기타 기능 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기타 기능</h4>\n<ul>\n<li>어노테이션 SQL 작성</li>\n<li>재사용이 가능한 SQL조각</li>\n<li>Result Maps\n<ul>\n<li>결과를 매핑할 때 테이블은 user_id지만 객체는 id이다.</li>\n<li>이런 경우 별칭 <code>as</code>를 사용한다.</li>\n</ul>\n</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"38319880943380546000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`<select id=&quot;selectUsers&quot; resultType=&quot;User&quot;>\n select\n user_id as &quot;id&quot;,\n user_name as &quot;userName&quot;,\n hashed_password as &quot;hashedPassword&quot;\n from some_table\n where id = #{id}\n</select>`, `38319880943380546000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"xml\" data-index=\"25\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">select</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;selectUsers&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">resultType</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;User&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> select</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> user_id as &quot;id&quot;,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> user_name as &quot;userName&quot;,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> hashed_password as &quot;hashedPassword&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> from some_table</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> where id = #{id}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">select</span><span class=\"mtk17\">&gt;</span></span></span></code></pre>\n<p>별칭을 사용하지 않고 resultMap 을 선언해서 사용하기도 한다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"46882758961374350000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`<resultMap id=&quot;userResultMap&quot; type=&quot;User&quot;>\n <id property=&quot;id&quot; column=&quot;user_id&quot; />\n <result property=&quot;username&quot; column=&quot;user_name&quot;/>\n <result property=&quot;password&quot; column=&quot;hashed_password&quot;/>\n</resultMap>\n<select id=&quot;selectUsers&quot; resultMap=&quot;userResultMap&quot;>\n select user_id, user_name, hashed_password\n from some_table\n where id = #{id}\n</select>`, `46882758961374350000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"xml\" data-index=\"26\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">resultMap</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;userResultMap&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">type</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;User&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">id</span><span class=\"mtk1\"> </span><span class=\"mtk12\">property</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;id&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">column</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;user_id&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk17\">/&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">result</span><span class=\"mtk1\"> </span><span class=\"mtk12\">property</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;username&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">column</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;user_name&quot;</span><span class=\"mtk17\">/&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">result</span><span class=\"mtk1\"> </span><span class=\"mtk12\">property</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;password&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">column</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;hashed_password&quot;</span><span class=\"mtk17\">/&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">resultMap</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">select</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;selectUsers&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">resultMap</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;userResultMap&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> select user_id, user_name, hashed_password</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> from some_table</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> where id = #{id}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">select</span><span class=\"mtk17\">&gt;</span></span></span></code></pre>\n<h1 id=\"4-jpa\" style=\"position:relative;\"><a href=\"#4-jpa\" aria-label=\"4 jpa permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. JPA</h1>\n<p>객체와 RDBMS의 차이</p>\n<ol>\n<li>상속</li>\n<li>연관관계</li>\n<li>데이터타입</li>\n<li>데이터 식별 방법</li>\n</ol>\n<p>JPA란?</p>\n<blockquote>\n<p>Java Persistence API\n자바 진형의 ORM기술 표준</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/621058e071d3adc963a6a67542f01ea7/cd322/jpa1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.89570552147239%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABJElEQVR42nWS2YqFQAxE7/9/ng+C+KgiuOC+LxlODyWO420I3dkqlXQ+wzDYOI6XoEu6rrO+793dtq0Tvdd1tbfzWZbFzvO0fd/tOI7LgT5NkxVFYU3TGHHoFK3r2t2vgDCBBcFUJ5HDjWDDxxFglmWX7RVQ9Llhk+e5lWVp8zw7Ox1wKAxz/AJEF6lt234BcdIuAACFYWhxHDt2URS5N8zEFoaMAjvx2BkDZBwgxqqq3I2RNwEkep5nvu9bEASWpqklSeJEOcSAQR5F/7WsNnkTgK5NoAid3FvWJmgL/gDqJ5/gmiGxzxniAwiG+D7aPTFhsN8AVfAO+LqH9yQd7Nq/p8DozlDiAGEIKxhJ0JkLQ0e/g91n+5Uhzqco+c2HPDsS4A+Vw6XNu5RYewAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/621058e071d3adc963a6a67542f01ea7/a81b5/jpa1.webp 163w,\n/static/621058e071d3adc963a6a67542f01ea7/da3ef/jpa1.webp 325w,\n/static/621058e071d3adc963a6a67542f01ea7/309d5/jpa1.webp 650w,\n/static/621058e071d3adc963a6a67542f01ea7/78344/jpa1.webp 975w,\n/static/621058e071d3adc963a6a67542f01ea7/bdb72/jpa1.webp 1300w,\n/static/621058e071d3adc963a6a67542f01ea7/a0d5a/jpa1.webp 1786w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/621058e071d3adc963a6a67542f01ea7/5e043/jpa1.png 163w,\n/static/621058e071d3adc963a6a67542f01ea7/e5cc6/jpa1.png 325w,\n/static/621058e071d3adc963a6a67542f01ea7/663f3/jpa1.png 650w,\n/static/621058e071d3adc963a6a67542f01ea7/d880f/jpa1.png 975w,\n/static/621058e071d3adc963a6a67542f01ea7/4c573/jpa1.png 1300w,\n/static/621058e071d3adc963a6a67542f01ea7/cd322/jpa1.png 1786w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/621058e071d3adc963a6a67542f01ea7/663f3/jpa1.png\"\n            alt=\"jpa1\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e1e4941b874f5248ebfbb5afe1f478b4/432df/jpa2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.34969325153374%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABOElEQVR42nWT2YqFMAyGff+nEy+880ZRVNz3vYcvQ0rnjFMItW3+pUn15nk267raWJbFxjRNZhxHiWEYJPgG8zyPeRseh9d1meM4zHmeNpE9zuq6FiLEWEPYNI2cvxL2fW+2bTP7vguI+b5vmRHpuk72GXqLoigs4bdTDwcQMHCIgLpCyAXhEJE8z39hKA9C7HlqX11ByJr6VVVlsiwTR5BwXfaTJLHOOYeQXAwIIW6YIVMQ5GVZmiAIjO/7JooicQ5ZmqaSBxEY8hHAvRCqfZyhGIahVdZmEAgDiuNYyCEDT07btj8O3RriijUH2lm3hgh81xAT5CIoTVHrBJsUWYv93RTWXI+aat6fZwORgtwnoA2CREOfjTZOh4v1UMQ+CQTK2mWArLmmG/ozvDp0fzs33Mf+Fv+ND5BopUz/QVxJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e1e4941b874f5248ebfbb5afe1f478b4/a81b5/jpa2.webp 163w,\n/static/e1e4941b874f5248ebfbb5afe1f478b4/da3ef/jpa2.webp 325w,\n/static/e1e4941b874f5248ebfbb5afe1f478b4/309d5/jpa2.webp 650w,\n/static/e1e4941b874f5248ebfbb5afe1f478b4/78344/jpa2.webp 975w,\n/static/e1e4941b874f5248ebfbb5afe1f478b4/bdb72/jpa2.webp 1300w,\n/static/e1e4941b874f5248ebfbb5afe1f478b4/0cc5a/jpa2.webp 1832w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e1e4941b874f5248ebfbb5afe1f478b4/5e043/jpa2.png 163w,\n/static/e1e4941b874f5248ebfbb5afe1f478b4/e5cc6/jpa2.png 325w,\n/static/e1e4941b874f5248ebfbb5afe1f478b4/663f3/jpa2.png 650w,\n/static/e1e4941b874f5248ebfbb5afe1f478b4/d880f/jpa2.png 975w,\n/static/e1e4941b874f5248ebfbb5afe1f478b4/4c573/jpa2.png 1300w,\n/static/e1e4941b874f5248ebfbb5afe1f478b4/432df/jpa2.png 1832w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e1e4941b874f5248ebfbb5afe1f478b4/663f3/jpa2.png\"\n            alt=\"jpa2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>ORM이란?</p>\n<blockquote>\n<p>Object-relational mapping (객체 관계 매핑)</p>\n</blockquote>\n<ul>\n<li>객체는 객체대로 설계</li>\n<li>관계형 데이터베이스는 관계형 데이터베이스대로 설계</li>\n<li>ORM 프레임워크가 중간에서 매핑</li>\n<li>대중적인 언어에는 대부분 ORM 기술이 존재</li>\n</ul>\n<p>JPA 사용해야 하는 이유</p>\n<ul>\n<li>SQL 중심적인 개발에서 객체 중심으로 개발</li>\n<li>생산성</li>\n<li>유지보수</li>\n<li>패러다임의 불일치 해결</li>\n<li>성능\n<ul>\n<li>1차 캐시와 동일성 보장</li>\n<li>트랜잭션을 지원하는 쓰기 지연</li>\n<li>지연 로딩 : 객체가 실제 사용될 떄 로딩</li>\n<li>즉시 로딩 : Join SQL로 한번에 연관된 객체까지 미리 조회</li>\n</ul>\n</li>\n<li>데이터 접근 추상화와 벤더 독립성</li>\n<li>표준</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"87688815333231970000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@Data\n@Entity\npublic class Item {\n\n    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column(name = &quot;item_name&quot;, length = 10)\n    private String itemName;\n    private Integer price;\n    private Integer quantity;\n\n    public Item() {\n    }\n\n    public Item(String itemName, Integer price, Integer quantity) {\n        this.itemName = itemName;\n        this.price = price;\n        this.quantity = quantity;\n    }\n}`, `87688815333231970000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"27\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Data</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Entity</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Item</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Id</span><span class=\"mtk1\"> @</span><span class=\"mtk10\">GeneratedValue</span><span class=\"mtk1\">(strategy = </span><span class=\"mtk12\">GenerationType</span><span class=\"mtk1\">.</span><span class=\"mtk12\">IDENTITY</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Long</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Column</span><span class=\"mtk1\">(name = </span><span class=\"mtk8\">&quot;item_name&quot;</span><span class=\"mtk1\">, length = </span><span class=\"mtk7\">10</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">itemName</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Integer</span><span class=\"mtk1\"> </span><span class=\"mtk12\">price</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Integer</span><span class=\"mtk1\"> </span><span class=\"mtk12\">quantity</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Item</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Item</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">itemName</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Integer</span><span class=\"mtk1\"> </span><span class=\"mtk12\">price</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Integer</span><span class=\"mtk1\"> </span><span class=\"mtk12\">quantity</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">itemName</span><span class=\"mtk1\"> = itemName;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">price</span><span class=\"mtk1\"> = price;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">quantity</span><span class=\"mtk1\"> = quantity;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>@Entity : JPA가 사용하는 객체라는 뜻이다. 이 에노테이션이 있어야 JPA가 인식할 수 있다.<br>\n이렇게 @Entity 가 붙은 객체를 JPA에서는 엔티티라 한다.</p>\n<p>@Id : 테이블의 PK와 해당 필드를 매핑한다.</p>\n<p>@GeneratedValue(strategy = GenerationType.IDENTITY) : PK 생성 값을 데이터베이스에서 생성하는 IDENTITY 방식을 사용한다. 예) MySQL auto increment</p>\n<p>@Column : 객체의 필드를 테이블의 컬럼과 매핑한다.<br>\nname = “item_name” : 객체는 itemName 이지만 테이블의 컬럼은 item_name 이므로 이렇게 매핑.<br>\nlength = 10 : JPA의 매핑 정보로 DDL( create table )도 생성할 수 있는데, 그때 컬럼의 길이 값으로 활용된다. ( varchar 10 )</p>\n<p>@Column 을 생략할 경우 필드의 이름을 테이블 컬럼 이름으로 사용한다.<br>\n참고로 지금처럼 스프링 부트와 통합해서 사용하면 필드 이름을 테이블 컬럼 명으로 변경할 때 객체 필드의 카멜 케이스를 테이블 컬럼의 언더스코어로 자동으로 변환해준다.<br>\nitemName item_name , 따라서 위 예제의 @Column(name = “item_name”) 를 생략해도 된다.</p>\n<p>JPA는 public 또는 protected 의 기본 생성자가 필수이다</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"90131694020658900000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@Slf4j\n@Repository\n@Transactional\npublic class JpaItemRepository implements ItemRepository {\n\n    private final EntityManager em;\n\n    public JpaItemRepository(EntityManager em) {\n        this.em = em;\n    }\n\n    @Override\n    public Item save(Item item) {\n        em.persist(item);\n        return item;\n    }\n\n    @Override\n    public void update(Long itemId, ItemUpdateDto updateParam) {\n        Item findItem = em.find(Item.class, itemId);\n        findItem.setItemName(updateParam.getItemName());\n        findItem.setPrice(updateParam.getPrice());\n        findItem.setQuantity(updateParam.getQuantity());\n    }\n\n    @Override\n    public Optional<Item> findById(Long id) {\n        Item item = em.find(Item.class, id);\n        return Optional.ofNullable(item);\n    }\n\n    @Override\n    public List<Item> findAll(ItemSearchCond cond) {\n        String jpql = &quot;select i from Item i&quot;;\n\n        Integer maxPrice = cond.getMaxPrice();\n        String itemName = cond.getItemName();\n\n        if (StringUtils.hasText(itemName) || maxPrice != null) {\n            jpql += &quot; where&quot;;\n        }\n\n        boolean andFlag = false;\n        List<Object> param = new ArrayList<>();\n        if (StringUtils.hasText(itemName)) {\n            jpql += &quot; i.itemName like concat('%',:itemName,'%')&quot;;\n            param.add(itemName);\n            andFlag = true;\n        }\n\n        if (maxPrice != null) {\n            if (andFlag) {\n                jpql += &quot; and&quot;;\n            }\n            jpql += &quot; i.price <= :maxPrice&quot;;\n            param.add(maxPrice);\n        }\n\n        log.info(&quot;jpql={}&quot;, jpql);\n\n        TypedQuery<Item> query = em.createQuery(jpql, Item.class);\n        if (StringUtils.hasText(itemName)) {\n            query.setParameter(&quot;itemName&quot;, itemName);\n        }\n        if (maxPrice != null) {\n            query.setParameter(&quot;maxPrice&quot;, maxPrice);\n        }\n        return query.getResultList();\n    }\n}`, `90131694020658900000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"28\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Slf4j</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Repository</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Transactional</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">JpaItemRepository</span><span class=\"mtk1\"> </span><span class=\"mtk4\">implements</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ItemRepository</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">EntityManager</span><span class=\"mtk1\"> </span><span class=\"mtk12\">em</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">JpaItemRepository</span><span class=\"mtk1\">(</span><span class=\"mtk10\">EntityManager</span><span class=\"mtk1\"> </span><span class=\"mtk12\">em</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">em</span><span class=\"mtk1\"> = em;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Item</span><span class=\"mtk1\"> </span><span class=\"mtk11\">save</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Item</span><span class=\"mtk1\"> </span><span class=\"mtk12\">item</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">em</span><span class=\"mtk1\">.</span><span class=\"mtk11\">persist</span><span class=\"mtk1\">(item);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> item;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">update</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Long</span><span class=\"mtk1\"> </span><span class=\"mtk12\">itemId</span><span class=\"mtk1\">, </span><span class=\"mtk10\">ItemUpdateDto</span><span class=\"mtk1\"> </span><span class=\"mtk12\">updateParam</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Item</span><span class=\"mtk1\"> </span><span class=\"mtk12\">findItem</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">em</span><span class=\"mtk1\">.</span><span class=\"mtk11\">find</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Item</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">, itemId);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">findItem</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setItemName</span><span class=\"mtk1\">(</span><span class=\"mtk12\">updateParam</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getItemName</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">findItem</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setPrice</span><span class=\"mtk1\">(</span><span class=\"mtk12\">updateParam</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getPrice</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">findItem</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setQuantity</span><span class=\"mtk1\">(</span><span class=\"mtk12\">updateParam</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getQuantity</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Optional</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Item</span><span class=\"mtk1\">&gt; </span><span class=\"mtk11\">findById</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Long</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Item</span><span class=\"mtk1\"> </span><span class=\"mtk12\">item</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">em</span><span class=\"mtk1\">.</span><span class=\"mtk11\">find</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Item</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">, id);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Optional</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ofNullable</span><span class=\"mtk1\">(item);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Item</span><span class=\"mtk1\">&gt; </span><span class=\"mtk11\">findAll</span><span class=\"mtk1\">(</span><span class=\"mtk10\">ItemSearchCond</span><span class=\"mtk1\"> </span><span class=\"mtk12\">cond</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">jpql</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;select i from Item i&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Integer</span><span class=\"mtk1\"> </span><span class=\"mtk12\">maxPrice</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">cond</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMaxPrice</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">itemName</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">cond</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getItemName</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">StringUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">hasText</span><span class=\"mtk1\">(itemName) || maxPrice != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            jpql += </span><span class=\"mtk8\">&quot; where&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">boolean</span><span class=\"mtk1\"> </span><span class=\"mtk12\">andFlag</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">false</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Object</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">param</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ArrayList</span><span class=\"mtk1\">&lt;&gt;();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">StringUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">hasText</span><span class=\"mtk1\">(itemName)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            jpql += </span><span class=\"mtk8\">&quot; i.itemName like concat(&#39;%&#39;,:itemName,&#39;%&#39;)&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">param</span><span class=\"mtk1\">.</span><span class=\"mtk11\">add</span><span class=\"mtk1\">(itemName);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            andFlag = </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (maxPrice != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (andFlag) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                jpql += </span><span class=\"mtk8\">&quot; and&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            jpql += </span><span class=\"mtk8\">&quot; i.price &lt;= :maxPrice&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">param</span><span class=\"mtk1\">.</span><span class=\"mtk11\">add</span><span class=\"mtk1\">(maxPrice);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;jpql={}&quot;</span><span class=\"mtk1\">, jpql);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">TypedQuery</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Item</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">query</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">em</span><span class=\"mtk1\">.</span><span class=\"mtk11\">createQuery</span><span class=\"mtk1\">(jpql, </span><span class=\"mtk12\">Item</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">StringUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">hasText</span><span class=\"mtk1\">(itemName)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">query</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setParameter</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;itemName&quot;</span><span class=\"mtk1\">, itemName);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (maxPrice != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">query</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setParameter</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;maxPrice&quot;</span><span class=\"mtk1\">, maxPrice);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">query</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getResultList</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>private final EntityManager em : 생성자를 보면 스프링을 통해 엔티티 매니저( EntityManager )라는 것을 주입</p>\n<p>JPA의 모든 동작은 엔티티 매니저를 통해서 이루어진다.</p>\n<p>엔티티매니저는 내부에 데이터소스를 가지고 있고, 데이터베이스에 접근할 수 있다.</p>\n<p>@Transactional : JPA의 모든 데이터 변경(등록, 수정, 삭제)은 트랜잭션 안에서 이루어져야 한다.(항상 필요)<br>\n조회는 트랜잭션이 없어도 가능하다</p>\n<p>update</p>\n<ul>\n<li>JPA는 트랜잭션이 커밋되는 시점에, 변경된 엔티티 객체가 있는지 확인한다.</li>\n<li>특정 엔티티 객체가 변경된 경우에는 UPDATE SQL을 실행한다.</li>\n</ul>\n<p>JPQL이란</p>\n<p>JPA는 JPQL(Java Persistence Query Language)이라는 객체지향 쿼리 언어를 제공한다.<br>\n주로 여러 데이터를 복잡한 조건으로 조회할 때 사용한다</p>\n<h4 id=\"jpa-예외-변환\" style=\"position:relative;\"><a href=\"#jpa-%EC%98%88%EC%99%B8-%EB%B3%80%ED%99%98\" aria-label=\"jpa 예외 변환 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JPA 예외 변환</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/40b1af877fb6cb1690f79f32df5516c6/fcbeb/prev.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.22085889570552%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABOElEQVR42l2RzU/CUBDE+/8f9IQJatQYjxoTiTcPXgyiKFEJoiK0r0ALilLSwvJe+36m9SPEuczuTnaSnXXIYW1BcfOO4d4mceUIOTnEvLSLOVlWUPLUor9bJj49RipHmNY9q/s5nKUIRmtEa6LOM/P6JfNGneS6ivR9UmtJjWEuQux7LOo15rfXhb5ULqml0HMPay3O2+eU8XRKRyk+koRJnCDWIoAfBCjPw3Vduq+vdJVittQs82vSDHcYoIYBXhDQH40wxuCMWk3eWw8MGzdM2o+8hyGyELQIYRDg/Rgqpej1esyiqNBEhEG3i3t1Sad6gVuroschTniwQ7+0xmBjHX+rhImiv1zyE7IsK3i1/s1MD3zG2yUme2Xi/S3k/AwnjzvPKbPfvAr7r/+PXE+0ZmHM31O+AHc2wiHzl2CPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/40b1af877fb6cb1690f79f32df5516c6/a81b5/prev.webp 163w,\n/static/40b1af877fb6cb1690f79f32df5516c6/da3ef/prev.webp 325w,\n/static/40b1af877fb6cb1690f79f32df5516c6/309d5/prev.webp 650w,\n/static/40b1af877fb6cb1690f79f32df5516c6/78344/prev.webp 975w,\n/static/40b1af877fb6cb1690f79f32df5516c6/4cc08/prev.webp 1206w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/40b1af877fb6cb1690f79f32df5516c6/5e043/prev.png 163w,\n/static/40b1af877fb6cb1690f79f32df5516c6/e5cc6/prev.png 325w,\n/static/40b1af877fb6cb1690f79f32df5516c6/663f3/prev.png 650w,\n/static/40b1af877fb6cb1690f79f32df5516c6/d880f/prev.png 975w,\n/static/40b1af877fb6cb1690f79f32df5516c6/fcbeb/prev.png 1206w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/40b1af877fb6cb1690f79f32df5516c6/663f3/prev.png\"\n            alt=\"prev\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/44e725ac592988036df74c0dcd167d25/95fbb/next.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.96932515337423%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABf0lEQVR42mWRbW/TMBSF8/vhbyCgX6YJBi0bSkUryLpWZdU6St/ShaVdWycpWV7aJLYflHTsAxzp2PJj+1q+x9BoSkVZSHNWx5yc0Vk1Cfai4o831wQXdTKrRfHjpmJhr0NonpOXbDauGPpYx5BKUkjJLvH5Mv2EtTC5vGsiovXxodGQ+LJN2rXYj25RGpLhgEerRdL5ymE2RmmNKnK0lBhxFJP8TtncC+JdQhqmkIPYekwmY2aOQ5hlxIVk4S6xbZup84v5aokXJ9wLj7m7xNls2UURxmb3QGveoGU3MKdnuL5DUUjsuwWdXpf+9z6u65JnGb4nEELgex7b9QPp4YA36LN6f8LywymB1cYIYo/G4JT69QkXw3f4iUAXirxpktbecKi9JeteUZTfUurZUsqqJel8wvr8I5HVpvh5i6GfmvlX5TrLM8xRjVffXvDaeknP+YxWx71/VRL5NFehlClrrcoRVd4qD0hJkAZ4ex+RCsJ9iFb/F3tOt7RSlf8An9wKZ2djOP8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/44e725ac592988036df74c0dcd167d25/a81b5/next.webp 163w,\n/static/44e725ac592988036df74c0dcd167d25/da3ef/next.webp 325w,\n/static/44e725ac592988036df74c0dcd167d25/309d5/next.webp 650w,\n/static/44e725ac592988036df74c0dcd167d25/78344/next.webp 975w,\n/static/44e725ac592988036df74c0dcd167d25/e0c4a/next.webp 1172w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/44e725ac592988036df74c0dcd167d25/5e043/next.png 163w,\n/static/44e725ac592988036df74c0dcd167d25/e5cc6/next.png 325w,\n/static/44e725ac592988036df74c0dcd167d25/663f3/next.png 650w,\n/static/44e725ac592988036df74c0dcd167d25/d880f/next.png 975w,\n/static/44e725ac592988036df74c0dcd167d25/95fbb/next.png 1172w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/44e725ac592988036df74c0dcd167d25/663f3/next.png\"\n            alt=\"next\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ul>\n<li>EntityManager 는 순수한 JPA 기술이고, 스프링과는 관계가 없다. 따라서 엔티티 매니저는 예외가 발생하면 JPA 관련 예외를 발생시킨다.</li>\n<li>JPA는 PersistenceException 과 그 하위 예외를 발생시킨다.\n<ul>\n<li>추가로 JPA는 IllegalStateException , IllegalArgumentException 을 발생시킬 수 있다</li>\n</ul>\n</li>\n<li>@Repository의 기능\n<ul>\n<li>@Repository 가 붙은 클래스는 컴포넌트 스캔의 대상이 된다.</li>\n<li>@Repository 가 붙은 클래스는 예외 변환 AOP의 적용 대상이 된다.\n<ul>\n<li>스프링과 JPA를 함께 사용하는 경우 스프링은 JPA 예외 변환기 (PersistenceExceptionTranslator)를 등록한다.</li>\n<li>예외 변환 AOP 프록시는 JPA 관련 예외가 발생하면 JPA 예외 변환기를 통해 발생한 예외를 스프링 데이터 접근 예외로 변환한다</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"5-spring-data-jpa\" style=\"position:relative;\"><a href=\"#5-spring-data-jpa\" aria-label=\"5 spring data jpa permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. Spring Data JPA</h1>\n<ul>\n<li>스프링 데이터 JPA는 JPA를 편리하게 사용할 수 있도록 도와주는 라이브러리</li>\n<li>수많은 편리한 기능을 제공하지만 가장 대표적인 기능은 다음과 같다.\n<ul>\n<li>공통 인터페이스 기능</li>\n<li>쿼리 메소드 기능\n<ul>\n<li>메소드 이름으로 쿼리를 자동으로 만들어주고 실행해주는 기능\n<ul>\n<li>조회: find…By , read…By , query…By , get…By\n<ul>\n<li>예:) findHelloBy 처럼 …에 식별하기 위한 내용(설명)이 들어가도 된다.</li>\n</ul>\n</li>\n<li>COUNT: count…By 반환타입 long</li>\n<li>EXISTS: exists…By 반환타입 boolean</li>\n<li>삭제: delete…By , remove…By 반환타입 long</li>\n<li>DISTINCT: findDistinct , findMemberDistinctBy</li>\n<li>LIMIT: findFirst3 , findFirst , findTop , findTop3</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>직접 JPQL을 사용하고 싶을 경우엔 <code>@Query</code>와 함꼐 JPQL작성</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"6-querydsl\" style=\"position:relative;\"><a href=\"#6-querydsl\" aria-label=\"6 querydsl permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. QueryDSL</h1>\n<p>Query의 문제점</p>\n<ul>\n<li>Query는 문자, Type-check불가능</li>\n<li>실행하기 전까지 작동여부 확인 불가</li>\n<li>에러는 크게 컴파일 에러, 런타임 에러</li>\n<li>QueryDSL은 <strong>컴파일 시 컴파일 오류 발생</strong></li>\n<li>QueryDSL은 <strong>동적 쿼리 작성에 용이</strong></li>\n<li>Java Code로 작성하기에 모듈화가 가능하다.</li>\n<li>DSL\n<ul>\n<li>도메인 + 특화 + 언어</li>\n<li>특정한 도메인에 초점을 맞춘 제한적인 표현력을 가진 컴퓨터 프로그래밍 언어</li>\n<li>특징 : 단순, 간결, 유창\n<ul>\n<li>QueryDSL : 쿼리 + 도메인 + 특화 + 언어</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>데이터 쿼리 추상화</li>\n</ul>\n<h1 id=\"7-데이터-접근-기술---활용-방안\" style=\"position:relative;\"><a href=\"#7-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%91%EA%B7%BC-%EA%B8%B0%EC%88%A0---%ED%99%9C%EC%9A%A9-%EB%B0%A9%EC%95%88\" aria-label=\"7 데이터 접근 기술   활용 방안 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. 데이터 접근 기술 - 활용 방안</h1>\n<ul>\n<li>DI, OCP를 지키기 위해 어댑터를 도입하고, 더 많은 코드를 유지한다.</li>\n<li>어댑터를 제거하고 구조를 단순하게 가져가지만, DI, OCP를 포기하고, ItemService 코드를 직접 변경한다.</li>\n</ul>\n<p>=> 결국 여기서 발생하는 트레이드 오프는 구조의 안정성 vs 단순한 구조와 개발의 편리성 사이의 선택이다.</p>\n<p>어설픈 추상화는 오히려 독이된다</p>\n<p>무엇보다 <strong>추상화도 비용이 든다.</strong></p>\n<hr>\n<h4 id=\"실용적인-구조\" style=\"position:relative;\"><a href=\"#%EC%8B%A4%EC%9A%A9%EC%A0%81%EC%9D%B8-%EA%B5%AC%EC%A1%B0\" aria-label=\"실용적인 구조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>실용적인 구조</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5b1ef5217410a5bc62b1ca75438a575c/cda85/querydsl.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.533742331288344%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABM0lEQVR42pVSDauCQBC8//+nkgJBCRUhSAM/SyvtS0UErYlZuIcPetBbGPbWu5vdm1Hhi3i9XpKrqkKe5zidTjifzz9gvd/vZV/pw59INBjjOKIsS6nTNMVqtcJyuYRpmsiyTM6wmdKXn8/nL2girvu+x/V6RRAEuN1uWK/XsCwLtm3L2nEc1HUtUyp25YK5KAocj0dZJ0kiNQ/e73c8Hg8hI3a7HRaLhUxnGIaQXi4XdF0HxTEZnufBdV34vi8EbduKJnMN50EJpmkSzPcVJ+KE1IHk1OdwOMiEzCRnZxJ8E0rrNzdB68gYhkGeySdtt1tpomVhJugyv/Pcny5/+m2iKBJjqCHzZrNBGIYC7vFV6hsyPS2niONYLlIaQtfMNFHhH0EDaBZBE+kyjaTGTdOIzm98UPlrFwL2KQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5b1ef5217410a5bc62b1ca75438a575c/a81b5/querydsl.webp 163w,\n/static/5b1ef5217410a5bc62b1ca75438a575c/da3ef/querydsl.webp 325w,\n/static/5b1ef5217410a5bc62b1ca75438a575c/309d5/querydsl.webp 650w,\n/static/5b1ef5217410a5bc62b1ca75438a575c/0743e/querydsl.webp 928w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5b1ef5217410a5bc62b1ca75438a575c/5e043/querydsl.png 163w,\n/static/5b1ef5217410a5bc62b1ca75438a575c/e5cc6/querydsl.png 325w,\n/static/5b1ef5217410a5bc62b1ca75438a575c/663f3/querydsl.png 650w,\n/static/5b1ef5217410a5bc62b1ca75438a575c/cda85/querydsl.png 928w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5b1ef5217410a5bc62b1ca75438a575c/663f3/querydsl.png\"\n            alt=\"querydsl\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>단순 조회는 스프링 데이터 JPA가 담당하고, 복잡한 조회 쿼리는 QueryDSL이 담당한다.</p>\n<h4 id=\"다양한-데이터-접근-기술-조합\" style=\"position:relative;\"><a href=\"#%EB%8B%A4%EC%96%91%ED%95%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%91%EA%B7%BC-%EA%B8%B0%EC%88%A0-%EC%A1%B0%ED%95%A9\" aria-label=\"다양한 데이터 접근 기술 조합 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>다양한 데이터 접근 기술 조합</h4>\n<ul>\n<li>실무에선 95% 정도는 JPA, 스프링 데이터 JPA, QueryDSL등으로 해결하고, 나머지 5%는 SQL을 직접 사용해야 하니 JDBCTemplate or MyBatis로 해결</li>\n<li>트랜잭션 매니저 선택\n<ul>\n<li>모두 JPA기술을 사용하니 <code>JpaTransactionManager</code>사용</li>\n<li>JPA기술을 사용하면 스프링 부타는 자동으로 <code>JpaTransactionManager</code>를 스프링 빈에 등록</li>\n<li>JdbcTemplate, MyBatis는 내부에서 직접 SDBC를 사용해서 <code>DataSourceTransactionManager</code>를 사용\n<ul>\n<li><code>JpaTransactionManager</code>는 <code>DataSourceTransactionManager</code>가 제공하는 기능을 대부분 제공\n<ul>\n<li>내부에서는 DataSource와 JDBC커넥션을 사용하기 떄문</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>=> 결과적으로 <code>JpaTransactionManager</code>를 하나만 스프링 빈에 등록하면 JPA, JdbcTemplate, MyBatis 모두를 하나의 트랜잭션으로 묶어서 사용이 가능 (롤백도 가능)</p>\n<p>이렇게 사용할 경우에 JPA의 플러시 타이밍에 주의</p>\n<p>JPA는 데이터 변경 사항을 즉시 DB에 반영하지 않는다.</p>\n<p>하나의 트랜잭션 안에서 JPA를 통해 데이터를 변경한 다음 JdbcTemplate를 호출하는 경우 JPA가 변경한 데이터를 읽지 못하는 경우 생김</p>\n<p>JPA변경 내역을 플러시 기능을 사용해 반영해줘야 사용 가능</p>\n<h1 id=\"8-스프링-트랜잭션-이해\" style=\"position:relative;\"><a href=\"#8-%EC%8A%A4%ED%94%84%EB%A7%81-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%9D%B4%ED%95%B4\" aria-label=\"8 스프링 트랜잭션 이해 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8. 스프링 트랜잭션 이해</h1>\n<h4 id=\"트랜잭션-적용-확인\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%A0%81%EC%9A%A9-%ED%99%95%EC%9D%B8\" aria-label=\"트랜잭션 적용 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션 적용 확인</h4>\n<ul>\n<li>AOP기반으로 동작하기에 눈으로 확인이 어렵다.</li>\n<li>실제로 <code>@Transactinal</code>을 사용하고, 주입받은 클래스를 <code>getClass()</code>로 찍어보면 프록시 객체가 나온다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/da8ce8b3de3cac54fab046a6edc3f1cd/4cff2/SpringContainerTransactionProxy.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.46625766871166%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABzUlEQVR42o2RS2sTURiG8w9ci4j4H8SFQd3kLyh4Q3GpCzcuBNGFoCJVBPFCFlYxK0VFsFAbFQXrRqpV0+YySVo7k6SZSWvaSTLTmTnnPDLTpGbUgu/h49xeHs77nQTKR0kfpQJQAZZlUq1W0XUd3/cRQtBzeyw2Gxh1g+X2En7goZQilFQSoYKolJIk6EsqcAUIqQZHeL6HtdjCaXnYZo9Vs4vXFnSWuriuG3kG4IES3tQpjPdnmZs4jf/lDGJVI5AgRIDwJIXGdx7WrvGgNMKj4k0yjetka09xu2sR4OvKR+7lLpGeuUzFmSHRebKFz3d3kEtvx32xFaf2joVai3K5yE+zzQcty9E3SY692seh50kOjO/ixqdzaPkKTcPkWfk+B1/u5shEkklrfD2y6tdGfCmj3oWzri+gFSo0dRO9ajCnzVPIF7BtO4obRVa/IQn+0Iapv5ZC4QQdSvY38svTmGsGSsQ9sR7G8MQvwx8MNd2eJPV4J3sz27hTuti/E+vAoRHu/nrhvxQonx8rGqVWjrplEDhyU++mQNV/3bxTZNS4wujsCOmpq9yaPc9YPRPz/BdwOO7xt/s5+TrFibEUh7N7uK1diHmGgb8AD0ng3lCOmwEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/da8ce8b3de3cac54fab046a6edc3f1cd/a81b5/SpringContainerTransactionProxy.webp 163w,\n/static/da8ce8b3de3cac54fab046a6edc3f1cd/da3ef/SpringContainerTransactionProxy.webp 325w,\n/static/da8ce8b3de3cac54fab046a6edc3f1cd/309d5/SpringContainerTransactionProxy.webp 650w,\n/static/da8ce8b3de3cac54fab046a6edc3f1cd/78344/SpringContainerTransactionProxy.webp 975w,\n/static/da8ce8b3de3cac54fab046a6edc3f1cd/bdb72/SpringContainerTransactionProxy.webp 1300w,\n/static/da8ce8b3de3cac54fab046a6edc3f1cd/3c61e/SpringContainerTransactionProxy.webp 1404w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/da8ce8b3de3cac54fab046a6edc3f1cd/5e043/SpringContainerTransactionProxy.png 163w,\n/static/da8ce8b3de3cac54fab046a6edc3f1cd/e5cc6/SpringContainerTransactionProxy.png 325w,\n/static/da8ce8b3de3cac54fab046a6edc3f1cd/663f3/SpringContainerTransactionProxy.png 650w,\n/static/da8ce8b3de3cac54fab046a6edc3f1cd/d880f/SpringContainerTransactionProxy.png 975w,\n/static/da8ce8b3de3cac54fab046a6edc3f1cd/4c573/SpringContainerTransactionProxy.png 1300w,\n/static/da8ce8b3de3cac54fab046a6edc3f1cd/4cff2/SpringContainerTransactionProxy.png 1404w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/da8ce8b3de3cac54fab046a6edc3f1cd/663f3/SpringContainerTransactionProxy.png\"\n            alt=\"SpringContainerTransactionProxy\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ul>\n<li><code>@Transactional</code>어노테이션이 특정 클래스나 메서드에 하나라도 있으면 트랜잭션 AOP는 프록시를 만들어 스프링 컨테이너에 등록한다.</li>\n<li>클라이언트인 <code>txBasicTest</code>는 스프링 컨테이너에 의족관계 주입을 요청한다.</li>\n<li>스프링 컨테이너에서는 실제 객체 대신 프록시가 스프링 빈으로 등록되어 있기 때문에 프록시를 주입한다.</li>\n</ul>\n<h4 id=\"트랜잭션-적용-위치\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%A0%81%EC%9A%A9-%EC%9C%84%EC%B9%98\" aria-label=\"트랜잭션 적용 위치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션 적용 위치</h4>\n<ul>\n<li>스프링에서 우선순위는 항상 <strong>더 구체적이고 자세한 것이 높은 우선순위를 가진다.</strong></li>\n</ul>\n<p>스프링의 @Transactional 은 다음 두 가지 규칙이 있다.</p>\n<ol>\n<li>우선순위 규칙</li>\n<li>클래스에 적용하면 메서드는 자동 적용</li>\n</ol>\n<h4 id=\"인터페이스에도-transactional적용\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4%EC%97%90%EB%8F%84-transactional%EC%A0%81%EC%9A%A9\" aria-label=\"인터페이스에도 transactional적용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인터페이스에도 @Transactional적용</h4>\n<p>인터페이스에도 <code>@Transactional</code>을 적용할 수 있다.</p>\n<p>우선순위는 다음과 같다.</p>\n<ol>\n<li>클래스의 메서드 (우선순위가 높다.)</li>\n<li>클래스의 타입</li>\n<li>인터페이스의 메서드</li>\n<li>인터페이스 타입</li>\n</ol>\n<p>인터페이스에 <code>@Transactional</code> 사용하는 것은 스프링 공식 메뉴얼에서 권장하는 사항이 아니다.</p>\n<p>AOP가 적용되지 않는 경우도 있기 떄문이다.</p>\n<p>가급적 <strong>구현 클래스에서 <code>@Transactional</code>을 사용하자</strong></p>\n<h4 id=\"트랜잭션-aop-주의사항---프록시-내부-호출\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-aop-%EC%A3%BC%EC%9D%98%EC%82%AC%ED%95%AD---%ED%94%84%EB%A1%9D%EC%8B%9C-%EB%82%B4%EB%B6%80-%ED%98%B8%EC%B6%9C\" aria-label=\"트랜잭션 aop 주의사항   프록시 내부 호출 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션 AOP 주의사항 - 프록시 내부 호출</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dfd2d7ba1a7b21568a49d3c1a336eae4/a20ca/transactionSuccess.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.036809815950924%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABNUlEQVR42q1RTU+DQBDtf/bmL/Bk4l/w6lnjwVMPNbRiKaVpEGqIksKyC1IL8rm8hjGLNpp4cZKXTGbevJ15O8I/x0glXdcNxaZpEEUMQnDwKEK231O9bVuClJI432cGwZ7QN3vUdY2qqmhg8+xBny/waJh4S1MiM8agaRrBNE0SV8so8ZFhGFiv1/A8D77vIwxDZHmOPOVoM4E8ZcizdyInSYKiKCiP45ge/7GhEIKau92OCGVZYeM6MMfXcLVbzO+uYGhjRFxg9jDD0lrCtm1Mp1MEQUCznHPKy7L83UMpW/j+KyaTCZwnB2zL8JEVqIoajuNA13W6pLdI+ao8PRLs0funTlpZK1ibBV5SF/bWQlyx4UP+/OXj6NDKT8PHwQ3O7k9wPjvF5fICjWyGBaT8ghI8AD7iZBq18x8fAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/dfd2d7ba1a7b21568a49d3c1a336eae4/a81b5/transactionSuccess.webp 163w,\n/static/dfd2d7ba1a7b21568a49d3c1a336eae4/da3ef/transactionSuccess.webp 325w,\n/static/dfd2d7ba1a7b21568a49d3c1a336eae4/309d5/transactionSuccess.webp 650w,\n/static/dfd2d7ba1a7b21568a49d3c1a336eae4/78344/transactionSuccess.webp 975w,\n/static/dfd2d7ba1a7b21568a49d3c1a336eae4/bdb72/transactionSuccess.webp 1300w,\n/static/dfd2d7ba1a7b21568a49d3c1a336eae4/8a635/transactionSuccess.webp 1428w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/dfd2d7ba1a7b21568a49d3c1a336eae4/5e043/transactionSuccess.png 163w,\n/static/dfd2d7ba1a7b21568a49d3c1a336eae4/e5cc6/transactionSuccess.png 325w,\n/static/dfd2d7ba1a7b21568a49d3c1a336eae4/663f3/transactionSuccess.png 650w,\n/static/dfd2d7ba1a7b21568a49d3c1a336eae4/d880f/transactionSuccess.png 975w,\n/static/dfd2d7ba1a7b21568a49d3c1a336eae4/4c573/transactionSuccess.png 1300w,\n/static/dfd2d7ba1a7b21568a49d3c1a336eae4/a20ca/transactionSuccess.png 1428w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/dfd2d7ba1a7b21568a49d3c1a336eae4/663f3/transactionSuccess.png\"\n            alt=\"transactionSuccess\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>정상 호출</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/418050e7b77600c607f23f8c4276e0b6/fa6a4/transactionError.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.288343558282207%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABBklEQVR42nVQa2uEMBD0/+Nn8c+UflOwqeWu1R4FqW8SX1FPFD11ygY82oMOLJtkN7szo23bhtvthmVZVCbs+67yOI4wTRO6rsMwDHRdd68fPY/Qfl+oaZomNXgYBgjB0UqJLMtUnQYWRYE8z9H3/Z/l94H0sSxL1HWtIk1TxHEM//MC//KF04eHF8ZQVSUYY3BdF5ZlwfM8kLp1XXGopKzRxjAMEUURmqZRW7YdaEWMNnqH/D7jWnMQDyGEsoGYcs4V2yRJlIIgCCClhHY0UJCPB/qK42Q/4816wlWW6o2kOo4D27bh+z7meVaSiSUFnbVHUw9H5mWBZdlg7FVJOUDMyJr/8APDucb3rXKBpwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/418050e7b77600c607f23f8c4276e0b6/a81b5/transactionError.webp 163w,\n/static/418050e7b77600c607f23f8c4276e0b6/da3ef/transactionError.webp 325w,\n/static/418050e7b77600c607f23f8c4276e0b6/309d5/transactionError.webp 650w,\n/static/418050e7b77600c607f23f8c4276e0b6/78344/transactionError.webp 975w,\n/static/418050e7b77600c607f23f8c4276e0b6/bdb72/transactionError.webp 1300w,\n/static/418050e7b77600c607f23f8c4276e0b6/66029/transactionError.webp 1412w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/418050e7b77600c607f23f8c4276e0b6/5e043/transactionError.png 163w,\n/static/418050e7b77600c607f23f8c4276e0b6/e5cc6/transactionError.png 325w,\n/static/418050e7b77600c607f23f8c4276e0b6/663f3/transactionError.png 650w,\n/static/418050e7b77600c607f23f8c4276e0b6/d880f/transactionError.png 975w,\n/static/418050e7b77600c607f23f8c4276e0b6/4c573/transactionError.png 1300w,\n/static/418050e7b77600c607f23f8c4276e0b6/fa6a4/transactionError.png 1412w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/418050e7b77600c607f23f8c4276e0b6/663f3/transactionError.png\"\n            alt=\"transactionError\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>external() 메서드에서 @Transactional이 적용된 proxy객체인 internal이 아니라</p>\n<p>내부의 internal() 메소드를 호출하면 내부 호출이 되어 프록시를 거치지 않아 <strong>트랜잭션이 적용되지 않는다.</strong></p>\n<p>내부 호출로 인해 트랜잭션이 적용되지 않는 것은 프록시 방식의 AOP 한계이다.</p>\n<p>문제를 해결하는 방법은 내부 호출을 피하기 위해 <strong>메서드를 별도의 클래스로 분리</strong>하는 것이다.</p>\n<p>아래와 같이 <strong>내부 호출을 외부 호출로 변경</strong>한다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/af435aff59ed2c9da0f74c5b5119e31b/7daeb/transactionFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.171779141104295%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABJUlEQVR42pVRa2+DMAzk//+ufan4uE6CdqyBAAXCm/KYCtx03qiqqdNUS5YSJz7fna11XcFclgVblGWJMAyRJMmtvv27z0dheZ6H4/EIY4wUpmmC1hpVVcH3fbk/ExablFKI4xjDMCAIAriuiyzLsN/vEUUR+r6Xe57nqOtazkVRPAZs2xZd12EcRynM8yyglEymTdOIdNpAFefzGaHWAsqgJdfrVfp4tu7RN1843XEcYcTgMOY0fcLkBaq6Qd208sY/VEgSVGP9Z/JW7y4XnNxXmION9O0FqXJwGUb4SgkBei6Af4H8HrKsKwLlIdEfiNUB+vSOsqpuftMOWmQ9s8G+H6QxMwZN+y2ZO6CvaZoK06cA6aNt29jtdrLtHzmyMErmlr8ADm62YuNbBeMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/af435aff59ed2c9da0f74c5b5119e31b/a81b5/transactionFlow.webp 163w,\n/static/af435aff59ed2c9da0f74c5b5119e31b/da3ef/transactionFlow.webp 325w,\n/static/af435aff59ed2c9da0f74c5b5119e31b/309d5/transactionFlow.webp 650w,\n/static/af435aff59ed2c9da0f74c5b5119e31b/78344/transactionFlow.webp 975w,\n/static/af435aff59ed2c9da0f74c5b5119e31b/bdb72/transactionFlow.webp 1300w,\n/static/af435aff59ed2c9da0f74c5b5119e31b/5e94d/transactionFlow.webp 1386w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/af435aff59ed2c9da0f74c5b5119e31b/5e043/transactionFlow.png 163w,\n/static/af435aff59ed2c9da0f74c5b5119e31b/e5cc6/transactionFlow.png 325w,\n/static/af435aff59ed2c9da0f74c5b5119e31b/663f3/transactionFlow.png 650w,\n/static/af435aff59ed2c9da0f74c5b5119e31b/d880f/transactionFlow.png 975w,\n/static/af435aff59ed2c9da0f74c5b5119e31b/4c573/transactionFlow.png 1300w,\n/static/af435aff59ed2c9da0f74c5b5119e31b/7daeb/transactionFlow.png 1386w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/af435aff59ed2c9da0f74c5b5119e31b/663f3/transactionFlow.png\"\n            alt=\"transactionFlow\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>다른 해결방안도 있지만, 실무에서는 이렇게 별도의 클래스로 분리하는 방법을 주로 사용한다.</p>\n<h4 id=\"트랜잭션-aop-주의사항---public-메서드에만-트랜잭션-적용\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-aop-%EC%A3%BC%EC%9D%98%EC%82%AC%ED%95%AD---public-%EB%A9%94%EC%84%9C%EB%93%9C%EC%97%90%EB%A7%8C-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%A0%81%EC%9A%A9\" aria-label=\"트랜잭션 aop 주의사항   public 메서드에만 트랜잭션 적용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션 AOP 주의사항 - public 메서드에만 트랜잭션 적용</h4>\n<p>스프링 트랜잭션 AOP기능은 <code>public</code>메서드에만 트랜잭션을 적용하게 기본 설정이 되어있다.</p>\n<p>트랜잭션을 의도하지 않는 곳까지 과도하게 적용되지 않게 하기 위해 <code>public</code>에만 적용하도록 설정<br>\n(private나 protected같은 경우 트랜잭션을 사용하지 않을 의도를 가질 확률이 높음)</p>\n<h4 id=\"트랜잭션-aop-주의사항---초기화-시점\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-aop-%EC%A3%BC%EC%9D%98%EC%82%AC%ED%95%AD---%EC%B4%88%EA%B8%B0%ED%99%94-%EC%8B%9C%EC%A0%90\" aria-label=\"트랜잭션 aop 주의사항   초기화 시점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션 AOP 주의사항 - 초기화 시점</h4>\n<p>초기화 코드가 먼저 호출되고, 그 다음에 트랜잭션 AOP가 적용되기 떄문에 초기화 시점에는 트랜잭션 획득 불가능</p>\n<h4 id=\"트랜잭션-옵션-소개\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%98%B5%EC%85%98-%EC%86%8C%EA%B0%9C\" aria-label=\"트랜잭션 옵션 소개 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션 옵션 소개</h4>\n<p>트랜잭션을 사용할 때 트랜잭션 매니저를 주입받아 사용한다.</p>\n<p><code>@Transactional</code>에서도 트랜잭션 프록시가 사용할 매니저를 지정해주어야 한다.</p>\n<p>트랜잭션 매니저를 지정할 때는 <code>value</code>, <code>transactionManager</code>둘 중 하나에 트랜잭션 매니저의 스프링 빈의 이름을 적어주면 된다.</p>\n<p>이 값을 생략하면 기본적으로 등록된 트랜잭션 매니저를 사용하기에 대부분 생략한다.</p>\n<p>트랜잭션 매니저가 2개 이상이라면 다음과 같이 트랜잭션 매니저의 이름을 지정해서 구분한다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"37819938645161665000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`public class TxService {\n    // value는 생략이 가능\n    // @Transactional(&quot;memberTxManager&quot;)\n    @Transactional(value = &quot;memberTxManager&quot;)\n    public void member() {...}\n\n    @Transactional(&quot;orderTxManager&quot;)\n    public void order() {...}\n}`, `37819938645161665000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"29\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">TxService</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// value는 생략이 가능</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// @Transactional(&quot;memberTxManager&quot;)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Transactional</span><span class=\"mtk1\">(value = </span><span class=\"mtk8\">&quot;memberTxManager&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">member</span><span class=\"mtk1\">() {...}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Transactional</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;orderTxManager&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">order</span><span class=\"mtk1\">() {...}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"21066471352836280000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@Transactional(rollbackFor = Exception.class)`, `21066471352836280000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"30\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Transactional</span><span class=\"mtk1\">(rollbackFor = </span><span class=\"mtk12\">Exception</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<p>예외 발생 시 트랜잭션의 기본 정책은 다음과 같다.</p>\n<ul>\n<li>언체크 예외인 <code>RuntimeException</code>, <code>Error</code>와 하위 예외가 발생하면 롤백</li>\n<li>체크 예외인 <code>Exception</code>과 그 하위 예외는 커밋</li>\n</ul>\n<p>rollbackFor는 어떤 예외가 발생할 때 롤백하는지 지정할 수 있다.</p>\n<ul>\n<li>noRollBackFor : rollbackFor와 반대, 기본 저액에 추가로 어떤 예외가 발생했을 때 롤백하면 안되는지 지정</li>\n<li>propagation : 트랜잭션 전파에 대한 오변</li>\n<li>isolation : 트랜잭션 격리 수준을 지정 가능\n<ul>\n<li>DEFAULT : 데이터베이스에서 설정한 격리 수준을 따른다.</li>\n<li>READ_UNCOMMITTED : 커밋되지 않은 읽기</li>\n<li>READ_COMMITTED : 커밋된 읽기</li>\n<li>REPEATABLE_READ : 반복 가능한 읽기</li>\n<li>SERIALIZABLE : 직렬화 가능</li>\n</ul>\n</li>\n<li>timeout : 트랜잭션 수행시간에 대한 타임아웃을 초단위로 지정</li>\n<li>label : 트랜잭션 어노테이션 있는 값을 일거 어떤 동작을 하고 싶을 때 사용 (잘 사용 안함)</li>\n<li>readOnly : 기본적으로 읽기 쓰기가 모두 가능한 트랜잭션 생성\n<ul>\n<li>크게 3곳에 적용된다.\n<ul>\n<li>프레임워크\n<ul>\n<li>JdbcTemplate는 읽기전용 트랜잭션 안에서 변경 기능을 실행하면 예외를 던진다.</li>\n<li>JPA는 읽기 전용 트랜잭션의 경우 커밋시점에 플로시 호출x (추가적인 다양한 최적화 발생)</li>\n</ul>\n</li>\n<li>JDBC드라이버\n<ul>\n<li>아래의 내용들은 DB와 드라이버 버전에 따라 다르게 동작, 사전에 확인 필요</li>\n<li>읽기 전용 트랜잭션에서 변경 쿼리 발생 시 예외 던진다.</li>\n<li>읽기, 쓰기(마스터 , 슬레이브) DB를 구분해서 요청</li>\n<li>읽기 전용 트랜잭션의 경우 읽기 데이터베이스 커넥션 획득해서 사용</li>\n</ul>\n</li>\n<li>DB\n<ul>\n<li>읽기 전용 트랜잭션의 경우 읽기만 하면 되므로, 내부에서 성능 최적화 발생</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"예외와-트랜잭션-커밋-롤백\" style=\"position:relative;\"><a href=\"#%EC%98%88%EC%99%B8%EC%99%80-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%BB%A4%EB%B0%8B-%EB%A1%A4%EB%B0%B1\" aria-label=\"예외와 트랜잭션 커밋 롤백 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>예외와 트랜잭션 커밋, 롤백</h4>\n<ul>\n<li>예외 발생시 스프링 트랜잭션 AOP는 예외의 종류에 따라 트랜잭션을 커밋하거나 롤백한다.\n<ul>\n<li><strong>언체크 예외</strong>인 RuntimeException , Error 와 그 하위 예외가 발생하면 <strong>트랜잭션을 롤백</strong>한다.</li>\n<li><strong>체크 예외</strong>인 Exception 과 그 하위 예외가 발생하면 <strong>트랜잭션을 커밋</strong>한다.</li>\n</ul>\n</li>\n</ul>\n<p>스프링은 체크 예외는 커밋하고, 언체크(런타임) 예외는 롤백하는데 왜 이렇게 동작을 할까</p>\n<p>기본적으로 <strong>체크예외는 비즈니스 의미가 있을 때 사용하고, 런타임 예외는 복구 불가능한 예외로 가정</strong>한다.</p>\n<p>꼭 이런 정책을 따를 필요는 없고 <code>rollbackFor</code>옵션 사용해서 체크예외도 롤백하면 된다.</p>\n<p>비즈니스 예외</p>\n<ol>\n<li>정상: 주문시 결제를 성공하면 주문 데이터를 저장하고 결제 상태를 완료 로 처리한다.</li>\n<li>시스템 예외: 주문시 내부에 복구 불가능한 예외가 발생하면 전체 데이터를 롤백한다. (보통 런타임 예외로 처리한다.)</li>\n<li>비즈니스 예외: 주문시 결제 잔고가 부족하면 주문 데이터를 저장하고, 결제 상태를 대기 로 처리한다.<br>\n-> 이 경우 고객에게 잔고 부족을 알리고 별도의 계좌로 입금하도록 안내한다.</li>\n</ol>\n<p>정리</p>\n<ul>\n<li>비즈니스 상 오류 발생 -> 시스템이 정상동작 -> 트랜잭션을 커밋하는게 맞다</li>\n<li>체크 예외의 경우에도 트랜잭션 커밋하지 않고 롤백하고 싶다. -> <code>rollbackFor</code>옵션 사용</li>\n<li>런타임 예외는 항상 롤백된다\n<ul>\n<li>체크 예외인 경우에만 비즈니스 상황에 맞게 커밋과 롤백을 선택</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"9-스프링-트랜잭션-전파1---기본\" style=\"position:relative;\"><a href=\"#9-%EC%8A%A4%ED%94%84%EB%A7%81-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%A0%84%ED%8C%8C1---%EA%B8%B0%EB%B3%B8\" aria-label=\"9 스프링 트랜잭션 전파1   기본 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>9. 스프링 트랜잭션 전파1 - 기본</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ae0f8421ac6e930ac864887dd3618e8d/bcfad/doubleTransaction.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.09815950920245%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACjklEQVR42nWT247bVBSG56q8AX1NQEKlV6iPgYTKBWgEQppLJK4QKi0I6IQ5NPHEiRPHcXy2tw/bdhxvf8g7Q4fQsi7s5SWvT+vwrzPe2nB81gKVrunFltIz2Sc2Q+6i0g0qdxmKHRQ7/VbZhuHQ8m87e+AdgUq4dFKwcX1++vkFU2NOKWsUkOUlqSiIkpQ0lzSJC3V2UtDZA284hsqALNwxmxnc3tywXCzYbh26bo9lLXG3W+7uDIIwQngraIv3A8fAGKqjNbG/pawkWZaxWq1IkgQhBHme07YtQmSEUUJfxQz/rbDve+00Ta3bqXwL1VY6FkURpmni+z6e52noaFJWJKlgqFPUPXBQ6gicTqdMJhMMw0A2LciQPAmYzRe8mc6YGneEYUTT7nXC58+e8eSzp9rv8hAl09MKwzAkCAIcx0EUFcgYGaxxrDmBs8Q2p6S+Q+BYNEXCd18/55vnX0DfIj2TtojpekVZliilHmY4flSyJgu2NPYlnTMhn7+iXv3Bwb1C+deo3TWUFpRrBveKgz/VuS9+ecnjxx9ycXHxrmwOmUPibTCXlv5xbFvWNb1S5EVJHCd6BGleIaPNmMGr337ng0ePOD8/PwX+I5s8DlgsLYzZDNu29VL2+7324yjCWi5JRY7w1tCVVHWjJdV13alsdOuFTydzirLSmx23vNvtkFLqWedCEAYBW9fjUIQcyphmf3jPpdwD+9xjuJdNmiZsbJv1ek3g+0RRqA9AZBlxkuot16mnM4dBvXt6x5Z9ROxxeXXL5V/XvJ5csfP9t7L59MlTPvr4E+2PMCWT/7mU+6VQRVTOLa7xJ978NfbNr2T2GwJzQu0v+PH7r/jh2y/Hk6IPTYZ9dQL8GwQCHH0TzMkIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ae0f8421ac6e930ac864887dd3618e8d/a81b5/doubleTransaction.webp 163w,\n/static/ae0f8421ac6e930ac864887dd3618e8d/da3ef/doubleTransaction.webp 325w,\n/static/ae0f8421ac6e930ac864887dd3618e8d/309d5/doubleTransaction.webp 650w,\n/static/ae0f8421ac6e930ac864887dd3618e8d/78344/doubleTransaction.webp 975w,\n/static/ae0f8421ac6e930ac864887dd3618e8d/bdb72/doubleTransaction.webp 1300w,\n/static/ae0f8421ac6e930ac864887dd3618e8d/85310/doubleTransaction.webp 1396w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ae0f8421ac6e930ac864887dd3618e8d/5e043/doubleTransaction.png 163w,\n/static/ae0f8421ac6e930ac864887dd3618e8d/e5cc6/doubleTransaction.png 325w,\n/static/ae0f8421ac6e930ac864887dd3618e8d/663f3/doubleTransaction.png 650w,\n/static/ae0f8421ac6e930ac864887dd3618e8d/d880f/doubleTransaction.png 975w,\n/static/ae0f8421ac6e930ac864887dd3618e8d/4c573/doubleTransaction.png 1300w,\n/static/ae0f8421ac6e930ac864887dd3618e8d/bcfad/doubleTransaction.png 1396w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ae0f8421ac6e930ac864887dd3618e8d/663f3/doubleTransaction.png\"\n            alt=\"doubleTransaction\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>트랜잭션을 연속해서 S2번 사용하면 같은 커넥션을 사용한 것을 볼 수 있다.<br>\n-> 커넥션은 재사용, 프록시 객체의 주소가 다르기 때문에 각각 커넥션 풀에서 커넥션을 조회한 것이다.</p>\n<hr>\n<p>트랜잭션을 수행중인데 내부에서 트랜잭션을 중첩해서 사용한 경우</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/958716849ba71c645e2efe40a1620f35/d234e/transactionPropagation.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.263803680981596%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABa0lEQVR42mWRjXKbMBCEef936zidJk6MncSQgGwhMPoDAkhfC3bapr2ZlWZOp73du4S/I0bih18RBsc8WBg7Ol2zu7/j6ceG7fdv673kl5oFn3/i1JPcmK5nr5mrPUELohHg5YqxecOUKaZYsMOUtxp3hq5aa0NbMMuUJC6qQlgJg1UrlpDnE9uHBx6398zjB/+Gs4aX52fuNhtqJdfcrI5fFQbfEHTJZCRtVdKecmqRMTSCOLjfZMFWOFXQnt9oRIapCoJrmOsjyeFwIE1TtHX0lxN9lfGSPqGaC+l+T2scr4cUJXJabTDWUr7uyPOcQgiOxwxZ1WhVwiUjcc7hrGUKkdnVBF2gTu9UqkaUJXXdIMU7k28Jy3iI+EZwEiVnKRFCIGVF10pi82k53iwvhFYSesPoL8xdy+g1s2+IY/fHcm+Y/IWp08ydvjYbzNXyly376xxC1xKtIjpF9PW1kf8f6/sNYRHwa8s/ARNGZFsN6as2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/958716849ba71c645e2efe40a1620f35/a81b5/transactionPropagation.webp 163w,\n/static/958716849ba71c645e2efe40a1620f35/da3ef/transactionPropagation.webp 325w,\n/static/958716849ba71c645e2efe40a1620f35/309d5/transactionPropagation.webp 650w,\n/static/958716849ba71c645e2efe40a1620f35/78344/transactionPropagation.webp 975w,\n/static/958716849ba71c645e2efe40a1620f35/bdb72/transactionPropagation.webp 1300w,\n/static/958716849ba71c645e2efe40a1620f35/640c8/transactionPropagation.webp 1378w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/958716849ba71c645e2efe40a1620f35/5e043/transactionPropagation.png 163w,\n/static/958716849ba71c645e2efe40a1620f35/e5cc6/transactionPropagation.png 325w,\n/static/958716849ba71c645e2efe40a1620f35/663f3/transactionPropagation.png 650w,\n/static/958716849ba71c645e2efe40a1620f35/d880f/transactionPropagation.png 975w,\n/static/958716849ba71c645e2efe40a1620f35/4c573/transactionPropagation.png 1300w,\n/static/958716849ba71c645e2efe40a1620f35/d234e/transactionPropagation.png 1378w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/958716849ba71c645e2efe40a1620f35/663f3/transactionPropagation.png\"\n            alt=\"transactionPropagation\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ul>\n<li>스프링은 이해를 돕기 위해 논리 트랜잭션과 물리 트랜잭션이라는 개념을 나눈다.</li>\n<li>논리 트랜잭션들은 하나의 물리 트랜잭션으로 묶인다.</li>\n<li>물리 트랜잭션은 우리가 이해하는 실제 데이터베이스에 적용되는 트랜잭션을 뜻한다. 실제 커넥션을 통해서 트랜잭션을 시작( setAutoCommit(false)) 하고, 실제 커넥션을 통해서 커밋, 롤백하는 단위이다.</li>\n<li>논리 트랜잭션은 트랜잭션 매니저를 통해 트랜잭션을 사용하는 단위이다.</li>\n</ul>\n<p>논리 트랜잭션 개념을 도입해 단순한 원칙 2가지를 만든다.</p>\n<ol>\n<li>모든 논리 트랜잭션이 커밋되어야 물리 트랜잭션이 커밋된다.</li>\n<li>하나의 논리 트랜잭션이라도 롤백되면 물리 트랜잭션은 롤백된다.</li>\n</ol>\n<p>외부 트랜잭션에 내부트랜잭션이 있는경우 내부 트랜잭션은 새로운 트랜잭션이 생기지 않고 그대로 이어 받는다.</p>\n<p>외부 트랜잭션과 내부 트랜잭션이 <strong>하나의 물리 트랜잭션으로 묶이는 것</strong>이다.</p>\n<p>만약 내부 트랜잭션이 실제 물리 트랜잭션을 커밋하면 트랜잭션이 끝난다. -> 내부 트랜잭션은 물리 트랜잭션을 커밋하면 안된다.</p>\n<p>스프링은 이렇게 여러 트랜잭션이 함께 사용되는 경우, <strong>차음 트랜잭션을 시작한 외부 트랜잭션이 실제 물리 트랜잭션을 관리</strong>하도록 한다.</p>\n<p>요청 흐름</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b9a0e5fc8dc3f9d62d769a6e38be085b/a20ca/tx1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.828220858895705%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACBklEQVR42nWS2XKbQBBF9f+vSf4kqbxnkRLLkW2iaMUghNgFwmIdZuC4wHu5cqu6ZunuO317esQTOkURWmy0S4zFjLZIENmR5hxRpwHyHEIR45kLFrMxqW9BlSLuQmR2pD55tHnMKM9zDNMkcA/o80umFxdMxj/wnAO2tUPfrLF2JsFuhW8suPoz5ef3b+jbDdbOwDns2W7W7A2dOnEZtUpRi4amyimSAM8PCIKA/r4sS9L0Dv3WIHENVBZxjGPsw4GqqhBCDDFRdETXt9Spz6jrukHx+RQzn/0eCMMgwHEc0jQdfH2SzCLM5TW6rhPHMWEYDjFlUSCVQtQVXREzggdCUeZkR48gjEiSmLqukVI++IRAZUeK2BnIegV9hb21bYtoGlQjoExeCJUo2a3/sliuWC4Wb6rrE3u5WbhH07ShSsuyhod6ND2hfCZ8hBJs/10xu9aYz+fc3GhY1p69bZP3svr+2TrjyS/Gkwnj8QTP9ymrirpXIJv3hKlnYu8tHNvC1Df47oFWNsimpk4cqsQl9F0OlsnevB0mI/AcyvwMqqbNohfCrlV0ZQIyB5E9rmdkHnMX2mjTMWttSpm4qPIETYYqkmEG2/I0fEhXn19VyEM3X1uPoigQjeTzl698+PiJLC+IkwQpFVK1z3FPGL09du9MKYlh3LJerVgtl8O+n4D/5dwDzHdBg9J+SdYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b9a0e5fc8dc3f9d62d769a6e38be085b/a81b5/tx1.webp 163w,\n/static/b9a0e5fc8dc3f9d62d769a6e38be085b/da3ef/tx1.webp 325w,\n/static/b9a0e5fc8dc3f9d62d769a6e38be085b/309d5/tx1.webp 650w,\n/static/b9a0e5fc8dc3f9d62d769a6e38be085b/78344/tx1.webp 975w,\n/static/b9a0e5fc8dc3f9d62d769a6e38be085b/bdb72/tx1.webp 1300w,\n/static/b9a0e5fc8dc3f9d62d769a6e38be085b/8a635/tx1.webp 1428w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b9a0e5fc8dc3f9d62d769a6e38be085b/5e043/tx1.png 163w,\n/static/b9a0e5fc8dc3f9d62d769a6e38be085b/e5cc6/tx1.png 325w,\n/static/b9a0e5fc8dc3f9d62d769a6e38be085b/663f3/tx1.png 650w,\n/static/b9a0e5fc8dc3f9d62d769a6e38be085b/d880f/tx1.png 975w,\n/static/b9a0e5fc8dc3f9d62d769a6e38be085b/4c573/tx1.png 1300w,\n/static/b9a0e5fc8dc3f9d62d769a6e38be085b/a20ca/tx1.png 1428w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b9a0e5fc8dc3f9d62d769a6e38be085b/663f3/tx1.png\"\n            alt=\"tx1\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>응답 흐름</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c3e22d0f59eac6c5900ccae21f1e34f4/02f69/tx2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.44171779141104%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB70lEQVR42m2RWW/aQBRG+f+PVftPqva1T0nThIiGYNPgBQfMYrDxeJnxNnMqDCS0ypWuxvL3zbnLDMBwDCMPhM6E4c0Plo6FkSnqsKUWO+RhS5ssaPMdjjXqPSJaghKoNKLJ9qh0S5dHDBaLBa7nE4c+498jbm5vsadTfN9nuVwym83w/Dkr+57NYs7D44ifd3c4jtvrYbjCtqd484AqWTPouo5OG2oRURYZqRAIITj+V0pRFgV5UVJHLnWRUkpFHMdIKc8eSZFn5KWky/cMLiN3RQymo2lb1us1YRgSBAFlWZ70eI6pi/67KIpeP3Z4nLBtmtPayitgm+9p64osz0nTtK/eti1a696hkzmdymjajuTc4VG/9vRAY05AmawZ3v/i+XmCZVlkWXaqasyppFiwWwUMh4+Mn55wXbcHnU3vHV6AZbxialmMnyd4vo/jekS7HfoM1IdXNss5E/sPlm3jzwOC4LWf5BKmjK92mEXoKkfXCl3LPtP9Fn9mk+y2mMRDywO6a056o2hkjmkUtBK6GpNtjsAzvS76C0YJtBKYSqBlSiV2JOuAl/EDm2BGsV+hy5OPSvTnW1bZO/D/uKwiz3Okqvj0+Qtfv31HVdXby38UgyvCP2nOC5dliW3bOM6M2csLnufS1PWHd475FwvVR0Oi/ILYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c3e22d0f59eac6c5900ccae21f1e34f4/a81b5/tx2.webp 163w,\n/static/c3e22d0f59eac6c5900ccae21f1e34f4/da3ef/tx2.webp 325w,\n/static/c3e22d0f59eac6c5900ccae21f1e34f4/309d5/tx2.webp 650w,\n/static/c3e22d0f59eac6c5900ccae21f1e34f4/78344/tx2.webp 975w,\n/static/c3e22d0f59eac6c5900ccae21f1e34f4/bdb72/tx2.webp 1300w,\n/static/c3e22d0f59eac6c5900ccae21f1e34f4/2e4e1/tx2.webp 1394w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c3e22d0f59eac6c5900ccae21f1e34f4/5e043/tx2.png 163w,\n/static/c3e22d0f59eac6c5900ccae21f1e34f4/e5cc6/tx2.png 325w,\n/static/c3e22d0f59eac6c5900ccae21f1e34f4/663f3/tx2.png 650w,\n/static/c3e22d0f59eac6c5900ccae21f1e34f4/d880f/tx2.png 975w,\n/static/c3e22d0f59eac6c5900ccae21f1e34f4/4c573/tx2.png 1300w,\n/static/c3e22d0f59eac6c5900ccae21f1e34f4/02f69/tx2.png 1394w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c3e22d0f59eac6c5900ccae21f1e34f4/663f3/tx2.png\"\n            alt=\"tx2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>요기서 포인트는 내부 트랜잭션이 요청시에는 신규 트랜잭션이 아니고, 기존 트랜잭션에 참여해 아무것도 안한다.</p>\n<p>응답시에는 실제 커밋을 호출하지 않는다.</p>\n<p>여기서 정리하면</p>\n<ul>\n<li>핵심은 트랜잭션 매니저에 커밋을 호출한다고 해서 항상 실제 커넥션에 물리 커밋이 발생하지 안흔ㄴ다.</li>\n<li>트랜잭션이 내부에서 추가로 사용되면, 트랜잭션 매니저를 통해 논리 트랜잭션을 관리하고, 모든 논리 트랜잭션이 커밋되면 물리 트랜잭션이 커밋된다고 이해하면 된다.</li>\n</ul>\n<hr>\n<p>외부 트랜잭션만 롤백하는 경우는 당연히 물리 롤백이 일어난다.</p>\n<p>그러면 내부 트랜잭션의 경우에는 어떻게 동작할까?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b95607e79e053772d7ffdb6a3ab34ed4/98c82/innerRollback.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.50920245398773%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACTUlEQVR42p2Ty2sTURSH8+e6E8SVYHdWKVIskoVduVJQ1IUgKgi1qRJbm0ebSdo8pmmSaZtMZjK5857JvZ9MHrUFVx44cDn3/j4Ov3NuLlaKk9/7WB8/IH/uIhs15qEU/xM5ObFxN9dxNtexnjzkLP+UU62Eb1+gggmJMEndMalrgWdiXeg0ykUsQ4dYkGR3zhVx4QtyOiKnLJPO29cYlo097FHWavwo7NJunmIMenT1DuddnZ7eZNQqU6tW2Pu+w3GljGUO6Q96NEsHDF++IOy3yGVteq6L0W4xOTvBHo+ZOA6WbRPFMcJ1Ea6H704Jh228IETECaZlkyQpnuczFQI3nRELk5yaOkzW7tO/d4fRg7skzmTuRXfcYvt4ncLg88LSJCR1L0krh8TbWzjVEvLa64Xf0rfJMZshR1dgmUR6HV8IgiDEtEzC1CdOgrlGpRHJuEs0dfAGfUzDmGOUUigl5+cFcFnMYmx0qNc1tLrGma4js8er8ckEzzilelSl0WxSbzSWujnqRodZSS4KztU5pXKZ3cIexf0DwsmE0BgQ+z7IlHGvgdbWKZYqlLQ6nfPerfW6Bq48CMY9rvo6l+cdjIs+XnEH//lj/Mo+kYyJv73Hzm/Qe/YIY2MN8ekdyBgVeag4YOaOVsAldhbBMtNQoNIAOYsIhEXrpMbXN68QWomgraH6beSwj0p8VJwBXVQa3gaues1yJuV8LbIBTaeC45rGVj6P4/k4jsNN72/9lH/jFpkJoiik3Wrxq1jkqFqlXDrEFYK/3t/W/AG4/4Ouq1sagwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b95607e79e053772d7ffdb6a3ab34ed4/a81b5/innerRollback.webp 163w,\n/static/b95607e79e053772d7ffdb6a3ab34ed4/da3ef/innerRollback.webp 325w,\n/static/b95607e79e053772d7ffdb6a3ab34ed4/309d5/innerRollback.webp 650w,\n/static/b95607e79e053772d7ffdb6a3ab34ed4/78344/innerRollback.webp 975w,\n/static/b95607e79e053772d7ffdb6a3ab34ed4/bdb72/innerRollback.webp 1300w,\n/static/b95607e79e053772d7ffdb6a3ab34ed4/592a3/innerRollback.webp 1456w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b95607e79e053772d7ffdb6a3ab34ed4/5e043/innerRollback.png 163w,\n/static/b95607e79e053772d7ffdb6a3ab34ed4/e5cc6/innerRollback.png 325w,\n/static/b95607e79e053772d7ffdb6a3ab34ed4/663f3/innerRollback.png 650w,\n/static/b95607e79e053772d7ffdb6a3ab34ed4/d880f/innerRollback.png 975w,\n/static/b95607e79e053772d7ffdb6a3ab34ed4/4c573/innerRollback.png 1300w,\n/static/b95607e79e053772d7ffdb6a3ab34ed4/98c82/innerRollback.png 1456w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b95607e79e053772d7ffdb6a3ab34ed4/663f3/innerRollback.png\"\n            alt=\"innerRollback\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>내부 트랜잭션은 물리 트랜잭션을 롤백하지 않는 대신에 트랜잭션 동기화 매니저에 <code>rollbackOnly=true</code>라는 표시를 해둔다.</p>\n<p>정리</p>\n<ul>\n<li>논리 트랜잭션이 하나라도 롤백되면 물리 트랜잭션은 롤백된다.</li>\n<li>내부 논리 트랜잭션이 롤백되면 롤백 전용 마크를 표시한다.</li>\n<li>외부 트랜잭션을 커밋할 때 롤백 전용 마크를 확인한다. 롤백 전용 마크가 표시되어 있으면 물리 트랜잭션을 롤백하고, <strong>UnexpectedRollbackException 예외</strong>를 던진다.</li>\n</ul>\n<h4 id=\"requires_new\" style=\"position:relative;\"><a href=\"#requires_new\" aria-label=\"requires_new permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>REQUIRES_NEW</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c84a26317106d7b34599d44a0cc3d34c/02f69/requires_new.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.852760736196316%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACCklEQVR42m2SPW/TQACG81OYGBgQA/8FMbH2FyBahBhgZGVhgUpUYkAMtAxAkUC0qEXQFqEmcZwmcew0tePztx1/3T0oTqlUwUk3nPR+3au3pes6lmU1V0qJVIqqlkip+N9RCqSEWiqU+hfT8n2fKArJiwJnYtDe2+bgyzvGx/uocELtm9TemDpyGsKo94uD3U2+fXrNsLNLGYwuMHIe0rqwBUrnhCI4oy5SVJFClUE1R9U5hd1tMN9/v2Rt8zaPt1d4uH2HjcMnICtkkVHP9MuCCxeqnDid4wqPIIxwZi5ZXqL8MarMKX0DPxYY0zGmY2I5p/hBuOS7Q1pHR0f0NI0gignGbdwzi/5ggBACTdPwPQ/DtIjMNt7sjMDU0LsaaZLR7/VxZy7T6bTpVIoRrTRNmWcZlYRiNqDK4iaVJwRxHCNcFy8IqcSIIosphYFwHYQnCIKAMAhwHHuZUAwvf1kuil10B3S6Gqv3H+D5fvNeCKoqX9aCoqgq7t5bZWdnd8n9n2C9SBgt3d5vveHG1SsMe8eNQDlto6qCytahTEhCwc3r13ix/nzJncfUtnYuyPmeMp94ojHp/MA1NVbWP/Nh/5BiqlEHVoNSsU1y2sPq/MS3NIqNp9h7H4ntASTOX0EuRhrFCbp+gu2F3HrV5dnXPmUaXcIkSUJ3aOCPDfJHawy23hKWdTPsP97X58i8eNWJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c84a26317106d7b34599d44a0cc3d34c/a81b5/requires_new.webp 163w,\n/static/c84a26317106d7b34599d44a0cc3d34c/da3ef/requires_new.webp 325w,\n/static/c84a26317106d7b34599d44a0cc3d34c/309d5/requires_new.webp 650w,\n/static/c84a26317106d7b34599d44a0cc3d34c/78344/requires_new.webp 975w,\n/static/c84a26317106d7b34599d44a0cc3d34c/bdb72/requires_new.webp 1300w,\n/static/c84a26317106d7b34599d44a0cc3d34c/2e4e1/requires_new.webp 1394w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c84a26317106d7b34599d44a0cc3d34c/5e043/requires_new.png 163w,\n/static/c84a26317106d7b34599d44a0cc3d34c/e5cc6/requires_new.png 325w,\n/static/c84a26317106d7b34599d44a0cc3d34c/663f3/requires_new.png 650w,\n/static/c84a26317106d7b34599d44a0cc3d34c/d880f/requires_new.png 975w,\n/static/c84a26317106d7b34599d44a0cc3d34c/4c573/requires_new.png 1300w,\n/static/c84a26317106d7b34599d44a0cc3d34c/02f69/requires_new.png 1394w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c84a26317106d7b34599d44a0cc3d34c/663f3/requires_new.png\"\n            alt=\"requires new\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>사진과 같이 물리 트랜잭션과 내부 트랜잭션을 분리하기 위해선 <code>REQUIRES_NEW</code>옵션을 사용하면 된다.</p>\n<p>요청 흐름과 응답 흐름은 다음과 같다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e39a7e6d4434b4f15e7cc1de91479c69/e9562/require1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.03067484662577%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACb0lEQVR42nWTzW/bRhDF9denl55zaFG0pwBx66KXHhqgBoK0KCLHlgxbnyQlSrIoUiRFmR+75JK7v4JU1LhBMsBilth9j2/fzPTquibPc4qiIM1yCiEQUnIOw5fDfLY/f/eEEHiex87zWFhTrNkYd2GBrkErMA2mqTrElf0rP7z/hu//eYEbj09k3VkDTYVpanpN01AIiRIZO+uO9++u6P/1J2m4Jdou8dc28XZJurVYO33eXF1wcfkd88lNdyd8XBCsHcL1nPrJp9c+1V2tiQIPz7WZWg6zucXxKcUP9izdFZazYLeYctytcJcbbGtBFCcEYYTv77GdJbPpBHkM6J19UDLnsFuz34dEUdj5WlUVWmv2+z3lwaOMfZIoIQgChBRkWYbWDUrVBN4j1VNIz5iTnUkUYI3vOlVRFHWglrQl1I3mKV7w4x/f8tO7l7i+Q5EXnfdtUVsKJQuMSD4p1JUk9lZMZ3NWrktZlifTjaGUJXUesPGH/P3wlsl8xDE5dj/rsO0dkZ0JTwq1kowHfW4HQ+6GQxzHxnwEtJ2ATIg3Djf9AdPJlPv7e9I0PWG1ppI5Rhw/KWzLvl1ajCczLNuif/2B0XhKperOS5PHxI8ON4Mho8mEh9GY+4cRSilUo6kr+f8nm7qkyfYYVWDKjDI7sFvZRN6KNN4hog3J1sFb2cT+BhpJU+aU6YEyS9AiQRfxM4UYTC0xSmCURLe5bn3UXL5+xeUvF/z8+hVvfv8NlEBmCTI9oER6wlQFRtfPCT8brY/VV3XN9fUHbm8HXW5XVamvwb5OeI62Ldo+DMOwy3Ec0U7Xf1NszLNpNvwLwaTXi+HN7asAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e39a7e6d4434b4f15e7cc1de91479c69/a81b5/require1.webp 163w,\n/static/e39a7e6d4434b4f15e7cc1de91479c69/da3ef/require1.webp 325w,\n/static/e39a7e6d4434b4f15e7cc1de91479c69/309d5/require1.webp 650w,\n/static/e39a7e6d4434b4f15e7cc1de91479c69/78344/require1.webp 975w,\n/static/e39a7e6d4434b4f15e7cc1de91479c69/bdb72/require1.webp 1300w,\n/static/e39a7e6d4434b4f15e7cc1de91479c69/e40a7/require1.webp 1438w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e39a7e6d4434b4f15e7cc1de91479c69/5e043/require1.png 163w,\n/static/e39a7e6d4434b4f15e7cc1de91479c69/e5cc6/require1.png 325w,\n/static/e39a7e6d4434b4f15e7cc1de91479c69/663f3/require1.png 650w,\n/static/e39a7e6d4434b4f15e7cc1de91479c69/d880f/require1.png 975w,\n/static/e39a7e6d4434b4f15e7cc1de91479c69/4c573/require1.png 1300w,\n/static/e39a7e6d4434b4f15e7cc1de91479c69/e9562/require1.png 1438w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e39a7e6d4434b4f15e7cc1de91479c69/663f3/require1.png\"\n            alt=\"require1\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9bd6672b2d00e621b77781011c241a63/fa6a4/require2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.576687116564415%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACUklEQVR42n2SSW8TQRBG84M5c4w4IrFIIJDgkgMEDjlECA4ckEAEJcpC4iXYTsYZz2LGHnv2sT2bp/uhjGMnQYSSPnWpu+qpuqrWdE3HsixUVUW7ULD6BslsArIEMb+WlPSCX5z5RyjRMXHmghBIUazekYK1LMtwXJd43MdUmtQPfjAyu1BMyCOHYuKST1zEdMzX5luebd/n4ft7dPUDKBLS2KFwB6RfPiCiEWuKotButxn0OtX57fsOjeYpjuuhGyaabmD8HmB1fuJbA7ptncOdI3Stz2jsYDsuSqOB/foFha0tKizLkiy0cUYjwjBkZNsUeUE6ywiDgCCMmA67xN6QSVnipQmO55JnGVEU4vs+fpoznziscWXl1CPP0soPooDt3gabZ8+JMr+6m3sGIo3JP38kfbdBZPUXiZe9Q1aumLq3gWkyoywFnu/hzIbYU4uizKvwS2CZxAjTYNqsETrOFU8ipbgGSrmgRyOTTrtFp9Oh1WohhLhRAYigz9BU6WgGzXOFnqatgLcqXAKDoU69XmN//4BarYZhmuRFgTlRUaIWU0dBO29zfHLCaaOxGORweIX6x5czf0jf6NFTL1AvutgDizxL+HS2yVb3FSO7TrL1hvjlY1JTJy9L0tlstX9V2+LxNVCmETKLYD6tdlDmMSIJyDwfW1HxTAX9eJdAOUVOPEQaItOQcuavJGbeDaBcNvhaS1t/sM7u3h6Pnj5h//DwKl4shrFIXGkF/NuWwCRJqNXqaFqPrqLQU9Vqb+/Iuhu4tPl8Xi37UnEc/zf+D1YJ1T2YdF98AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/9bd6672b2d00e621b77781011c241a63/a81b5/require2.webp 163w,\n/static/9bd6672b2d00e621b77781011c241a63/da3ef/require2.webp 325w,\n/static/9bd6672b2d00e621b77781011c241a63/309d5/require2.webp 650w,\n/static/9bd6672b2d00e621b77781011c241a63/78344/require2.webp 975w,\n/static/9bd6672b2d00e621b77781011c241a63/bdb72/require2.webp 1300w,\n/static/9bd6672b2d00e621b77781011c241a63/66029/require2.webp 1412w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/9bd6672b2d00e621b77781011c241a63/5e043/require2.png 163w,\n/static/9bd6672b2d00e621b77781011c241a63/e5cc6/require2.png 325w,\n/static/9bd6672b2d00e621b77781011c241a63/663f3/require2.png 650w,\n/static/9bd6672b2d00e621b77781011c241a63/d880f/require2.png 975w,\n/static/9bd6672b2d00e621b77781011c241a63/4c573/require2.png 1300w,\n/static/9bd6672b2d00e621b77781011c241a63/fa6a4/require2.png 1412w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/9bd6672b2d00e621b77781011c241a63/663f3/require2.png\"\n            alt=\"require2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>내부 트랜잭션이 신규 트랜잭션인지 확인하고 롤백한다.</p>\n<h4 id=\"트랜잭션-다양한-전파-옵션\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EB%8B%A4%EC%96%91%ED%95%9C-%EC%A0%84%ED%8C%8C-%EC%98%B5%EC%85%98\" aria-label=\"트랜잭션 다양한 전파 옵션 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션 다양한 전파 옵션</h4>\n<p>대부분 기본 설정은 <code>REQUIRED</code></p>\n<p>아주 가끔 <code>REQUIRES_NEW</code>를 사용한다. 나머지는 사용할 때 알아보자</p>\n<p>간략히 정리하면</p>\n<p>SUPPORT - 트랜잭션을 지원한다는 뜻이다. 기존 트랜잭션이 없으면, 없는대로 진행하고, 있으면 참여한다.</p>\n<p>NOT_SUPPORT - 트랜잭션을 지원하지 않는다는 의미이다</p>\n<p>MANDATORY - 의무사항이다. 트랜잭션이 반드시 있어야 한다. 기존 트랜잭션이 없으면 예외가 발생한다.</p>\n<p>NEVER - 트랜잭션을 사용하지 않는다는 의미이다. 기존 트랜잭션이 있으면 예외가 발생</p>\n<p>NESTED - 기존 트랜잭션 없음: 새로운 트랜잭션을 생성한다. / 기존 트랜잭션 있음: 중첩 트랜잭션을 만든다.<br>\n(거의 사용안해서 DB가 지원하는지 확인 필요)</p>\n<h1 id=\"10-스프링-트랜잭션-전파2---활용\" style=\"position:relative;\"><a href=\"#10-%EC%8A%A4%ED%94%84%EB%A7%81-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%A0%84%ED%8C%8C2---%ED%99%9C%EC%9A%A9\" aria-label=\"10 스프링 트랜잭션 전파2   활용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10. 스프링 트랜잭션 전파2 - 활용</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/98a004ca387407356befef4a8c97b7a6/b04fb/dtx.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.717791411042946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABbElEQVR42o2Ry27bMBBF/f/f0yyyaFzAbhE4faZp7FoWbL2sd2SJkihLIk8hpm6AdNHezSw493LmzAxAa80/pTXJ/pH1xwXbLx8YTkf0WVwe/7TNXvvGcSD09ljrByLfgUEag5IVVeKzurvj6uoN7t5G5gHDqCjLEsdxTDWBUkrqumZUmlEKSm/DannD+5trCm9DnYdIUVIlHuExwDnsKdIIVWdmtmHoaduWvu+fA7Msw/d9uu5sAjN/h2VZbNaPRI5lJhsVRNtPHD6/Jd7conMbLau/V574XRj2/UAvW86nEJG6qObJsOq7lqbMid0dX7/dM5/PydOEsUpMVNdJiqIwm74w1IrM/cnDasHtu2tE6kNXvcDtG5o8wN5Z/Ph+T+DYdE/PDIUQRFFE0zTM0iTBD4509YkmC9jubJbLBVEco8oQlPp9ZGWYDVXMKBJTp09eazbBFNNBzhKZHEg9m8S1KCMHNZn+Uxd0vwBlwGKOC/yn8wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/98a004ca387407356befef4a8c97b7a6/a81b5/dtx.webp 163w,\n/static/98a004ca387407356befef4a8c97b7a6/da3ef/dtx.webp 325w,\n/static/98a004ca387407356befef4a8c97b7a6/309d5/dtx.webp 650w,\n/static/98a004ca387407356befef4a8c97b7a6/78344/dtx.webp 975w,\n/static/98a004ca387407356befef4a8c97b7a6/bdb72/dtx.webp 1300w,\n/static/98a004ca387407356befef4a8c97b7a6/6225e/dtx.webp 1398w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/98a004ca387407356befef4a8c97b7a6/5e043/dtx.png 163w,\n/static/98a004ca387407356befef4a8c97b7a6/e5cc6/dtx.png 325w,\n/static/98a004ca387407356befef4a8c97b7a6/663f3/dtx.png 650w,\n/static/98a004ca387407356befef4a8c97b7a6/d880f/dtx.png 975w,\n/static/98a004ca387407356befef4a8c97b7a6/4c573/dtx.png 1300w,\n/static/98a004ca387407356befef4a8c97b7a6/b04fb/dtx.png 1398w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/98a004ca387407356befef4a8c97b7a6/663f3/dtx.png\"\n            alt=\"dtx\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>위와같은 복잡한 트랜잭션 문제를 해결하기 위해 <strong>트랜잭션 전파</strong>가 필요하다.</p>\n<hr>\n<p>상황을 가정해보자</p>\n<p>회원 가입을 시도한 로그를 남기는데 실패하더라도 회원 가입은 유지되어야 한다.</p>\n<p>같은 요청사항이 있을 경우 이전에 배운 것과 같이 service에서 에러를 잡아서 처리하면</p>\n<p>될 것 같지만 아래와 같이 에러가 발생해 둘다 롤백이 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e6f48ce9ed713b5c5d2a82d2a148f283/c6e0f/rollback.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.89570552147239%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACUklEQVR42n2T2U7bQBiF/ca94QX6Cr3oTW960wVREBRBCilrIYECoXHIAtmcxGucBZyMncSxv8rTptAK9Uij3zP6Z3xG5xuFRHH89/iPoigmmocMRwGH9QH/divPbYrjmCiOZZXj91oiTdPY/ZJiLbXHy1SJrutSUFV0XWc6naLE4xGT9BbDtY94nz8x29kkHg7+HLyo8idRRKfToVAoUL27w7sf4jiOnLfbbSaTCUrUtZjnLzGbTZxmk+i+z02nx6uMjmObdFoaq4051lAwDXwGgwGNRoNisYjruvi+TxAECCHkt+JXK2gr7wmBWr3ObnqH9d191nNNcrkc+1/TbOZ1vGAm3VqWxe3tLa1Wi57r0nUcWROnvV4PJQhD7AePSRiiOw4/bor0rB5i7GEYhnTjmm3EeMx0NpOuEjeJZmGIJwTzJ0EqoXrFfC/F7OSAaXob9/sxx/YOjjAfA4pieZ3RaISh67QMA0fNI/I52lsbWJlvPAQBcRShRIM+M6PD3DHxtSZGtcSVlaXvNED4BNOJRGkRUKlYZGNrm6PVFeyTQ7rnGY6XP3ClqvhC/MJm0dwxDW5KJXS9S1C9pXR0wIulpac8MQkCtGoVa22Zqd5CRBFOr8/I8wjDEOUpzC1NI3N6ytn5GcIXjMZjyuWybEyQSDQQgqZtY5yd0q/f0dZ1LNOUIfX7/UewE5fD4VAmZdu2xKNSqaCqKtfX1/JgcZFFe/eW8pvXNHZTeOOx5LJWq8nwxOLKzylhK0EkeQGmaUosZpUi4UWW+WWWeaXIc4/0J33pfrzwheCrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e6f48ce9ed713b5c5d2a82d2a148f283/a81b5/rollback.webp 163w,\n/static/e6f48ce9ed713b5c5d2a82d2a148f283/da3ef/rollback.webp 325w,\n/static/e6f48ce9ed713b5c5d2a82d2a148f283/309d5/rollback.webp 650w,\n/static/e6f48ce9ed713b5c5d2a82d2a148f283/78344/rollback.webp 975w,\n/static/e6f48ce9ed713b5c5d2a82d2a148f283/bdb72/rollback.webp 1300w,\n/static/e6f48ce9ed713b5c5d2a82d2a148f283/c9fa7/rollback.webp 1416w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e6f48ce9ed713b5c5d2a82d2a148f283/5e043/rollback.png 163w,\n/static/e6f48ce9ed713b5c5d2a82d2a148f283/e5cc6/rollback.png 325w,\n/static/e6f48ce9ed713b5c5d2a82d2a148f283/663f3/rollback.png 650w,\n/static/e6f48ce9ed713b5c5d2a82d2a148f283/d880f/rollback.png 975w,\n/static/e6f48ce9ed713b5c5d2a82d2a148f283/4c573/rollback.png 1300w,\n/static/e6f48ce9ed713b5c5d2a82d2a148f283/c6e0f/rollback.png 1416w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e6f48ce9ed713b5c5d2a82d2a148f283/663f3/rollback.png\"\n            alt=\"rollback\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>해결하기 위해선 물리 트랜잭션을 별도로 분리한다</p>\n<p><code>REQUIRES_NEW</code>를 사용</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"49864520625976210000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@Transactional(propagation = Propagation.REQUIRES_NEW)\npublic void save(Log logMessage)`, `49864520625976210000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"31\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Transactional</span><span class=\"mtk1\">(propagation = </span><span class=\"mtk12\">Propagation</span><span class=\"mtk1\">.</span><span class=\"mtk12\">REQUIRES_NEW</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">save</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Log</span><span class=\"mtk1\"> logMessage)</span></span></span></code></pre>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8172e4719ae7ed3af77450eea4b72052/e7c3c/requireNew.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.37423312883436%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACGElEQVR42o2SW2/aQBBG87f7XAm1/R1Vqj5WVapGkUICCSoNFAQGBPaSUMCAr/EFr40vp7ITEvWl6kijT9odnZ35dk7iOEZKSalZllWZFwXFS1JpGZ7nMVYUfvYV3nwdsbIeCX0P3/dfak74jzgWCyGo1+tc1q/oqGtUMafZaDAej/8GHrvJ8xyZHLgULjvnEUNfoVgp5j5F7sOqE9u2mc2mSBmRpWmlSRxTFPkTMIqiaswwDBkpQ9qdLrXvI/oTDaXb5mNnjWrHVfF2Z6BqAk3MsWyHzXaHZdvVue04T0BN0+j1ekynU25bt/y66+GYFpuNTqfTYa6plI/mMsBZa9grjdDRkZ6Bb29II5csMEm9HWQJJ+Woxw+RkURzRuzkGgpI05TD4YAfBATbOQ9ihq6vCVYLwoXgvnmJM1GIDwlFEpKF1hPwGNFe0lycM9i1yZ89KcllRR4YzIXgonHD1adT3ItvOK0G7c+nDGcqpAlZaL8CS8OHypC12LAw53QXLd7XPmCaRnWfB2a1NkJT0c6+sNdXGGHE1rQwDIMskeQl8NjdcrlkMBigCRUxFyRJUq1ItN8/Aw32UcRG11menyF7dxx+P3DdvMF1PSgyssB6BZZ+lVmuTqkvVjxr5ulMhj3arSb9sYJ+r5IaOu9qb1mIGeSS1Df/vdgl/Ag8BA7WUsXVH5h0b+n/uEZfTEkiF2K/+pAijfkDL4I5pS4Lgf0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8172e4719ae7ed3af77450eea4b72052/a81b5/requireNew.webp 163w,\n/static/8172e4719ae7ed3af77450eea4b72052/da3ef/requireNew.webp 325w,\n/static/8172e4719ae7ed3af77450eea4b72052/309d5/requireNew.webp 650w,\n/static/8172e4719ae7ed3af77450eea4b72052/78344/requireNew.webp 975w,\n/static/8172e4719ae7ed3af77450eea4b72052/bdb72/requireNew.webp 1300w,\n/static/8172e4719ae7ed3af77450eea4b72052/9039b/requireNew.webp 1448w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8172e4719ae7ed3af77450eea4b72052/5e043/requireNew.png 163w,\n/static/8172e4719ae7ed3af77450eea4b72052/e5cc6/requireNew.png 325w,\n/static/8172e4719ae7ed3af77450eea4b72052/663f3/requireNew.png 650w,\n/static/8172e4719ae7ed3af77450eea4b72052/d880f/requireNew.png 975w,\n/static/8172e4719ae7ed3af77450eea4b72052/4c573/requireNew.png 1300w,\n/static/8172e4719ae7ed3af77450eea4b72052/e7c3c/requireNew.png 1448w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8172e4719ae7ed3af77450eea4b72052/663f3/requireNew.png\"\n            alt=\"requireNew\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>설정값을 넣어주면, 위의 그림처럼 동작하게 된다.</p>\n<p>정리</p>\n<ul>\n<li>논리 트랜잭션은 하나라도 롤백되면 관련된 물리 트랜잭션은 롤백된다.</li>\n<li>이 문제를 해결하려면 <code>REQUIRES_NEW</code>를 사용해 트랜잭션을 분리한다.</li>\n<li>특정 레포지토리만 트랜잭션을 분리한다고 생각한다.</li>\n</ul>\n<p>주의</p>\n<ul>\n<li><code>REQUIRES_NEW</code>를 사용하면 1개의 HTTP요청에 동시에 2개의 DB Connection을 사용한다. 성능이 중요한 곳에서 사용을 주의한다.</li>\n</ul>\n<p>더 좋은 방식은 구조를 변경하는 것이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4eb9d58425f87a88dddffb39c9826124/fa6a4/change.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.44171779141104%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAByklEQVR42oWSW28TMRCF8/uBl/4MHnjhMSp9oI1EGwpKaSGkCcnmttlN4t31Xuzs2v7QuqQSl4iRRseWR8dzZk6HE+Gc8yjFlsnDJ6L5I7ZKMKXAlsJjFi+RuzXUOU6nWJ3T4TSjB5OG1GWKbQ7gDK7FRuMOFavxPbe9Cx6/9MnjOUYE/ye0ecxyOmL4cIeIW/IMaw1NrSnSPTf9j7y/vCSO1hgx/5uwlfqc7V1uqJKIq6se3W6XxewHZbanKgvkdsVus2AXLiiTLUYsngiP8/qD2hOq3YIkXhNuIsIwJM8SVCl9xfn5OWdnZ09KnMNk8e8dWmvRWlPXNUopikpRbufoeIpJl7hs5bGREaiE4PuA2947qASNjGmSBZ08zwmCACklm82G6+trBoMBQgj/gXMWXIsGrZTPg9Zorfy712INzhw8dowxvqumaaiqiizLfLbnsiwpioKyUii5J40CluN7VqM7xoMPpOEEI2Nvo2Oc3vJxDMZgraOIZrx985pgPCRdT/j2+Yb+1QVJOMPsps+u6Jzc8K+CI2oR8uLlK2azKYXMGI4mfB2OSBJBs5//m/CEIZ8Mnse4Q4ZTKY2YU+8D6l2bM2/oo+SfN59Lo/H93G4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4eb9d58425f87a88dddffb39c9826124/a81b5/change.webp 163w,\n/static/4eb9d58425f87a88dddffb39c9826124/da3ef/change.webp 325w,\n/static/4eb9d58425f87a88dddffb39c9826124/309d5/change.webp 650w,\n/static/4eb9d58425f87a88dddffb39c9826124/78344/change.webp 975w,\n/static/4eb9d58425f87a88dddffb39c9826124/bdb72/change.webp 1300w,\n/static/4eb9d58425f87a88dddffb39c9826124/66029/change.webp 1412w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4eb9d58425f87a88dddffb39c9826124/5e043/change.png 163w,\n/static/4eb9d58425f87a88dddffb39c9826124/e5cc6/change.png 325w,\n/static/4eb9d58425f87a88dddffb39c9826124/663f3/change.png 650w,\n/static/4eb9d58425f87a88dddffb39c9826124/d880f/change.png 975w,\n/static/4eb9d58425f87a88dddffb39c9826124/4c573/change.png 1300w,\n/static/4eb9d58425f87a88dddffb39c9826124/fa6a4/change.png 1412w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4eb9d58425f87a88dddffb39c9826124/663f3/change.png\"\n            alt=\"change\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h1>\n<p><a href=\"https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-db-2/dashboard\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">스프링 DB 2편 - 데이터 접근 활용 기술 - 김영한</a></p>\n<pre><code></code></pre>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .mtk1 { color: #D4D4D4; }\n  .default-dark .mtk10 { color: #4EC9B0; }\n  .default-dark .mtk4 { color: #569CD6; }\n  .default-dark .mtk12 { color: #9CDCFE; }\n  .default-dark .mtk11 { color: #DCDCAA; }\n  .default-dark .mtk15 { color: #C586C0; }\n  .default-dark .mtk8 { color: #CE9178; }\n  .default-dark .mtk3 { color: #6A9955; }\n  .default-dark .mtk7 { color: #B5CEA8; }\n  .default-dark .mtk17 { color: #808080; }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","tableOfContents":"<ul>\n<li><a href=\"#1-jdbctemplate\">1. JdbcTemplate</a></li>\n<li><a href=\"#2-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%91%EA%B7%BC-%EA%B8%B0%EC%88%A0---%ED%85%8C%EC%8A%A4%ED%8A%B8\">2. 데이터 접근 기술 - 테스트</a></li>\n<li><a href=\"#3-mybatis\">3. MyBatis</a></li>\n<li><a href=\"#4-jpa\">4. JPA</a></li>\n<li><a href=\"#5-spring-data-jpa\">5. Spring Data JPA</a></li>\n<li><a href=\"#6-querydsl\">6. QueryDSL</a></li>\n<li><a href=\"#7-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%91%EA%B7%BC-%EA%B8%B0%EC%88%A0---%ED%99%9C%EC%9A%A9-%EB%B0%A9%EC%95%88\">7. 데이터 접근 기술 - 활용 방안</a></li>\n<li><a href=\"#8-%EC%8A%A4%ED%94%84%EB%A7%81-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%9D%B4%ED%95%B4\">8. 스프링 트랜잭션 이해</a></li>\n<li><a href=\"#9-%EC%8A%A4%ED%94%84%EB%A7%81-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%A0%84%ED%8C%8C1---%EA%B8%B0%EB%B3%B8\">9. 스프링 트랜잭션 전파1 - 기본</a></li>\n<li><a href=\"#10-%EC%8A%A4%ED%94%84%EB%A7%81-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%A0%84%ED%8C%8C2---%ED%99%9C%EC%9A%A9\">10. 스프링 트랜잭션 전파2 - 활용</a></li>\n<li><a href=\"#reference\">Reference</a></li>\n</ul>","frontmatter":{"title":"스프링 DB 2편 - 데이터 접근 활용 기술 정리","summary":["스프링 DB 2편 - 데이터 접근 활용 기술 강의 정리하자"],"date":"2025.01.03.","category":["Spring"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADlElEQVR42nVUTYgcRRTuza6JICoSQnR35r3qmVExEpCI6EFJ0JNHhQWDSMxFEREJY9frn9npRGO8KCKIoOLFg5DxoiIzu13V0z3jTMy6bn5MICiIt2AkQS+CujNbUt3TbWczFjy6qH7vq/e+974yjC1LKWNmsWXMFs8WW3u2+xf3bC+e+b6xzVfGtjTImDGmrcTJT51IVPaSgOM8AMEFXOIB/sgF9EjAu1an/NgkJLlcTQPMgOzV+Z1c4McU4oa/aqrGkCm3z5TbY6oxYEqfOREqK4C216uWXVlasAQ8W8T4D2y5VLO7ePHod6aiEMdc4AZJHHGJY23JXuCG3jdPmcru4mUrgBMUQsMa3HurUazfFvM73RjPNb81FRf4D0ncJIlq8t0kkRpPQGHkfcOUE+Nf1MEDFMLjboQPpNlNiLW78EGSWQqmeJrZSO/tEHU2SalLQ3MzvRTO2ivwoI614oW7nRifzvnjYfl+J2J/6kCusxA4bgxNpQM10CSrv7nEqyRQ8hAP+xHenMW/9QPc4fTxmRzQ66OryeYBbNhdHGvySWCfJLzsBPCE1YF9dlSt+adrt2UU6c76hXHyIjxIonJ7AuhE+MXSKVPzNXJjHFHIXsnGYtqc+tH+uSSuXdtlC/OehLIQnrMG5fmEQwpxLR0LU/N1TDu0WsasHxlzes60TzIJOjsNOOHdCvCg24G70qayQzyqlQwdYEtcSzOEK440dxebdcPgR0aSHQ/wMBfsUPbPjfB5PZNpyV388o0zFcUDFFMElKhBA2WKoKD8Kg/gk8xBV+P12Is5h16fNd88X9XdFKl2NcD+uVzTEyCnfecukniSBLTrK7tvyZs6KFepi/U8BVfCPidiY5LwhxcyLKpHZ2YL8yEu8H2SeI0kfqQ7qy/78HvjpoQ/iR6X+GTetUnZn564UFVeD2W9gwdsAS+QhM+4xJ+5gN9JQECi8mje6fwRwZdI4OfXjUHaJajYITtLAdZtCWeWholq1i3JmiRKe3WTFluLs1qiPMD7aAWfIgnLFMKV19rl6nWPQ8bREVla4O1ayeuz9VQ18EtiEn/T5fIQr1KI17Rqjp+rqsYAf61/ncrvhqnINb1cqlkCv7JjHL++XlFHV021NGSJNU+b6tiaqZw4UdJJKyjPZ0383wc213eEj5CEd0hCTAJ/IqkNYlvA23aXPZxVVoyZutRWJ2XMvNeu7dBWfOpz9WxZ/wJwOf3zP7mVigAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/daf23c051d1970bd74a5bdb9fe7de872/5f2c3/thumbnail.png","srcSet":"/static/daf23c051d1970bd74a5bdb9fe7de872/90cd3/thumbnail.png 100w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/614dc/thumbnail.png 200w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/5f2c3/thumbnail.png 400w","sizes":"(min-width: 400px) 400px, 100vw"},"sources":[{"srcSet":"/static/daf23c051d1970bd74a5bdb9fe7de872/e64f1/thumbnail.webp 100w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/8b00d/thumbnail.webp 200w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/9c0a1/thumbnail.webp 400w","type":"image/webp","sizes":"(min-width: 400px) 400px, 100vw"}]},"width":400,"height":400}},"publicURL":"/static/daf23c051d1970bd74a5bdb9fe7de872/thumbnail.png"}}}}]}},"pageContext":{"slug":"/SpringDB_2/","series":[{"slug":"/SpringDB_1/","title":"스프링 DB 1편 - 데이터 접근 핵심 원리 정리","num":1},{"slug":"/SpringDB_2/","title":"스프링 DB 2편 - 데이터 접근 활용 기술 정리","num":2}],"lastmod":"2025.01.03."}},"staticQueryHashes":["2383754777"],"slicesMap":{}}