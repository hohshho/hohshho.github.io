{"componentChunkName":"component---src-templates-post-tsx","path":"/SpringDB_1/","result":{"data":{"site":{"siteMetadata":{"title":"Just Keep Going","description":"Ian's Archive","siteUrl":"https://hohshho.github.io"}},"allMarkdownRemark":{"edges":[{"node":{"id":"ac9c9a6c-f2f9-504e-ab1e-bac0437a9ffc","html":"<p>WEB Application은 크게 3가지 기능 수행</p>\n<ol>\n<li>\n<p>웹이나 앱같은 클라이언트 요청을 받아서 처리하는 기능</p>\n</li>\n<li>\n<p>중간에서 비즈니스 로직을 수행하는 기능</p>\n</li>\n<li>\n<p>수행 결과를 DB에 보관하고 관리하는 기능</p>\n</li>\n</ol>\n<p>Application에서 DB의 데이터를 관리하기 위해서는 다양한 데이터 접근 기술 학습 필요</p>\n<p>어려운 이유는 크게 3가지이다.</p>\n<ol>\n<li>DB기반 지식이 약하기 때문</li>\n</ol>\n<p>모든 데이터 접근 기술은 DB에 데이터를 보관하고 관리하기 위한 것 (기본 이해 필요)</p>\n<ol start=\"2\">\n<li>데이터 접근 기술이 너무 다양</li>\n</ol>\n<p>ex - JDBC, JdbcTemplate, MyBatis, JPA, QueryDSL …</p>\n<ol start=\"3\">\n<li>DB접근 기술의 역사가 너무 오래되었다.</li>\n</ol>\n<p>20년 동안 DB접근 기술은 물론이고, 스프링은 DB접근 기술을 편리하게 사용하도록 수많은 기능을 발전시키고 개선</p>\n<p>너무 많은게 자동화되고, 추상화 되었다.</p>\n<hr>\n<p>강의는 20년전으로 돌아가 데이터 접근 기술의 시작인 JDBC를 시작으로</p>\n<p>커넥션, 커넥션 풀, 데이터 소스, 트랜잭션 개념, 데이터 접근 계층을 위한 Java 예외처리, Spring이 지원하는 데이터 접근 기술까지 단계적으로 진행</p>\n<p>백엔드 개발자는</p>\n<p>웹 MVC, DB와 관련된 DB접근 기술을 꼭 알아야 한다.</p>\n<hr>\n<p>dependencies에 lombok설정 추가</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"75885507170679440000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`//테스트에서 lombok 사용\ntestCompileOnly 'org.projectlombok:lombok' testAnnotationProcessor 'org.projectlombok:lombok'`, `75885507170679440000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"gradle\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//테스트에서 lombok 사용</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">testCompileOnly </span><span class=\"mtk8\">&#39;org.projectlombok:lombok&#39;</span><span class=\"mtk1\"> testAnnotationProcessor </span><span class=\"mtk8\">&#39;org.projectlombok:lombok&#39;</span></span></span></code></pre>\n<p>설정을 추가해야 <code>@Slfj4</code>같은 롬복 어노테이션 사용 가능</p>\n<h1 id=\"1-jdbc-이해\" style=\"position:relative;\"><a href=\"#1-jdbc-%EC%9D%B4%ED%95%B4\" aria-label=\"1 jdbc 이해 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. JDBC 이해</h1>\n<blockquote>\n<p>JDBC(Java Database Connectivity)는 자바에서 데이터베이스를 접속할 수 있도록 하는 자바 API다. JDBC는 DB에서 자료를 쿼리하거나 업데이트 하는 방법을 제공한다.</p>\n</blockquote>\n<p>대표적으로 3가지 기능을 표준 인터페이스로 정의하여 제공</p>\n<ul>\n<li>java.sql.Connection : 연결</li>\n<li>java.sql.Satatement : SQL에 담은 내용 (전달)</li>\n<li>java.sql.ResultSet : SQL요청 응답 (결과)</li>\n</ul>\n<p>정리</p>\n<p>JDBC의 등장으로 2가지 문제 해결</p>\n<ol>\n<li>DB변경 시 관련된 코드도 함께 변경해야 하는 문제</li>\n</ol>\n<ul>\n<li>Application 로직은 JDBC표준 인터페이스에만 의존</li>\n<li>DB변경 시 JDBC 구현라이브러리만 변경</li>\n</ul>\n<ol start=\"2\">\n<li>DB마다 커넥션 연결, SQL전달, 결과 응답 방법을 새로 학습하는 문제</li>\n</ol>\n<ul>\n<li>JDBC 표준 인터페이스 사용법만 학습</li>\n<li>한번 배우면 다른 DB모두 동일하게 적용 가능</li>\n</ul>\n<p>한계</p>\n<p>DB변경 시 JDBC코드는 변경하지 않아도 되지만 SQL은 해당 데이터 베이스에 맞게 변경 필요</p>\n<hr>\n<p>JDBC기술은 대표적으로 SQL Mapper와 ORM으로 나뉜다.</p>\n<p>SQL Mapper</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/370e729201e36fa32247d165484a4f08/d2d74/SQLMapper.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.539877300613497%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3ElEQVR42nWQSYqAMBBFc//beAIHUARFUXEE54WK08KFguhvfsBN011QpCqp4eeJaZoQxzG6rsN937iuC+/7gsZzXVcsy4J937Ftm4yf58F/JtI0he/7SJIEVVWhLEu0bYvjONA0DaIogm3bUFUVlmUhDEP0fS/fx3GUPXVdS2cugiCA53nI8xwcziGu62IYBhiGIYfzXtM0OI4j46IoZLOu68iyTC76+gW/+qmiM57nWcrn91hEVYqiwDRNGRMDjSqpjIophPXiLw5k9/l5nnIB+ZEjczL8OP9m+APlWnHE25rC0wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/370e729201e36fa32247d165484a4f08/a81b5/SQLMapper.webp 163w,\n/static/370e729201e36fa32247d165484a4f08/da3ef/SQLMapper.webp 325w,\n/static/370e729201e36fa32247d165484a4f08/309d5/SQLMapper.webp 650w,\n/static/370e729201e36fa32247d165484a4f08/78344/SQLMapper.webp 975w,\n/static/370e729201e36fa32247d165484a4f08/e2c2f/SQLMapper.webp 1152w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/370e729201e36fa32247d165484a4f08/5e043/SQLMapper.png 163w,\n/static/370e729201e36fa32247d165484a4f08/e5cc6/SQLMapper.png 325w,\n/static/370e729201e36fa32247d165484a4f08/663f3/SQLMapper.png 650w,\n/static/370e729201e36fa32247d165484a4f08/d880f/SQLMapper.png 975w,\n/static/370e729201e36fa32247d165484a4f08/d2d74/SQLMapper.png 1152w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/370e729201e36fa32247d165484a4f08/663f3/SQLMapper.png\"\n            alt=\"SQLMapper\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ul>\n<li>SQL응답 결과를 객체로 편리하게 변환</li>\n<li>JDBC의 반복코드 제거</li>\n<li>개발자가 SQL 직접 작성</li>\n<li>ex - JdbcTemplate, MyBatis</li>\n</ul>\n<p>ORM</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6087d5eca8bedf189280559981132df8/26e62/ORM.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.809815950920246%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA+UlEQVR42n2S7ctEUBDF/f//k282WUR2C+V134iyCIXN2c7Ubs+HfUxNd+5x/cyZS7lcLrBtG0VRYBgGtG2LeZ4lX6+XaM/nE33fo2karOuKvVCCIICu6/A8D77vCzyKItR1jdvtBsuycL1eRcuyTDTGtm2/gTzoOA4IZn06naQexxFlWcqz+/0u+uPxkPoD/JUKrXVdJ5a4Mv/a4p6dHY9HVFWFZVn2Lf8SP3b48vl8xuFwgKqqAs3z/PthjiVN029y/sp/rTOmaRIA52sYBsIwFOu8QNrXNA1xHMucuRKq7LVP64SYpilA13W/l8LgmJIkAf8Uwrh/A6bmD9QcoTl0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/6087d5eca8bedf189280559981132df8/a81b5/ORM.webp 163w,\n/static/6087d5eca8bedf189280559981132df8/da3ef/ORM.webp 325w,\n/static/6087d5eca8bedf189280559981132df8/309d5/ORM.webp 650w,\n/static/6087d5eca8bedf189280559981132df8/78344/ORM.webp 975w,\n/static/6087d5eca8bedf189280559981132df8/2f8f5/ORM.webp 1150w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/6087d5eca8bedf189280559981132df8/5e043/ORM.png 163w,\n/static/6087d5eca8bedf189280559981132df8/e5cc6/ORM.png 325w,\n/static/6087d5eca8bedf189280559981132df8/663f3/ORM.png 650w,\n/static/6087d5eca8bedf189280559981132df8/d880f/ORM.png 975w,\n/static/6087d5eca8bedf189280559981132df8/26e62/ORM.png 1150w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/6087d5eca8bedf189280559981132df8/663f3/ORM.png\"\n            alt=\"ORM\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ul>\n<li>객체를 DB Table과 매핑하는 기술</li>\n<li>JPA는 ORM표준 인터페이스 이고 이것을 구현한 것으로 하이버네이트 등이 있다.</li>\n</ul>\n<p>2가지 기술 모두 내부에서는 JDBC사용</p>\n<hr>\n<ul>\n<li>JDBC는 <code>java.sql.Connection</code>표준 커넥션 인터페이스를 정의</li>\n<li>H2 DB Driver는 JDBC Connection 인터페이스를 구현한 <code>org.h2.jdbc.JdbcConnection</code> 구현체를 제공</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8137a0b206886ef64300fe15914b06d2/dc896/DriverManager.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.69325153374233%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABkUlEQVR42n2SWYqqQQyF/3W4ApfjBtyBa3ABuhpf1AdBn1RwwBlxnkWc59nTfIG/aW43NxCSqlSdJCdxNpuN+v2+6Wg00mAwULPZ1H6/F7JYLNTtdnW5XPRTPp/PL0Wcx+Nhj8/ns67Xq+lutzPbaDTk9Xrl8XgUCATsw/v91v/E+feCTCQ5Ho86HA4qlUpKJpNWPYndhL1eT8Ph0DpC8Yk5z+fTnNvtpu12ayD4ABNzW8G/3+96vV4GUCgU1G63VavVzJKY/85kMlGr1RI2l8tpPB5bdVQBdzyGX/zpdKrVaqVyuax0Om0+MebAHdbpdDqq1+vWEj4K2Hw+VyqVUjQaVSKRUCwWU7Va1Xq9tjeZTMYKoFIsgAzS4cFsNrNsADNVV/Dhhjht0hI80mY8HrcEgBPLZrNWyK+hMBAmfjqdjDM4hDcsd/ANPWwAYNDFgDhby3/tE0PhI/z5/X75fD6Fw+HvLaDifD6vYrFo7VYqFWsdmpy/dokq2bflcqlQKKRgMKhIJPIN6O6iuwE/F/0LSEvg2LxzEmMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8137a0b206886ef64300fe15914b06d2/a81b5/DriverManager.webp 163w,\n/static/8137a0b206886ef64300fe15914b06d2/da3ef/DriverManager.webp 325w,\n/static/8137a0b206886ef64300fe15914b06d2/309d5/DriverManager.webp 650w,\n/static/8137a0b206886ef64300fe15914b06d2/78344/DriverManager.webp 975w,\n/static/8137a0b206886ef64300fe15914b06d2/b2cd5/DriverManager.webp 1140w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8137a0b206886ef64300fe15914b06d2/5e043/DriverManager.png 163w,\n/static/8137a0b206886ef64300fe15914b06d2/e5cc6/DriverManager.png 325w,\n/static/8137a0b206886ef64300fe15914b06d2/663f3/DriverManager.png 650w,\n/static/8137a0b206886ef64300fe15914b06d2/d880f/DriverManager.png 975w,\n/static/8137a0b206886ef64300fe15914b06d2/dc896/DriverManager.png 1140w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8137a0b206886ef64300fe15914b06d2/663f3/DriverManager.png\"\n            alt=\"DriverManager\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><code>DriverManager</code>는 라이브러리에 등록된 DB Driver관리, 커넥션 획득 기능 제공</p>\n<p>삽입</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"65116119996545030000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`pstmt = con.prepareStatement(sql);\npstmt.setString(1, member.getMemberId());\npstmt.setInt(2, member.getMoney());\npstmt.executeUpdate();`, `65116119996545030000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">pstmt = </span><span class=\"mtk12\">con</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prepareStatement</span><span class=\"mtk1\">(sql);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">pstmt</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setString</span><span class=\"mtk1\">(</span><span class=\"mtk7\">1</span><span class=\"mtk1\">, </span><span class=\"mtk12\">member</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMemberId</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">pstmt</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setInt</span><span class=\"mtk1\">(</span><span class=\"mtk7\">2</span><span class=\"mtk1\">, </span><span class=\"mtk12\">member</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMoney</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">pstmt</span><span class=\"mtk1\">.</span><span class=\"mtk11\">executeUpdate</span><span class=\"mtk1\">();</span></span></span></code></pre>\n<p>Statement - SQL 그대로 넣는 것<br>\nprepareStatement - 파라미터를 binding</p>\n<p>조회</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"68778238673326490000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`con = getConnection();\npstmt = con.prepareStatement(sql);\npstmt.setString(1, memberId);\nrs = pstmt.executeQuery();\n\nif (rs.next()) {\n    Member member = new Member();\n    member.setMemberId(rs.getString(&quot;member_id&quot;));\n    member.setMoney(rs.getInt(&quot;money&quot;));\n    return member;\n}\n\n...\n`, `68778238673326490000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">con = </span><span class=\"mtk11\">getConnection</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">pstmt = </span><span class=\"mtk12\">con</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prepareStatement</span><span class=\"mtk1\">(sql);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">pstmt</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setString</span><span class=\"mtk1\">(</span><span class=\"mtk7\">1</span><span class=\"mtk1\">, memberId);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">rs = </span><span class=\"mtk12\">pstmt</span><span class=\"mtk1\">.</span><span class=\"mtk11\">executeQuery</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">rs</span><span class=\"mtk1\">.</span><span class=\"mtk11\">next</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">Member</span><span class=\"mtk1\"> </span><span class=\"mtk12\">member</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Member</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">member</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setMemberId</span><span class=\"mtk1\">(</span><span class=\"mtk12\">rs</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getString</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;member_id&quot;</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">member</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setMoney</span><span class=\"mtk1\">(</span><span class=\"mtk12\">rs</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getInt</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;money&quot;</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> member;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span></code></pre>\n<ul>\n<li>executeQuery - 데이터 조회 시 사용</li>\n<li>executeQuery() - 결과는 ResultSet에 담아 반환</li>\n<li><code>ResultSet</code> 은 보통 select 쿼리의 결과가 순서대로 들어가 있음</li>\n</ul>\n<h1 id=\"2-커넥션-풀과-데이터-소스-이해\" style=\"position:relative;\"><a href=\"#2-%EC%BB%A4%EB%84%A5%EC%85%98-%ED%92%80%EA%B3%BC-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%86%8C%EC%8A%A4-%EC%9D%B4%ED%95%B4\" aria-label=\"2 커넥션 풀과 데이터 소스 이해 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 커넥션 풀과 데이터 소스 이해</h1>\n<h2 id=\"21-커넥션-풀\" style=\"position:relative;\"><a href=\"#21-%EC%BB%A4%EB%84%A5%EC%85%98-%ED%92%80\" aria-label=\"21 커넥션 풀 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.1 커넥션 풀</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c642aad3710fb584efa9c79df1e74e5a/dd200/ConnectionPool1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.67484662576687%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA8UlEQVR42n1R2YqEQAz0/7/DfxHBAxEZBcVrvEYELzzwqKECLvuwbKBJujqpqtDKtm1gDMOAOI4RBAF835f68/mgrms5TdMIVhQFqqpCnucy4zgONE2D53nCo6iqir7vhciyLMkkCMMQXdfBtm2YpilZ13UkSYK2bUXs/X7DMAy5U+g4DigEGWygKu9pmsJ1XRkmMTNdvV4veaMQ+2mE78ycE8L7voWQK+37jifO8xRn4zj+YPM8i5t1XQW/rgvTNIkRknJeIcggUJalKJOcilydqzA/GyzLgv9CeQo65QfxUCnLMkRRJCJ09Lz97v+r/gI1+cMSA3vG+AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c642aad3710fb584efa9c79df1e74e5a/a81b5/ConnectionPool1.webp 163w,\n/static/c642aad3710fb584efa9c79df1e74e5a/da3ef/ConnectionPool1.webp 325w,\n/static/c642aad3710fb584efa9c79df1e74e5a/309d5/ConnectionPool1.webp 650w,\n/static/c642aad3710fb584efa9c79df1e74e5a/78344/ConnectionPool1.webp 975w,\n/static/c642aad3710fb584efa9c79df1e74e5a/bdb72/ConnectionPool1.webp 1300w,\n/static/c642aad3710fb584efa9c79df1e74e5a/1f9bd/ConnectionPool1.webp 1726w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c642aad3710fb584efa9c79df1e74e5a/5e043/ConnectionPool1.png 163w,\n/static/c642aad3710fb584efa9c79df1e74e5a/e5cc6/ConnectionPool1.png 325w,\n/static/c642aad3710fb584efa9c79df1e74e5a/663f3/ConnectionPool1.png 650w,\n/static/c642aad3710fb584efa9c79df1e74e5a/d880f/ConnectionPool1.png 975w,\n/static/c642aad3710fb584efa9c79df1e74e5a/4c573/ConnectionPool1.png 1300w,\n/static/c642aad3710fb584efa9c79df1e74e5a/dd200/ConnectionPool1.png 1726w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c642aad3710fb584efa9c79df1e74e5a/663f3/ConnectionPool1.png\"\n            alt=\"ConnectionPool1\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ul>\n<li><code>DriverManager</code>는 항상 신규 커넥션 생성</li>\n<li>매번 커넥션을 새로 생성할 경우 자원 낭비</li>\n<li>해결책 -> 커넥션을 미리 생성해두고 사용하는 커넥션 풀</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b8771766857d0232b884fe05a3ff6cb9/010a2/ConnectionPool2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.852760736196316%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB60lEQVR42o2S22oTYRSF54X0pg/gpSj2Un0DkYqCivgQilgEoRQERfE+F20kVSnBYNOkOTfTNAmTmZwmh8lMJufTJ/svKb3wogvWzP7/2ay999qjJZNJUqkUnucxnU4ZjUaKk8nkkuPxmOVyyWKxULHkyVkwn88VV6uVOmulUolisahYLpep1+uKcl8oFNS9ruvk83mazSbVapVKpYLjOGSzWYLBIKFQSDWlBH3fZzAYqMrSpWA4HJLJZJSYCKXTaWQSy7JUMRFsNBqEw2EVm6apvilB1/Pw+j5936frOOpSkmPxOIlkivNikWg0qkSl6NoSaSKXy+G6LrPZDMMwLgTlMem7zMaS5GPbTTqdNme6zpdPu/i9DjKF2NFqtVQnQhEVsbVVYod4rJ3WurwI1XgeyPP0W4Str8I/PP58yJM9kw8RC5ZzTPNipKuQ5UinYpEUkAm0X3qNO4dwa+eIG1tv2Hi1w81n22y8/Mjtn3MeHdgsxgPMavVyk4Kr8VVoR2Wbh0GPB99Pufs2wOb2D+6922Pz/T73911eH1gwn2Ba1n8F1sLyFmrdrkMse0aiYHBybhL4HSH0N0GqXOM4V0AvGbi9ntrkdaB12m36bg/P6ZKMxzg5jpJJJaiZBoO+h9tzaNq2+sGvI/gP/nHZMiUoiUcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b8771766857d0232b884fe05a3ff6cb9/a81b5/ConnectionPool2.webp 163w,\n/static/b8771766857d0232b884fe05a3ff6cb9/da3ef/ConnectionPool2.webp 325w,\n/static/b8771766857d0232b884fe05a3ff6cb9/309d5/ConnectionPool2.webp 650w,\n/static/b8771766857d0232b884fe05a3ff6cb9/78344/ConnectionPool2.webp 975w,\n/static/b8771766857d0232b884fe05a3ff6cb9/bdb72/ConnectionPool2.webp 1300w,\n/static/b8771766857d0232b884fe05a3ff6cb9/4b981/ConnectionPool2.webp 1716w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b8771766857d0232b884fe05a3ff6cb9/5e043/ConnectionPool2.png 163w,\n/static/b8771766857d0232b884fe05a3ff6cb9/e5cc6/ConnectionPool2.png 325w,\n/static/b8771766857d0232b884fe05a3ff6cb9/663f3/ConnectionPool2.png 650w,\n/static/b8771766857d0232b884fe05a3ff6cb9/d880f/ConnectionPool2.png 975w,\n/static/b8771766857d0232b884fe05a3ff6cb9/4c573/ConnectionPool2.png 1300w,\n/static/b8771766857d0232b884fe05a3ff6cb9/010a2/ConnectionPool2.png 1716w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b8771766857d0232b884fe05a3ff6cb9/663f3/ConnectionPool2.png\"\n            alt=\"ConnectionPool2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ul>\n<li>Application 시작 시점에 필요한 만큼 커넥션 확보해 풀에 보관 (보통 10개, 상황 별 다름)</li>\n<li>적절한 커넥션 풀 숫자는 성능 테스트를 통해 정함</li>\n<li>커넥션 풀은 얻는 이점이 크기 떄문에 <strong>실무에서 항상 기본으로 사용</strong></li>\n<li>커넥션 풀 오픈소스 ex - HikariCP</li>\n<li>성능과 사용의 편리함 측면에서 최근에는 <code>hikariCP</code>주로 사용</li>\n<li>스프링 부트 2.0부터는 기본 커넥션 풀로 <code>hikariCP</code> 제공 (성능, 사용의 편리함, 안전성 검증이 되었다.)</li>\n</ul>\n<h2 id=\"22-datasource\" style=\"position:relative;\"><a href=\"#22-datasource\" aria-label=\"22 datasource permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.2 DataSource</h2>\n<blockquote>\n<p>커넥션을 획득하는 방법을 추상화</p>\n</blockquote>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"67758199378665810000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`public interface DataSource {\n    Connection getConnection() throws SQLException;\n}`, `67758199378665810000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">interface</span><span class=\"mtk1\"> </span><span class=\"mtk10\">DataSource</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">Connection</span><span class=\"mtk1\"> </span><span class=\"mtk11\">getConnection</span><span class=\"mtk1\">() </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">SQLException</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<ul>\n<li>대부분의 커넥션 풀은 <code>DataSource</code> 인터페이스를 이미 구현되어 있어 <code>DBCP2 커넥션 풀</code> ,\n<code>HikariCP 커넥션 풀</code> 의 코드를 직접 의존하는 것이 아니라 <code>DataSource</code> 인터페이스에만 의존하도록 애플리케이션 로직을 작성</li>\n<li>커넥션 풀 구현 기술을 변경하고 싶으면 해당 구현체로 갈아끼우기만 하면 된다.</li>\n<li><code>DriverManager</code>는 <code>DataSource</code>인터페이스를 사용하지 않음</li>\n<li><code>DriverManager</code> 도 <code>DataSource</code> 를 통해서 사용할 수 있도록 <code>DriverManagerDataSource</code>라는 <code>DataSource</code>구현한 클래스 제공</li>\n</ul>\n<hr>\n<ul>\n<li><code>DriverManager</code>는 커넥션 획득할 때 마다 URL, USERNAME, PASSWORD같은 파라미터 계속 전달</li>\n<li>반면에 <code>DataSource</code>를 사용하는 방식은 처음 객체 생성시에만 파라미터 넘겨주고, 커넥션을 획득할 때 <code>dataSource.getConnection()</code>만 호출</li>\n</ul>\n<p>=> 설정과 사용 분리<br>\n=> 리포지토리(Repository)는 <code>DataSource</code> 만 의존하고, 이런 속성을 몰라도 된다.</p>\n<p>커넥션 풀 예제를 실행시키면 별도의 쓰레드를 사용해서 커넥션 풀에 커넥션 채우는 것을 확인가능<br>\n-> 상당히 오래 걸리는 작업, 별도 쓰레드를 사용해야 어플리케이션 실행 시간에 영향을 주지 않는다.</p>\n<p><code>JdbcUtils</code>편의 메서드</p>\n<ul>\n<li>스프링은 JDBC를 편리하게 다룰 수 있는<code>JdbcUtils</code>라는 편의 메서드를 제공</li>\n<li><code>JdbcUtils</code> 을 사용하면 커넥션을 좀 더 편리하게 닫을 수 있다.</li>\n</ul>\n<h1 id=\"3-트랜잭션과-db-lock-이해\" style=\"position:relative;\"><a href=\"#3-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EA%B3%BC-db-lock-%EC%9D%B4%ED%95%B4\" aria-label=\"3 트랜잭션과 db lock 이해 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 트랜잭션과 DB Lock 이해</h1>\n<h2 id=\"31-트랜잭션\" style=\"position:relative;\"><a href=\"#31-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98\" aria-label=\"31 트랜잭션 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.1 트랜잭션</h2>\n<ul>\n<li>모든 작업이 성공해서 DB에 정상 반영 => 커밋</li>\n<li>작업 중 하나라도 실패해서 거래 이전으로 되돌리기 => 롤백</li>\n</ul>\n<p>트랜잭션은 <code>ACID</code>를 보장해야 한다.</p>\n<table>\n<thead>\n<tr>\n<th>종류</th>\n<th>내용</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>원자성(Automicity)</td>\n<td>트랜잭션 내에서 실행한 작업들은 하나의 작업인 것처럼 모두 성공하거나 실패해야 한다</td>\n</tr>\n<tr>\n<td>일관성(Consistency)</td>\n<td>일관성 있는 DB상태 유지, DB에서 정한 무결성 제약조건을 항상 만족해야 한다</td>\n</tr>\n<tr>\n<td>격리성(Isolation)</td>\n<td>동시에 실행되는 트랜잭션들이 서로에게 영향을 미치지 않도록 격리, 격리성은 동시성과 관련된 성능 이슈로 인해 <strong>트랜잭션 격리 수준</strong>을 선택할 수 있다</td>\n</tr>\n<tr>\n<td>지속성(Durability)</td>\n<td>트랜잭션을 성공적으로 끝내면 결과를 항상 기록, 시스템에 문제가 발생해도 DB로그 등을 사용해 성공한 트랜잭션 내용 복구</td>\n</tr>\n</tbody>\n</table>\n<p>문제는 격리성인데 트랜잭션 간에 격리성을 완벽히 보장하려면 트랜잭션을 거의 순서대로 실행해야 한다.</p>\n<p>이렇게 동시 처리하면 성능이 매우 나빠진다.</p>\n<p>ANSI 표준은 트랜잭션을 4단계로 나누어 정의</p>\n<ul>\n<li>READ UNCOMMITED(커밋되지 않은 읽기)</li>\n<li>READ COMMITTED(커밋된 읽기)</li>\n<li>REPEATABLE READ(반복 가능한 읽기)</li>\n<li>SERIALIZABLE(직렬화 가능)</li>\n</ul>\n<p>궁금하면 더 찾아보고 강의에서는 READ COMMITTED(커맷된 읽기)수준을 기준으로 설명</p>\n<hr>\n<p>트랜잭션을 제대로 수행하려면 자동 커밋은 끄고, 수동 커밋을 사용해야 한다.</p>\n<p>에러 상황 가정 - 오토 커밋 모드로 동작할 때 2가지 동작이 중간에 실패하면 -> 1개 성공, 1개 실패<br>\n=> 에러 발생 -> <strong>이런종류의 작업은 꼭 수동 커밋 모드를 사용해 수동으로 커밋, 롤백이 가능</strong>해야 한다.</p>\n<p>보통 이렇게 <strong>자동 커밋 모드에서 수동 커밋 모드로 전환하는 것을 트랜잭션을 시작한다고 표현</strong>한다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"45029001596180220000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`# 자동 커밋 사용\nset autocommit true;\n\n# 수동 커밋 사용\nset autocommit false;`, `45029001596180220000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"sql\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"># 자동 커밋 사용</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">set</span><span class=\"mtk1\"> autocommit true;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"># 수동 커밋 사용</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">set</span><span class=\"mtk1\"> autocommit false;</span></span></span></code></pre>\n<hr>\n<h2 id=\"32-db-lock\" style=\"position:relative;\"><a href=\"#32-db-lock\" aria-label=\"32 db lock permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.2 DB Lock</h2>\n<blockquote>\n<p>세션이 트랜잭션을 시작하고 데이터를 수정하는 동안에는 커밋이나 롤백 전까지 다른 세션에서 해당 데이터를 수정할 수 없게 막는 것</p>\n</blockquote>\n<p>일반적으로 조회 시 락 사용x<br>\n-> 사용하고 싶을 땐 <code>select for update</code>구문 사용</p>\n<p>예제</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"71639280455903860000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`set autocommit false;\nselect * from member where member_id='memberA' for update;`, `71639280455903860000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"sql\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">set</span><span class=\"mtk1\"> autocommit false;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">select</span><span class=\"mtk1\"> * </span><span class=\"mtk4\">from</span><span class=\"mtk1\"> member </span><span class=\"mtk4\">where</span><span class=\"mtk1\"> member_id=</span><span class=\"mtk8\">&#39;memberA&#39;</span><span class=\"mtk1\"> for </span><span class=\"mtk4\">update</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p>락을 걸 때 무한정 기다릴 수 없기 때문에 <code>timeout</code>이 발생한다.</p>\n<hr>\n<ul>\n<li>트랜잭션은 비즈니스 로직이 있는 서비스 계층에서 수행</li>\n<li>즉, 커넥션이 필요</li>\n<li>트랜잭션을 사용하는 동안 같은 커넥션 유지</li>\n<li>같은 트랜잭션을 유지하는 가장 단순한 방법은 파라미터로 전달해서 같은 커넥션이 사용되도록 유지</li>\n</ul>\n<h1 id=\"4-스프링과-문제-해결---트랜잭션\" style=\"position:relative;\"><a href=\"#4-%EC%8A%A4%ED%94%84%EB%A7%81%EA%B3%BC-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0---%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98\" aria-label=\"4 스프링과 문제 해결   트랜잭션 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 스프링과 문제 해결 - 트랜잭션</h1>\n<p>보통 역할에 따라 3가지 계층으로 나눈다.</p>\n<p><strong>프레젠테이션 계층</strong></p>\n<ul>\n<li>UI와 관련된 처리 담당</li>\n<li>웹 요청과 응답</li>\n<li>사용자 요청을 검증</li>\n<li>주 사용 기술: 서블릿과 HTTP 같은 웹 기술, 스프링 MVC</li>\n</ul>\n<p><strong>서비스 계층</strong></p>\n<ul>\n<li>비즈니스 로직을 담당</li>\n<li>주 사용 기술: 가급적 특정 기술에 의존하지 않고, 순수 자바 코드로 작성</li>\n</ul>\n<p><strong>데이터 접근 계층</strong></p>\n<ul>\n<li>실제 데이터베이스에 접근하는 코드</li>\n<li>주 사용 기술: JDBC, JPA, File, Redis, Mongo</li>\n</ul>\n<hr>\n<ul>\n<li>서비스 계층을 특정 기술에 종속적이지 않게 개발해야 한다.</li>\n<li>기술에 종속적인 부분은 프레젠테이션 계층, 데이터 접근 계층에서 가져간다.</li>\n<li>ex - HTTP API사용하다 GRPC같은 기술로 변경해도 프레젠테이션 계층만 변경</li>\n<li>ex - JDBC를 사용하다 JPA로 변경해도 서비스 계층은 변경x</li>\n</ul>\n<p>=> 비즈니스 로직만 구현하고 특정 구현 기술에 의존x<br>\n=> 구현 기술이 변경되어도 변경의 영향 범위 최소화</p>\n<p>JDBC로 작성한 <strong>코드의 문제점은 현재 3가지</strong>가 있다.</p>\n<ul>\n<li>트랜잭션 문제\n<ul>\n<li>JDBC구현 기술이 서비스 계층에 누수\n<ul>\n<li>서비스는 특정 기술에 종속되지 않아야 한다. -> 구현 기술을 변경해도 최대한 유지 가능해야 한다.</li>\n<li><strong>트랜잭션을 적용하면서 결국 서비스 계층에 JDBC구현 기술의 누수 발생</strong></li>\n</ul>\n</li>\n<li>트랜잭션 유지를 위해 커넥션을 파라미터로 넘겨야 한다.</li>\n<li>이에 파생되는 문제, 똑같은 기능도 트랜잭션용 기능과 트랜잭션을 유지하지 않아도 되는 기능으로 분리 필요</li>\n</ul>\n</li>\n<li>예외 누수 문제\n<ul>\n<li>JDBC의 예외가 서비스 계층으로 전파</li>\n<li><code>SQLException</code>발생 -> JDBC예외, JPA나 다른 데이터 접근 기술 사용 시 그에 맞는 예외 필요</li>\n</ul>\n</li>\n<li>JDBC반복 문제\n<ul>\n<li>유사한 반복 코드가 많다. (try, catch, finally)</li>\n<li>커넥션을 열고, PreparedStatement사용, 결과 매핑 등</li>\n</ul>\n</li>\n</ul>\n<p>트랜잭션 문제, 예외 누수 문제, JDBC반복 문제 하나씩 해결해 나간다.</p>\n<hr>\n<h4 id=\"트랜잭션-추상화\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%B6%94%EC%83%81%ED%99%94\" aria-label=\"트랜잭션 추상화 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션 추상화</h4>\n<p>구현 기술마다 트랜잭션을 사용하는 방법이 다르다.</p>\n<ul>\n<li>JDBC : <code>con.setAutoCommit(false)</code></li>\n<li>JPA : <code>transaction.begin()</code></li>\n</ul>\n<p>기술을 변경 시 서비스 계층의 코드도 JPA기술을 사용하도록 수정해야 한다.</p>\n<p>문제를 해결하기 위해 트랜잭션 기능을 추상화</p>\n<p>트랜잭션 추상화 인터페이스를 구현</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"72245091051690330000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`public interface TxManager {\n    begin();\n    commit();\n    rollback();\n}`, `72245091051690330000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">interface</span><span class=\"mtk1\"> </span><span class=\"mtk10\">TxManager</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">begin</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">commit</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">rollback</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><code>TxManager</code> 인터페이스를 기반으로 각각의 기술에 맞는 구현체 생성하면 된다.<br>\n<code>JdbcTxManager</code> - JDBC트랜잭션 기능 구현체<br>\n<code>JpaTxManager</code> - JPA트랜잭션 기능 제공 구현체</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b964d4f4fe6f561299275e6372d2e75d/13d1f/TxManager.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.69325153374233%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABQ0lEQVR42oWS646CQAyFef8H4q8P4B9iYlBBuWiMKMr96qXma4JhWTfbpMxMac857YyRpqms12vxPE+Wy6UsFgvJskyw1+slY/t2nsYMPk3TyPl8lt1uJ47jyHa7ldvtJo/H41M0FF6vVzmdTpqPmCmRAkZRpKBlWWoSQKzTAs6Q0tFmsxHf97VmnKOAsAE4n8/VSayqSoIgkDzPJUkSVQbIfr8X0zRlNpvJ4XBQMb8AL5eLMgEyrIDg2P1+V9WAo862bbEsS+dO7nieRt/3nzaYHyrY4xCN7fl86oWxUgfB1AzYUUXLsNV1/WNt21a96zq9qKIoVAmKOUMABvmQGPKHDTOhLVocLoI9oMyOWfPUhpdBzPj2vsaxMAwViLGsVisFQE0cxxoDCBJAif2rkDc3AFJ8PB71H+2h0HVd7QJiWn4D55H6NDJthhoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b964d4f4fe6f561299275e6372d2e75d/a81b5/TxManager.webp 163w,\n/static/b964d4f4fe6f561299275e6372d2e75d/da3ef/TxManager.webp 325w,\n/static/b964d4f4fe6f561299275e6372d2e75d/309d5/TxManager.webp 650w,\n/static/b964d4f4fe6f561299275e6372d2e75d/78344/TxManager.webp 975w,\n/static/b964d4f4fe6f561299275e6372d2e75d/bdb72/TxManager.webp 1300w,\n/static/b964d4f4fe6f561299275e6372d2e75d/64101/TxManager.webp 1518w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b964d4f4fe6f561299275e6372d2e75d/5e043/TxManager.png 163w,\n/static/b964d4f4fe6f561299275e6372d2e75d/e5cc6/TxManager.png 325w,\n/static/b964d4f4fe6f561299275e6372d2e75d/663f3/TxManager.png 650w,\n/static/b964d4f4fe6f561299275e6372d2e75d/d880f/TxManager.png 975w,\n/static/b964d4f4fe6f561299275e6372d2e75d/4c573/TxManager.png 1300w,\n/static/b964d4f4fe6f561299275e6372d2e75d/13d1f/TxManager.png 1518w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b964d4f4fe6f561299275e6372d2e75d/663f3/TxManager.png\"\n            alt=\"TxManager\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Interface를 구현했으면 구현체를 DI를 통해 주입하면 된다.</p>\n<p>인터페이스에 의존하고 DI를 사용한 덕분에 OCP원칙을 지키게 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7854387f2de77884a9e101c8add24524/e9562/PlatformTransactionManager.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.104294478527606%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABLklEQVR42m1RC8uCQBD0//8qIchehIEopIJF5iMfpaXlo/mY/bhI6OC4nb29udlZ7f1+o6oqpGmKMAzlbJoGavGeOEkS2XEco65ryf9a2uv1EsLL5YL9fi/FJGXufr/jeDzKned5WK/XUkPSLMs+H04Iu67D7XZDURQ4nU64Xq9CNgwDxnEU7DgOlsslDMPAYrHAbreT/E9CPj4cDgiCQAh930cURXg8HlLADhhTbdu2chLTBkX2TapRiVKjTrWfz6ds5SMXsXrDHOsmCr8BC+gPFXNAHAJbo2LG9JLe0Udien0+nyVmvizLf0IlmUl6pes6NpsNXNeFaZpYrVbYbrcSW5aF2WyG+Xwu2LZtqeXA6PVEYd/3opA/86R//ESp4PConEqZy/P80wExO/wDh85d2tmFQgoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7854387f2de77884a9e101c8add24524/a81b5/PlatformTransactionManager.webp 163w,\n/static/7854387f2de77884a9e101c8add24524/da3ef/PlatformTransactionManager.webp 325w,\n/static/7854387f2de77884a9e101c8add24524/309d5/PlatformTransactionManager.webp 650w,\n/static/7854387f2de77884a9e101c8add24524/78344/PlatformTransactionManager.webp 975w,\n/static/7854387f2de77884a9e101c8add24524/bdb72/PlatformTransactionManager.webp 1300w,\n/static/7854387f2de77884a9e101c8add24524/e40a7/PlatformTransactionManager.webp 1438w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7854387f2de77884a9e101c8add24524/5e043/PlatformTransactionManager.png 163w,\n/static/7854387f2de77884a9e101c8add24524/e5cc6/PlatformTransactionManager.png 325w,\n/static/7854387f2de77884a9e101c8add24524/663f3/PlatformTransactionManager.png 650w,\n/static/7854387f2de77884a9e101c8add24524/d880f/PlatformTransactionManager.png 975w,\n/static/7854387f2de77884a9e101c8add24524/4c573/PlatformTransactionManager.png 1300w,\n/static/7854387f2de77884a9e101c8add24524/e9562/PlatformTransactionManager.png 1438w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7854387f2de77884a9e101c8add24524/663f3/PlatformTransactionManager.png\"\n            alt=\"PlatformTransactionManager\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>스프링은 이런 고민 해결해 놨다.</p>\n<p>스프링 트랜잭션 추상화의 핵심은 <code>PlatformTransactionManager</code>인터페이스 이다.</p>\n<p>Tip!!</p>\n<ul>\n<li>스프링 5.3부터는 JDBC트랜잭션을 관리할 때 <code>DataSourceTransactionManager</code>를 상속받아서 기능을 확장한 <code>JdbcTransactionManager</code>를 제공</li>\n<li>기능차이가 크지 않으므로 같은것으로 이해하면 된다.</li>\n</ul>\n<p>PlatformTransactionManager 인터페이스</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"78951546807847880000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`package org.springframework.transaction;\n\npublic interface PlatformTransactionManager extends TransactionManager {\n    TransactionStatus getTransaction(@Nullable TransactionDefinition definition) throws TransactionException;\n    void commit(TransactionStatus status) throws TransactionException;\n    void rollback(TransactionStatus status) throws TransactionException;\n}`, `78951546807847880000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">package</span><span class=\"mtk1\"> org.springframework.transaction;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">interface</span><span class=\"mtk1\"> </span><span class=\"mtk10\">PlatformTransactionManager</span><span class=\"mtk1\"> </span><span class=\"mtk4\">extends</span><span class=\"mtk1\"> </span><span class=\"mtk10\">TransactionManager</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">TransactionStatus</span><span class=\"mtk1\"> </span><span class=\"mtk11\">getTransaction</span><span class=\"mtk1\">(@</span><span class=\"mtk10\">Nullable</span><span class=\"mtk1\"> </span><span class=\"mtk10\">TransactionDefinition</span><span class=\"mtk1\"> </span><span class=\"mtk12\">definition</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">TransactionException</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">commit</span><span class=\"mtk1\">(</span><span class=\"mtk10\">TransactionStatus</span><span class=\"mtk1\"> </span><span class=\"mtk12\">status</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">TransactionException</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">rollback</span><span class=\"mtk1\">(</span><span class=\"mtk10\">TransactionStatus</span><span class=\"mtk1\"> </span><span class=\"mtk12\">status</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">TransactionException</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<ul>\n<li><code>getTransaction()</code>\n<ul>\n<li>이름이 <code>getTransaction()</code>인 이유는 이미 진행중인 트랜잭션이 있는 경우 해당 트랜잭션에 참여할 수 있기 때문 (시작이라고 이해하면 된다.)</li>\n</ul>\n</li>\n<li><code>commit</code> : 트랜잭션 커밋</li>\n<li><code>rollback</code> : 트랜잭션을 롤백</li>\n</ul>\n<p>앞으로 <code>PlatformTransactionManager</code> 인터페이스와 구현체를 포함해서 <strong>트랜잭션 매니저</strong>로 줄여서 부른다.</p>\n<hr>\n<h4 id=\"트랜잭션-동기화\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EB%8F%99%EA%B8%B0%ED%99%94\" aria-label=\"트랜잭션 동기화 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션 동기화</h4>\n<p>스프링이 제공하는 트랜잭션 매니저는 크게 2가지 역할을 한다.</p>\n<ul>\n<li>트랜잭션 추상화</li>\n<li>리소스 동기화</li>\n</ul>\n<p>이전까지 예제에서는 같은 커넥션을 사용하기 위해서 파라미터로 커넥션을 전달해서 사용<br>\n-> 스프링에선 <strong>트랜잭션 동기화 매니저</strong> 제공</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dc065dfd442bdcaa84bed3bd518729ab/e7c3c/transactionManager.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.80368098159509%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABf0lEQVR42nWTW86CQAyFZ/8L4MkduAfefTTGKN4iGsU7gop3z5+vyfxBA03KDJ1Oe07bcf1+X4PBQOPxWOzb7bZarZatm81GdfL5fHQ6nZSmqY7Hoyn/7vV66fl86v1+63w+K0kSbbdb0+VyabbD4aDFYqHr9Wq+3GE/n89VFIXyPDddrVZy5ay3280CEgidzWaWFfvlcrHg/KMg6vV6CoJAYRhqOBxqNBp9B4QGFNbrtWXOssxsVQIjklCaTqej3W5nKN2vIyjIzoXH42FrnUD9fr9rv99biRAHAo8CRNRhMplYRvYE9+h/EdI03xD8CfyFEAOH3W7XgpKVElQJ6PEvJ8PXcYlDhG5Co9ykOoTcwb98hq9rNBqKosguT6dTqwlUaQwZKXRVQMYHhH4aPBtHMMYAoSZkBqXvoqdchZAz7AT/R1huCga6zIthrkBAo+pq+EvZEPLxNWRfVjpXhxAWlIaklIcVhq7ZbCqO469hxYEXA1pPp07w8U+UOfwDSJ/oJ2YslGYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/dc065dfd442bdcaa84bed3bd518729ab/a81b5/transactionManager.webp 163w,\n/static/dc065dfd442bdcaa84bed3bd518729ab/da3ef/transactionManager.webp 325w,\n/static/dc065dfd442bdcaa84bed3bd518729ab/309d5/transactionManager.webp 650w,\n/static/dc065dfd442bdcaa84bed3bd518729ab/78344/transactionManager.webp 975w,\n/static/dc065dfd442bdcaa84bed3bd518729ab/bdb72/transactionManager.webp 1300w,\n/static/dc065dfd442bdcaa84bed3bd518729ab/9039b/transactionManager.webp 1448w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/dc065dfd442bdcaa84bed3bd518729ab/5e043/transactionManager.png 163w,\n/static/dc065dfd442bdcaa84bed3bd518729ab/e5cc6/transactionManager.png 325w,\n/static/dc065dfd442bdcaa84bed3bd518729ab/663f3/transactionManager.png 650w,\n/static/dc065dfd442bdcaa84bed3bd518729ab/d880f/transactionManager.png 975w,\n/static/dc065dfd442bdcaa84bed3bd518729ab/4c573/transactionManager.png 1300w,\n/static/dc065dfd442bdcaa84bed3bd518729ab/e7c3c/transactionManager.png 1448w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/dc065dfd442bdcaa84bed3bd518729ab/663f3/transactionManager.png\"\n            alt=\"transactionManager\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ul>\n<li>트랜잭션 동기화 매니저는 쓰레드 로컬을 사용해 커넥션을 동기화</li>\n<li>트랜잭션 매니저는 내부에서 이 <strong>트랜잭션 동기화 매니저</strong> 사용</li>\n</ul>\n<p>동작 방식 설명</p>\n<ol>\n<li>트랜잭션 매니저는 데이터 소스를 통해 커넥션을 만들고 트랜잭션 시작</li>\n<li>트랜잭션 매니저는 트랜잭션이 시작된 커넥션을 트랜잭션 동기화 매니저에 보관</li>\n<li>Repository는 트랜잭션 동기화 매니저에 보관된 커넥션을 꺼내서 사용</li>\n<li>트랜잭션이 종료되면 트랜잭션 매니저는 트랜잭션 동기화 매니저에 보관된 커넥션을 통해 트랜잭션 종료 후 커넥션을 닫는다.</li>\n</ol>\n<p>쓰레드 로컬 관련된 내용은 추후 스프링 고급편에서 설명</p>\n<p>여기서 핵심은 트랜잭션 매니저가 트랜잭션을 실행하면 트랜잭션 동기화 매니저라는 곳에다 트랜잭션을 보관한다.</p>\n<p>Repository에서 필요할 때 가져다 쓴다.</p>\n<hr>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"12983099549369514000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`private void close(Connection con, Statement stmt, ResultSet rs) { JdbcUtils.closeResultSet(rs);\n    JdbcUtils.closeStatement(stmt);\n    //주의! 트랜잭션 동기화를 사용하려면 DataSourceUtils를 사용해야 한다.\n    DataSourceUtils.releaseConnection(con, dataSource);\n}\nprivate Connection getConnection() throws SQLException {\n    //주의! 트랜잭션 동기화를 사용하려면 DataSourceUtils를 사용해야 한다.\n    Connection con = DataSourceUtils.getConnection(dataSource);\n    log.info(&quot;get connection={} class={}&quot;, con, con.getClass());\n    return con;\n}`, `12983099549369514000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">close</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Connection</span><span class=\"mtk1\"> con, </span><span class=\"mtk10\">Statement</span><span class=\"mtk1\"> stmt, </span><span class=\"mtk10\">ResultSet</span><span class=\"mtk1\"> rs) { </span><span class=\"mtk12\">JdbcUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">closeResultSet</span><span class=\"mtk1\">(rs);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">JdbcUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">closeStatement</span><span class=\"mtk1\">(stmt);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//주의! 트랜잭션 동기화를 사용하려면 DataSourceUtils를 사용해야 한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">DataSourceUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">releaseConnection</span><span class=\"mtk1\">(con, dataSource);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Connection</span><span class=\"mtk1\"> </span><span class=\"mtk11\">getConnection</span><span class=\"mtk1\">() throws SQLException {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//주의! 트랜잭션 동기화를 사용하려면 DataSourceUtils를 사용해야 한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">Connection</span><span class=\"mtk1\"> </span><span class=\"mtk12\">con</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">DataSourceUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getConnection</span><span class=\"mtk1\">(dataSource);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;get connection={} class={}&quot;</span><span class=\"mtk1\">, con, </span><span class=\"mtk12\">con</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getClass</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> con;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><code>DataSourceUtils.getConnection()</code>은 <strong>트랜잭션 동기화 매니저가 관리하는 커넥션이 있으면 해당 커넥션을 반환</strong>하고, 없는 경우 새로운 커넥션을 생성해 반환</p>\n<p><code>DataSourceUtils.releaseConnection()</code>을 <strong>사용하면 커넥션을 바로 닫는것이 아니라 트랜잭션을 사용하기 위해 동기화된 커넥션은 유지</strong>하고, 트랜잭션 동기화 매니저가 관리하는 커넥션이 없는 경우 해당 커넥션을 닫는다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"97675884569911310000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`/**\n * 트랜잭션 - 트랜잭션 매니저 사용해 파라미터로 전달하지 않아도 된다.\n */\n@Slf4j\n@RequiredArgsConstructor // 생성자를 만들어 주는 어노테이션\npublic class MemberServiceV3_1 {\n\n    private final PlatformTransactionManager transactionManager;\n    private final MemberRepositoryV3 memberRepository;\n\n//    public MemberServiceV1(MemberRepositoryV1 memberRepositoryV1){\n//        this.memberRepositoryV1 = memberRepositoryV1;\n//    }\n\n    public void accountTransfer(String fromId, String toId, int money) throws SQLException {\n         TransactionStatus status = transactionManager.getTransaction(new DefaultTransactionDefinition());\n\n        try {\n            bizLogic(fromId, toId, money);\n            transactionManager.commit(status); //성공시 커밋\n        } catch (Exception e) {\n            transactionManager.rollback(status ); //실패시 롤백\n            throw new IllegalStateException(e);\n        }\n    }\n\n    private void bizLogic(String fromId, String toId, int\n            money) throws SQLException {\n        Member fromMember = memberRepository.findById(fromId);\n        Member toMember = memberRepository.findById(toId);\n        memberRepository.update(fromId, fromMember.getMoney() - money);\n        validation(toMember);\n        memberRepository.update(toId, toMember.getMoney() + money);\n    }\n\n    private void validation(Member toMember) {\n        if (toMember.getMemberId().equals(&quot;ex&quot;)) {\n            throw new IllegalStateException(&quot;이체중 예외 발생&quot;);\n        }\n    }\n\n    private void release(Connection con) {\n        if (con != null) {\n            try {\n                con.setAutoCommit(true); //커넥션 풀 고려 con.close();\n            } catch (Exception e) {\n                log.info(&quot;error&quot;, e);\n            }\n        }\n    }\n}`, `97675884569911310000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"> * 트랜잭션 - 트랜잭션 매니저 사용해 파라미터로 전달하지 않아도 된다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"> */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Slf4j</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">RequiredArgsConstructor</span><span class=\"mtk1\"> </span><span class=\"mtk3\">// 생성자를 만들어 주는 어노테이션</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">MemberServiceV3_1</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">PlatformTransactionManager</span><span class=\"mtk1\"> </span><span class=\"mtk12\">transactionManager</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">MemberRepositoryV3</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memberRepository</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//    public MemberServiceV1(MemberRepositoryV1 memberRepositoryV1){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//        this.memberRepositoryV1 = memberRepositoryV1;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">accountTransfer</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">fromId</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">toId</span><span class=\"mtk1\">, </span><span class=\"mtk10\">int</span><span class=\"mtk1\"> </span><span class=\"mtk12\">money</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">SQLException</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk10\">TransactionStatus</span><span class=\"mtk1\"> </span><span class=\"mtk12\">status</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">transactionManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getTransaction</span><span class=\"mtk1\">(</span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DefaultTransactionDefinition</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk11\">bizLogic</span><span class=\"mtk1\">(fromId, toId, money);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">transactionManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">commit</span><span class=\"mtk1\">(status); </span><span class=\"mtk3\">//성공시 커밋</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">Exception</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">transactionManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">rollback</span><span class=\"mtk1\">(status ); </span><span class=\"mtk3\">//실패시 롤백</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">IllegalStateException</span><span class=\"mtk1\">(e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">bizLogic</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">fromId</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">toId</span><span class=\"mtk1\">, </span><span class=\"mtk10\">int</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">money</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">SQLException</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Member</span><span class=\"mtk1\"> </span><span class=\"mtk12\">fromMember</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">memberRepository</span><span class=\"mtk1\">.</span><span class=\"mtk11\">findById</span><span class=\"mtk1\">(fromId);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Member</span><span class=\"mtk1\"> </span><span class=\"mtk12\">toMember</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">memberRepository</span><span class=\"mtk1\">.</span><span class=\"mtk11\">findById</span><span class=\"mtk1\">(toId);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">memberRepository</span><span class=\"mtk1\">.</span><span class=\"mtk11\">update</span><span class=\"mtk1\">(fromId, </span><span class=\"mtk12\">fromMember</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMoney</span><span class=\"mtk1\">() - money);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">validation</span><span class=\"mtk1\">(toMember);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">memberRepository</span><span class=\"mtk1\">.</span><span class=\"mtk11\">update</span><span class=\"mtk1\">(toId, </span><span class=\"mtk12\">toMember</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMoney</span><span class=\"mtk1\">() + money);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">validation</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Member</span><span class=\"mtk1\"> </span><span class=\"mtk12\">toMember</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">toMember</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMemberId</span><span class=\"mtk1\">().</span><span class=\"mtk11\">equals</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;ex&quot;</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">IllegalStateException</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;이체중 예외 발생&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">release</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Connection</span><span class=\"mtk1\"> </span><span class=\"mtk12\">con</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (con != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">con</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setAutoCommit</span><span class=\"mtk1\">(</span><span class=\"mtk4\">true</span><span class=\"mtk1\">); </span><span class=\"mtk3\">//커넥션 풀 고려 con.close();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">Exception</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;error&quot;</span><span class=\"mtk1\">, e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><code>private final PlatformTransactionManager transactionManager</code></p>\n<ul>\n<li>트랜잭션 매니저를 주입받는다. JDBC를 사용하기 때문에 <code>DataSourceTransactionManager</code> 주입</li>\n<li>JPA로 변경 시 <code>JpaTransactionManager</code> 를 주입 받으면 된다.</li>\n</ul>\n<p><code>transactionManager.getTransaction()</code></p>\n<ul>\n<li>트랜잭션을 시작</li>\n<li><code>TransactionStatus status</code> 를 반환, 현재 트랜잭션의 상태 정보가 포함되어 있고, 트랜잭\n션을 커밋, 롤백할 때 필요하다.</li>\n</ul>\n<p><code>transactionManager.commit(status)</code></p>\n<ul>\n<li>트랜잭션 커밋</li>\n</ul>\n<p><code>transactionManager.rollback(status)</code></p>\n<ul>\n<li>트랜잭션 롤백</li>\n</ul>\n<hr>\n<h4 id=\"트랜잭션-매니저의-전체-동작-흐름\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EB%A7%A4%EB%8B%88%EC%A0%80%EC%9D%98-%EC%A0%84%EC%B2%B4-%EB%8F%99%EC%9E%91-%ED%9D%90%EB%A6%84\" aria-label=\"트랜잭션 매니저의 전체 동작 흐름 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션 매니저의 전체 동작 흐름</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4c0b4c169acbfefd643660c90b19be47/e1749/tm1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.03067484662577%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABf0lEQVR42oWT266CQAxF5///gnf9DROffDWIiYqAgnfwAoI1q0nJHKM5TSYzzLS7e7fFnc9nmU6nEsexbLdbmc/nslwu5fF4SNu28nq9BGPvuk7M+H4+n9I0jfpx5t1xAPR6verjer2WKIokyzJdRVHIYDCQ1WqlCcuylNvtJpfLRX3Z8zzXdTgcxPkZsf1+L0mS9ICn00nvdrudBi0WC71P01SVDYdDCcOwJ9EDmt3vd9lsNgpExqqq+jfUoIS9rms5Ho8yGo36hPj+AYQlC5lIJCtsqY0p8M3qRqk4Y86XyyWZTBZnWH4zGPKOElNDfd2nXGQYO5Py2V0M6QD4yrQpgDAmlpVsNhIAkcAHNLNO2+iw4+toQBAEesFYUD+KCzNY4MScfWsejIhnAa6ABDEClhWGMEUOSQj6xdAmwJqmkk2/n5WBnc1m2hjq+F8NDRRfB9XJZKKOSOMSUMCQAONvZuxRx29LqSDkCBiPx/1/y6LI/I6/5s83CAFsdX4De5XpUKV22VEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4c0b4c169acbfefd643660c90b19be47/a81b5/tm1.webp 163w,\n/static/4c0b4c169acbfefd643660c90b19be47/da3ef/tm1.webp 325w,\n/static/4c0b4c169acbfefd643660c90b19be47/309d5/tm1.webp 650w,\n/static/4c0b4c169acbfefd643660c90b19be47/78344/tm1.webp 975w,\n/static/4c0b4c169acbfefd643660c90b19be47/bdb72/tm1.webp 1300w,\n/static/4c0b4c169acbfefd643660c90b19be47/b80ee/tm1.webp 2230w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4c0b4c169acbfefd643660c90b19be47/5e043/tm1.png 163w,\n/static/4c0b4c169acbfefd643660c90b19be47/e5cc6/tm1.png 325w,\n/static/4c0b4c169acbfefd643660c90b19be47/663f3/tm1.png 650w,\n/static/4c0b4c169acbfefd643660c90b19be47/d880f/tm1.png 975w,\n/static/4c0b4c169acbfefd643660c90b19be47/4c573/tm1.png 1300w,\n/static/4c0b4c169acbfefd643660c90b19be47/e1749/tm1.png 2230w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4c0b4c169acbfefd643660c90b19be47/663f3/tm1.png\"\n            alt=\"tm1\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol>\n<li>서비스 계층에서 <code>transactionManager.getTransaction()</code>을 호출해서 트랜잭션을 시작</li>\n<li>트랜잭션 매니저 내부에서 데이터 소스를 생성해 커넥션 생성</li>\n<li>커넥션을 수동 커밋모드로 변경해 실제 DB트랜잭션 시작</li>\n<li>커넥션을 트랜잭션 동기화 매니저에 보관</li>\n<li>트랜잭션 동기화 매니저는 쓰레드 로컬에 커넥션 보관 (멀티 쓰레드 환경에서 안전하게 커넥션 보관)</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/30ce45ba86ba4fbedfe70a7cfe6084e0/e249b/tm2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.190184049079754%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABaElEQVR42nWTyw6CQAxF+f+lf+POnWuXJqiJgIgvkKf4qjlNOhkUmzQDzPTctlMCEZH3+80iVVXJ4XCQoijkeDxKWZbi7/uW57lcLhc9w3meiQ/8ADa2262kaarA0+nkgOZmCK9WK1kulxLHsWRZpjE/wCiKZL/fy263U9V/GZLNfD6XyWQi6/VawjDU+MA/RODr9XJuoPv9rgDKRBBHsK5r/Xa73Vz8AIgCPSGY9Xq96vfn8ylt26oDYWUPKC2iImJJwgHJgj4kSSKbzUaf6ZOpf9v5fFYhqwQgYgMgPcO5FDL0yxm7ZRyQ9XQARMlUgfAO3Eq1jLn5vu8VMJvNZDqdujFrmuYXyEGCUGO1+bJscN4ZFZtbGzEFAsIej4cDAWGTlWzGjD1/nIgblEyg9Y+BtZuj3LHhJrOu67T3tMmqCxaLhQugT0CBUSKlWAXfBoyzNpMAqVKBpspKpsBQ/gfzfwSyoj1mH7nh6x6+y7HcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/30ce45ba86ba4fbedfe70a7cfe6084e0/a81b5/tm2.webp 163w,\n/static/30ce45ba86ba4fbedfe70a7cfe6084e0/da3ef/tm2.webp 325w,\n/static/30ce45ba86ba4fbedfe70a7cfe6084e0/309d5/tm2.webp 650w,\n/static/30ce45ba86ba4fbedfe70a7cfe6084e0/78344/tm2.webp 975w,\n/static/30ce45ba86ba4fbedfe70a7cfe6084e0/bdb72/tm2.webp 1300w,\n/static/30ce45ba86ba4fbedfe70a7cfe6084e0/57a23/tm2.webp 2192w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/30ce45ba86ba4fbedfe70a7cfe6084e0/5e043/tm2.png 163w,\n/static/30ce45ba86ba4fbedfe70a7cfe6084e0/e5cc6/tm2.png 325w,\n/static/30ce45ba86ba4fbedfe70a7cfe6084e0/663f3/tm2.png 650w,\n/static/30ce45ba86ba4fbedfe70a7cfe6084e0/d880f/tm2.png 975w,\n/static/30ce45ba86ba4fbedfe70a7cfe6084e0/4c573/tm2.png 1300w,\n/static/30ce45ba86ba4fbedfe70a7cfe6084e0/e249b/tm2.png 2192w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/30ce45ba86ba4fbedfe70a7cfe6084e0/663f3/tm2.png\"\n            alt=\"tm2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol start=\"6\">\n<li>서비스의 비즈니스 로직이 실행되면서 Repository 메서드 호출 (커넥션으로 파라미터 전달x)</li>\n<li>Repository메서드들은 트랜잭션이 시작된 커넥션 필요\n<ul>\n<li><code>DataSourceUtils.getConnection()</code>을 사용해 보관된 커넥션을 꺼내서 사용</li>\n<li>자연스럽게 같은 커넥션 사용, 트랜잭션도 유지</li>\n</ul>\n</li>\n<li>획득한 커넥션을 사용해 SQL을 DB에 전달해 실행</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/69e33e6c7ed1f9d3ab3f5196381a11a1/53e1c/tm3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.6441717791411%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABgElEQVR42n2TXa6CMBCF2f8zm3AdbIBoYoI+oCLiD6IICgg4N9+YEiBym0xopzOn55wWS0ajKArJ81zj9Xpprq5reb/fg7q2beX5fMrj8dDaLMukqiqx+kU0Ho9HuV6vcrvdJAgC2e/3mgvDUJvTNNVDL5eLnE4nBSXHOo7jL+Dn81HApmm0EZDz+Sye58lsNtM5eYDv97s2s3ZdV2zblvl8LovFQg+wxpJ3u51u0AQQrGGEfCSZw8nDeLlcKkPm1FiwQj8eQR8WgBKbzUZZ/xoAA4qXfM1cATEVsMPhoP4BCjs8QWLflv7loYJ9wtR2kmEJGMn1ei3b7ba7nF8DiYCagcIkSb6ALGCJF2VZqkzoM59iCAFU0UvgX8cQ/QAaY2FG0MQhU4DsRVGkViGZtUUhASCb3CTM+CJpSjKAfcnUUzt4NlwEzPCQYP2fh+ZPGnjo+77SZeAJgOYNkqfx1wCAfd4skqmHteU4jqxWq84nwvxiXMzYu/H/DCueGZIZf0LJ6lUpcs73AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/69e33e6c7ed1f9d3ab3f5196381a11a1/a81b5/tm3.webp 163w,\n/static/69e33e6c7ed1f9d3ab3f5196381a11a1/da3ef/tm3.webp 325w,\n/static/69e33e6c7ed1f9d3ab3f5196381a11a1/309d5/tm3.webp 650w,\n/static/69e33e6c7ed1f9d3ab3f5196381a11a1/78344/tm3.webp 975w,\n/static/69e33e6c7ed1f9d3ab3f5196381a11a1/bdb72/tm3.webp 1300w,\n/static/69e33e6c7ed1f9d3ab3f5196381a11a1/41513/tm3.webp 2200w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/69e33e6c7ed1f9d3ab3f5196381a11a1/5e043/tm3.png 163w,\n/static/69e33e6c7ed1f9d3ab3f5196381a11a1/e5cc6/tm3.png 325w,\n/static/69e33e6c7ed1f9d3ab3f5196381a11a1/663f3/tm3.png 650w,\n/static/69e33e6c7ed1f9d3ab3f5196381a11a1/d880f/tm3.png 975w,\n/static/69e33e6c7ed1f9d3ab3f5196381a11a1/4c573/tm3.png 1300w,\n/static/69e33e6c7ed1f9d3ab3f5196381a11a1/53e1c/tm3.png 2200w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/69e33e6c7ed1f9d3ab3f5196381a11a1/663f3/tm3.png\"\n            alt=\"tm3\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol start=\"9\">\n<li>비즈니스 로직이 끝나고 트랜잭션 종료, 트랜잭션은 커밋하거나 롤백하면 종료</li>\n<li>트랜잭션을 종료하면 동기화된 커넥션 필요, 트랜잭션 동기화 매니저를 통해 동기화된 커넥션 획득</li>\n<li>획득한 커넥션을 통해 DB에 트랜잭션을 커밋하거나 롤백</li>\n<li>전체 리소스 정리</li>\n</ol>\n<hr>\n<p>트랜잭션 추상화 덕분에 서비스 코드는 JDBC기술에 의존 x</p>\n<ul>\n<li>기술 변경 시 의존관계 주입만 <code>DataSourceTransactionManager</code>에서 <code>JpaTransactionManager</code>로 변경해주면 된다.</li>\n<li><code>java.sql.SQLException</code>은 남아있지만 뒤에서 예외 문제 해결</li>\n<li>트랜잭션 동기화 매니저 덕분에 커넥션을 파라미터로 넘기지 않아도 된다.</li>\n</ul>\n<hr>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"77681554757381200000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`//트랜잭션 시작\nTransactionStatus status = transactionManager.getTransaction(new DefaultTransactionDefinition());\n\ntry {\n//비즈니스 로직\n    bizLogic(fromId, toId, money);\n    transactionManager.commit(status); //성공시 커밋\n} catch (Exception e) {\n    transactionManager.rollback(status); //실패시 롤백\n    throw new IllegalStateException(e);\n}`, `77681554757381200000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//트랜잭션 시작</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">TransactionStatus</span><span class=\"mtk1\"> </span><span class=\"mtk12\">status</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">transactionManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getTransaction</span><span class=\"mtk1\">(</span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DefaultTransactionDefinition</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//비즈니스 로직</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">bizLogic</span><span class=\"mtk1\">(fromId, toId, money);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">transactionManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">commit</span><span class=\"mtk1\">(status); </span><span class=\"mtk3\">//성공시 커밋</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">} </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">Exception</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">transactionManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">rollback</span><span class=\"mtk1\">(status); </span><span class=\"mtk3\">//실패시 롤백</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">IllegalStateException</span><span class=\"mtk1\">(e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<ul>\n<li>트랜잭션을 시작하고, 비즈니스 로직 실행, 성공 시 커밋, 예외 시 롤백</li>\n<li>try, catch를 포함해 반복된다.</li>\n<li>이럴 경우 <strong>템플릿 콜백 패턴</strong>을 활용하면 반복 문제를 깔끔하게 해결할 수 있다.</li>\n<li>템플릿 콜백 패턴 이해를 못해도 괜찮다. 추후에 고급편 강의에서 자세히 다룬다.</li>\n<li>지금은 스프링이 <code>TransactionTemplate</code>라는 편리한 기능을 제공하는 구나 라고 이해</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"89352486675427600000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`public class TransactionTemplate {\n    private PlatformTransactionManager transactionManager;\n\n    public <T> T execute(TransactionCallback<T> action){..}\n    void executeWithoutResult(Consumer<TransactionStatus> action){..}\n}`, `89352486675427600000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">TransactionTemplate</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">PlatformTransactionManager</span><span class=\"mtk1\"> </span><span class=\"mtk12\">transactionManager</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> &lt;</span><span class=\"mtk10\">T</span><span class=\"mtk1\">&gt; </span><span class=\"mtk10\">T</span><span class=\"mtk1\"> </span><span class=\"mtk11\">execute</span><span class=\"mtk1\">(</span><span class=\"mtk10\">TransactionCallback</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">T</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">action</span><span class=\"mtk1\">){..}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">executeWithoutResult</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Consumer</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">TransactionStatus</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">action</span><span class=\"mtk1\">){..}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><code>execute()</code> : 응답 값이 있을 때 사용한다.\n<code>executeWithoutResult()</code> : 응답 값이 없을 때 사용한다.</p>\n<p>여기서 잠깐 정리하고 가면</p>\n<p>V0 -> JDBC DriverManager사용\nV1 -> DataSource 사용, JdbcUtils 사용\nV2 -> 트랜잭션 - 파라미터 연동, 풀을 고려한 종료 (파라미터로 커넥션 전달)\nV3_1 -> DataSourceUtils 사용 (파라미터로 전달하지 않아도 된다.)\nV3_2 -> try, catch등 반복문제 제거</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"86770224397107720000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`public class MemberServiceV3_2 {\n    private final TransactionTemplate txTemplate;\n    private final MemberRepositoryV3 memberRepository;\n\n    public MemberServiceV3_2(PlatformTransactionManager transactionManager,\n        MemberRepositoryV3 memberRepository) {\n        this.txTemplate = new TransactionTemplate(transactionManager);\n        this.memberRepository = memberRepository;\n    }\n    ...\n\n    public void accountTransfer(String fromId, String toId, int money) throws SQLException {\n        txTemplate.executeWithoutResult((status) -> {\n            //비즈니스 로직\n            try {\n                bizLogic(fromId, toId, money);\n            } catch (SQLException e) {\n                throw new IllegalStateException(e);\n            }\n        });\n    }`, `86770224397107720000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">MemberServiceV3_2</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">TransactionTemplate</span><span class=\"mtk1\"> </span><span class=\"mtk12\">txTemplate</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">MemberRepositoryV3</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memberRepository</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MemberServiceV3_2</span><span class=\"mtk1\">(</span><span class=\"mtk10\">PlatformTransactionManager</span><span class=\"mtk1\"> </span><span class=\"mtk12\">transactionManager</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">MemberRepositoryV3</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memberRepository</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">txTemplate</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">TransactionTemplate</span><span class=\"mtk1\">(transactionManager);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">memberRepository</span><span class=\"mtk1\"> = memberRepository;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">accountTransfer</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">fromId</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">toId</span><span class=\"mtk1\">, </span><span class=\"mtk10\">int</span><span class=\"mtk1\"> </span><span class=\"mtk12\">money</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">SQLException</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">txTemplate</span><span class=\"mtk1\">.</span><span class=\"mtk11\">executeWithoutResult</span><span class=\"mtk1\">((status) </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">//비즈니스 로직</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk11\">bizLogic</span><span class=\"mtk1\">(fromId, toId, money);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">SQLException</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">IllegalStateException</span><span class=\"mtk1\">(e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><code>PlatformTransactionManager</code>을 주입받아 <code>TransactionTemplate</code>로 감쌌는데 여러 이유가 있는데</p>\n<ol>\n<li>관례적</li>\n<li><code>TransactionTemplate</code>은 클래스이다. 유연성이 별로 없음</li>\n</ol>\n<p><code>executeWithoutResult</code> 이 코드가 성공적으로 반환 -> Commit, 언체크 예외 -> Rollback (체크 예외의 경우엔 커밋하는데 이부분은 뒤에서 설명 / 소스에선 언체크 예외로 던진다.)</p>\n<p>완벽한 이해는 고급편 이후로 미뤄두자</p>\n<hr>\n<p>정리</p>\n<ul>\n<li>트랜잭션 템플릿 덕분에 트랜잭션 사용 시 반복 코드 제거</li>\n<li>서비스 로직인데 비즈니스 로직 뿐만 아니라 트랜잭션을 처리하는 기술 로직이 함께 포함되어 있다.</li>\n<li>비즈니스 로직과 트랜잭션을 처리하는 기술 로직이 한 곳에 있으면 두 관심사를 하나의 클래스에서 처리하게 된다</li>\n</ul>\n<hr>\n<h4 id=\"트랜잭션-aop\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-aop\" aria-label=\"트랜잭션 aop permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션 AOP</h4>\n<p>아직 서비스에 비즈니스 로직과 트랜잭션 처리 로직이 함께 섞여있다.</p>\n<ul>\n<li>트랜잭션 프록시를 도입하면 트랜잭션 처리 로직을 모두 가져간다.</li>\n<li>트랜잭션을 시작한 후에 실제 서 비스를 대신 호출한다.</li>\n</ul>\n<p><code>@Transactional</code></p>\n<ul>\n<li>개발자는 트랜잭션 처리가 필요한 곳에 <code>@Transactional</code> 애노테이션만 붙여주면 된다.</li>\n<li>스프링의 트랜잭션 AOP는 이 애노테이션을 인식해서 트랜잭션 프록시를 적용해준다.</li>\n<li>스프링 AOP를 적용하려면 어드바이저, 포인트컷, 어드바이스가 필요하다.</li>\n<li>스프링은 트랜잭션 AOP 처리를 위해 아래와 같은 클래스를 제공한다.</li>\n<li>스프링 부트를 사용하면 해당 빈들은 스프링 컨테이너에 자동으로 등록된다.</li>\n</ul>\n<p>어드바이저: <code>BeanFactoryTransactionAttributeSourceAdvisor</code><br>\n포인트컷: <code>TransactionAttributeSourcePointcut</code><br>\n어드바이스: <code>TransactionInterceptor</code></p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"34381465735272300000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@Transactional\npublic void accountTransfer(String fromId, String toId, int money) throws SQLException {\n    bizLogic(fromId, toId, money);\n}`, `34381465735272300000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Transactional</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">accountTransfer</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> fromId, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> toId, </span><span class=\"mtk10\">int</span><span class=\"mtk1\"> money) throws SQLException {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">bizLogic</span><span class=\"mtk1\">(fromId, toId, money);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<ul>\n<li><code>@Transactional</code> 애노테이션은 메서드에 붙여도 되고, 클래스에 붙여도 된다.</li>\n<li>클래스에 붙이면 외부에서 호출 가능한 <code>public</code> 메서드가 AOP 적용 대상이 된다.</li>\n</ul>\n<hr>\n<p>@Transaction Test 코드를 짜다보면 스프링 컨테이너를 쓰고 있지 않아서 @Transaction 적용이 되지 않는다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"23426625033081373000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@Slf4j\n@SpringBootTest\nclass MemberServiceV3_3Test {\n    ...\n    @Autowired\n    MemberRepositoryV3 memberRepository;\n    @Autowired\n    MemberServiceV3_3 memberService;\n\n    ...\n\n    @TestConfiguration\n    static class TestConfig {\n        @Bean\n        DataSource dataSource() {\n            return new DriverManagerDataSource(URL, USERNAME, PASSWORD);\n        }\n        @Bean\n        PlatformTransactionManager transactionManager() {\n            return new DataSourceTransactionManager(dataSource());\n        }\n        @Bean\n        MemberRepositoryV3 memberRepositoryV3() {\n            return new MemberRepositoryV3(dataSource());\n        }\n        @Bean\n        MemberServiceV3_3 memberServiceV3_3() {\n            return new MemberServiceV3_3(memberRepositoryV3());\n        }\n    }\n}`, `23426625033081373000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Slf4j</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">SpringBootTest</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">MemberServiceV3_3Test</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Autowired</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">MemberRepositoryV3</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memberRepository</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Autowired</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">MemberServiceV3_3</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memberService</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">TestConfiguration</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">TestConfig</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">DataSource</span><span class=\"mtk1\"> </span><span class=\"mtk11\">dataSource</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DriverManagerDataSource</span><span class=\"mtk1\">(URL, USERNAME, PASSWORD);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">PlatformTransactionManager</span><span class=\"mtk1\"> </span><span class=\"mtk11\">transactionManager</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DataSourceTransactionManager</span><span class=\"mtk1\">(</span><span class=\"mtk11\">dataSource</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">MemberRepositoryV3</span><span class=\"mtk1\"> </span><span class=\"mtk11\">memberRepositoryV3</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MemberRepositoryV3</span><span class=\"mtk1\">(</span><span class=\"mtk11\">dataSource</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">MemberServiceV3_3</span><span class=\"mtk1\"> </span><span class=\"mtk11\">memberServiceV3_3</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MemberServiceV3_3</span><span class=\"mtk1\">(</span><span class=\"mtk11\">memberRepositoryV3</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<ul>\n<li><code>@SpringBootTest</code> 스프링 AOP를 적용하려면 스프링 컨테이너 필요\n<ul>\n<li>해당 어노테이션 있으면 테스트 시 스프링 부트를 통해 스프링 컨테이너 생성</li>\n<li>테스트에서 <code>@Autowired</code>등 스프링 컨테이너가 관리하는 빈들을 사용 가능</li>\n</ul>\n</li>\n<li><code>TestConfiguration</code> 테스트 안에서 내부 설정 클래스를 만들어 사용 시 추가로 필요한 스프링 빈들을 등록하고 테스트 수행 가능</li>\n<li><code>TestConfig</code>\n<ul>\n<li><code>DataSourceTransactionManager</code> 트랜잭션 매니저를 스프링 빈으로 등록\n<ul>\n<li>스프링이 제공하는 트랜잭션 AOP는 스프링 빈에 등록된 트랜잭션 매니저를 찾아 사용<br>\n-> 트랜잭션 매니저를 스프링 빈으로 등록해야 한다.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>프록시 도입(@Transaction 사용) 하면 서비스 로직을 상속 받는다.<br>\n-> 트랜잭션 코드를 만들어 낸다 (이전 V2처럼)\n-> 즉, 실제로 실행되는 service는 transaction proxy 코드다</p>\n<hr>\n<h4 id=\"트랜잭션-aop-정리\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-aop-%EC%A0%95%EB%A6%AC\" aria-label=\"트랜잭션 aop 정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션 AOP 정리</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0e1fc8526b356b629a138ae6ad550c62/eb638/transactionAOP.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.668711656441715%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABaklEQVR42n2T3Y6CQAyF5/2fxdfgwlvviIYgGEB+lB9FELXma1Jl2c1O0jDTaU/PaQf3er0EY/F9PB5qz+dT5stiuJum6RO3XG5+qOtaiqKQsizldDrJer2W3W4neZ5LmqaSZZlUVSVd18n5fNb9srC7Xq960TSNJhwOhw8gifg5H49HBQ7DUFarlRaKoug34O1202CSMYL2+70CI83kmmQIJEmijGGJ7Pv9/gWkAgwIQC6MLpeLJnJnfQWcRPYG3ratMqa4gbp5dQA3m42yRJ4F0VuSUUDMMAwfPwYBiIzj+AWEDUn0jiCSYWmJtkgmkXhAbOHjznmeJ9vt9odsmyBSGFQcxwpOMYzCGCqI48u573txvu+r05gwJPoEACxhTwEYYbBAMj0l3t4jPmUImEmjOv0LgkAnD7j5AQAcEOTZ3gYHhgLOhwIA8ng2SLA3hh+WSKNv9ofAisLkoIZ4t/x1bEB/LSv8X/wbsl2eQVd2+p0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0e1fc8526b356b629a138ae6ad550c62/a81b5/transactionAOP.webp 163w,\n/static/0e1fc8526b356b629a138ae6ad550c62/da3ef/transactionAOP.webp 325w,\n/static/0e1fc8526b356b629a138ae6ad550c62/309d5/transactionAOP.webp 650w,\n/static/0e1fc8526b356b629a138ae6ad550c62/78344/transactionAOP.webp 975w,\n/static/0e1fc8526b356b629a138ae6ad550c62/bdb72/transactionAOP.webp 1300w,\n/static/0e1fc8526b356b629a138ae6ad550c62/5f780/transactionAOP.webp 1422w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0e1fc8526b356b629a138ae6ad550c62/5e043/transactionAOP.png 163w,\n/static/0e1fc8526b356b629a138ae6ad550c62/e5cc6/transactionAOP.png 325w,\n/static/0e1fc8526b356b629a138ae6ad550c62/663f3/transactionAOP.png 650w,\n/static/0e1fc8526b356b629a138ae6ad550c62/d880f/transactionAOP.png 975w,\n/static/0e1fc8526b356b629a138ae6ad550c62/4c573/transactionAOP.png 1300w,\n/static/0e1fc8526b356b629a138ae6ad550c62/eb638/transactionAOP.png 1422w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0e1fc8526b356b629a138ae6ad550c62/663f3/transactionAOP.png\"\n            alt=\"transactionAOP\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol>\n<li><code>@Transaction</code>이 있으면 AOP Proxy생성</li>\n<li>스프링 컨테이너를 통해 트랜잭션 매니저 획득</li>\n<li>트랜잭션 시작</li>\n<li>데이터 소스로 커넥션 생성</li>\n<li>수동 커밋 모드로 만듬</li>\n<li>트랜잭션 동기화 매니저에 보관</li>\n<li>실제 서비스 호출</li>\n<li>트랜잭션 동기화 커넥션 획득</li>\n<li>다 끝나면 성공이면 commit, 예외 발생 시 rollback</li>\n</ol>\n<p>트랜잭션을 공부하다보면 선언적 vs 프로그래밍 방식이 나온다.</p>\n<p>선언적 트랜잭션 관리</p>\n<ul>\n<li><code>@Transactional</code> 애노테이션 하나만 선언해서 매우 편리하게 트랜잭션을 적용하는 것</li>\n<li>과거 XML설정하기도 했다.</li>\n</ul>\n<p>프로그래밍 방식</p>\n<ul>\n<li>직접 코드로 짜는 것</li>\n</ul>\n<hr>\n<p>정리</p>\n<p><code>@Transactional</code>를 통해 어노테이션만 붙여주면 트랜잭션 관련 코드를 비즈니스 로직에서 제거 가능</p>\n<hr>\n<h4 id=\"스프링-부트의-자동-리소스-등록\" style=\"position:relative;\"><a href=\"#%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8%EC%9D%98-%EC%9E%90%EB%8F%99-%EB%A6%AC%EC%86%8C%EC%8A%A4-%EB%93%B1%EB%A1%9D\" aria-label=\"스프링 부트의 자동 리소스 등록 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>스프링 부트의 자동 리소스 등록</h4>\n<p>스프링 부트가 등장하기 이전에는 데이터소스와 트랜잭션 매니저를 개발자가 직접 스프링 빈으로 등록해서 사용</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"17148688812860402000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@Bean\nDataSource dataSource() {\n    return new DriverManagerDataSource(URL, USERNAME, PASSWORD);\n}\n\n@Bean\nPlatformTransactionManager transactionManager() {\n    return new DataSourceTransactionManager(dataSource());\n}`, `17148688812860402000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">DataSource</span><span class=\"mtk1\"> </span><span class=\"mtk11\">dataSource</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DriverManagerDataSource</span><span class=\"mtk1\">(URL, USERNAME, PASSWORD);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">PlatformTransactionManager</span><span class=\"mtk1\"> </span><span class=\"mtk11\">transactionManager</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DataSourceTransactionManager</span><span class=\"mtk1\">(</span><span class=\"mtk11\">dataSource</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><strong>데이터소스 - 자동 등록</strong></p>\n<ul>\n<li>스프링 부트는 데이터소스( <code>DataSource</code> )를 스프링 빈에 자동으로 등록한다.</li>\n<li>자동으로 등록되는 스프링 빈 이름: <code>dataSource</code></li>\n<li>참고로 개발자가 직접 데이터소스를 빈으로 등록하면 스프링 부트는 데이터소스를 자동으로 등록하지 않는다.</li>\n</ul>\n<p><code>application.properties</code>의 속성을 사용해 <code>DataSource</code>생성</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"91714429615183300000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`spring.datasource.url=jdbc:h2:tcp://localhost/~/test\nspring.datasource.username=sa\nspring.datasource.password=`, `91714429615183300000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"properties\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">spring.datasource.url</span><span class=\"mtk1\">=jdbc:h2:tcp://localhost/~/test</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">spring.datasource.username</span><span class=\"mtk1\">=sa</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">spring.datasource.password</span><span class=\"mtk1\">=</span></span></span></code></pre>\n<ul>\n<li>스프링 부트가 기본적으로 생성하는 데이터 소스는 커넥션 풀을 제공하는 <code>HikariDataSource</code>이다.</li>\n<li><code>spring.datasource.url</code>속성이 없으면 내장 DB생성 시도</li>\n</ul>\n<h4 id=\"트랜잭션-매니저---자동-등록\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EB%A7%A4%EB%8B%88%EC%A0%80---%EC%9E%90%EB%8F%99-%EB%93%B1%EB%A1%9D\" aria-label=\"트랜잭션 매니저   자동 등록 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>트랜잭션 매니저 - 자동 등록</strong></h4>\n<ul>\n<li>트랜잭션 매니저( <code>PlatformTransactionManager</code> )자동으로 스프링 빈에 등록</li>\n<li>자동 등록되는 빈 이름 : <code>transactionManager</code></li>\n<li>트랜잭션 매니저를 선택할지는 현재 등록된 라이브러리를 보고 판단\n-> JDBC를 기술을 사용하면 <code>DataSourceTransactionManager</code> 를 빈으로 등록<br>\n-> JPA를 사용하면 <code>JpaTransactionManager</code> 를 빈으로 등록<br>\n(참고로 Jpa~ 는 Data~ 제공 기능 대부분 지원)</li>\n</ul>\n<h1 id=\"5-자바-예외-이해\" style=\"position:relative;\"><a href=\"#5-%EC%9E%90%EB%B0%94-%EC%98%88%EC%99%B8-%EC%9D%B4%ED%95%B4\" aria-label=\"5 자바 예외 이해 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 자바 예외 이해</h1>\n<p>자바 예외의 이해부터 시작</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/714ee0123fcd7f34719a8baf10fc83bf/db98b/ErrorThrow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.89570552147239%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABV0lEQVR42pWSW2+CQBCF+f//SV948wmiqCAoUdAEEQW836b5JtmWNrbUSSbLMrNnzjm7lvwjqqqSPM9lt9u19lp/FZ/Pp67r9VoGg4GsVqt2QHOoCdJMAmaTyUSyLPvW8zZD4nw+SxRF4vu+jMdjlf94PH5neDweZb/fy+FwkLqupSxLPVQUhTKC3e12+2RGz2az0b7r9aq1+/3+BchhCkxlDcNQhsOhBEGgg155SlCL41jZM8DULApGwul00iaYpWmql0ENFiQDL5eLJt+oa/bB1NputzKfzyVJEp22WCwUlCbHcfR2+Q9z5DMUEigD2HVdzX6/L8vlUizYcHA0GqlMjPc8TwHI6XSqgADjmwk8hyWeGv+5QMtIYAM7HjDy2MMCf4xP1FECCRS0PhtjrFkB6fV60u12FRQrOp2O2Lat+58X1foOMR2WeMw7xILZbKb/qL1i+AGN1ZtoxZmT8gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/714ee0123fcd7f34719a8baf10fc83bf/a81b5/ErrorThrow.webp 163w,\n/static/714ee0123fcd7f34719a8baf10fc83bf/da3ef/ErrorThrow.webp 325w,\n/static/714ee0123fcd7f34719a8baf10fc83bf/309d5/ErrorThrow.webp 650w,\n/static/714ee0123fcd7f34719a8baf10fc83bf/78344/ErrorThrow.webp 975w,\n/static/714ee0123fcd7f34719a8baf10fc83bf/bdb72/ErrorThrow.webp 1300w,\n/static/714ee0123fcd7f34719a8baf10fc83bf/87cd1/ErrorThrow.webp 1822w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/714ee0123fcd7f34719a8baf10fc83bf/5e043/ErrorThrow.png 163w,\n/static/714ee0123fcd7f34719a8baf10fc83bf/e5cc6/ErrorThrow.png 325w,\n/static/714ee0123fcd7f34719a8baf10fc83bf/663f3/ErrorThrow.png 650w,\n/static/714ee0123fcd7f34719a8baf10fc83bf/d880f/ErrorThrow.png 975w,\n/static/714ee0123fcd7f34719a8baf10fc83bf/4c573/ErrorThrow.png 1300w,\n/static/714ee0123fcd7f34719a8baf10fc83bf/db98b/ErrorThrow.png 1822w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/714ee0123fcd7f34719a8baf10fc83bf/663f3/ErrorThrow.png\"\n            alt=\"ErrorThrow\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>자바 예외는 기본적으로 Throwable부터 시작</p>\n<p>에러도 객체기 때문에 최상위 Object를 가지고 있다.</p>\n<p>error와 exception으로 나뉘는데</p>\n<p><code>Error</code>는 메모리 부족이나 심각한 시스템 오류와 같이 애플리케이션에서 복구 불가능한 시스템 예외이다.</p>\n<p>그렇기에 애플리케이션 개발자는 <code>Error</code>를 잡으려고 해서는 안된다.</p>\n<p>상위 예외를 <code>catch</code> 로 잡으면 그 하위 예외까지 함께 잡는다.</p>\n<p>따라서 애플리케이션 로직에서는 <code>Throwable</code> 예외도 잡으면 안된다. (error가 함께 잡히기 때문)</p>\n<p>Exception과 그 하위 예외는 모두 컴파일러가 체크하는 예외 (RuntimeExcption은 예외)</p>\n<p><code>RuntimeException</code> 언체크 예외, 런타임 예외로 컴파일러가 체크하지 않는 언체크 예외이다.</p>\n<p><code>RuntimeException</code> 의 이름을 따라서 <code>RuntimeException</code> 과 그 하위 언체크 예외를 <strong>런타임 예외</strong>라 고 많이 부른다</p>\n<hr>\n<p>예외는 기본적으로 잡아서 처리하거나, 처리할 수 없으면 밖으로 던져야 한다.</p>\n<p>예외를 처리하면 정상 흐름으로 동작하고, 처리하지 못하면 호출한 곳으로 예외를 계속 던진다.</p>\n<p>2가지 기본 규칙을 기억하자</p>\n<ol>\n<li>예외는 잡아서 처리하거나 던져야 한다.</li>\n<li>예외를 잡거나 던질 때 지정한 예외 뿐만 아니라 그 예외의 자식들도 함께 처리한다.</li>\n</ol>\n<hr>\n<h4 id=\"체크-예외\" style=\"position:relative;\"><a href=\"#%EC%B2%B4%ED%81%AC-%EC%98%88%EC%99%B8\" aria-label=\"체크 예외 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>체크 예외</h4>\n<p>체크 예외는 잡아서 처리하거나, 또는 밖으로 던지도록 선언해야한다. 그렇지 않으면 컴파일 오류가 발생한다.</p>\n<p>컴파일러가 오류를 잡아낸다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"17782556110431402000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`static class MyCheckedException extends Exception {\n    public MyCheckedException(String message) {\n        super(message);\n    }\n}`, `17782556110431402000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">MyCheckedException</span><span class=\"mtk1\"> </span><span class=\"mtk4\">extends</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Exception</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MyCheckedException</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">message</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">super</span><span class=\"mtk1\">(message);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<ul>\n<li>\n<p><code>MyCheckedException</code>는<code>Exception</code>을 상속받았다.<code>Exception</code> 을 상속받으면 체크 예외가 된다.</p>\n</li>\n<li>\n<p>참고로 <code>RuntimeException</code> 을 상속받으면 언체크 예외가 된다. 이런 규칙은 자바 언어에서 문법으로 정한 것 이다.</p>\n</li>\n</ul>\n<h4 id=\"체크예외-장단점\" style=\"position:relative;\"><a href=\"#%EC%B2%B4%ED%81%AC%EC%98%88%EC%99%B8-%EC%9E%A5%EB%8B%A8%EC%A0%90\" aria-label=\"체크예외 장단점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>체크예외 장단점</h4>\n<p>체크예외는 예외를 잡아서 처리할 수 없을 떄, 예외를 밖으로 던지는 <code>throw</code>예외를 필수로 선언해야 한다. 이것 때문에 장, 단점이 동시에 존재</p>\n<p>장점</p>\n<ul>\n<li>개발자가 실수로 예외를 누락하지 않게 컴파일러를 통해 문제를 잡아주는 안전장치</li>\n</ul>\n<p>단점</p>\n<ul>\n<li>실제로는 개발자가 모든 체크 예외를 반드시 잡거나 던진다.</li>\n<li>신경쓰고싶지 않은 예외를 모두 챙기고, 의존관계에 따른 단점도 존재(상세한건 뒤에서)</li>\n</ul>\n<hr>\n<h4 id=\"언체크런타입-예외\" style=\"position:relative;\"><a href=\"#%EC%96%B8%EC%B2%B4%ED%81%AC%EB%9F%B0%ED%83%80%EC%9E%85-%EC%98%88%EC%99%B8\" aria-label=\"언체크런타입 예외 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>언체크(런타입) 예외</h4>\n<ul>\n<li><code>RuntimeException</code> 과 그 하위 예외는 언체크 예외로 분류</li>\n<li>컴파일러가 예외를 체크하지 않음</li>\n<li>throws를 선언하지 않고, 생략 가능 -> 자동으로 예외를 던진다.</li>\n</ul>\n<h4 id=\"체크예외-vs-언체크런타입-예외\" style=\"position:relative;\"><a href=\"#%EC%B2%B4%ED%81%AC%EC%98%88%EC%99%B8-vs-%EC%96%B8%EC%B2%B4%ED%81%AC%EB%9F%B0%ED%83%80%EC%9E%85-%EC%98%88%EC%99%B8\" aria-label=\"체크예외 vs 언체크런타입 예외 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>체크예외 vs 언체크(런타입) 예외</h4>\n<ul>\n<li>체크 예외: 예외를 잡아서 처리하지 않으면 항상 <code>throws</code> 에 던지는 예외를 선언</li>\n<li>언체크 예외: 예외를 잡아서 처리하지 않아도 <code>throws</code> 를 생략 가능</li>\n</ul>\n<h4 id=\"언체크런타입-예외의-장단점\" style=\"position:relative;\"><a href=\"#%EC%96%B8%EC%B2%B4%ED%81%AC%EB%9F%B0%ED%83%80%EC%9E%85-%EC%98%88%EC%99%B8%EC%9D%98-%EC%9E%A5%EB%8B%A8%EC%A0%90\" aria-label=\"언체크런타입 예외의 장단점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>언체크(런타입) 예외의 장단점</h4>\n<p>예외를 생략할 수 있어서 장, 단점 존재</p>\n<p>장점</p>\n<ul>\n<li>신경쓰고 싶지 않은 언체크 예외를 무시할 수 있다</li>\n<li>신경 쓰고 싶지 않은 예외의 의존관계를 참조하지 않아도 된다는 장점</li>\n</ul>\n<p>단점</p>\n<ul>\n<li>개발자가 실수로 예외를 누락할 수 있다.</li>\n</ul>\n<hr>\n<h4 id=\"체크-예외-활용\" style=\"position:relative;\"><a href=\"#%EC%B2%B4%ED%81%AC-%EC%98%88%EC%99%B8-%ED%99%9C%EC%9A%A9\" aria-label=\"체크 예외 활용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>체크 예외 활용</h4>\n<p>기본적으로 원칙 2가지 생각</p>\n<ul>\n<li>기본적으로 언체크(런타임) 예외 사용</li>\n<li>체크 예외는 비즈니스 로직 상 의도적으로 던지는 예외에서만 사용</li>\n</ul>\n<p>ex - 계좌 이체 실패 / 결제 시 포인트 부족 / 로그인 ID, PW불일치 등</p>\n<p>체크 예외가 더 좋아보이지만 사용하지 않는 이유는 문제점 떄문이다.</p>\n<p>DB가 죽었을 때 생기는 SQLException이나 ConnectException은 Service나 Controller로직에서 처리하기가 힘듬</p>\n<p>보통 공통적으로 처리하는 ControllerAdvice에서 이런 예외를 공통적으로 처리</p>\n<p>2가지 문제</p>\n<ol>\n<li>복구가 불가능한 예외</li>\n</ol>\n<ul>\n<li>대부분의 예외는 복구가 불가능</li>\n<li>대부분의 서비스나 컨트롤러는 이런 문제를 해결할 수는 없다</li>\n<li>따라서 이런 문제들은 일관성 있게 공통으로 처리</li>\n</ul>\n<ol start=\"2\">\n<li>의존 관계에 대한 문제</li>\n</ol>\n<ul>\n<li>체크 예외이기 때문에 컨트롤러나 서비스 입장에서는 본인 이처리할수없어도어쩔수없이 <code>throws</code> 를통해던지는예외를선언</li>\n<li>컨트롤러에서 <code>java.sql.SQLException</code> 을 의존하기 때문에 문제가 된다.</li>\n<li>향후 리포지토리를 JDBC 기술이 아닌 다른 기술로 변경 시 문제 (ex - JPAException)</li>\n</ul>\n<p>문제가 있어 최상위 예외인 <code>Exception</code>을 던지는 것은 좋지 않은 패턴</p>\n<p>꼭 필요한 예외를 그냥 넘어갈 수 있다.</p>\n<hr>\n<h4 id=\"런타임-예외-사용\" style=\"position:relative;\"><a href=\"#%EB%9F%B0%ED%83%80%EC%9E%84-%EC%98%88%EC%99%B8-%EC%82%AC%EC%9A%A9\" aria-label=\"런타임 예외 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>런타임 예외 사용</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ed91ac2f3e37da2b78df407b801499ab/39b47/runtimeException.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.65030674846626%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABXUlEQVR42o1SSUvDQBSeP+tJ8Cd4EQ/iRb0ogksvgqjoyYte646KtKFJmzQGtaQmzdIms2T55I0iBT30wWPefPO+tw6zLAuO42AwGCCKIpDUdY1ZJOIhQj5EJAKk6pvLJpMJsiyDEAJSyj+kqqq0TktZlhCS46J/isbDBravVnH8vA9VSDCqhggUrCiK35NwSkI2qVJK++V5rn1IFVd49z5gWw56lg3OOZjrujAMA57n6SAE2raNdrutR0EB4jgG+Zmmqc8gCCCkQFmVP8mpi1LzWcfqoGW00Hf7GqB2aJZhGCJNU32n6sgmzPd9JEmiE+c81++6y7pCjRosTzjGowxiLGdaBJEpAQUsVAm756Br2ugYpt4FO7jfwtHTHs57h/Dzt1/Sf5uexotK4fL1DI3HdezermGzuYKX4R3YYnMOy9cLWLqZx0l3R5c9U6WoEfMQI/6JWIb66/Aiwxcv218whJx7wgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ed91ac2f3e37da2b78df407b801499ab/a81b5/runtimeException.webp 163w,\n/static/ed91ac2f3e37da2b78df407b801499ab/da3ef/runtimeException.webp 325w,\n/static/ed91ac2f3e37da2b78df407b801499ab/309d5/runtimeException.webp 650w,\n/static/ed91ac2f3e37da2b78df407b801499ab/78344/runtimeException.webp 975w,\n/static/ed91ac2f3e37da2b78df407b801499ab/bdb72/runtimeException.webp 1300w,\n/static/ed91ac2f3e37da2b78df407b801499ab/64f2d/runtimeException.webp 2034w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ed91ac2f3e37da2b78df407b801499ab/5e043/runtimeException.png 163w,\n/static/ed91ac2f3e37da2b78df407b801499ab/e5cc6/runtimeException.png 325w,\n/static/ed91ac2f3e37da2b78df407b801499ab/663f3/runtimeException.png 650w,\n/static/ed91ac2f3e37da2b78df407b801499ab/d880f/runtimeException.png 975w,\n/static/ed91ac2f3e37da2b78df407b801499ab/4c573/runtimeException.png 1300w,\n/static/ed91ac2f3e37da2b78df407b801499ab/39b47/runtimeException.png 2034w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ed91ac2f3e37da2b78df407b801499ab/663f3/runtimeException.png\"\n            alt=\"runtimeException\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>그림과 같이 runtime exception 시 controller와 service에서 넘어가는게 가능하다.</p>\n<p>예제로 <code>SQLException</code>을 <code>RuntimeSQLException</code>로 바꿔 던짐</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"66665630689670750000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`public void call() {\n    try {\n        runSQL();\n    } catch (SQLException e) {\n        throw new RuntimeSQLException(e);\n    }\n}`, `66665630689670750000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">call</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">runSQL</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">SQLException</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">RuntimeSQLException</span><span class=\"mtk1\">(e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<ul>\n<li>기술을 바꿔도 해당 예외를 사용하지 않는 컨트롤러, 서비스에서는 코드 변경하지 않아도 된다.</li>\n<li>구현 기술이 변경되는 경우, 예외를 공통으로 처리하는 곳에서는 예외에 따른 다른 처리가 필요할 수 있다<br>\n-> 하지만 공통 처리하는 한곳만 변경하면 되기 때문에 변경의 영향 범위는 최소화 된다.</li>\n</ul>\n<hr>\n<p>정리</p>\n<ul>\n<li>체크 예외를 사용한다면 잡을 건 잡고 던질 예외는 명확하게 던지도록 선언</li>\n<li>체크 예외의 이런 문제점 때문에 최근 라이브러리들은 대부분 런타임 예외를 기본으로 제공</li>\n<li>런타임 예외도 필요하면 잡을 수 있다.</li>\n<li><strong>추가로 런타임 예외는 놓칠 수 있기 때문에 문서화가 중요</strong></li>\n</ul>\n<hr>\n<h4 id=\"예외-포함과-스택-트레이스\" style=\"position:relative;\"><a href=\"#%EC%98%88%EC%99%B8-%ED%8F%AC%ED%95%A8%EA%B3%BC-%EC%8A%A4%ED%83%9D-%ED%8A%B8%EB%A0%88%EC%9D%B4%EC%8A%A4\" aria-label=\"예외 포함과 스택 트레이스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>예외 포함과 스택 트레이스</h4>\n<ul>\n<li>예외를 전환할 때는 꼭 기존 예외를 포함해야 한다.</li>\n<li>그렇지 않으면 스택 트레이스를 확인할 때 심각한 문제 발생</li>\n<li>실무에서는 항상 로그를 사용해야 한다는 점을 기억</li>\n<li>아래 코드와 같이 e를 넘겨주지 않으면 예외를 확인할 수 없음</li>\n<li><strong>예외를 전환할 때는 꼭! 기존 예외를 포함하자</strong></li>\n</ul>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"44787942875063400000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`public void call() {\n    try {\n        runSQL();\n    } catch (SQLException e) {\n        throw new RuntimeSQLException(); // e를 넘겨줘야 함\n        // throw new RuntimeSQLException(e);\n    }\n}\n\nstatic class RuntimeSQLException extends RuntimeException {\n    public RuntimeSQLException() {\n    }\n    public RuntimeSQLException(Throwable cause) {\n        super(cause);\n    }\n}`, `44787942875063400000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"19\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">call</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">runSQL</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">SQLException</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">RuntimeSQLException</span><span class=\"mtk1\">(); </span><span class=\"mtk3\">// e를 넘겨줘야 함</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// throw new RuntimeSQLException(e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">RuntimeSQLException</span><span class=\"mtk1\"> </span><span class=\"mtk4\">extends</span><span class=\"mtk1\"> </span><span class=\"mtk10\">RuntimeException</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">RuntimeSQLException</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">RuntimeSQLException</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Throwable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">cause</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">super</span><span class=\"mtk1\">(cause);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h1 id=\"6-스프링과-문제-해결---예외-처리-반복\" style=\"position:relative;\"><a href=\"#6-%EC%8A%A4%ED%94%84%EB%A7%81%EA%B3%BC-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0---%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC-%EB%B0%98%EB%B3%B5\" aria-label=\"6 스프링과 문제 해결   예외 처리 반복 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. 스프링과 문제 해결 - 예외 처리, 반복</h1>\n<p>repository를 추상화를 해 인터페이스로 작성</p>\n<p>인터페이스로 분리하더라도 인터페이스에도 동일하게 <code>SQLException</code>이 필요</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"25383825273117176000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`public interface MemberRepositoryEx {\n    Member save(Member member) throws SQLException;\n    Member findById(String memberId) throws SQLException;\n    void update(String memberId, int money) throws SQLException;\n    void delete(String memberId) throws SQLException;\n}`, `25383825273117176000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"20\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">interface</span><span class=\"mtk1\"> </span><span class=\"mtk10\">MemberRepositoryEx</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">Member</span><span class=\"mtk1\"> </span><span class=\"mtk11\">save</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Member</span><span class=\"mtk1\"> </span><span class=\"mtk12\">member</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">SQLException</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">Member</span><span class=\"mtk1\"> </span><span class=\"mtk11\">findById</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memberId</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">SQLException</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">update</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memberId</span><span class=\"mtk1\">, </span><span class=\"mtk10\">int</span><span class=\"mtk1\"> </span><span class=\"mtk12\">money</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">SQLException</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">delete</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memberId</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">SQLException</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>서비스가 처리할 수 없는 <code>SQLException</code>에 대한 의존을 제거하기 위해선</p>\n<p>레포지토리에서 던지는 <code>SQLException</code>체크 예외를 런타임 예외로 전환한다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"71132272681749180000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`public class MyDbException extends RuntimeException {\n    public MyDbException() {\n    }\n\n    public MyDbException(String message) {\n        super(message);\n    }\n\n    public MyDbException(String message, Throwable cause) {\n        super(message, cause);\n    }\n\n    public MyDbException(Throwable cause) {\n        super(cause);\n    }\n}\n\n//\n    @Override\n    public Member save(Member member) {\n        String sql = &quot;insert into member(member_id, money) values (?, ?)&quot;;\n\n        Connection con = null;\n        PreparedStatement pstmt = null;\n\n        try {\n            con = getConnection();\n            pstmt = con.prepareStatement(sql);\n            pstmt.setString(1, member.getMemberId());\n            pstmt.setInt(2, member.getMoney());\n            pstmt.executeUpdate();\n            return member;\n        } catch (SQLException e) {\n            throw new MyDbException(e);\n        } finally {\n            close(con, pstmt, null);\n        }\n    }`, `71132272681749180000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"21\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">MyDbException</span><span class=\"mtk1\"> </span><span class=\"mtk4\">extends</span><span class=\"mtk1\"> </span><span class=\"mtk10\">RuntimeException</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MyDbException</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MyDbException</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">message</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">super</span><span class=\"mtk1\">(message);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MyDbException</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">message</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Throwable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">cause</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">super</span><span class=\"mtk1\">(message, cause);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MyDbException</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Throwable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">cause</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">super</span><span class=\"mtk1\">(cause);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Member</span><span class=\"mtk1\"> </span><span class=\"mtk11\">save</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Member</span><span class=\"mtk1\"> member) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">sql</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;insert into member(member_id, money) values (?, ?)&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Connection</span><span class=\"mtk1\"> </span><span class=\"mtk12\">con</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">null</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">PreparedStatement</span><span class=\"mtk1\"> </span><span class=\"mtk12\">pstmt</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">null</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            con = </span><span class=\"mtk11\">getConnection</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            pstmt = </span><span class=\"mtk12\">con</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prepareStatement</span><span class=\"mtk1\">(sql);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">pstmt</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setString</span><span class=\"mtk1\">(</span><span class=\"mtk7\">1</span><span class=\"mtk1\">, </span><span class=\"mtk12\">member</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMemberId</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">pstmt</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setInt</span><span class=\"mtk1\">(</span><span class=\"mtk7\">2</span><span class=\"mtk1\">, </span><span class=\"mtk12\">member</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMoney</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">pstmt</span><span class=\"mtk1\">.</span><span class=\"mtk11\">executeUpdate</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> member;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">SQLException</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MyDbException</span><span class=\"mtk1\">(e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">finally</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk11\">close</span><span class=\"mtk1\">(con, pstmt, </span><span class=\"mtk4\">null</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><code>SQLException</code> 시 catch로 잡아 MyDBException(RuntimeException)으로 던져준다.</p>\n<p><strong>예외를 변환할 때는 기존 예외를 꼭! 포함</strong></p>\n<p>장애가 발생하고 로그에서 진짜 원인이 남지 않는 심각한 문제가 발생할 수 있다</p>\n<hr>\n<h4 id=\"데이터-접근-예외-직접-만들기\" style=\"position:relative;\"><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%91%EA%B7%BC-%EC%98%88%EC%99%B8-%EC%A7%81%EC%A0%91-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"데이터 접근 예외 직접 만들기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>데이터 접근 예외 직접 만들기</h4>\n<p>데이터베이스 오류에 따라서 특정 예외는 복구하고 싶을 수 있다.</p>\n<p><code>SQLException</code>에는 <code>errorCode</code>라는 것이 들어있는데 이 오류 코드를 통해 어떤 문제가 발생했는지 확인할 수 있다.</p>\n<p>ex) 키 중복 오류 코드<br>\nH2 DB: <code>23505</code><br>\nMySQL: <code>1062</code></p>\n<p>스프링은 이러한 문제를 미리 해결</p>\n<hr>\n<h4 id=\"스프링-예외-추상화\" style=\"position:relative;\"><a href=\"#%EC%8A%A4%ED%94%84%EB%A7%81-%EC%98%88%EC%99%B8-%EC%B6%94%EC%83%81%ED%99%94\" aria-label=\"스프링 예외 추상화 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>스프링 예외 추상화</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/539651515b40386b24d0f7cd1f9ae00f/704c2/SpringException.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.23312883435584%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABwUlEQVR42oWTB4sCQQyF9///I1ERe++KomvvvYM9xxeYZU/cu0AM67x5SV4y1vv9lsViIdPpVON4PJbdbifGXq+X42Cfz6dGL7M4hGC73WrcbDZyPp8dwGg0klQqJfl8XtLptFSrVcVi34gtr0wGvF6vZTKZSLvdluFwKLPZzEnoScjBN8cgSiaTUiwWtcpCoSCr1er/Cr0I5/O5tom+vV5PGo2GXC4XR9/PO54tAz6dTs5lYwzlcDjI7Xb7PhR+uLRcLmW/36tGOHoxcUhNAux4PCqWM3B0QAIzTOvxeMhgMNBD2gkEAuLz+SSTySiYobglaTabSkiMRqMSDAb1HoRoa1E6lbGHaNTpdBTAuvBNRcZIzsRJDg6MwfE/nVr3+12Zs9mshEIhzZpIJCQej6uTyK1fvV6XSqUisVhMHTxeKpV0cNb1ev2lk/tVmOgmbLVaujokzeVyulIkhpC2lZCyAZbLZc1OxI02bg05Rzc8HA6r5n6/XyKRiEqhU4a02+3qEtdqNV1iNLJt23nXplK6YYj9fl83gYiGFMWZEjIYDmgFLXmzkDLJv96t5x4yPVpjHXCGZKJZbEP4+TI+X8sP7FVsyVYdr0sAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/539651515b40386b24d0f7cd1f9ae00f/a81b5/SpringException.webp 163w,\n/static/539651515b40386b24d0f7cd1f9ae00f/da3ef/SpringException.webp 325w,\n/static/539651515b40386b24d0f7cd1f9ae00f/309d5/SpringException.webp 650w,\n/static/539651515b40386b24d0f7cd1f9ae00f/78344/SpringException.webp 975w,\n/static/539651515b40386b24d0f7cd1f9ae00f/bdb72/SpringException.webp 1300w,\n/static/539651515b40386b24d0f7cd1f9ae00f/1f6df/SpringException.webp 2286w\"\n              sizes=\"(max-width: 650px) 100vw, 650px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/539651515b40386b24d0f7cd1f9ae00f/5e043/SpringException.png 163w,\n/static/539651515b40386b24d0f7cd1f9ae00f/e5cc6/SpringException.png 325w,\n/static/539651515b40386b24d0f7cd1f9ae00f/663f3/SpringException.png 650w,\n/static/539651515b40386b24d0f7cd1f9ae00f/d880f/SpringException.png 975w,\n/static/539651515b40386b24d0f7cd1f9ae00f/4c573/SpringException.png 1300w,\n/static/539651515b40386b24d0f7cd1f9ae00f/704c2/SpringException.png 2286w\"\n            sizes=\"(max-width: 650px) 100vw, 650px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/539651515b40386b24d0f7cd1f9ae00f/663f3/SpringException.png\"\n            alt=\"SpringException\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ul>\n<li>스프링은 데이터 접근 계층에 대한 수십가지 예외를 정리해서 일관된 예외 계층 제공</li>\n<li>각각의 예외는 특정 기술에 종속적이지 않게 설계</li>\n<li>JDBC나 JPA를 사용할 때 발생하는 예외를 스프링이 제공하는 예외로 변환도 스프링이 제공</li>\n<li>최고 상위는 <code>org.springframework.dao.DataAccessException</code> 런타임 예외\n<ul>\n<li>런타임 예외를 상속 받았기 때문에 스프링에서 제공하는 데이터 접근 계층의 모든 예외는 런타임 예외</li>\n</ul>\n</li>\n<li><code>DataAccessException</code> 은 크게 2가지로 구분하는데 <code>NonTransient</code> 예외와 <code>Transient</code> 예외\n<ul>\n<li><code>Transient</code> 는 일시적이라는 뜻이다. <code>Transient</code> 하위 예외는 동일한 SQL을 다시 시도했을 때 성공할 가능성이 있다.\n<ul>\n<li>ex - 쿼리 타임 아웃, 락 등</li>\n</ul>\n</li>\n<li><code>NonTransient</code> 는 일시적이지 않다는 뜻이다. 같은 SQL을 그대로 반복해서 실행하면 실패한다.\n<ul>\n<li>SQL문법 오류, 데이터베이스 제약조건 위배 등</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<ul>\n<li>오류 코드를 확인하고 스프링의 예외 체계에 맞추어 예외를 변환하는 것은 현실성이 없다.</li>\n<li>그래서 스프링은 예외 변환기를 제공한다.</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"49945110513141650000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`SQLExceptionTranslator exTranslator = new SQLErrorCodeSQLExceptionTranslator(dataSource);\nDataAccessException resultEx = exTranslator.translate(&quot;select&quot;, sql, e);`, `49945110513141650000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"22\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">SQLExceptionTranslator</span><span class=\"mtk1\"> </span><span class=\"mtk12\">exTranslator</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">SQLErrorCodeSQLExceptionTranslator</span><span class=\"mtk1\">(dataSource);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">DataAccessException</span><span class=\"mtk1\"> </span><span class=\"mtk12\">resultEx</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">exTranslator</span><span class=\"mtk1\">.</span><span class=\"mtk11\">translate</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;select&quot;</span><span class=\"mtk1\">, sql, e);</span></span></span></code></pre>\n<p>다음과 같이 사용한다.</p>\n<p><code>translate()</code> 메서드의 첫번째 파라미터는 읽을 수 있는 설명이고, 두번째는 실행한 sql, 마지막은 발생된\n<code>SQLException</code> 을 전달하면 된다. 이렇게 하면 적절한 스프링 데이터 접근 계층의 예외로 변환해서 반환해준다.</p>\n<p><code>org.springframework.jdbc.support.sql-error-codes.xml</code>파일을 확인해보면 DB마다 에러코드 시 어떤 Exception을 발생할 지 작성되어 있다.</p>\n<h4 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h4>\n<ul>\n<li>스프링은 데이터 접근 계층에 대한 일관된 예외 추상화를 제공</li>\n<li>스프링은 예외 변환기를 통해 <code>SQLException</code>의 <code>ErrorCode</code>에 맞는 적절한 스프링 데이터 접근 예외로 변경해준다.</li>\n<li>만약 컨트롤러, 서비스 계층에서 예외 처리가 필요하면 <code>SQLException</code>같은 스프링이 제공하는 데이터 접근예외를 사용</li>\n<li>추상화 덕분에 특정 기술에 종속적이지 않고, 향후 JDBC에서 JPA로 구현기술을 변경하더라도, 스프링은 JPA예외를 적절한 스프링 데이터 접근 예외로 변환한다.ㅂ</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"45014914636275850000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`    @Override\n    public Member save(Member member) {\n        String sql = &quot;insert into member(member_id, money) values (?, ?)&quot;;\n\n        Connection con = null;\n        PreparedStatement pstmt = null;\n\n        try {\n            con = getConnection();\n            pstmt = con.prepareStatement(sql);\n            pstmt.setString(1, member.getMemberId());\n            pstmt.setInt(2, member.getMoney());\n            pstmt.executeUpdate();\n            return member;\n        } catch (SQLException e) {\n            throw exTranslator.translate(&quot;save&quot;, sql, e);\n        } finally {\n            close(con, pstmt, null);\n        }\n    }`, `45014914636275850000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"23\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Member</span><span class=\"mtk1\"> </span><span class=\"mtk11\">save</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Member</span><span class=\"mtk1\"> member) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">sql</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;insert into member(member_id, money) values (?, ?)&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Connection</span><span class=\"mtk1\"> </span><span class=\"mtk12\">con</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">null</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">PreparedStatement</span><span class=\"mtk1\"> </span><span class=\"mtk12\">pstmt</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">null</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            con = </span><span class=\"mtk11\">getConnection</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            pstmt = </span><span class=\"mtk12\">con</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prepareStatement</span><span class=\"mtk1\">(sql);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">pstmt</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setString</span><span class=\"mtk1\">(</span><span class=\"mtk7\">1</span><span class=\"mtk1\">, </span><span class=\"mtk12\">member</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMemberId</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">pstmt</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setInt</span><span class=\"mtk1\">(</span><span class=\"mtk7\">2</span><span class=\"mtk1\">, </span><span class=\"mtk12\">member</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMoney</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">pstmt</span><span class=\"mtk1\">.</span><span class=\"mtk11\">executeUpdate</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> member;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">SQLException</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk12\">exTranslator</span><span class=\"mtk1\">.</span><span class=\"mtk11\">translate</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;save&quot;</span><span class=\"mtk1\">, sql, e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">finally</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk11\">close</span><span class=\"mtk1\">(con, pstmt, </span><span class=\"mtk4\">null</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>위의 catch문과 같이 <code>exTranslator.translate(\"save\", sql, e);</code>로 넘겨주기만 하면된다.</p>\n<ul>\n<li>스프링이 예외를 추상화해 서비스 계층에서 예외에 종속되지 않는다.</li>\n<li>서비스 계층에서 특정 구현 기술이 변경되더라도 그대로 유지 가능 (DI를 제대로 활용할 수 있게 되었다)</li>\n<li>추가로 서비스 계층에서 예외를 잡아서 복구해야 하는 경우, 예외가 스프링이 제공하는 데이터 접근 예외로 변경되어서 서비스 계층에 넘어오기 때문에 필요 시 예외를 잡아 복구한다.</li>\n</ul>\n<hr>\n<h4 id=\"jdbc-반복-문제-해결\" style=\"position:relative;\"><a href=\"#jdbc-%EB%B0%98%EB%B3%B5-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0\" aria-label=\"jdbc 반복 문제 해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JDBC 반복 문제 해결</h4>\n<p>리포지토리에서 JDBC를 사용하기 때문에 발생하는 반복 문제를 해결</p>\n<p>JDBC 반복 문제</p>\n<ul>\n<li>커넥션 조회, 동기화</li>\n<li><code>PreparedStatement</code>생성 및 파라미터 바인딩</li>\n<li>쿼리 실행</li>\n<li>결과 바인딩</li>\n<li>예외 발생 시 스프링 예외 변환기 실행</li>\n<li>리소스 종료</li>\n</ul>\n<p>이러한 반복을 효과적으로 처리하는 방법 => <strong>템플릿 콜백 패턴</strong></p>\n<p>JDBC반복 문제를 해결하기 위해 <code>JDBCTemplate</code>제공</p>\n<p>JDBC템플릿 사용방법에 대한 자세한 설명은 다음 강의</p>\n<p><code>JDBCTemplate</code>은 JDBC로 개발할 때 발생하는 반복 대부분 해결</p>\n<p>트랜잭션을 위한 <strong>커넥션 동기화</strong>는 물론이고, 예외 발생 시 <strong>스프링 예외 변환기</strong>도 자동으로 실행</p>\n<hr>\n<p>정리</p>\n<ul>\n<li>서비스 계층의 순수성\n<ul>\n<li>트랜잭션 추상화 + 트랜잭션 AOP 덕분에 서비스 계층의 순수성을 유지하며 트랜잭션 사용이 가능</li>\n<li>스프링이 제공하는 예외 추상화와 예외 변환기 덕분에 데이터 접근 기술이 변경되어도 서비스 계층의 순수성 유지하며 예외 사용</li>\n<li>서비스 계층이 리포지토리 인터페이스를 의존한 덕분에 다른 데이터 접근 기술로 변경되어도 서비스 계층 순수하게 유지 가능</li>\n</ul>\n</li>\n<li>JDBC를 반복하는 코드가 <code>JDBCTemplate</code>으로 대부분 제거</li>\n</ul>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h1>\n<p><a href=\"https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-db-1/dashboard\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">스프링 DB 1편 데이터 접근 핵심 원리 - 김영한</a></p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .mtk3 { color: #6A9955; }\n  .default-dark .mtk1 { color: #D4D4D4; }\n  .default-dark .mtk8 { color: #CE9178; }\n  .default-dark .mtk12 { color: #9CDCFE; }\n  .default-dark .mtk11 { color: #DCDCAA; }\n  .default-dark .mtk7 { color: #B5CEA8; }\n  .default-dark .mtk15 { color: #C586C0; }\n  .default-dark .mtk10 { color: #4EC9B0; }\n  .default-dark .mtk4 { color: #569CD6; }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#1-jdbc-%EC%9D%B4%ED%95%B4\">1. JDBC 이해</a></p>\n</li>\n<li>\n<p><a href=\"#2-%EC%BB%A4%EB%84%A5%EC%85%98-%ED%92%80%EA%B3%BC-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%86%8C%EC%8A%A4-%EC%9D%B4%ED%95%B4\">2. 커넥션 풀과 데이터 소스 이해</a></p>\n<ul>\n<li><a href=\"#21-%EC%BB%A4%EB%84%A5%EC%85%98-%ED%92%80\">2.1 커넥션 풀</a></li>\n<li><a href=\"#22-datasource\">2.2 DataSource</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#3-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EA%B3%BC-db-lock-%EC%9D%B4%ED%95%B4\">3. 트랜잭션과 DB Lock 이해</a></p>\n<ul>\n<li><a href=\"#31-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98\">3.1 트랜잭션</a></li>\n<li><a href=\"#32-db-lock\">3.2 DB Lock</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#4-%EC%8A%A4%ED%94%84%EB%A7%81%EA%B3%BC-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0---%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98\">4. 스프링과 문제 해결 - 트랜잭션</a></p>\n</li>\n<li>\n<p><a href=\"#5-%EC%9E%90%EB%B0%94-%EC%98%88%EC%99%B8-%EC%9D%B4%ED%95%B4\">5. 자바 예외 이해</a></p>\n</li>\n<li>\n<p><a href=\"#6-%EC%8A%A4%ED%94%84%EB%A7%81%EA%B3%BC-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0---%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC-%EB%B0%98%EB%B3%B5\">6. 스프링과 문제 해결 - 예외 처리, 반복</a></p>\n</li>\n<li>\n<p><a href=\"#reference\">Reference</a></p>\n</li>\n</ul>","frontmatter":{"title":"스프링 DB 1편 - 데이터 접근 핵심 원리 정리","summary":["김영한 강사님의 스프링 DB 1편 - 데이터 접근 핵심 원리 강의 정리하자"],"date":"2024.12.15.","category":["Spring"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADlElEQVR42nVUTYgcRRTuza6JICoSQnR35r3qmVExEpCI6EFJ0JNHhQWDSMxFEREJY9frn9npRGO8KCKIoOLFg5DxoiIzu13V0z3jTMy6bn5MICiIt2AkQS+CujNbUt3TbWczFjy6qH7vq/e+974yjC1LKWNmsWXMFs8WW3u2+xf3bC+e+b6xzVfGtjTImDGmrcTJT51IVPaSgOM8AMEFXOIB/sgF9EjAu1an/NgkJLlcTQPMgOzV+Z1c4McU4oa/aqrGkCm3z5TbY6oxYEqfOREqK4C216uWXVlasAQ8W8T4D2y5VLO7ePHod6aiEMdc4AZJHHGJY23JXuCG3jdPmcru4mUrgBMUQsMa3HurUazfFvM73RjPNb81FRf4D0ncJIlq8t0kkRpPQGHkfcOUE+Nf1MEDFMLjboQPpNlNiLW78EGSWQqmeJrZSO/tEHU2SalLQ3MzvRTO2ivwoI614oW7nRifzvnjYfl+J2J/6kCusxA4bgxNpQM10CSrv7nEqyRQ8hAP+xHenMW/9QPc4fTxmRzQ66OryeYBbNhdHGvySWCfJLzsBPCE1YF9dlSt+adrt2UU6c76hXHyIjxIonJ7AuhE+MXSKVPzNXJjHFHIXsnGYtqc+tH+uSSuXdtlC/OehLIQnrMG5fmEQwpxLR0LU/N1TDu0WsasHxlzes60TzIJOjsNOOHdCvCg24G70qayQzyqlQwdYEtcSzOEK440dxebdcPgR0aSHQ/wMBfsUPbPjfB5PZNpyV388o0zFcUDFFMElKhBA2WKoKD8Kg/gk8xBV+P12Is5h16fNd88X9XdFKl2NcD+uVzTEyCnfecukniSBLTrK7tvyZs6KFepi/U8BVfCPidiY5LwhxcyLKpHZ2YL8yEu8H2SeI0kfqQ7qy/78HvjpoQ/iR6X+GTetUnZn564UFVeD2W9gwdsAS+QhM+4xJ+5gN9JQECi8mje6fwRwZdI4OfXjUHaJajYITtLAdZtCWeWholq1i3JmiRKe3WTFluLs1qiPMD7aAWfIgnLFMKV19rl6nWPQ8bREVla4O1ayeuz9VQ18EtiEn/T5fIQr1KI17Rqjp+rqsYAf61/ncrvhqnINb1cqlkCv7JjHL++XlFHV021NGSJNU+b6tiaqZw4UdJJKyjPZ0383wc213eEj5CEd0hCTAJ/IqkNYlvA23aXPZxVVoyZutRWJ2XMvNeu7dBWfOpz9WxZ/wJwOf3zP7mVigAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/daf23c051d1970bd74a5bdb9fe7de872/5f2c3/thumbnail.png","srcSet":"/static/daf23c051d1970bd74a5bdb9fe7de872/90cd3/thumbnail.png 100w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/614dc/thumbnail.png 200w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/5f2c3/thumbnail.png 400w","sizes":"(min-width: 400px) 400px, 100vw"},"sources":[{"srcSet":"/static/daf23c051d1970bd74a5bdb9fe7de872/e64f1/thumbnail.webp 100w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/8b00d/thumbnail.webp 200w,\n/static/daf23c051d1970bd74a5bdb9fe7de872/9c0a1/thumbnail.webp 400w","type":"image/webp","sizes":"(min-width: 400px) 400px, 100vw"}]},"width":400,"height":400}},"publicURL":"/static/daf23c051d1970bd74a5bdb9fe7de872/thumbnail.png"}}}}]}},"pageContext":{"slug":"/SpringDB_1/","series":[{"slug":"/SpringDB_1/","title":"스프링 DB 1편 - 데이터 접근 핵심 원리 정리","num":1}],"lastmod":"2024.12.15."}},"staticQueryHashes":["2383754777"],"slicesMap":{}}