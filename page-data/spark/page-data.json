{"componentChunkName":"component---src-templates-post-tsx","path":"/spark/","result":{"data":{"site":{"siteMetadata":{"title":"Just Keep Going","description":"Ian's Archive","siteUrl":"https://hohshho.github.io"}},"allMarkdownRemark":{"edges":[{"node":{"id":"3176174a-4569-5427-9b7d-bdb898f6cf5f","html":"<p>최근 우리 팀은 정책 상 등록할 수 있는 데이터의 최대 크기가 수십GB 수준으로 확정되면서, 검토 중이던 Apache Spark를 최종적으로 도입하지 않기로 결정했다.<br>\n(이미 너무 많은 데이터 갱신 로직이 있고, 현재 상황엔 서비스 할 때 까지 배치가 안정적으로 도는게 중요)</p>\n<p>하지만 추후 크기가 큰 데이터 융복합이나, 대량의 데이터가 생길 경우에는 다시 고민을 해보자는 결론이 났으므로, 리마인드 겸 블로그를 통해 정리한다.</p>\n<hr>\n<p>현재 개발 중인 스케줄러가 있다. 이 스케줄러가 처리하는 작업은 크게 4가지로 나뉜다.</p>\n<ol>\n<li>모듈: 이미 존재하는 데이터를 동기화하는 내부 로직</li>\n<li>DB: 사용자가 설정한 값으로 DB에서 데이터를 가져오는 작업</li>\n<li>API: 외부 API를 호출하여 데이터를 가져오는 작업</li>\n<li>File: 사용자가 업로드한 파일을 읽어 처리하는 작업</li>\n</ol>\n<p>‘모듈’을 제외한 나머지 3가지는 사용자가 입력한 설정값을 기반으로 동작한다. 여기서 고민이 됐던 부분은 바로 ‘File’ 처리였다.</p>\n<h1 id=\"1-고민의-시작\" style=\"position:relative;\"><a href=\"#1-%EA%B3%A0%EB%AF%BC%EC%9D%98-%EC%8B%9C%EC%9E%91\" aria-label=\"1 고민의 시작 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 고민의 시작</h1>\n<p>가장 큰 걱정거리는 3가지였다.</p>\n<ul>\n<li>대용량 파일을 업로드하면 문제없이 끝까지 처리할 수 있을까?</li>\n<li>파일 처리 부하가 급증할 때 다른 API까지 먹통이 되면서 서버가 뻗지는 않을까?</li>\n<li>현재 스트림 방식으로 파일이 DB에 잘 적재만 되게 구현했는데, 융복합 기능 개발 시 운영서버나 DB서버에 쌓일 부하</li>\n</ul>\n<p>로컬 PC에서 40GB짜리 txt 파일을 Java 코드로 변환 후 DB에 삽입하는 테스트를 했을 때 돌아는 갔지만, 실제 여러 사용자가 접속하는 서비스 환경을 생각하니 문제가 없을 지 확신이 없었다.</p>\n<p>작성한 코드는 결국 Java 애플리케이션 위에서 돌고, 대용량 파일을 처리하려면 스트림 처리를 하더라도 그만큼의 메모리(JVM Heap)를 점유할 것이기 때문이다.</p>\n<p>한 사용자가 올린 파일 하나가 너무 큰 파일이거나 전체 짧은 시간에 여러 요청이 와서 서비스가 OOM(OutOfMemoryError)으로 죽어버리는 좋지 않은 시나리오가 계속해서 걱정이 되었다.<br>\n(괜한 고민이긴 했다. 수십 GB정도는 서버 성능이 좋아서 기존대로 처리해도 크게 문제가 되지는 않을 것 같다는 피드백이 있었다.)</p>\n<p>이러한 성능상의 문제를 해결해줄 수 있는 솔루션이 있는지 찾아보았다.</p>\n<h1 id=\"2-그래서-어떤-방법이-있는데\" style=\"position:relative;\"><a href=\"#2-%EA%B7%B8%EB%9E%98%EC%84%9C-%EC%96%B4%EB%96%A4-%EB%B0%A9%EB%B2%95%EC%9D%B4-%EC%9E%88%EB%8A%94%EB%8D%B0\" aria-label=\"2 그래서 어떤 방법이 있는데 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 그래서 어떤 방법이 있는데?</h1>\n<ol>\n<li>기존 방안 - 스트림 활용</li>\n</ol>\n<p>장점</p>\n<ul>\n<li>현재 구현방식으로 순수한 Java코드로 해결이 가능</li>\n</ul>\n<p>단점</p>\n<ul>\n<li>추후에 복잡한 데이터 변환이나 여러 데이터 소스를 조인하는 로직을 구현하기엔 코드가 지저분해짐</li>\n<li>결국 서버 한 대의 성능이 한계</li>\n</ul>\n<ol start=\"2\">\n<li>작업 분리</li>\n</ol>\n<p>구현 방법</p>\n<ul>\n<li>메시지 큐 도입</li>\n<li>큐를 감시하고 있는 별도의 워커 애플리케이션은 만듬, 워커는 큐에 메시지가 들어오면 그걸 가져가서 실제 파일 처리를 수행하고, 결과를 DB에 저장</li>\n</ul>\n<p>장점</p>\n<ul>\n<li>격리, 워커가 파일을 처리하다가 죽더라도 메인 웹 어플리케이션은 영향을 받지 않음</li>\n<li>확장성, 일이 많이 쌓이면 워커 어플리케이션의 인스턴스 개수 증가, 메인 서버와 독립적으로 확장</li>\n</ul>\n<p>단점</p>\n<ul>\n<li>새로운 시스템을 도입해야하고, 아키텍처가 복잡해짐</li>\n<li>워커 어플리케이션을 별도로 개발하고 배포, 관리해야 함</li>\n</ul>\n<ol start=\"3\">\n<li>대용량 데이터 처리 전문 프레임워크 도입</li>\n</ol>\n<p>구현 방법</p>\n<ul>\n<li>분산처리 프레임워크 사용 (Apache Spark)</li>\n<li>Spark 엔진이 알아서 파일을 분할하고, 여러코어로 병렬 처리, 메모리가 부족하면 디스크 사용 등 복잡한 과정 책임져 준다.</li>\n</ul>\n<p>장점</p>\n<ul>\n<li>Spark가 알아서 메모리, 디스크 관리</li>\n<li>단일 머신에선 멀티코어 100% 활용, 나중에 데이터가 커지면 코드 수정 없이 클러스터 환경으로 전환해 무제한으로 확장 가능</li>\n<li>데이터 조인, 집계 등 복잡한 로직을 매우 간결한 코드로 작성할 수 있게 해주는 강력한 API 제공</li>\n</ul>\n<p>단점</p>\n<ul>\n<li>간단한 작업을 처리하기엔 배보다 배꼽이 더 클 수 있다.</li>\n<li>Spark라는 새로운 기술에 대한 학습 곡선</li>\n<li>Spark라는 무거운 의존성 추가된다.</li>\n</ul>\n<p>오버 엔지니어링을 가장 걱정했지만, 실제 서비스는 데이터 처리가 가장 핵심이고 “여러 사용자가”, “동시에”, “어떤 크기의 파일을 올릴지 모르는 상황에서”, “앞으로 더 복잡한 분석 기능이 추가될 수 있고”, “장애 상황에서도 안정적으로” 동작해야 했기 때문에 Spark 도입하는 것이 좋은 방법이라 생각했다.</p>\n<h1 id=\"3-spark-정리\" style=\"position:relative;\"><a href=\"#3-spark-%EC%A0%95%EB%A6%AC\" aria-label=\"3 spark 정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Spark 정리</h1>\n<p>Spark는 단순히 파일 처리 도구가 아니라, **통합 분석 엔진(Unified Analytics Engine)**이다. 분산 처리를 위한 RDD(Resilient Distributed Dataset)라는 핵심 개념 위에, 다양한 모듈을 얹어서 사용한다.</p>\n<ul>\n<li>Spark SQL: 정형 데이터를 다루는 모듈. 우리가 흔히 아는 DataFrame이나 Dataset API를 제공해서 SQL 쓰듯이 데이터를 다룰 수 있게 해준다.</li>\n<li>Structured Streaming: 실시간 데이터 처리용. 배치 처리 코드랑 거의 비슷하게 쓸 수 있어서 좋다.</li>\n<li>MLlib / GraphX: 각각 머신러닝, 그래프 처리용 라이브러리다.</li>\n</ul>\n<p>이 모든 걸 하나의 엔진과 일관된 API로 쓸 수 있다는 게 Spark의 가장 큰 매력이다.</p>\n<h1 id=\"4-spark-그런데-컴퓨터가-한-대-인데\" style=\"position:relative;\"><a href=\"#4-spark-%EA%B7%B8%EB%9F%B0%EB%8D%B0-%EC%BB%B4%ED%93%A8%ED%84%B0%EA%B0%80-%ED%95%9C-%EB%8C%80-%EC%9D%B8%EB%8D%B0\" aria-label=\"4 spark 그런데 컴퓨터가 한 대 인데 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. Spark, 그런데 컴퓨터가 한 대 인데?</h1>\n<p>Spark 하면 보통 수십, 수백 대의 컴퓨터를 엮어서 쓰는 ‘분산 처리’ 기술의 끝판왕으로 알려져 있다. 그런데 우리 서버는 그냥 단일 클러스터, 쉽게 말해 컴퓨터 한 대다. 이런 환경에서 Spark를 쓰는 게 과연 의미가 있을까? “닭 잡는 데 소 잡는 칼 쓰는 격 아닌가?” 하는 의문이 들기도 했다.</p>\n<p>단일 머신에서 Spark를 실행하는 걸 **‘로컬 모드(Local Mode)‘**라고 한다. 이 모드의 장점을 파고들기 전에, 먼저 기존 방식과 Spark 방식의 근본적인 차이를 짚어볼 필요가 있다.</p>\n<p>전통적인 방식 vs. Spark 방식</p>\n<p>시나리오: DB 안에 있는 40GB짜리 로그 테이블(Table A)과 100GB짜리 사용자 행동 테이블(Table B)을 조인해서, 두 정보를 합친 약 140GB 크기의 새로운 분석용 테이블(Table C)을 만든다고 가정</p>\n<p>(시나리오는 추후 데이터 융복합과정이 부하가 더 클것으로 생각되어 이러한 시나리오로 가정)</p>\n<p>방식 1: 전통적인 Java + SQL</p>\n<ol>\n<li>Java 애플리케이션이 거대하고 복잡한 JOIN SQL을 생성한다.</li>\n<li>이 SQL을 DB로 전송한다.</li>\n<li>모든 부하는 DB 서버에 집중된다. DB는 1억 건과 100만 건 테이블을 전부 읽고, 조인하고, 그룹핑하고, 계산까지 혼자 다 한다. 이 작업 동안 DB는 다른 요청에 제대로 응답하기 어렵다.</li>\n</ol>\n<p>처리 부하: 모든 계산(1억 건 x 100만 건 조인)이 DB 서버에 집중된다. 이 작업이 실행되는 동안 DB는 다른 서비스 요청에 응답하기 어려울 수 있다.</p>\n<p>SQL의 역할: 데이터 **처리(Process)와 적재(Load)**를 모두 담당</p>\n<p>방식 2: Spark를 이용한 방식</p>\n<ol>\n<li>Spark가 DB에 “판매 기록이랑 고객 정보 그냥 통째로 줘” 라고 요청한다. (단순 SELECT *)</li>\n<li>DB에서 읽어온 데이터의 처리 주체는 Spark가 된다. Spark는 데이터를 여러 조각으로 나눠 병렬로 조인, 그룹핑, 계산을 수행한다. 이 모든 무거운 작업은 DB가 아닌 Spark 엔진(여기서는 우리 애플리케이션 서버)에서 일어난다.</li>\n<li>Spark가 모든 계산을 끝내고 나온 최종 결과(예: 1,000건)만 DB에 “이것만 저장해줘” 라고 요청한다. (단순 INSERT)</li>\n</ol>\n<p>마지막은 SQL이 지만 Spark는 많은 데이터를 처리하는 무거운 계산을 DB 외부의 분산 환경에서 모두 끝내고, 그 결과인 몇천 건의 “정답”만 들고 가서 “이것만 DB에 적어주세요” 라고 요청하는 방식이다.</p>\n<p>핵심은 **계산 부하를 DB에서 Spark로 완전히 분리(Offloading)**하는 것이다. DB는 데이터 창고 역할에만 충실하게 되고, 시스템 전체의 안정성이 올라간다.</p>\n<p>이 개념을 파일 처리에 그대로 적용할 수 있다. 기존 방식은 Java 애플리케이션의 메모리가 모든 부하를 감당했지만, Spark를 쓰면 Spark 엔진이 그 역할을 대신하게 되는 거다.</p>\n<p>추후에 시스템을 확장하더라도 DB 서버 스케일업 (비용 높고 한계 명확)보단, Spark 클러스터 스케일아웃 (비용 효율적, 거의 무한 확장)이 효율적이다.</p>\n<h1 id=\"5-단일-클러스터일-경우-진짜-이점\" style=\"position:relative;\"><a href=\"#5-%EB%8B%A8%EC%9D%BC-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0%EC%9D%BC-%EA%B2%BD%EC%9A%B0-%EC%A7%84%EC%A7%9C-%EC%9D%B4%EC%A0%90\" aria-label=\"5 단일 클러스터일 경우 진짜 이점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 단일 클러스터일 경우 진짜 이점</h1>\n<p>그럼 이제 “컴퓨터 한 대인데 그게 무슨 소용이야?” 라는 질문에 답을 할 차례다. 크게 3가지 장점이 있다.</p>\n<ol>\n<li>멀티코어 활용 극대화 (병렬 처리)</li>\n</ol>\n<p>평범한 Java 코드는 특별한 병렬 프로그래밍을 하지 않는 이상, 기본적으로 단일 코어로만 동작한다. 8코어 CPU가 있어도 1개 코어만 죽어라 일하고 나머지 7개는 노는 셈이다.</p>\n<p>하지만 Spark 로컬 모드는 다르다. local[*] 옵션을 주면 Spark는 알아서 기기의 모든 CPU 코어를 최대한 활용해 작업을 병렬로 처리한다. 40GB짜리 파일을 8개 코어가 5GB씩 나눠서 동시에 처리하는 식이다. 덕분에 단일 머신 내에서도 훨씬 빠른 성능을 기대할 수 있다.</p>\n<ol start=\"2\">\n<li>메모리 관리의 효율성 (OOM으로부터의 해방)</li>\n</ol>\n<p>이게 Spark를 선택한 가장 결정적인 이유다.</p>\n<p>내 서버의 가용 메모리가 16GB인데 40GB짜리 파일 처리를 요청받았다고 가정해보자.</p>\n<ul>\n<li>Spark 로컬 모드: Spark는 데이터를 한 번에 메모리에 올리지 않는다. 파일을 여러 개의 작은 조각(Partition)으로 나누어 처리한다. 만약 처리 도중 메모리가 부족해지면, 처리 중인 데이터를 디스크에 잠시 내려놓고(Spilling) 나중에 다시 읽어오는 아주 영리한 방식으로 동작한다. 속도는 조금 느려질 수 있어도, 애플리케이션이 죽는 최악의 상황은 절대 발생하지 않는다.</li>\n</ul>\n<ol start=\"3\">\n<li>코드의 일관성과 확장성 (미래를 위한 투자)</li>\n</ol>\n<p>이건 전략적으로 가장 중요한 이점이다.</p>\n<ul>\n<li>지금은 데이터가 적으니 단일 머신(로컬 모드)에서 Spark 코드를 개발한다.</li>\n<li>1년 뒤, 데이터가 100배로 늘어 도저히 서버 한 대로 감당이 안 되는 시점이 왔다.</li>\n<li>이때, 우리는 기존에 작성한 Spark 코드를 단 한 줄도 수정할 필요 없이, 실행 환경만 로컬 모드에서 실제 분산 클러스터(YARN, Kubernetes 등)로 바꿔주기만 하면 된다.</li>\n</ul>\n<p>DataSet API의 간결함 -> 가장 마음에 들었던 부분이다.</p>\n<p>그리고 Spark에서는 데이터 변환이나 합성을 위해 DataSet을 사용하는 방법을 지원하는데, 이게 짱이다. 기존 Java 코드였다면 CSV 한 줄씩 읽어서 객체로 파싱하고, for문 돌리면서 조건 체크하고, 다른 데이터랑 합치기 위해 또 복잡한 로직을 짜야 했다. 하지만 DataSet API를 쓰니 dataset.filter(…).join(…).withColumn(…) 같은 함수형 스타일로 코드가 훨씬 깔끔해졌다. 가독성도 좋고 유지보수도 쉬워 보였다.</p>\n<h1 id=\"6-그래서-얼마나-빨라졌나-속도보단-안정성성\" style=\"position:relative;\"><a href=\"#6-%EA%B7%B8%EB%9E%98%EC%84%9C-%EC%96%BC%EB%A7%88%EB%82%98-%EB%B9%A8%EB%9D%BC%EC%A1%8C%EB%82%98-%EC%86%8D%EB%8F%84%EB%B3%B4%EB%8B%A8-%EC%95%88%EC%A0%95%EC%84%B1%EC%84%B1\" aria-label=\"6 그래서 얼마나 빨라졌나 속도보단 안정성성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. 그래서 얼마나 빨라졌나? (속도보단 안정성성)</h1>\n<p>실제 파일 처리 스케줄러에 Spark를 적용한 후 시간을 측정해봤다.</p>\n<table>\n<thead>\n<tr>\n<th>구분</th>\n<th>시작 시간</th>\n<th>종료 시간</th>\n<th>소요 시간</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Spark 적용 전</td>\n<td>2025-07-23 16:49:21</td>\n<td>2025-07-23 17:19:59</td>\n<td>약 30분 38초</td>\n</tr>\n<tr>\n<td>Spark local[*] 옵션</td>\n<td>2025-07-24 11:21:05</td>\n<td>2025-07-24 11:46:26</td>\n<td>약 25분</td>\n</tr>\n<tr>\n<td>Spark 적용 후</td>\n<td>2025-07-24 14:54:51</td>\n<td>2025-07-24 15:29:15</td>\n<td>약 34분 24초</td>\n</tr>\n</tbody>\n</table>\n<p>“어? 오히려 더 느려졌잖아?” 라고 생각할 수 있다. 맞다. local[2] 처럼 적은 코어를 할당하고 디스크 I/O가 발생하니 작업에서의 속도가 조금 느려졌다.</p>\n<p>local[*]일 경우는 CPU를 많이 잡아먹긴 하지만 5분 정도 시간이 단축되었다.</p>\n<p>하지만</p>\n<ul>\n<li>기존 구조는 메모리보다 큰 파일이 들어오는 순간 OOM으로 그냥 죽는다. (언제 터질지 모르는 시한폭탄과 같다.)</li>\n<li>Spark 구조는 파일 크기가 아무리 커져도 느려질지언정 죽지 않고 작업을 완료한다. (시스템 전체의 생존을 보장하는 안전장치인 셈이다.)</li>\n</ul>\n<p>나는 약간의 속도를 포기하고, 그 대가로 안정성과 미래 확장성을 얻었다. 이보다 더 좋은 거래는 없다고 생각했다.</p>\n<p><strong>잠깐! Spark는 메모리 기반 아니었어?</strong></p>\n<ul>\n<li>\n<p>많은 사람들이 “Spark는 인메모리(In-Memory) 처리, 하둡은 디스크 기반 처리”라고 알고 있을 거다. 이건 반은 맞고 반은 틀린 이야기다. Spark는 하둡과 달리 가급적 메모리를 사용해서 작업 간 데이터 전달을 하기에 빠른 게 맞다.</p>\n</li>\n<li>\n<p>하지만 핵심은 메모리가 부족할 때다. 이때 Spark는 앞서 말했듯 지능적으로 디스크를 활용하여 OOM 없이 안정적으로 작업을 끝낸다. 즉, “Spark는 메모리의 속도와 디스크의 안정성을 모두 활용하는 하이브리드 시스템” 이라고 이해하는 게 가장 정확하다.</p>\n</li>\n</ul>\n<h1 id=\"7-적용-방법\" style=\"position:relative;\"><a href=\"#7-%EC%A0%81%EC%9A%A9-%EB%B0%A9%EB%B2%95\" aria-label=\"7 적용 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. 적용 방법</h1>\n<ol>\n<li>build.gradle 추가</li>\n</ol>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"78055077389275680000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"복사 되었습니다!\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`\t// Spark\r\n\timplementation 'org.apache.spark:spark-core_2.13:3.5.6'\r\n\timplementation 'org.apache.spark:spark-sql_2.13:3.5.6'\r\n\timplementation 'com.databricks:spark-xml_2.13:0.18.0'\r\n\r\n\t// Spark는 window 파일 시스템 작업을 위해 내부적으로 Hadoop API를 사용\r\n\truntimeOnly(&quot;org.apache.hadoop:hadoop-client-runtime:3.3.6&quot;)\r\n\truntimeOnly(&quot;org.apache.hadoop:hadoop-client-api:3.3.6&quot;)\r\n\r\n\t// Spark UI가 필요로 하는 javax.servlet-api를 직접 추가\r\n\t// Spring Boot 3.x의 jakarta.servlet-api와의 충돌을 해결\r\n\timplementation(&quot;javax.servlet:javax.servlet-api:4.0.1&quot;)\r\n\r\n\t// 2. Spark UI의 REST API가 사용하는 Jersey 관련 라이브러리 버전을 명시적으로 지정\r\n\timplementation &quot;org.glassfish.jersey.core:jersey-client:\\${jerseyVersion}&quot;\r\n\timplementation &quot;org.glassfish.jersey.core:jersey-common:\\${jerseyVersion}&quot;\r\n\timplementation &quot;org.glassfish.jersey.core:jersey-server:\\${jerseyVersion}&quot;\r\n\timplementation &quot;org.glassfish.jersey.containers:jersey-container-servlet:\\${jerseyVersion}&quot;\r\n\timplementation &quot;org.glassfish.jersey.containers:jersey-container-servlet-core:\\${jerseyVersion}&quot;\r\n\timplementation &quot;org.glassfish.jersey.inject:jersey-hk2:\\${jerseyVersion}&quot;`, `78055077389275680000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                복사<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk3\">// Spark</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">\timplementation </span><span class=\"mtk8\">&#39;org.apache.spark:spark-core_2.13:3.5.6&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">\timplementation </span><span class=\"mtk8\">&#39;org.apache.spark:spark-sql_2.13:3.5.6&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">\timplementation </span><span class=\"mtk8\">&#39;com.databricks:spark-xml_2.13:0.18.0&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk3\">// Spark는 window 파일 시스템 작업을 위해 내부적으로 Hadoop API를 사용</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk11\">runtimeOnly</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;org.apache.hadoop:hadoop-client-runtime:3.3.6&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk11\">runtimeOnly</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;org.apache.hadoop:hadoop-client-api:3.3.6&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk3\">// Spark UI가 필요로 하는 javax.servlet-api를 직접 추가</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk3\">// Spring Boot 3.x의 jakarta.servlet-api와의 충돌을 해결</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk11\">implementation</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;javax.servlet:javax.servlet-api:4.0.1&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk3\">// 2. Spark UI의 REST API가 사용하는 Jersey 관련 라이브러리 버전을 명시적으로 지정</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">\timplementation </span><span class=\"mtk8\">&quot;org.glassfish.jersey.core:jersey-client:${jerseyVersion}&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"16\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">\timplementation </span><span class=\"mtk8\">&quot;org.glassfish.jersey.core:jersey-common:${jerseyVersion}&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"17\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">\timplementation </span><span class=\"mtk8\">&quot;org.glassfish.jersey.core:jersey-server:${jerseyVersion}&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"18\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">\timplementation </span><span class=\"mtk8\">&quot;org.glassfish.jersey.containers:jersey-container-servlet:${jerseyVersion}&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"19\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">\timplementation </span><span class=\"mtk8\">&quot;org.glassfish.jersey.containers:jersey-container-servlet-core:${jerseyVersion}&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"20\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">\timplementation </span><span class=\"mtk8\">&quot;org.glassfish.jersey.inject:jersey-hk2:${jerseyVersion}&quot;</span></span></span></code></pre>\n<ol start=\"2\">\n<li>yml 설정 변경</li>\n</ol>\n<p>application-dev.yml</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"45627228453394350000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"복사 되었습니다!\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`spark:\r\n  app:\r\n    name: Dev-DataPlatform-Job\r\n  master:\r\n    uri: local[6]\r\n  sql:\r\n    warehouse:\r\n      dir: file:///\\${java.io.tmpdir}/spark-warehouse-dev\r\n    shuffle:\r\n      partitions: 3\r\n  driver:\r\n    memory: 4g\r\n  memory:\r\n    offHeap:\r\n      size: 1g`, `45627228453394350000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                복사<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">spark</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  app</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    name</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> Dev-DataPlatform-</span><span class=\"mtk10\">Job</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  master</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    uri</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> local[</span><span class=\"mtk7\">6</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  sql</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    warehouse</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      dir</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> file</span><span class=\"mtk15\">:</span><span class=\"mtk3\">///${java.io.tmpdir}/spark-warehouse-dev</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    shuffle</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      partitions</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  driver</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    memory</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> 4g</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  memory</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    offHeap</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      size</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> 1g</span></span></span></code></pre>\n<p>application-prod.yml</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"19402545817059160000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"복사 되었습니다!\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`spark:\r\n  app:\r\n    name: Prod-DataPlatform-Job\r\n  master:\r\n    uri: local[16]\r\n  sql:\r\n    warehouse:\r\n      dir: file:///tmp/spark-warehouse-prod\r\n    shuffle:\r\n      partitions: 16\r\n  driver:\r\n    memory: 20g\r\n  memory:\r\n    offHeap:\r\n      size: 4g`, `19402545817059160000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                복사<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">spark</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  app</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    name</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> Prod-DataPlatform-</span><span class=\"mtk10\">Job</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  master</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    uri</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> local[</span><span class=\"mtk7\">16</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  sql</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    warehouse</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      dir</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> file</span><span class=\"mtk15\">:</span><span class=\"mtk3\">///tmp/spark-warehouse-prod</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    shuffle</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      partitions</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">16</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  driver</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    memory</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> 20g</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  memory</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    offHeap</span><span class=\"mtk15\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      size</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> 4g</span></span></span></code></pre>\n<ol start=\"3\">\n<li>SparkConfig 생성</li>\n</ol>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"29130316524082668000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"복사 되었습니다!\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`@Configuration\r\npublic class SparkConfig {\r\n\r\n    @Value(&quot;\\${spark.app.name}&quot;)\r\n    private String appName;\r\n\r\n    @Value(&quot;\\${spark.master.uri}&quot;)\r\n    private String masterUri;\r\n\r\n    @Value(&quot;\\${spark.sql.warehouse.dir}&quot;)\r\n    private String warehouseDir;\r\n\r\n    @Value(&quot;\\${spark.driver.memory}&quot;)\r\n    private String driverMemory;\r\n\r\n    @Value(&quot;\\${spark.sql.shuffle.partitions}&quot;)\r\n    private String shufflePartitions;\r\n\r\n    @Value(&quot;\\${spark.memory.offHeap.size}&quot;)\r\n    private String offHeapMemorySize;\r\n\r\n    @Bean\r\n    public SparkConf sparkConf() {\r\n        SparkConf sparkConfiguration = new SparkConf()\r\n                .setAppName(appName)\r\n                .setMaster(masterUri)\r\n                .set(&quot;spark.sql.warehouse.dir&quot;, warehouseDir)\r\n                .set(&quot;spark.driver.memory&quot;, driverMemory)\r\n                .set(&quot;spark.sql.shuffle.partitions&quot;, shufflePartitions)\r\n                .set(&quot;spark.memory.offHeap.enabled&quot;, &quot;true&quot;)\r\n                .set(&quot;spark.memory.offHeap.size&quot;, offHeapMemorySize)\r\n                .set(&quot;spark.scheduler.mode&quot;, &quot;FAIR&quot;); // FAIR 스케줄러 모드 설정\r\n\r\n        try {\r\n            ClassPathResource resource = new ClassPathResource(&quot;fairscheduler.xml&quot;);\r\n\r\n            try (InputStream inputStream = resource.getInputStream()) {\r\n                // 임시 파일을 생성합니다.\r\n                File tempFile = File.createTempFile(&quot;fairscheduler-&quot;, &quot;.xml&quot;);\r\n                tempFile.deleteOnExit();\r\n\r\n                try (OutputStream outputStream = new FileOutputStream(tempFile)) {\r\n                    StreamUtils.copy(inputStream, outputStream);\r\n                }\r\n\r\n                sparkConfiguration.set(&quot;spark.scheduler.allocation.file&quot;, tempFile.getAbsolutePath());\r\n            }\r\n\r\n        } catch (IOException e) {\r\n            throw new RuntimeException(&quot;Could not find or process fairscheduler.xml in classpath&quot;, e);\r\n        }\r\n\r\n        return sparkConfiguration;\r\n    }\r\n\r\n    @Bean(destroyMethod = &quot;stop&quot;)\r\n    public SparkSession sparkSession() {\r\n        return SparkSession.builder()\r\n                .config(sparkConf())\r\n                .getOrCreate();\r\n    }\r\n}`, `29130316524082668000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                복사<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Configuration</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">SparkConfig</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Value</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;${spark.app.name}&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">appName</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Value</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;${spark.master.uri}&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">masterUri</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Value</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;${spark.sql.warehouse.dir}&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">warehouseDir</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Value</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;${spark.driver.memory}&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">driverMemory</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"16\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Value</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;${spark.sql.shuffle.partitions}&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"17\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">shufflePartitions</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"18\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"19\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Value</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;${spark.memory.offHeap.size}&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"20\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">offHeapMemorySize</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"21\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"22\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"23\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">SparkConf</span><span class=\"mtk1\"> </span><span class=\"mtk11\">sparkConf</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"24\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">SparkConf</span><span class=\"mtk1\"> </span><span class=\"mtk12\">sparkConfiguration</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">SparkConf</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"25\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">setAppName</span><span class=\"mtk1\">(appName)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"26\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">setMaster</span><span class=\"mtk1\">(masterUri)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"27\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">set</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;spark.sql.warehouse.dir&quot;</span><span class=\"mtk1\">, warehouseDir)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"28\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">set</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;spark.driver.memory&quot;</span><span class=\"mtk1\">, driverMemory)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"29\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">set</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;spark.sql.shuffle.partitions&quot;</span><span class=\"mtk1\">, shufflePartitions)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"30\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">set</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;spark.memory.offHeap.enabled&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;true&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"31\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">set</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;spark.memory.offHeap.size&quot;</span><span class=\"mtk1\">, offHeapMemorySize)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"32\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">set</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;spark.scheduler.mode&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;FAIR&quot;</span><span class=\"mtk1\">); </span><span class=\"mtk3\">// FAIR 스케줄러 모드 설정</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"33\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"34\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"35\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">ClassPathResource</span><span class=\"mtk1\"> </span><span class=\"mtk12\">resource</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">ClassPathResource</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;fairscheduler.xml&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"36\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"37\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">InputStream</span><span class=\"mtk1\"> </span><span class=\"mtk12\">inputStream</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">resource</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getInputStream</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"38\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\">// 임시 파일을 생성합니다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"39\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk10\">File</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tempFile</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">File</span><span class=\"mtk1\">.</span><span class=\"mtk11\">createTempFile</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;fairscheduler-&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;.xml&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"40\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">tempFile</span><span class=\"mtk1\">.</span><span class=\"mtk11\">deleteOnExit</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"41\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"42\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">OutputStream</span><span class=\"mtk1\"> </span><span class=\"mtk12\">outputStream</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">FileOutputStream</span><span class=\"mtk1\">(tempFile)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"43\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">StreamUtils</span><span class=\"mtk1\">.</span><span class=\"mtk11\">copy</span><span class=\"mtk1\">(inputStream, outputStream);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"44\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"45\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"46\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">sparkConfiguration</span><span class=\"mtk1\">.</span><span class=\"mtk11\">set</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;spark.scheduler.allocation.file&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">tempFile</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getAbsolutePath</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"47\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"48\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"49\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">IOException</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"50\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">RuntimeException</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Could not find or process fairscheduler.xml in classpath&quot;</span><span class=\"mtk1\">, e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"51\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"52\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"53\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> sparkConfiguration;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"54\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"55\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"56\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Bean</span><span class=\"mtk1\">(destroyMethod = </span><span class=\"mtk8\">&quot;stop&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"57\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">SparkSession</span><span class=\"mtk1\"> </span><span class=\"mtk11\">sparkSession</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"58\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">SparkSession</span><span class=\"mtk1\">.</span><span class=\"mtk11\">builder</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"59\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">config</span><span class=\"mtk1\">(</span><span class=\"mtk11\">sparkConf</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"60\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">getOrCreate</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"61\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"62\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<ol start=\"4\">\n<li>Service 코드 변경</li>\n</ol>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"80615922312644250000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"복사 되었습니다!\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`    /**\r\n     * 스케줄에 등록된 파일 처리를 위한 메인 진입점.\r\n     * 파일 유형을 감지하고 적절한 처리기로 라우팅합니다.\r\n     */\r\n    public void processScheduledFile(String schedulId, String schedulHistId) { // History ID를 받도록 수정\r\n        SchedulDetailDto detail = wrkClctDao.getSchedulDetailById(schedulId);\r\n        String fileType = determineFileType(detail.getUploadedFiles());\r\n\r\n        if (fileType == null) {\r\n            String errorMsg = &quot;처리할 파일이 없거나 지원하지 않는 파일 유형입니다.&quot;;\r\n            log.error(&quot;스케줄 ID [{}]: {}&quot;, schedulId, errorMsg);\r\n            updateHistory(schedulHistId, &quot;FAIL&quot;, errorMsg);\r\n            return;\r\n        }\r\n\r\n        log.info(&quot;스케줄 ID [{}]: 감지된 파일 유형 '{}'에 대한 처리를 시작합니다.&quot;, schedulId, fileType);\r\n\r\n        try {\r\n            // 공간정보 파일은 기존 ogr2ogr 방식 유지\r\n            if (&quot;shp&quot;.equalsIgnoreCase(fileType) || &quot;gpkg&quot;.equalsIgnoreCase(fileType)) {\r\n                handleGeospatialFile(detail, fileType);\r\n            } else {\r\n                // 그 외 모든 파일(CSV, JSON, XML, TXT 등)은 Spark으로 통합 처리\r\n                handleFileWithSpark(detail, fileType);\r\n            }\r\n        } catch (Exception e) {\r\n            String errorMsg = &quot;파일 처리 중 최상위 오류 발생: &quot; + e.getMessage();\r\n            log.error(&quot;파일 처리 중 오류 발생 (스케줄 ID: {})&quot;, schedulId, e);\r\n            updateHistory(schedulHistId, &quot;FAIL&quot;, errorMsg);\r\n            throw new RuntimeException(&quot;스케줄 &quot; + schedulId + &quot;의 파일 처리 실패&quot;, e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Spark를 사용하여 일반 파일(CSV, JSON, XML, TXT 등)을 처리하는 통합 메소드.\r\n     *\r\n     * @param detail   스케줄 상세 정보\r\n     * @param fileType 파일 유형\r\n     */\r\n    private void handleFileWithSpark(SchedulDetailDto detail, String fileType) {\r\n        UploadedFileDto uploadedFile = detail.getUploadedFiles().get(0);\r\n        Path filePath = Paths.get(permanentStoragePath, uploadedFile.getUniqueName());\r\n\r\n        if (!Files.exists(filePath)) {\r\n            throw new RuntimeException(&quot;파일을 찾을 수 없습니다: &quot; + filePath);\r\n        }\r\n\r\n        log.info(&quot;Spark(v{}) 기반 파일 처리 시작. 파일: {}&quot;, sparkSession.version(), filePath);\r\n\r\n        // 1. Spark를 사용하여 파일 읽기\r\n        Dataset<Row> sourceDf = readDataWithSpark(filePath.toAbsolutePath().toString(), fileType);\r\n        if (sourceDf == null) {\r\n            throw new IllegalArgumentException(&quot;지원하지 않는 파일 유형이거나 읽기에 실패했습니다: &quot; + fileType);\r\n        }\r\n        log.info(&quot;파일로부터 {} 건의 데이터를 DataFrame으로 읽었습니다.&quot;, sourceDf.count());\r\n        sourceDf.printSchema();\r\n\r\n        // 2. 데이터 변환 (Transformation)\r\n        Dataset<Row> transformedDf = transformDataFrame(sourceDf, detail.getDataId());\r\n        log.info(&quot;DataFrame 변환 완료. 최종 스키마:&quot;);\r\n        transformedDf.printSchema();\r\n\r\n        // 3. Spark를 사용하여 대상 DB에 데이터 쓰기\r\n        String targetTableName = &quot;clct_storage_test.&quot; + sanitizeIdentifier(detail.getClctDataEngNm());\r\n        Properties targetProps = new Properties();\r\n        targetProps.put(&quot;user&quot;, targetDbUsername);\r\n        targetProps.put(&quot;password&quot;, targetDbPassword);\r\n        targetProps.put(&quot;driver&quot;, &quot;org.postgresql.Driver&quot;);\r\n\r\n        SaveMode saveMode = &quot;overwrite&quot;.equalsIgnoreCase(detail.getUpdateMode()) ? SaveMode.Overwrite : SaveMode.Append;\r\n\r\n        // 테이블 DDL 관리를 위해, Overwrite 모드일 때 테이블을 미리 준비\r\n        if (saveMode == SaveMode.Overwrite) {\r\n            List<ClctDataColumnResponseDto> columnSchema = clctDataColumnService.findByDataId(detail.getDataId());\r\n            prepareTargetTable(sanitizeIdentifier(detail.getClctDataEngNm()), &quot;overwrite&quot;, columnSchema);\r\n        }\r\n\r\n        transformedDf.write().mode(saveMode).jdbc(targetDbUrl, targetTableName, targetProps);\r\n        log.info(&quot;Spark 파일 처리 작업 성공. 데이터가 테이블 '{}'에 저장되었습니다.&quot;, targetTableName);\r\n    }`, `80615922312644250000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                복사<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">    /**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">     * 스케줄에 등록된 파일 처리를 위한 메인 진입점.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">     * 파일 유형을 감지하고 적절한 처리기로 라우팅합니다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">     */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">processScheduledFile</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> schedulId, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> schedulHistId) { </span><span class=\"mtk3\">// History ID를 받도록 수정</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">SchedulDetailDto</span><span class=\"mtk1\"> </span><span class=\"mtk12\">detail</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">wrkClctDao</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getSchedulDetailById</span><span class=\"mtk1\">(schedulId);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">fileType</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">determineFileType</span><span class=\"mtk1\">(</span><span class=\"mtk12\">detail</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getUploadedFiles</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (fileType == </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">errorMsg</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;처리할 파일이 없거나 지원하지 않는 파일 유형입니다.&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">error</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;스케줄 ID [{}]: {}&quot;</span><span class=\"mtk1\">, schedulId, errorMsg);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk11\">updateHistory</span><span class=\"mtk1\">(schedulHistId, </span><span class=\"mtk8\">&quot;FAIL&quot;</span><span class=\"mtk1\">, errorMsg);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"16\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;스케줄 ID [{}]: 감지된 파일 유형 &#39;{}&#39;에 대한 처리를 시작합니다.&quot;</span><span class=\"mtk1\">, schedulId, fileType);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"17\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"18\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"19\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// 공간정보 파일은 기존 ogr2ogr 방식 유지</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"20\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk8\">&quot;shp&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk11\">equalsIgnoreCase</span><span class=\"mtk1\">(fileType) || </span><span class=\"mtk8\">&quot;gpkg&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk11\">equalsIgnoreCase</span><span class=\"mtk1\">(fileType)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"21\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk11\">handleGeospatialFile</span><span class=\"mtk1\">(detail, fileType);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"22\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"23\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\">// 그 외 모든 파일(CSV, JSON, XML, TXT 등)은 Spark으로 통합 처리</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"24\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk11\">handleFileWithSpark</span><span class=\"mtk1\">(detail, fileType);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"25\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"26\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">Exception</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"27\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">errorMsg</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;파일 처리 중 최상위 오류 발생: &quot;</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">e</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMessage</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"28\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">error</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;파일 처리 중 오류 발생 (스케줄 ID: {})&quot;</span><span class=\"mtk1\">, schedulId, e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"29\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk11\">updateHistory</span><span class=\"mtk1\">(schedulHistId, </span><span class=\"mtk8\">&quot;FAIL&quot;</span><span class=\"mtk1\">, errorMsg);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"30\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">RuntimeException</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;스케줄 &quot;</span><span class=\"mtk1\"> + schedulId + </span><span class=\"mtk8\">&quot;의 파일 처리 실패&quot;</span><span class=\"mtk1\">, e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"31\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"32\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"33\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"34\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">    /**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"35\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">     * Spark를 사용하여 일반 파일(CSV, JSON, XML, TXT 등)을 처리하는 통합 메소드.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"36\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">     *</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"37\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">     * </span><span class=\"mtk4\">@param</span><span class=\"mtk3\"> </span><span class=\"mtk12\">detail</span><span class=\"mtk3\">   스케줄 상세 정보</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"38\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">     * </span><span class=\"mtk4\">@param</span><span class=\"mtk3\"> </span><span class=\"mtk12\">fileType</span><span class=\"mtk3\"> 파일 유형</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"39\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">     */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"40\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">handleFileWithSpark</span><span class=\"mtk1\">(</span><span class=\"mtk10\">SchedulDetailDto</span><span class=\"mtk1\"> detail, </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> fileType) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"41\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">UploadedFileDto</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uploadedFile</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">detail</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getUploadedFiles</span><span class=\"mtk1\">().</span><span class=\"mtk11\">get</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"42\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Path</span><span class=\"mtk1\"> </span><span class=\"mtk12\">filePath</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Paths</span><span class=\"mtk1\">.</span><span class=\"mtk11\">get</span><span class=\"mtk1\">(permanentStoragePath, </span><span class=\"mtk12\">uploadedFile</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getUniqueName</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"43\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"44\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (!</span><span class=\"mtk12\">Files</span><span class=\"mtk1\">.</span><span class=\"mtk11\">exists</span><span class=\"mtk1\">(filePath)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"45\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">RuntimeException</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;파일을 찾을 수 없습니다: &quot;</span><span class=\"mtk1\"> + filePath);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"46\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"47\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"48\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Spark(v{}) 기반 파일 처리 시작. 파일: {}&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">sparkSession</span><span class=\"mtk1\">.</span><span class=\"mtk11\">version</span><span class=\"mtk1\">(), filePath);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"49\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"50\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// 1. Spark를 사용하여 파일 읽기</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"51\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Dataset</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Row</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">sourceDf</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">readDataWithSpark</span><span class=\"mtk1\">(</span><span class=\"mtk12\">filePath</span><span class=\"mtk1\">.</span><span class=\"mtk11\">toAbsolutePath</span><span class=\"mtk1\">().</span><span class=\"mtk11\">toString</span><span class=\"mtk1\">(), fileType);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"52\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (sourceDf == </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"53\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">IllegalArgumentException</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;지원하지 않는 파일 유형이거나 읽기에 실패했습니다: &quot;</span><span class=\"mtk1\"> + fileType);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"54\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"55\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;파일로부터 {} 건의 데이터를 DataFrame으로 읽었습니다.&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">sourceDf</span><span class=\"mtk1\">.</span><span class=\"mtk11\">count</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"56\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">sourceDf</span><span class=\"mtk1\">.</span><span class=\"mtk11\">printSchema</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"57\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"58\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// 2. 데이터 변환 (Transformation)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"59\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Dataset</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Row</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">transformedDf</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">transformDataFrame</span><span class=\"mtk1\">(sourceDf, </span><span class=\"mtk12\">detail</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getDataId</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"60\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;DataFrame 변환 완료. 최종 스키마:&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"61\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">transformedDf</span><span class=\"mtk1\">.</span><span class=\"mtk11\">printSchema</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"62\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"63\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// 3. Spark를 사용하여 대상 DB에 데이터 쓰기</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"64\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">targetTableName</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;clct_storage_test.&quot;</span><span class=\"mtk1\"> + </span><span class=\"mtk11\">sanitizeIdentifier</span><span class=\"mtk1\">(</span><span class=\"mtk12\">detail</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getClctDataEngNm</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"65\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Properties</span><span class=\"mtk1\"> </span><span class=\"mtk12\">targetProps</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Properties</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"66\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">targetProps</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;user&quot;</span><span class=\"mtk1\">, targetDbUsername);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"67\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">targetProps</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;password&quot;</span><span class=\"mtk1\">, targetDbPassword);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"68\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">targetProps</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;driver&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;org.postgresql.Driver&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"69\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"70\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">SaveMode</span><span class=\"mtk1\"> </span><span class=\"mtk12\">saveMode</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;overwrite&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk11\">equalsIgnoreCase</span><span class=\"mtk1\">(</span><span class=\"mtk12\">detail</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getUpdateMode</span><span class=\"mtk1\">()) </span><span class=\"mtk15\">?</span><span class=\"mtk1\"> </span><span class=\"mtk12\">SaveMode</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Overwrite</span><span class=\"mtk1\"> </span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">SaveMode</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Append</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"71\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"72\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// 테이블 DDL 관리를 위해, Overwrite 모드일 때 테이블을 미리 준비</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"73\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (saveMode == </span><span class=\"mtk12\">SaveMode</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Overwrite</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"74\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">ClctDataColumnResponseDto</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">columnSchema</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">clctDataColumnService</span><span class=\"mtk1\">.</span><span class=\"mtk11\">findByDataId</span><span class=\"mtk1\">(</span><span class=\"mtk12\">detail</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getDataId</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"75\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk11\">prepareTargetTable</span><span class=\"mtk1\">(</span><span class=\"mtk11\">sanitizeIdentifier</span><span class=\"mtk1\">(</span><span class=\"mtk12\">detail</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getClctDataEngNm</span><span class=\"mtk1\">()), </span><span class=\"mtk8\">&quot;overwrite&quot;</span><span class=\"mtk1\">, columnSchema);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"76\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"77\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"78\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">transformedDf</span><span class=\"mtk1\">.</span><span class=\"mtk11\">write</span><span class=\"mtk1\">().</span><span class=\"mtk11\">mode</span><span class=\"mtk1\">(saveMode).</span><span class=\"mtk11\">jdbc</span><span class=\"mtk1\">(targetDbUrl, targetTableName, targetProps);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"79\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Spark 파일 처리 작업 성공. 데이터가 테이블 &#39;{}&#39;에 저장되었습니다.&quot;</span><span class=\"mtk1\">, targetTableName);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"80\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<ol start=\"5\">\n<li>fairscheduler.xml 설정</li>\n</ol>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"62730826642234260000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"복사 되었습니다!\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`<?xml version=&quot;1.0&quot;?>\r\n<allocations>\r\n    <!--\r\n      'default' 풀은 모든 작업이 기본적으로 할당되는 곳입니다.\r\n      FAIR 스케줄링 모드를 사용하도록 설정합니다.\r\n    -->\r\n    <pool name=&quot;default&quot;>\r\n        <schedulingMode>FAIR</schedulingMode>\r\n        <weight>1</weight>\r\n        <minShare>0</minShare>\r\n    </pool>\r\n\r\n    <!--\r\n      추후에 특정 종류의 작업에 우선순위를 주고 싶다면\r\n      아래와 같이 새로운 풀을 추가할 수 있습니다. (지금은 필요 없음)\r\n\r\n      <pool name=&quot;high-priority-jobs&quot;>\r\n        <schedulingMode>FAIR</schedulingMode>\r\n        <weight>2</weight>\r\n        <minShare>10</minShare>\r\n      </pool>\r\n    -->\r\n</allocations>`, `62730826642234260000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                복사<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"xml\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;?</span><span class=\"mtk4\">xml</span><span class=\"mtk12\"> version</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;1.0&quot;</span><span class=\"mtk17\">?&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">allocations</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">&lt;!--</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">      &#39;default&#39; 풀은 모든 작업이 기본적으로 할당되는 곳입니다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">      FAIR 스케줄링 모드를 사용하도록 설정합니다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">    --&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">pool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">name</span><span class=\"mtk1\">=</span><span class=\"mtk8\">&quot;default&quot;</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">schedulingMode</span><span class=\"mtk17\">&gt;</span><span class=\"mtk1\">FAIR</span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">schedulingMode</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">weight</span><span class=\"mtk17\">&gt;</span><span class=\"mtk1\">1</span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">weight</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">minShare</span><span class=\"mtk17\">&gt;</span><span class=\"mtk1\">0</span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">minShare</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">pool</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">&lt;!--</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">      추후에 특정 종류의 작업에 우선순위를 주고 싶다면</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">      아래와 같이 새로운 풀을 추가할 수 있습니다. (지금은 필요 없음)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"16\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"17\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">      &lt;pool name=&quot;high-priority-jobs&quot;&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"18\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">        &lt;schedulingMode&gt;FAIR&lt;/schedulingMode&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"19\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">        &lt;weight&gt;2&lt;/weight&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"20\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">        &lt;minShare&gt;10&lt;/minShare&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"21\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">      &lt;/pool&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"22\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">    --&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"23\"></span><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">allocations</span><span class=\"mtk17\">&gt;</span></span></span></code></pre>\n<h1 id=\"8-간단한-설정만-했는데-그럼-현재-구조에선-동작을-어떻게-하는거지\" style=\"position:relative;\"><a href=\"#8-%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%84%A4%EC%A0%95%EB%A7%8C-%ED%96%88%EB%8A%94%EB%8D%B0-%EA%B7%B8%EB%9F%BC-%ED%98%84%EC%9E%AC-%EA%B5%AC%EC%A1%B0%EC%97%90%EC%84%A0-%EB%8F%99%EC%9E%91%EC%9D%84-%EC%96%B4%EB%96%BB%EA%B2%8C-%ED%95%98%EB%8A%94%EA%B1%B0%EC%A7%80\" aria-label=\"8 간단한 설정만 했는데 그럼 현재 구조에선 동작을 어떻게 하는거지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8. 간단한 설정만 했는데, 그럼 현재 구조에선 동작을 어떻게 하는거지?</h1>\n<p>처음엔 Spring 애플리케이션이 어떻게 Spark를 실행시키는지 궁금했다. 별도의 Spark 데몬 같은 걸 띄우는 건가? 하고 찾아보니 그게 아니었다.</p>\n<ul>\n<li>\n<p>동작 방식: Spring Boot 애플리케이션에서 SparkSession을 생성하는 순간, Spring Boot 애플리케이션의 JVM 자체가 Spark 드라이버(Driver) 프로그램이 된다. 그리고 master 설정을 local[N]으로 하면, 이 드라이버는 자기 자신(같은 JVM) 내부에 N개의 실행자(Executor) 쓰레드를 생성해서 작업을 병렬로 처리한다. 즉, 외부 시스템 없이 Spring Boot 애플리케이션 하나가 다 하는, 아주 깔끔한 구조다.</p>\n</li>\n<li>\n<p>미래: 나중에 클러스터 확장이 필요하면 Docker나 Kubernetes로 Spark 클러스터를 구축하고, 코드 수정 없이 application.yml의 spark.master.uri 값만 클러스터 주소(예: k8s://…)로 바꿔주면 끝이다. 로직은 그대로, 실행 환경만 바뀌는 것이다.</p>\n</li>\n</ul>\n<h1 id=\"9-결론\" style=\"position:relative;\"><a href=\"#9-%EA%B2%B0%EB%A1%A0\" aria-label=\"9 결론 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>9. 결론</h1>\n<p>스파크의 장점을 요약하자면</p>\n<ul>\n<li>Java 애플리케이션은 Spark에게 “이 작업 좀 해줘”라고 **요청(Orchestration)**만 한다.</li>\n<li>모든 무거운 데이터 처리는 독립된 Spark 엔진이 알아서 한다.</li>\n<li>덕분에 Java 애플리케이션의 메모리는 안전하게 유지되고, 다른 API 요청도 안정적으로 처리할 수 있다.</li>\n</ul>\n<p>스케줄러 작업이 순차적으로 실행되는 환경에서, 앞선 작업 하나가 대용량 파일을 처리하다가 서버 전체를 죽여버린다면 뒤따라올 모든 작업이 그대로 멈추게 된다. Spark를 도입함으로써, 스케줄러는 이제 어떤 크기의 파일이 들어와도 메모리 걱정 없이 안정적으로 작업을 수행할 수 있게 된다는 점을 확인했다.</p>\n<p>하지만, 앞서 말했듯 최종적으로 우리는 Spark를 도입하지 않았다.</p>\n<p>PoC를 통해 Spark의 강력함은 충분히 확인했지만, 플랫폼 정책 상 처리할 데이터 최대 크기가 수십 GB로 확정된 것이 결정적이었다. 이 규모는 굳이 Spark를 쓸 필요가 없는 크기라고 판단했다.</p>\n<ul>\n<li>복잡성: Spark 도입은 단순히 라이브러리 추가가 아니라, 무거운 의존성과 Spark만의 생명주기, 설정을 관리해야 하는 복잡성을 안고 가는 것이다.</li>\n<li>우선순위: 현재로서는 비즈니스 로직을 빠르게 개발하는 것이 새로운 기술 스택을 도입하고 학습하는 것보다 더 중요했다.</li>\n</ul>\n<p>결국 약간의 속도를 포기하고 안정성과 확장성을 얻는 부분은 매우 매력적이었지만, 우리가 다룰 ‘데이터 크기’가 아직 크지 않았다.</p>\n<p>그래서 우리는 Java 애플리케이션이 Spark에게 “이 작업 좀 해줘”라고 요청하는 대신, 지금은 우리가 할 수 있는 가장 단순한 방법으로 문제를 해결하기로 했다. 물론, 데이터가 우리의 예상을 뛰어넘는 날이 온다면, 이 글에 정리해 둔 고민과 코드가 아주 좋은 출발점이 되길…</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .mtk1 { color: #D4D4D4; }\n  .default-dark .mtk3 { color: #6A9955; }\n  .default-dark .mtk8 { color: #CE9178; }\n  .default-dark .mtk11 { color: #DCDCAA; }\n  .default-dark .mtk15 { color: #C586C0; }\n  .default-dark .mtk10 { color: #4EC9B0; }\n  .default-dark .mtk7 { color: #B5CEA8; }\n  .default-dark .mtk4 { color: #569CD6; }\n  .default-dark .mtk12 { color: #9CDCFE; }\n  .default-dark .mtk17 { color: #808080; }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","tableOfContents":"<ul>\n<li><a href=\"#1-%EA%B3%A0%EB%AF%BC%EC%9D%98-%EC%8B%9C%EC%9E%91\">1. 고민의 시작</a></li>\n<li><a href=\"#2-%EA%B7%B8%EB%9E%98%EC%84%9C-%EC%96%B4%EB%96%A4-%EB%B0%A9%EB%B2%95%EC%9D%B4-%EC%9E%88%EB%8A%94%EB%8D%B0\">2. 그래서 어떤 방법이 있는데?</a></li>\n<li><a href=\"#3-spark-%EC%A0%95%EB%A6%AC\">3. Spark 정리</a></li>\n<li><a href=\"#4-spark-%EA%B7%B8%EB%9F%B0%EB%8D%B0-%EC%BB%B4%ED%93%A8%ED%84%B0%EA%B0%80-%ED%95%9C-%EB%8C%80-%EC%9D%B8%EB%8D%B0\">4. Spark, 그런데 컴퓨터가 한 대 인데?</a></li>\n<li><a href=\"#5-%EB%8B%A8%EC%9D%BC-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0%EC%9D%BC-%EA%B2%BD%EC%9A%B0-%EC%A7%84%EC%A7%9C-%EC%9D%B4%EC%A0%90\">5. 단일 클러스터일 경우 진짜 이점</a></li>\n<li><a href=\"#6-%EA%B7%B8%EB%9E%98%EC%84%9C-%EC%96%BC%EB%A7%88%EB%82%98-%EB%B9%A8%EB%9D%BC%EC%A1%8C%EB%82%98-%EC%86%8D%EB%8F%84%EB%B3%B4%EB%8B%A8-%EC%95%88%EC%A0%95%EC%84%B1%EC%84%B1\">6. 그래서 얼마나 빨라졌나? (속도보단 안정성성)</a></li>\n<li><a href=\"#7-%EC%A0%81%EC%9A%A9-%EB%B0%A9%EB%B2%95\">7. 적용 방법</a></li>\n<li><a href=\"#8-%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%84%A4%EC%A0%95%EB%A7%8C-%ED%96%88%EB%8A%94%EB%8D%B0-%EA%B7%B8%EB%9F%BC-%ED%98%84%EC%9E%AC-%EA%B5%AC%EC%A1%B0%EC%97%90%EC%84%A0-%EB%8F%99%EC%9E%91%EC%9D%84-%EC%96%B4%EB%96%BB%EA%B2%8C-%ED%95%98%EB%8A%94%EA%B1%B0%EC%A7%80\">8. 간단한 설정만 했는데, 그럼 현재 구조에선 동작을 어떻게 하는거지?</a></li>\n<li><a href=\"#9-%EA%B2%B0%EB%A1%A0\">9. 결론</a></li>\n</ul>","frontmatter":{"title":"데이터 플랫폼, Apache Spark 도입을 보류한 이유","summary":["이 글은 Spark를 왜 고려했고, 어떤 장점을 확인했으며, 그럼에도 불구하고 왜 도입을 보류했는지에 대한 기술적 의사결정 과정을 기록"],"date":"2025.07.25.","update":"2025.07.25.","category":["Engineering"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADoklEQVR42iWS608TVhjGuy/bDNn2ZZMt6gfH5mYCKmywzLG5OGRLdEJEZCp4AYG4IUQJF2Ey2BQIhSxQCDColHZcCqVyLS2FXoByb2ktQ6FcSlFi4jDL/oHfjuzDm5OTvOd9n/N7HsnsnJMZURMz84QnZvJa6Hf4H4tmT1gEITHJmGwzOJ1uHM4FNn2bbG4+Yd3r48WLbZ7//Ryvz8f6+garq+s823qKZHRsmuXHS6QW1+P39Tl27X2fVz88QtSNIvxDIym/34bOYGHAaGFlZRWPZw2vGLiyts6SuD95uoV3w4dndU0M3EKiN4yi7jESGHeDt8NO8Nb+g7x+IITg2B/ZG3GBjHtVtGgHaOnqwzY5zazDhdO1wMa6d0fxypoXh3txZ8k/29tIOh4MUVLXzp4Tcbyy7yPeEKp2BRxi95fRvBd5XiwbpFXTT7/RisFs26nuQRM+7wbuvx5hm7EzZXfxr0AwaZ9HUt2kIePXWj49l8abh8MJ+uYUwWcSOXD6GnllNeiHzIyYxxmfnGXIYkPbP4x+ZBTz2ARa3bCoEeaF4qk5F/Wt2v8HZpc1cym3koCIWMJjk7iYWUj6PRnyli76dEas4rHn8TJrHg96o5neASPDpjG6xWmbcmAw2aht1jAoOEuU6j5ulyuIvHwLvw+O4Lc/iGPnrxN+KZ1TaXeYnrZjs03S3qvHIBQuLz7CMWuno6tXqB9hVRj6bNOHa97Fw4duJCbBpLJBTWDEWd4JOor/J8cJirpCaEImF3KlLIgmo3WCmOwyrosklMjVXC2q5PuMIhLypVzOLaFRfFXTZ2BWsJTUNqlRtnWTkHWXd784ye7Q40gCDhMckyqajMzbHfxSpSLpTjVpv9WRUlhDdoWCApmKwpo/KW/soE75gOZOHW3CYEm+AN/Y3ElxjYqPo6+x76soAk8nUiD9A7NlHKt1jOQiGQfjMjiTXshnV7I4dDaVsNgUPo9P59ukW1zMKiE+t5yruWVI+oRLZTVKMgp+J6u4jtvSJoqkDWh69DtmLC0sklMh52jKzyhUnYTEZ3MyOYfUnLv88FMeeSVV9OvNDA5bRRpsSPp1Zirq1dwsrKJUpkQqlLZrBnacHLdNC9hO5OoBbpbWU92gJCm/gtJqOXKVGq3IqErdw+jYJA6RQfdLUxpUvcgaNVQJFqUyBYoWLd0CsEEEeUhsfZlDtVZHtbwd4/Ao9Qo1NfdbaRJGWIRZJssEU5NzgrUTt8vNf9gk1yCX6zxKAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/ec158f5b034127907e85efd501832317/67257/thumbnail.png","srcSet":"/static/ec158f5b034127907e85efd501832317/5954d/thumbnail.png 134w,\n/static/ec158f5b034127907e85efd501832317/9f2a2/thumbnail.png 267w,\n/static/ec158f5b034127907e85efd501832317/67257/thumbnail.png 534w","sizes":"(min-width: 534px) 534px, 100vw"},"sources":[{"srcSet":"/static/ec158f5b034127907e85efd501832317/5d20d/thumbnail.webp 134w,\n/static/ec158f5b034127907e85efd501832317/16dcf/thumbnail.webp 267w,\n/static/ec158f5b034127907e85efd501832317/888bd/thumbnail.webp 534w","type":"image/webp","sizes":"(min-width: 534px) 534px, 100vw"}]},"width":534,"height":354}},"publicURL":"/static/ec158f5b034127907e85efd501832317/thumbnail.png"}}}}]}},"pageContext":{"slug":"/spark/","series":[],"lastmod":"2025.07.25.","prev":{"fields":{"slug":"/largeDownload/"},"frontmatter":{"title":"대용량 파일 다운로드 기능을 구현해보자","date":"2025.07.22.","update":"2025.07.22.","category":["Spring"],"tags":["Spring"],"summary":["대용량 파일 다운로드 기능을 구현해보자"]}},"next":{"fields":{"slug":"/SpringCloudGateway/"},"frontmatter":{"title":"Spring Cloud Gateway 도입과 인가로직 적용하기","date":"2025.08.25.","update":"2025.08.25.","category":["Spring"],"tags":["Spring"],"summary":["스프링 클라우드 게이트웨이 개념, 인가 기능 구현방법 정리"]}}}},"staticQueryHashes":["427104293"],"slicesMap":{}}