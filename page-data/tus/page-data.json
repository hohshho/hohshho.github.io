{"componentChunkName":"component---src-templates-post-tsx","path":"/tus/","result":{"data":{"site":{"siteMetadata":{"title":"Just Keep Going","description":"Ian's Archive","siteUrl":"https://hohshho.github.io"}},"allMarkdownRemark":{"edges":[{"node":{"id":"f6b1c8a7-569b-5592-9df9-73fe44417f31","html":"<p>“대용량 파일 업로드, 어떻게 처리하고 계신가요?”</p>\n<p>데이터 플랫폼이나 콘텐츠 관리 시스템을 개발하다 보면 GB 단위의 대용량 파일을 안정적으로 업로드해야 하는 요구사항을 마주한다. 일반적인 HTTP POST 요청은 파일이 크거나 네트워크가 불안정할 경우 연결이 끊기면 처음부터 다시 시작해야 하는 치명적인 단점이 있다.</p>\n<p>이 문제를 해결하기 위해 다음과 같은 요구사항을 정의했다.</p>\n<ul>\n<li>Next.js 프론트엔드에서 파일 업로드 기능 제공</li>\n<li>수백 MB 이상의 대용량 파일도 청크(Chunk) 단위로 분할하여 안정적으로 업로드</li>\n<li>네트워크 문제로 업로드가 중단되더라도, 재시도 시 중단된 지점부터 이어서 업로드 가능</li>\n</ul>\n<p>이 글에서는 위 요구사항을 만족시키기 위해 Uppy 라이브러리와 TUS(The Upload Server) 프로토콜을 선택한 이유와 이를 Spring Boot 백엔드와 연동하여 안정적인 대용량 파일 업로드 시스템을 구축한 과정을 공유한다.</p>\n<h1 id=\"1-왜-uppy를-선택했는가\" style=\"position:relative;\"><a href=\"#1-%EC%99%9C-uppy%EB%A5%BC-%EC%84%A0%ED%83%9D%ED%96%88%EB%8A%94%EA%B0%80\" aria-label=\"1 왜 uppy를 선택했는가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 왜 Uppy를 선택했는가?</h1>\n<p>React/Next.js 환경에서 파일 업로드를 구현하기 위해 여러 라이브러리를 검토했다.</p>\n<ul>\n<li>react-dropzone: 가볍고 UI 자유도가 매우 높지만, 파일 전송 로직은 직접 구현해야 한다.</li>\n<li>FilePond: 세련된 UI와 이미지 편집 등 다양한 플러그인을 제공한다.</li>\n<li>Uppy: 강력한 기능과 플러그인 생태계를 갖춘 올인원 파일 업로더이다.</li>\n</ul>\n<p>고민 끝에 Uppy를 최종 선택했으며, 그 이유는 다음과 같다.</p>\n<ul>\n<li>완성도 높은 대시보드 UI: 파일 드래그 앤 드롭, 파일 목록, 이미지 미리보기, 업로드 진행률 표시, 오류 메시지까지 포함된 대시보드를 기본으로 제공하여 개발 시간을 단축할 수 있다.</li>\n<li>TUS 프로토콜의 손쉬운 적용: 대용량 파일을 위한 청크(Chunking) 업로드와 중단 시 이어 올리기(Resumable Upload) 기능을 Tus 플러그인 하나로 간편하게 적용할 수 있다.</li>\n<li>유연한 모듈식 구조: @uppy/core를 중심으로 필요한 기능(ex: @uppy/drag-drop, @uppy/progress-bar)만 선택적으로 가져와 사용할 수 있어 번들 크기를 최적화할 수 있다.</li>\n</ul>\n<p>물론 단점도 존재한다. 제공되는 UI가 강력한 만큼, 회사의 고유 디자인 시스템에 맞춰 세세한 커스터마이징이 필요할 경우 react-dropzone보다 작업이 복잡할 수 있다는 점이다.</p>\n<p>하지만 react-dropzone은 대용량 파일 처리를 위한 청크 및 이어 올리기 로직을 직접 구현하거나 tus-js-client 같은 별도 라이브러리를 조합해야 하는 부담이 있었다. 개발 효율성과 기능적 안정성을 더 중요하게 고려하여 Uppy를 도입하기로 결정했다.</p>\n<h1 id=\"2-uppy-연동\" style=\"position:relative;\"><a href=\"#2-uppy-%EC%97%B0%EB%8F%99\" aria-label=\"2 uppy 연동 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Uppy 연동</h1>\n<p>useEffect 훅을 사용하여 컴포넌트가 마운트될 때 Uppy 인스턴스를 설정하고, 상태가 변경될 때 옵션을 동적으로 조절하도록 구현했다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"18448912962714157000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`const uppyRef = useRef<Uppy | null>(null);\n\nuseEffect(() => {\n    // 연계 유형이 'file'일 때만 Uppy 로직을 실행\n    if (formData.clctLinkType === 'file') {\n      const isShp = formData.fileExtension === 'shp';\n\n      if (!uppyRef.current) {\n        const uppyInstance = new Uppy({\n          debug: process.env.NODE_ENV === 'development',\n          autoProceed: true,\n          restrictions: {\n            maxNumberOfFiles: 5,\n            allowedFileTypes: [\\`.\\${formData.fileExtension}\\`],\n          },\n        });\n\n        // 파일 추가 시 메타데이터 설정\n        uppyInstance.on('file-added', file => {\n          uppyInstance.setFileMeta(file.id, {\n            filename: file.name,\n            filetype: file.type || 'application/octet-stream',\n          });\n        });\n\n        // Tus 플러그인 설정\n        uppyInstance.use(Tus, {\n          endpoint: \\`\\${process.env.NEXT_PUBLIC_CLCT_URL}/api/tus/upload\\`,\n          // 병렬 업로드 개수 설정\n          parallelUploads: 3,\n          retryDelays: [0, 1000, 3000, 5000],\n          // 청크 크기 설정\n          chunkSize: 100 * 1024 * 1024,\n          // 동시에 처리할 개수\n          limit: 5\n        });\n\n        // Dashboard UI 플러그인 설정\n        uppyInstance.use(DashboardPlugin, {\n          id: DASHBOARD_ID,\n          inline: true,\n          target: \\`#\\${DASHBOARD_TARGET_ID}\\`,\n          proudlyDisplayPoweredByUppy: false,\n          theme: 'light',\n          height: 250,\n        });\n\n        uppyInstance.on('upload-success', (file, response) => {\n          // 파일 객체나 응답, 특히 uploadURL이 없으면 중단\n          if (!file || !response?.uploadURL) {\n            toast.error('업로드 응답이 올바르지 않습니다.');\n            return;\n          }\n          const uploadURL = response.uploadURL;\n\n          console.log('TUS upload successful. Finalizing on server...');\n          console.log('Upload URL:', uploadURL);\n\n          // 서버의 후처리 API(/api/files/finalize)를 호출\n          fetch(\\`\\${process.env.NEXT_PUBLIC_CLCT_URL}/api/files/finalize\\`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n              uploadUrl: uploadURL,\n            }),\n          })\n            .then(res => {\n              if (!res.ok) {\n                return res.text().then(text => {\n                  throw new Error(text || '서버 파일 처리 중 오류 발생');\n                });\n              }\n              // res.json()이 Promise<any>를 반환하므로 타입을 지정\n              return res.json() as Promise<FinalizeResponse>;\n            })\n            .then(data => {\n              console.log('Server finalization response:', data);\n\n              // 스토어에 추가할 때 고유 파일명도 함께 저장\n              addUploadedFile({\n                id: file.id,\n                name: data.originalFilename, // UI 표시용 원본 이름\n                uniqueName: data.uniqueFilename, // 서버 파일 관리를 위한 고유 이름\n                extension: formData.fileExtension,\n                uploadURL: uploadURL,\n              });\n\n              toast.success(\n                \\`'\\${data.originalFilename}' 파일이 성공적으로 처리되었습니다.\\`,\n              );\n            })\n            .catch(error => {\n              console.error('Failed to finalize upload on server:', error);\n              toast.error(\\`파일 후처리 실패: \\${error.message}\\`);\n              // 실패했으므로 Uppy에서 해당 파일을 제거하여 다시 업로드할 수 있도록 유도\n              uppyRef.current?.removeFile(file.id);\n            });\n        });\n\n        uppyRef.current = uppyInstance;\n      }\n\n      uppyRef.current?.setOptions({\n        restrictions: {\n          maxNumberOfFiles: isShp ? 0 : 1, // shp는 여러 파일, 나머지는 1개\n          allowedFileTypes: isShp\n            ? SHAPEFILE_EXTENSIONS\n            : [\\`.\\${formData.fileExtension}\\`],\n        },\n      });\n\n      // Dashboard 노트 텍스트 업데이트 (타입 캐스팅 없이)\n      const dashboard = uppyRef.current?.getPlugin(DASHBOARD_ID);\n      // 'setOptions' 메서드가 있는지 확인하여 안전하게 호출\n      if (dashboard && typeof (dashboard as any).setOptions === 'function') {\n        (dashboard as any).setOptions({\n          note: isShp\n            ? 'Shapefile을 구성하는 모든 파일(.shp, .shx, .dbf 등)을 함께 선택해주세요.'\n            : \\`선택한 확장자(.\\${formData.fileExtension}) 파일 1개만 업로드 가능합니다.\\`,\n        });\n      }\n    }\n\n    // Cleanup 함수\n    return () => {\n      if (uppyRef.current) {\n        uppyRef.current.destroy();\n        uppyRef.current = null;\n      }\n    };\n  }, [\n    formData.clctLinkType,\n    formData.fileExtension,\n    addUploadedFile,\n    removeUploadedFile,\n  ]);\n\n  ...\n\n  <div className={styles.formRow}>\n    <div className={styles.formFullColumn}>\n      <label className={styles.formLabel}>파일 업로드</label>\n      <div id={DASHBOARD_TARGET_ID} />\n    </div>\n  </div>\n`, `18448912962714157000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"typescript\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uppyRef</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">useRef</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Uppy</span><span class=\"mtk1\"> | </span><span class=\"mtk10\">null</span><span class=\"mtk1\">&gt;(</span><span class=\"mtk4\">null</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"><span class=\"mtk11\">useEffect</span><span class=\"mtk1\">(() </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// 연계 유형이 &#39;file&#39;일 때만 Uppy 로직을 실행</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">formData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">clctLinkType</span><span class=\"mtk1\"> === </span><span class=\"mtk8\">&#39;file&#39;</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">isShp</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">formData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">fileExtension</span><span class=\"mtk1\"> === </span><span class=\"mtk8\">&#39;shp&#39;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (!</span><span class=\"mtk12\">uppyRef</span><span class=\"mtk1\">.</span><span class=\"mtk12\">current</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uppyInstance</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Uppy</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">debug:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">process</span><span class=\"mtk1\">.</span><span class=\"mtk12\">env</span><span class=\"mtk1\">.</span><span class=\"mtk12\">NODE_ENV</span><span class=\"mtk1\"> === </span><span class=\"mtk8\">&#39;development&#39;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">autoProceed:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">restrictions:</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">maxNumberOfFiles:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">5</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">allowedFileTypes:</span><span class=\"mtk1\"> [</span><span class=\"mtk8\">`.</span><span class=\"mtk4\">${</span><span class=\"mtk12\">formData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">fileExtension</span><span class=\"mtk4\">}</span><span class=\"mtk8\">`</span><span class=\"mtk1\">],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"16\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"17\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"18\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// 파일 추가 시 메타데이터 설정</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"19\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uppyInstance</span><span class=\"mtk1\">.</span><span class=\"mtk11\">on</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;file-added&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">file</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"20\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">uppyInstance</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setFileMeta</span><span class=\"mtk1\">(</span><span class=\"mtk12\">file</span><span class=\"mtk1\">.</span><span class=\"mtk12\">id</span><span class=\"mtk1\">, {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"21\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">filename:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">file</span><span class=\"mtk1\">.</span><span class=\"mtk12\">name</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"22\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">filetype:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">file</span><span class=\"mtk1\">.</span><span class=\"mtk12\">type</span><span class=\"mtk1\"> || </span><span class=\"mtk8\">&#39;application/octet-stream&#39;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"23\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"24\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"25\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"26\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Tus 플러그인 설정</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"27\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uppyInstance</span><span class=\"mtk1\">.</span><span class=\"mtk11\">use</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Tus</span><span class=\"mtk1\">, {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"28\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">endpoint:</span><span class=\"mtk1\"> </span><span class=\"mtk8\">`</span><span class=\"mtk4\">${</span><span class=\"mtk12\">process</span><span class=\"mtk1\">.</span><span class=\"mtk12\">env</span><span class=\"mtk1\">.</span><span class=\"mtk12\">NEXT_PUBLIC_CLCT_URL</span><span class=\"mtk4\">}</span><span class=\"mtk8\">/api/tus/upload`</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"29\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk3\">// 병렬 업로드 개수 설정</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"30\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">parallelUploads:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">3</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"31\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">retryDelays:</span><span class=\"mtk1\"> [</span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1000</span><span class=\"mtk1\">, </span><span class=\"mtk7\">3000</span><span class=\"mtk1\">, </span><span class=\"mtk7\">5000</span><span class=\"mtk1\">],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"32\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk3\">// 청크 크기 설정</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"33\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">chunkSize:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">100</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">1024</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">1024</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"34\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk3\">// 동시에 처리할 개수</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"35\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">limit:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">5</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"36\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"37\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"38\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Dashboard UI 플러그인 설정</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"39\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uppyInstance</span><span class=\"mtk1\">.</span><span class=\"mtk11\">use</span><span class=\"mtk1\">(</span><span class=\"mtk12\">DashboardPlugin</span><span class=\"mtk1\">, {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"40\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">id:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">DASHBOARD_ID</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"41\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">inline:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"42\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">target:</span><span class=\"mtk1\"> </span><span class=\"mtk8\">`#</span><span class=\"mtk4\">${</span><span class=\"mtk12\">DASHBOARD_TARGET_ID</span><span class=\"mtk4\">}</span><span class=\"mtk8\">`</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"43\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">proudlyDisplayPoweredByUppy:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">false</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"44\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">theme:</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&#39;light&#39;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"45\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">height:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">250</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"46\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"47\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"48\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uppyInstance</span><span class=\"mtk1\">.</span><span class=\"mtk11\">on</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;upload-success&#39;</span><span class=\"mtk1\">, (</span><span class=\"mtk12\">file</span><span class=\"mtk1\">, </span><span class=\"mtk12\">response</span><span class=\"mtk1\">) </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"49\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk3\">// 파일 객체나 응답, 특히 uploadURL이 없으면 중단</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"50\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (!</span><span class=\"mtk12\">file</span><span class=\"mtk1\"> || !</span><span class=\"mtk12\">response</span><span class=\"mtk1\">?.</span><span class=\"mtk12\">uploadURL</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"51\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">toast</span><span class=\"mtk1\">.</span><span class=\"mtk11\">error</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;업로드 응답이 올바르지 않습니다.&#39;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"52\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"53\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"54\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uploadURL</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">response</span><span class=\"mtk1\">.</span><span class=\"mtk12\">uploadURL</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"55\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"56\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;TUS upload successful. Finalizing on server...&#39;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"57\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;Upload URL:&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uploadURL</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"58\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"59\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk3\">// 서버의 후처리 API(/api/files/finalize)를 호출</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"60\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk11\">fetch</span><span class=\"mtk1\">(</span><span class=\"mtk8\">`</span><span class=\"mtk4\">${</span><span class=\"mtk12\">process</span><span class=\"mtk1\">.</span><span class=\"mtk12\">env</span><span class=\"mtk1\">.</span><span class=\"mtk12\">NEXT_PUBLIC_CLCT_URL</span><span class=\"mtk4\">}</span><span class=\"mtk8\">/api/files/finalize`</span><span class=\"mtk1\">, {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"61\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">method:</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&#39;POST&#39;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"62\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">headers:</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"63\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk8\">&#39;Content-Type&#39;</span><span class=\"mtk12\">:</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&#39;application/json&#39;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"64\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"65\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">body:</span><span class=\"mtk1\"> </span><span class=\"mtk10\">JSON</span><span class=\"mtk1\">.</span><span class=\"mtk11\">stringify</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"66\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk12\">uploadUrl:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uploadURL</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"67\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"68\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"69\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            .</span><span class=\"mtk11\">then</span><span class=\"mtk1\">(</span><span class=\"mtk12\">res</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"70\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (!</span><span class=\"mtk12\">res</span><span class=\"mtk1\">.</span><span class=\"mtk12\">ok</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"71\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">res</span><span class=\"mtk1\">.</span><span class=\"mtk11\">text</span><span class=\"mtk1\">().</span><span class=\"mtk11\">then</span><span class=\"mtk1\">(</span><span class=\"mtk12\">text</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"72\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk15\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">(</span><span class=\"mtk12\">text</span><span class=\"mtk1\"> || </span><span class=\"mtk8\">&#39;서버 파일 처리 중 오류 발생&#39;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"73\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"74\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"75\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk3\">// res.json()이 Promise&lt;any&gt;를 반환하므로 타입을 지정</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"76\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">res</span><span class=\"mtk1\">.</span><span class=\"mtk11\">json</span><span class=\"mtk1\">() </span><span class=\"mtk15\">as</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Promise</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">FinalizeResponse</span><span class=\"mtk1\">&gt;;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"77\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"78\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            .</span><span class=\"mtk11\">then</span><span class=\"mtk1\">(</span><span class=\"mtk12\">data</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"79\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;Server finalization response:&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">data</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"80\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"81\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk3\">// 스토어에 추가할 때 고유 파일명도 함께 저장</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"82\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk11\">addUploadedFile</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"83\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">id:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">file</span><span class=\"mtk1\">.</span><span class=\"mtk12\">id</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"84\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">name:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">data</span><span class=\"mtk1\">.</span><span class=\"mtk12\">originalFilename</span><span class=\"mtk1\">, </span><span class=\"mtk3\">// UI 표시용 원본 이름</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"85\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">uniqueName:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">data</span><span class=\"mtk1\">.</span><span class=\"mtk12\">uniqueFilename</span><span class=\"mtk1\">, </span><span class=\"mtk3\">// 서버 파일 관리를 위한 고유 이름</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"86\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">extension:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">formData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">fileExtension</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"87\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">uploadURL:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uploadURL</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"88\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"89\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"90\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk12\">toast</span><span class=\"mtk1\">.</span><span class=\"mtk11\">success</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"91\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk8\">`&#39;</span><span class=\"mtk4\">${</span><span class=\"mtk12\">data</span><span class=\"mtk1\">.</span><span class=\"mtk12\">originalFilename</span><span class=\"mtk4\">}</span><span class=\"mtk8\">&#39; 파일이 성공적으로 처리되었습니다.`</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"92\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"93\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"94\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            .</span><span class=\"mtk11\">catch</span><span class=\"mtk1\">(</span><span class=\"mtk12\">error</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"95\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">error</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;Failed to finalize upload on server:&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">error</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"96\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk12\">toast</span><span class=\"mtk1\">.</span><span class=\"mtk11\">error</span><span class=\"mtk1\">(</span><span class=\"mtk8\">`파일 후처리 실패: </span><span class=\"mtk4\">${</span><span class=\"mtk12\">error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">message</span><span class=\"mtk4\">}</span><span class=\"mtk8\">`</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"97\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk3\">// 실패했으므로 Uppy에서 해당 파일을 제거하여 다시 업로드할 수 있도록 유도</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"98\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk12\">uppyRef</span><span class=\"mtk1\">.</span><span class=\"mtk12\">current</span><span class=\"mtk1\">?.</span><span class=\"mtk11\">removeFile</span><span class=\"mtk1\">(</span><span class=\"mtk12\">file</span><span class=\"mtk1\">.</span><span class=\"mtk12\">id</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"99\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"100\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"101\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"102\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uppyRef</span><span class=\"mtk1\">.</span><span class=\"mtk12\">current</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">uppyInstance</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"103\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"104\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"105\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">uppyRef</span><span class=\"mtk1\">.</span><span class=\"mtk12\">current</span><span class=\"mtk1\">?.</span><span class=\"mtk11\">setOptions</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"106\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">restrictions:</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"107\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">maxNumberOfFiles:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">isShp</span><span class=\"mtk1\"> ? </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">1</span><span class=\"mtk1\">, </span><span class=\"mtk3\">// shp는 여러 파일, 나머지는 1개</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"108\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">allowedFileTypes:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">isShp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"109\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            ? </span><span class=\"mtk12\">SHAPEFILE_EXTENSIONS</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"110\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            : [</span><span class=\"mtk8\">`.</span><span class=\"mtk4\">${</span><span class=\"mtk12\">formData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">fileExtension</span><span class=\"mtk4\">}</span><span class=\"mtk8\">`</span><span class=\"mtk1\">],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"111\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"112\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"113\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"114\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\">// Dashboard 노트 텍스트 업데이트 (타입 캐스팅 없이)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"115\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">dashboard</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">uppyRef</span><span class=\"mtk1\">.</span><span class=\"mtk12\">current</span><span class=\"mtk1\">?.</span><span class=\"mtk11\">getPlugin</span><span class=\"mtk1\">(</span><span class=\"mtk12\">DASHBOARD_ID</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"116\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\">// &#39;setOptions&#39; 메서드가 있는지 확인하여 안전하게 호출</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"117\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">dashboard</span><span class=\"mtk1\"> &amp;&amp; </span><span class=\"mtk4\">typeof</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">dashboard</span><span class=\"mtk1\"> </span><span class=\"mtk15\">as</span><span class=\"mtk1\"> </span><span class=\"mtk10\">any</span><span class=\"mtk1\">).</span><span class=\"mtk12\">setOptions</span><span class=\"mtk1\"> === </span><span class=\"mtk8\">&#39;function&#39;</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"118\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        (</span><span class=\"mtk12\">dashboard</span><span class=\"mtk1\"> </span><span class=\"mtk15\">as</span><span class=\"mtk1\"> </span><span class=\"mtk10\">any</span><span class=\"mtk1\">).</span><span class=\"mtk11\">setOptions</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"119\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">note:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">isShp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"120\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            ? </span><span class=\"mtk8\">&#39;Shapefile을 구성하는 모든 파일(.shp, .shx, .dbf 등)을 함께 선택해주세요.&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"121\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            : </span><span class=\"mtk8\">`선택한 확장자(.</span><span class=\"mtk4\">${</span><span class=\"mtk12\">formData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">fileExtension</span><span class=\"mtk4\">}</span><span class=\"mtk8\">) 파일 1개만 업로드 가능합니다.`</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"122\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"123\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"124\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"125\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"126\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Cleanup 함수</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"127\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"128\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uppyRef</span><span class=\"mtk1\">.</span><span class=\"mtk12\">current</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"129\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uppyRef</span><span class=\"mtk1\">.</span><span class=\"mtk12\">current</span><span class=\"mtk1\">.</span><span class=\"mtk11\">destroy</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"130\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uppyRef</span><span class=\"mtk1\">.</span><span class=\"mtk12\">current</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">null</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"131\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"132\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    };</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"133\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  }, [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"134\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">formData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">clctLinkType</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"135\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">formData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">fileExtension</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"136\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">addUploadedFile</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"137\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">removeUploadedFile</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"138\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  ]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"139\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"140\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"141\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"142\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk12\">div</span><span class=\"mtk1\"> </span><span class=\"mtk12\">className</span><span class=\"mtk1\">={styles.</span><span class=\"mtk12\">formRow</span><span class=\"mtk1\">}&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"143\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk12\">div</span><span class=\"mtk1\"> </span><span class=\"mtk12\">className</span><span class=\"mtk1\">={styles.</span><span class=\"mtk12\">formFullColumn</span><span class=\"mtk1\">}&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"144\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk12\">label</span><span class=\"mtk1\"> </span><span class=\"mtk12\">className</span><span class=\"mtk1\">={styles.</span><span class=\"mtk12\">formLabel</span><span class=\"mtk1\">}&gt;</span><span class=\"mtk12\">파일</span><span class=\"mtk1\"> </span><span class=\"mtk12\">업로드</span><span class=\"mtk1\">&lt;/</span><span class=\"mtk12\">label</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"145\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk12\">div</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">={</span><span class=\"mtk12\">DASHBOARD_TARGET_ID</span><span class=\"mtk1\">} /&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"146\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;/</span><span class=\"mtk12\">div</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"147\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;/</span><span class=\"mtk12\">div</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"148\"></span><span class=\"grvsc-source\"></span></span></code></pre>\n<p>위 코드에서 div 태그에 id를 부여하고, Uppy의 DashboardPlugin의 target 옵션에 해당 id를 연결하면 지정된 위치에 업로드 UI가 렌더링된다.</p>\n<h1 id=\"3-tus란\" style=\"position:relative;\"><a href=\"#3-tus%EB%9E%80\" aria-label=\"3 tus란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. tus란?</h1>\n<p>이어 올리기를 위한 개방형 프로토콜이다. HTTP기반으로 동작하며, 클라이언트와 서버가 파일 업로드 상태를 계속 추적하여 네트워크가 끊기거나 브라우저가 닫혀도 이전에 업로드 된 지점부터 다시 시작할 수 있게 해준다.</p>\n<p>주요 특징:</p>\n<ul>\n<li>이어 올리기: TUS의 핵심 기능으로, 업로드 중단 시 손실을 최소화한다.</li>\n<li>표준 프로토콜: HTTP 헤더 설정, 파일 병합, 임시 파일 관리 등 업로드 절차가 명확히 정의되어 있다.</li>\n<li>다양한 서버/클라이언트 구현체: Java, Go, Node.js, Python 등 다양한 언어로 구현된 서버가 있으며, tus-js-client(Uppy가 내부적으로 사용) 등 클라이언트 라이브러리도 풍부하다.</li>\n<li>확장 기능: 병렬 업로드, MD5 체크섬 비교, 업로드 만료 시간 설정 등 다양한 부가 기능을 지원한다.</li>\n</ul>\n<h1 id=\"4-tus의-작동-방식\" style=\"position:relative;\"><a href=\"#4-tus%EC%9D%98-%EC%9E%91%EB%8F%99-%EB%B0%A9%EC%8B%9D\" aria-label=\"4 tus의 작동 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. TUS의 작동 방식</h1>\n<p>TUS는 주로 HEAD, POST, PATCH HTTP 메서드를 사용하여 업로드를 관리한다.</p>\n<ol>\n<li>\n<p>(선택적) HEAD 요청: 클라이언트는 파일 업로드를 시작하기 전에 서버에 HEAD 요청을 보내 이미 해당 파일의 일부가 업로드되어 있는지 확인하고, 있다면 어느 지점(Upload-Offset)까지 업로드되었는지 파악한다. (처음 시작 시 404에러)</p>\n</li>\n<li>\n<p>POST 요청: 새로운 파일을 업로드하거나 HEAD 요청 결과 파일 정보가 없다면, 클라이언트는 POST 요청을 보낸다. 이때 Upload-Length 헤더에 전체 파일 크기를 담아 보낸다. 서버는 이 요청을 받고 파일을 저장할 고유한 URL을 생성하여 Location 헤더에 담아 응답한다.</p>\n</li>\n<li>\n<p>PATCH 요청: 클라이언트는 파일 데이터를 청크 단위로 나누어 PATCH 요청을 통해 서버에 전송한다. 각 요청에는 현재 데이터의 시작 위치를 나타내는 Upload-Offset 헤더와 데이터 타입을 명시하는 Content-Type: application/offset+octet-stream 헤더가 포함된다. 서버는 받은 청크를 임시 파일에 이어 붙이고, 현재까지 받은 총 바이트 수를 Upload-Offset 헤더에 담아 응답한다.</p>\n</li>\n<li>\n<p>업로드 완료: 클라이언트가 보낸 Upload-Offset과 서버가 알고 있는 전체 파일 크기(Upload-Length)가 일치하면 업로드가 완료된다.</p>\n</li>\n</ol>\n<p>업로드 상태(URL, 오프셋 등)는 브라우저의 로컬 스토리지에 저장하여 페이지를 새로고침해도 상태를 유지한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 439px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2de4558422d4f34ebd4dca93570635f0/54b61/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 107.36196319018406%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADXUlEQVR42m1V2ZKiQBDkU2a8QEFp7htBDhW8ZnT+/1NyI8txZ2NiHyoKsTs7K7Oq0ZqmwfV6xfF4RJZl0HUdy+VSgs/b7VbC9320bSvr4jhBHMeIo0hykiR/Q+OmNE1RVRX2+z12ux1WqxUMw8BsNsPX15dssm0bjuvAcRwoW0EpB77vQSklh3MPQwDruhZAgpFN13UCMJ1Ocb/fEcURym2Jum5kLatqmhZd2wirxUIXAgxtPp8jz3MBOp/PkheLhZxGhvfHQyrgYr57sVkuf55N05QQhiyBG8iIQAwewj+ZyZAs0iyFaS7/Mvk3uJbVkb0WhqGYwpIJ6nme6ESw9/d3AeTiha7DoFkrE6Zl/SfWsNbrJ0NqdrlcxMFhGHA6neSAKIrElMPhANd1EYk5SqSYf1fyOzS2Q9/3wpKZoNSR9CkFAU+nM9qmw/l8gev5mEymmM3nmM7mP/k7tPV6LQxYFlkRiDKQEU/8/PzE8Tggy3L5jy0UhCHSLJN3IXsxSRAEoWSNTpEZyyYwn8uylKBzBDxfLijKEm3Xoe/3smYYR+xJpGm+c4umbaHRoVcfFkUh7KgRDXl7exNT+v0eQRBIe+V5gbLcIpPnXNZvq0qmh5OmkQUXkxFNoNPUlaVxCgh4vz/Qdb2YNY4n0fTj4xPHYcBxGKXJ63qH2+0DGvuOp5AhZ/VlDDN1JCCN6fcHKZ1gBL3ebjidzxhPJymZUgggR49ALJs6EpijRXYs+fF4SJmWZWGz2ch7tprn+fKb72VSODEr86nhczYbjOMoLUPH6b6M3v0u7eP7AZJ8i6zcoWr22O5aqCCEpVwsNzasIMZKuU8NCfZqGwaZ8nReDmQYhSHMjYO4usJNWvhRjiTLkRQlyqaDy+usbqHC+KdkBtkx063X9SWAUYTFfA7lpYjrG/yogFtW8Ose/q6HnZbYOC6Wuv40hRtozCuT3W/A2XQK20vhpy3sKIeVlbDrAzZli5Wt5DI2jCU09hINYWarkB0P+Q04nbzDS3bPqEe4eYNNUcOKM+iGIRXILHNSqN9LR4K/RmwymQggn3XdEDA3rqDyBm51gJ3VclkoxdvclZtKNOQGNjY/AdSQbDmGbAm6zG+HuVbwkgZBuEOcDsiKD3heAcdRMggcDlbyB5yvuLHyjmfIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/2de4558422d4f34ebd4dca93570635f0/a81b5/1.webp 163w,\n/static/2de4558422d4f34ebd4dca93570635f0/da3ef/1.webp 325w,\n/static/2de4558422d4f34ebd4dca93570635f0/5aee8/1.webp 439w\"\n              sizes=\"(max-width: 439px) 100vw, 439px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/2de4558422d4f34ebd4dca93570635f0/5e043/1.png 163w,\n/static/2de4558422d4f34ebd4dca93570635f0/e5cc6/1.png 325w,\n/static/2de4558422d4f34ebd4dca93570635f0/54b61/1.png 439w\"\n            sizes=\"(max-width: 439px) 100vw, 439px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/2de4558422d4f34ebd4dca93570635f0/54b61/1.png\"\n            alt=\"1\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h1 id=\"5-spring-boot-백엔드-구현\" style=\"position:relative;\"><a href=\"#5-spring-boot-%EB%B0%B1%EC%97%94%EB%93%9C-%EA%B5%AC%ED%98%84\" aria-label=\"5 spring boot 백엔드 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. Spring Boot 백엔드 구현</h1>\n<p>이제 Uppy 클라이언트와 통신할 Spring Boot 서버를 구성한다. tus-java-server 라이브러리를 활용하면 TUS 프로토콜을 손쉽게 구현할 수 있다.</p>\n<ol>\n<li>의존성 추가</li>\n</ol>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"15958931222157146000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`implementation 'me.desair.tus:tus-java-server:1.0.0-3.0'`, `15958931222157146000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"groovy\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">implementation </span><span class=\"mtk8\">&#39;me.desair.tus:tus-java-server:1.0.0-3.0&#39;</span></span></span></code></pre>\n<ol start=\"2\">\n<li>Tus Service 설정(Configuration)</li>\n</ol>\n<p>TUS 서버의 핵심 설정을 구성한다. 임시 파일 저장 경로, 업로드 URL, 임시 파일 만료 시간 등을 정의한다.</p>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"8426476383845105000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@Configuration\npublic class TusConfig {\n\n    private static final Logger log = LoggerFactory.getLogger(TusConfig.class);\n\n    @Value(&quot;\\${tus.server.data-path}&quot;)\n    private String tusDataPath;\n\n    @Value(&quot;\\${server.servlet.context-path}&quot;)\n    private String contextPath;\n\n    @Bean\n    public TusFileUploadService tusFileUploadService() throws IOException {\n        Path storagePath = Paths.get(tusDataPath);\n        if (Files.notExists(storagePath)) {\n            Files.createDirectories(storagePath);\n            log.info(&quot;Tus storage directory created at: {}&quot;, storagePath);\n        }\n\n        final String uploadUri = contextPath + &quot;/api/tus/upload&quot;;\n        log.info(&quot;Tus Upload URI configured to: {}&quot;, uploadUri);\n        log.info(&quot;Tus temporary data path: {}&quot;, tusDataPath);\n\n        return new TusFileUploadService()\n                .withStoragePath(tusDataPath)\n                .withUploadUri(uploadUri)\n                .withUploadExpirationPeriod(24 * 60 * 60 * 1000L);\n    }\n}`, `8426476383845105000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Configuration</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">TusConfig</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Logger</span><span class=\"mtk1\"> </span><span class=\"mtk12\">log</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">LoggerFactory</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getLogger</span><span class=\"mtk1\">(</span><span class=\"mtk12\">TusConfig</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Value</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;${tus.server.data-path}&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tusDataPath</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Value</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;${server.servlet.context-path}&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">contextPath</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Bean</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">TusFileUploadService</span><span class=\"mtk1\"> </span><span class=\"mtk11\">tusFileUploadService</span><span class=\"mtk1\">() </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">IOException</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">Path</span><span class=\"mtk1\"> </span><span class=\"mtk12\">storagePath</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Paths</span><span class=\"mtk1\">.</span><span class=\"mtk11\">get</span><span class=\"mtk1\">(tusDataPath);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">Files</span><span class=\"mtk1\">.</span><span class=\"mtk11\">notExists</span><span class=\"mtk1\">(storagePath)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"16\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">Files</span><span class=\"mtk1\">.</span><span class=\"mtk11\">createDirectories</span><span class=\"mtk1\">(storagePath);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"17\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Tus storage directory created at: {}&quot;</span><span class=\"mtk1\">, storagePath);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"18\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"19\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"20\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uploadUri</span><span class=\"mtk1\"> = contextPath + </span><span class=\"mtk8\">&quot;/api/tus/upload&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"21\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Tus Upload URI configured to: {}&quot;</span><span class=\"mtk1\">, uploadUri);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"22\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Tus temporary data path: {}&quot;</span><span class=\"mtk1\">, tusDataPath);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"23\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"24\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">TusFileUploadService</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"25\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">withStoragePath</span><span class=\"mtk1\">(tusDataPath)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"26\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">withUploadUri</span><span class=\"mtk1\">(uploadUri)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"27\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk11\">withUploadExpirationPeriod</span><span class=\"mtk1\">(</span><span class=\"mtk7\">24</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">60</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">60</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">1000L</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"28\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"29\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<ol start=\"3\">\n<li>controller 구현</li>\n</ol>\n<p>TUS 프로토콜 처리는 두 단계로 나뉜다.</p>\n<ul>\n<li>TusUploadController: TUS 프로토콜의 모든 HTTP 요청(POST, PATCH, HEAD 등)을 받아 TusFileUploadService에 위임한다. 이 컨트롤러는 순수하게 프로토콜 처리만 담당한다.</li>\n<li>FileProcessingController: TUS 업로드가 100% 완료된 후, 클라이언트가 호출하는 별도의 API이다. 임시 파일을 영구 저장소로 옮기고, 파일 정보를 DB에 저장하는 등 비즈니스 로직을 수행한다.</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container copyButtonContainer\"\n              data-toaster-id=\"31388430906029896000\"\n              data-toaster-class=\"gatsby-code-button-toaster copyButtonToaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text copyButtonToasterText\"\n              data-toaster-text=\"customToasterText\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@RestController\n@RequestMapping(&quot;/api/files&quot;)\n@CrossOrigin\npublic class FileProcessingController {\n\n    private static final Logger log = LoggerFactory.getLogger(FileProcessingController.class);\n\n    private final TusFileUploadService tusFileUploadService;\n    private final Path permanentStoragePath;\n\n    public FileProcessingController(TusFileUploadService tusFileUploadService,\n                                    @Value(&quot;\\${file.permanent-storage-path}&quot;) String permanentStoragePathStr) throws IOException {\n        this.tusFileUploadService = tusFileUploadService;\n        this.permanentStoragePath = Paths.get(permanentStoragePathStr);\n        // 영구 저장소 디렉토리가 없으면 생성\n        if (Files.notExists(this.permanentStoragePath)) {\n            Files.createDirectories(this.permanentStoragePath);\n            log.info(&quot;Permanent storage directory created at: {}&quot;, this.permanentStoragePath);\n        }\n    }\n\n    /**\n     * TUS 업로드가 완료된 후 클라이언트가 호출하는 후처리 API\n     * @param payload 클라이언트가 보낸 JSON. {&quot;uploadUrl&quot;: &quot;...&quot;} 형태여야 함\n     * @return 처리 결과\n     */\n    @PostMapping(&quot;/finalize&quot;)\n    public ResponseEntity<Map<String, String>> finalizeUpload(@RequestBody Map<String, String> payload) {\n        String uploadUrl = payload.get(&quot;uploadUrl&quot;);\n        if (uploadUrl == null || uploadUrl.isBlank()) {\n            return ResponseEntity.badRequest().body(null);\n        }\n\n        try {\n            UploadInfo uploadInfo = tusFileUploadService.getUploadInfo(uploadUrl);\n            if (uploadInfo == null || uploadInfo.isUploadInProgress()) {\n                return ResponseEntity.badRequest().body(null);\n            }\n\n            // 원본 파일명과 확장자 추출\n            String originalFilename = uploadInfo.getMetadata().getOrDefault(&quot;filename&quot;, &quot;untitled&quot;);\n            String extension = &quot;&quot;;\n            int lastDot = originalFilename.lastIndexOf('.');\n            if (lastDot > 0) {\n                extension = originalFilename.substring(lastDot); // .csv, .txt 등\n            }\n\n            // UUID를 기반으로 새로운 고유 파일명 생성\n            String uniqueFilename = UUID.randomUUID().toString() + extension;\n            Path destinationFile = permanentStoragePath.resolve(uniqueFilename);\n\n            log.info(&quot;Finalizing upload. Original: {}, Unique: {}, Destination: {}&quot;, originalFilename, uniqueFilename, destinationFile);\n\n            // 고유 파일명으로 파일 저장\n            try (InputStream uploadedBytes = tusFileUploadService.getUploadedBytes(uploadUrl)) {\n                Files.copy(uploadedBytes, destinationFile, StandardCopyOption.REPLACE_EXISTING);\n            }\n\n            // 임시 파일 삭제\n            tusFileUploadService.deleteUpload(uploadUrl);\n\n            // 클라이언트에 원본 파일명과 고유 파일명을 모두 담아 JSON으로 반환\n            Map<String, String> responseBody = new HashMap<>();\n            responseBody.put(&quot;originalFilename&quot;, originalFilename);\n            responseBody.put(&quot;uniqueFilename&quot;, uniqueFilename);\n\n            return ResponseEntity.ok(responseBody);\n\n        } catch (IOException | TusException e) {\n            log.error(&quot;Failed to finalize upload for URL: {}&quot;, uploadUrl, e);\n            return ResponseEntity.internalServerError().body(null);\n        }\n    }\n\n\n    /**\n     * 영구 저장소에 있는 파일을 삭제하는 API\n     * @param uniqueFilename URL 경로를 통해 전달된, 고유 파일명\n     * @return 삭제 처리 결과\n     */\n    @DeleteMapping(&quot;/{uniqueFilename}&quot;)\n    public ResponseEntity<String> deleteFile(@PathVariable String uniqueFilename) {\n        String decodedFilename;\n        try {\n            decodedFilename = URLDecoder.decode(uniqueFilename, StandardCharsets.UTF_8);\n        } catch (IllegalArgumentException e) {\n            log.warn(&quot;Failed to decode filename: {}&quot;, uniqueFilename, e);\n            decodedFilename = uniqueFilename;\n        }\n\n        log.info(&quot;Received request to delete file: {}&quot;, decodedFilename);\n\n        if (decodedFilename == null || decodedFilename.isBlank()) {\n            return ResponseEntity.badRequest().body(&quot;Filename is missing.&quot;);\n        }\n\n        try {\n            Path fileToDelete = permanentStoragePath.resolve(decodedFilename);\n\n            // Path Traversal 공격을 방지하기 위한 기본적인 검증\n            if (!fileToDelete.normalize().startsWith(permanentStoragePath.normalize())) {\n                log.error(&quot;Path traversal attempt detected! Filename: {}&quot;, decodedFilename);\n                return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(&quot;Invalid filename.&quot;);\n            }\n\n            // Files.deleteIfExists()는 파일이 없어도 예외를 던지지 않고 false를 반환\n            boolean deleted = Files.deleteIfExists(fileToDelete);\n\n            if (deleted) {\n                log.info(&quot;Successfully deleted file from permanent storage: {}&quot;, fileToDelete);\n                return ResponseEntity.ok(&quot;File deleted successfully: &quot; + decodedFilename);\n            } else {\n                log.warn(&quot;File to delete was not found in permanent storage: {}&quot;, fileToDelete);\n                return ResponseEntity.ok(&quot;File was not found, but considered deleted: &quot; + decodedFilename);\n            }\n\n        } catch (IOException e) {\n            log.error(&quot;Error deleting file: {}&quot;, decodedFilename, e);\n            return ResponseEntity.internalServerError().body(&quot;Error occurred while deleting the file.&quot;);\n        }\n    }\n}\n\n@Controller\n@CrossOrigin\n@RequestMapping(&quot;/api/tus&quot;)\npublic class TusUploadController {\n\n    private static final Logger log = LoggerFactory.getLogger(TusUploadController.class);\n    private final TusFileUploadService tusFileUploadService;\n\n    @Autowired\n    public TusUploadController(TusFileUploadService tusFileUploadService) {\n        this.tusFileUploadService = tusFileUploadService;\n    }\n\n    @RequestMapping(value = {&quot;/upload&quot;, &quot;/upload/**&quot;}, method = {\n            RequestMethod.POST, RequestMethod.PATCH, RequestMethod.HEAD, RequestMethod.DELETE, RequestMethod.OPTIONS\n    })\n    public void processTusUpload(HttpServletRequest servletRequest, HttpServletResponse servletResponse) {\n        try {\n            this.tusFileUploadService.process(servletRequest, servletResponse);\n        } catch (IOException e) {\n            log.error(&quot;Tus exception occurred: {}&quot;, e.getMessage());\n        }\n    }\n}`, `31388430906029896000`)\"\n            >\n              <div\n                class=\"gatsby-code-button copyButtonClass\"\n                data-tooltip=\"\"\n              >\n                copyButtonText<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">RestController</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">RequestMapping</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/api/files&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">CrossOrigin</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">FileProcessingController</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Logger</span><span class=\"mtk1\"> </span><span class=\"mtk12\">log</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">LoggerFactory</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getLogger</span><span class=\"mtk1\">(</span><span class=\"mtk12\">FileProcessingController</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">TusFileUploadService</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tusFileUploadService</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Path</span><span class=\"mtk1\"> </span><span class=\"mtk12\">permanentStoragePath</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">FileProcessingController</span><span class=\"mtk1\">(</span><span class=\"mtk10\">TusFileUploadService</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tusFileUploadService</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                                    @</span><span class=\"mtk10\">Value</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;${file.permanent-storage-path}&quot;</span><span class=\"mtk1\">) </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">permanentStoragePathStr</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">IOException</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">tusFileUploadService</span><span class=\"mtk1\"> = tusFileUploadService;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">permanentStoragePath</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Paths</span><span class=\"mtk1\">.</span><span class=\"mtk11\">get</span><span class=\"mtk1\">(permanentStoragePathStr);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// 영구 저장소 디렉토리가 없으면 생성</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"16\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">Files</span><span class=\"mtk1\">.</span><span class=\"mtk11\">notExists</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">permanentStoragePath</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"17\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">Files</span><span class=\"mtk1\">.</span><span class=\"mtk11\">createDirectories</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">permanentStoragePath</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"18\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Permanent storage directory created at: {}&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">permanentStoragePath</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"19\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"20\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"21\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"22\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">    /**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"23\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">     * TUS 업로드가 완료된 후 클라이언트가 호출하는 후처리 API</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"24\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">     * </span><span class=\"mtk4\">@param</span><span class=\"mtk3\"> </span><span class=\"mtk12\">payload</span><span class=\"mtk3\"> 클라이언트가 보낸 JSON. {&quot;uploadUrl&quot;: &quot;...&quot;} 형태여야 함</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"25\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">     * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> 처리 결과</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"26\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">     */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"27\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">PostMapping</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/finalize&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"28\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ResponseEntity</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\">&gt;&gt; </span><span class=\"mtk11\">finalizeUpload</span><span class=\"mtk1\">(@</span><span class=\"mtk10\">RequestBody</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">payload</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"29\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uploadUrl</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">payload</span><span class=\"mtk1\">.</span><span class=\"mtk11\">get</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;uploadUrl&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"30\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (uploadUrl == </span><span class=\"mtk4\">null</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">uploadUrl</span><span class=\"mtk1\">.</span><span class=\"mtk11\">isBlank</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"31\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ResponseEntity</span><span class=\"mtk1\">.</span><span class=\"mtk11\">badRequest</span><span class=\"mtk1\">().</span><span class=\"mtk11\">body</span><span class=\"mtk1\">(</span><span class=\"mtk4\">null</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"32\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"33\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"34\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"35\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">UploadInfo</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uploadInfo</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">tusFileUploadService</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getUploadInfo</span><span class=\"mtk1\">(uploadUrl);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"36\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (uploadInfo == </span><span class=\"mtk4\">null</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">uploadInfo</span><span class=\"mtk1\">.</span><span class=\"mtk11\">isUploadInProgress</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"37\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ResponseEntity</span><span class=\"mtk1\">.</span><span class=\"mtk11\">badRequest</span><span class=\"mtk1\">().</span><span class=\"mtk11\">body</span><span class=\"mtk1\">(</span><span class=\"mtk4\">null</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"38\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"39\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"40\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// 원본 파일명과 확장자 추출</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"41\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">originalFilename</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">uploadInfo</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMetadata</span><span class=\"mtk1\">().</span><span class=\"mtk11\">getOrDefault</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;filename&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;untitled&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"42\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">extension</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"43\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">int</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lastDot</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">originalFilename</span><span class=\"mtk1\">.</span><span class=\"mtk11\">lastIndexOf</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;.&#39;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"44\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (lastDot &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"45\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                extension = </span><span class=\"mtk12\">originalFilename</span><span class=\"mtk1\">.</span><span class=\"mtk11\">substring</span><span class=\"mtk1\">(lastDot); </span><span class=\"mtk3\">// .csv, .txt 등</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"46\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"47\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"48\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// UUID를 기반으로 새로운 고유 파일명 생성</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"49\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uniqueFilename</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">UUID</span><span class=\"mtk1\">.</span><span class=\"mtk11\">randomUUID</span><span class=\"mtk1\">().</span><span class=\"mtk11\">toString</span><span class=\"mtk1\">() + extension;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"50\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">Path</span><span class=\"mtk1\"> </span><span class=\"mtk12\">destinationFile</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">permanentStoragePath</span><span class=\"mtk1\">.</span><span class=\"mtk11\">resolve</span><span class=\"mtk1\">(uniqueFilename);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"51\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"52\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Finalizing upload. Original: {}, Unique: {}, Destination: {}&quot;</span><span class=\"mtk1\">, originalFilename, uniqueFilename, destinationFile);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"53\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"54\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// 고유 파일명으로 파일 저장</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"55\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">InputStream</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uploadedBytes</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">tusFileUploadService</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getUploadedBytes</span><span class=\"mtk1\">(uploadUrl)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"56\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">Files</span><span class=\"mtk1\">.</span><span class=\"mtk11\">copy</span><span class=\"mtk1\">(uploadedBytes, destinationFile, </span><span class=\"mtk12\">StandardCopyOption</span><span class=\"mtk1\">.</span><span class=\"mtk12\">REPLACE_EXISTING</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"57\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"58\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"59\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// 임시 파일 삭제</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"60\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">tusFileUploadService</span><span class=\"mtk1\">.</span><span class=\"mtk11\">deleteUpload</span><span class=\"mtk1\">(uploadUrl);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"61\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"62\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// 클라이언트에 원본 파일명과 고유 파일명을 모두 담아 JSON으로 반환</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"63\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">Map</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">String</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">responseBody</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">HashMap</span><span class=\"mtk1\">&lt;&gt;();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"64\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">responseBody</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;originalFilename&quot;</span><span class=\"mtk1\">, originalFilename);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"65\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">responseBody</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;uniqueFilename&quot;</span><span class=\"mtk1\">, uniqueFilename);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"66\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"67\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ResponseEntity</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ok</span><span class=\"mtk1\">(responseBody);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"68\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"69\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">IOException</span><span class=\"mtk1\"> | </span><span class=\"mtk10\">TusException</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"70\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">error</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Failed to finalize upload for URL: {}&quot;</span><span class=\"mtk1\">, uploadUrl, e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"71\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ResponseEntity</span><span class=\"mtk1\">.</span><span class=\"mtk11\">internalServerError</span><span class=\"mtk1\">().</span><span class=\"mtk11\">body</span><span class=\"mtk1\">(</span><span class=\"mtk4\">null</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"72\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"73\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"74\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"75\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"76\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">    /**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"77\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">     * 영구 저장소에 있는 파일을 삭제하는 API</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"78\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">     * </span><span class=\"mtk4\">@param</span><span class=\"mtk3\"> </span><span class=\"mtk12\">uniqueFilename</span><span class=\"mtk3\"> URL 경로를 통해 전달된, 고유 파일명</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"79\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">     * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> 삭제 처리 결과</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"80\"></span><span class=\"grvsc-source\"><span class=\"mtk3\">     */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"81\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">DeleteMapping</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/{uniqueFilename}&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"82\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ResponseEntity</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">&gt; </span><span class=\"mtk11\">deleteFile</span><span class=\"mtk1\">(@</span><span class=\"mtk10\">PathVariable</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uniqueFilename</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"83\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">decodedFilename</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"84\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"85\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            decodedFilename = </span><span class=\"mtk12\">URLDecoder</span><span class=\"mtk1\">.</span><span class=\"mtk11\">decode</span><span class=\"mtk1\">(uniqueFilename, </span><span class=\"mtk12\">StandardCharsets</span><span class=\"mtk1\">.</span><span class=\"mtk12\">UTF_8</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"86\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">IllegalArgumentException</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"87\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warn</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Failed to decode filename: {}&quot;</span><span class=\"mtk1\">, uniqueFilename, e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"88\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            decodedFilename = uniqueFilename;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"89\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"90\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"91\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Received request to delete file: {}&quot;</span><span class=\"mtk1\">, decodedFilename);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"92\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"93\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (decodedFilename == </span><span class=\"mtk4\">null</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">decodedFilename</span><span class=\"mtk1\">.</span><span class=\"mtk11\">isBlank</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"94\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ResponseEntity</span><span class=\"mtk1\">.</span><span class=\"mtk11\">badRequest</span><span class=\"mtk1\">().</span><span class=\"mtk11\">body</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Filename is missing.&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"95\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"96\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"97\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"98\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">Path</span><span class=\"mtk1\"> </span><span class=\"mtk12\">fileToDelete</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">permanentStoragePath</span><span class=\"mtk1\">.</span><span class=\"mtk11\">resolve</span><span class=\"mtk1\">(decodedFilename);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"99\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"100\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Path Traversal 공격을 방지하기 위한 기본적인 검증</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"101\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (!</span><span class=\"mtk12\">fileToDelete</span><span class=\"mtk1\">.</span><span class=\"mtk11\">normalize</span><span class=\"mtk1\">().</span><span class=\"mtk11\">startsWith</span><span class=\"mtk1\">(</span><span class=\"mtk12\">permanentStoragePath</span><span class=\"mtk1\">.</span><span class=\"mtk11\">normalize</span><span class=\"mtk1\">())) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"102\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">error</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Path traversal attempt detected! Filename: {}&quot;</span><span class=\"mtk1\">, decodedFilename);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"103\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ResponseEntity</span><span class=\"mtk1\">.</span><span class=\"mtk11\">status</span><span class=\"mtk1\">(</span><span class=\"mtk12\">HttpStatus</span><span class=\"mtk1\">.</span><span class=\"mtk12\">BAD_REQUEST</span><span class=\"mtk1\">).</span><span class=\"mtk11\">body</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Invalid filename.&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"104\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"105\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"106\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Files.deleteIfExists()는 파일이 없어도 예외를 던지지 않고 false를 반환</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"107\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">boolean</span><span class=\"mtk1\"> </span><span class=\"mtk12\">deleted</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Files</span><span class=\"mtk1\">.</span><span class=\"mtk11\">deleteIfExists</span><span class=\"mtk1\">(fileToDelete);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"108\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"109\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (deleted) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"110\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">info</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Successfully deleted file from permanent storage: {}&quot;</span><span class=\"mtk1\">, fileToDelete);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"111\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ResponseEntity</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ok</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;File deleted successfully: &quot;</span><span class=\"mtk1\"> + decodedFilename);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"112\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"113\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warn</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;File to delete was not found in permanent storage: {}&quot;</span><span class=\"mtk1\">, fileToDelete);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"114\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ResponseEntity</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ok</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;File was not found, but considered deleted: &quot;</span><span class=\"mtk1\"> + decodedFilename);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"115\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"116\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"117\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">IOException</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"118\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">error</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Error deleting file: {}&quot;</span><span class=\"mtk1\">, decodedFilename, e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"119\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ResponseEntity</span><span class=\"mtk1\">.</span><span class=\"mtk11\">internalServerError</span><span class=\"mtk1\">().</span><span class=\"mtk11\">body</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Error occurred while deleting the file.&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"120\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"121\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"122\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"123\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"124\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">Controller</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"125\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">CrossOrigin</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"126\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk10\">RequestMapping</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/api/tus&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"127\"></span><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">TusUploadController</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"128\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"129\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Logger</span><span class=\"mtk1\"> </span><span class=\"mtk12\">log</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">LoggerFactory</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getLogger</span><span class=\"mtk1\">(</span><span class=\"mtk12\">TusUploadController</span><span class=\"mtk1\">.</span><span class=\"mtk12\">class</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"130\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">TusFileUploadService</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tusFileUploadService</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"131\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"132\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">Autowired</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"133\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">TusUploadController</span><span class=\"mtk1\">(</span><span class=\"mtk10\">TusFileUploadService</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tusFileUploadService</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"134\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">tusFileUploadService</span><span class=\"mtk1\"> = tusFileUploadService;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"135\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"136\"></span><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"137\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">RequestMapping</span><span class=\"mtk1\">(value = {</span><span class=\"mtk8\">&quot;/upload&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;/upload/**&quot;</span><span class=\"mtk1\">}, method = {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"138\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">RequestMethod</span><span class=\"mtk1\">.</span><span class=\"mtk12\">POST</span><span class=\"mtk1\">, </span><span class=\"mtk12\">RequestMethod</span><span class=\"mtk1\">.</span><span class=\"mtk12\">PATCH</span><span class=\"mtk1\">, </span><span class=\"mtk12\">RequestMethod</span><span class=\"mtk1\">.</span><span class=\"mtk12\">HEAD</span><span class=\"mtk1\">, </span><span class=\"mtk12\">RequestMethod</span><span class=\"mtk1\">.</span><span class=\"mtk12\">DELETE</span><span class=\"mtk1\">, </span><span class=\"mtk12\">RequestMethod</span><span class=\"mtk1\">.</span><span class=\"mtk12\">OPTIONS</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"139\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"140\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">processTusUpload</span><span class=\"mtk1\">(</span><span class=\"mtk10\">HttpServletRequest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletRequest</span><span class=\"mtk1\">, </span><span class=\"mtk10\">HttpServletResponse</span><span class=\"mtk1\"> </span><span class=\"mtk12\">servletResponse</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"141\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"142\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">tusFileUploadService</span><span class=\"mtk1\">.</span><span class=\"mtk11\">process</span><span class=\"mtk1\">(servletRequest, servletResponse);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"143\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">IOException</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"144\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">error</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Tus exception occurred: {}&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">e</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getMessage</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"145\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"146\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"147\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>간략하게 내용 공유하라는 지시가 있어서 정리해보았다.</p>\n<p>지금까지 Uppy와 TUS 프로토콜을 활용하여 Spring Boot 환경에서 안정적인 대용량 파일 업로드 기능을 구현하는 방법을 살펴봤다. 이 아키텍처는 업로드 중단에 대한 강력한 내성을 제공하여 사용자 경험을 크게 향상시킨다.</p>\n<p>하지만 현재 구조는 모든 파일을 하나의 폴더에 저장하므로, 파일 개수가 수만 개 이상으로 늘어날 경우 파일 시스템의 성능 저하를 유발할 수 있다. 이를 해결하기 위해 다음과 같은 추가 개선을 계획하고 있다.</p>\n<p>날짜 기반 서브디렉토리 생성: 파일을 저장할 때 YYYY/MM/DD와 같은 날짜 기반의 하위 폴더를 동적으로 생성하여 파일을 분산 저장하는 로직을 추가한다.</p>\n<p>다시 일하러 가야겠다 하하</p>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h1>\n<p><a href=\"https://jaimemin.tistory.com/2194\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">[tus protocol] 재개 가능한 파일 업로드를 위한 오픈 프로토콜</a></p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .mtk4 { color: #569CD6; }\n  .default-dark .mtk1 { color: #D4D4D4; }\n  .default-dark .mtk12 { color: #9CDCFE; }\n  .default-dark .mtk11 { color: #DCDCAA; }\n  .default-dark .mtk10 { color: #4EC9B0; }\n  .default-dark .mtk3 { color: #6A9955; }\n  .default-dark .mtk15 { color: #C586C0; }\n  .default-dark .mtk8 { color: #CE9178; }\n  .default-dark .mtk7 { color: #B5CEA8; }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","tableOfContents":"<ul>\n<li><a href=\"#1-%EC%99%9C-uppy%EB%A5%BC-%EC%84%A0%ED%83%9D%ED%96%88%EB%8A%94%EA%B0%80\">1. 왜 Uppy를 선택했는가?</a></li>\n<li><a href=\"#2-uppy-%EC%97%B0%EB%8F%99\">2. Uppy 연동</a></li>\n<li><a href=\"#3-tus%EB%9E%80\">3. tus란?</a></li>\n<li><a href=\"#4-tus%EC%9D%98-%EC%9E%91%EB%8F%99-%EB%B0%A9%EC%8B%9D\">4. TUS의 작동 방식</a></li>\n<li><a href=\"#5-spring-boot-%EB%B0%B1%EC%97%94%EB%93%9C-%EA%B5%AC%ED%98%84\">5. Spring Boot 백엔드 구현</a></li>\n<li><a href=\"#reference\">Reference</a></li>\n</ul>","frontmatter":{"title":"Spring Boot와 Uppy로 구현하는 대용량 파일 업로드","summary":["안정적인 대용량 파일 업로드를 위해 TUS 프로토콜과 Uppy 라이브러리를 Spring Boot 백엔드와 연동하는 방법 정리"],"date":"2025.07.11.","category":["JAVA"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAtUlEQVR42q2SvQrCQBCE8/4PIAg2EhCsBSsLEbUUYkAFLTSo8T/xcskFs7cjoilsvKiZbln4mNkdC0XEjKKyjCwAOo5Bp3M5wIeSVhu3sfscNP8HFCrDtdOFnM0h2BzfMp1t4keoDddwvBCbi/otcu4hJcbIj9F0jhisBGTGb/viDl/2KAgRuVPIpYfDwkOy3Ru//hno7yAqVUi7gaRuI+31fwTmXKWggxAgglYKTFRObb4p9x3WOxL+xHfnvwAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/f784bddc9194832ab3765b5252fc49b0/1c869/thumbnail.png","srcSet":"/static/f784bddc9194832ab3765b5252fc49b0/7991d/thumbnail.png 368w,\n/static/f784bddc9194832ab3765b5252fc49b0/66749/thumbnail.png 735w,\n/static/f784bddc9194832ab3765b5252fc49b0/1c869/thumbnail.png 1470w","sizes":"(min-width: 1470px) 1470px, 100vw"},"sources":[{"srcSet":"/static/f784bddc9194832ab3765b5252fc49b0/90d11/thumbnail.webp 368w,\n/static/f784bddc9194832ab3765b5252fc49b0/81303/thumbnail.webp 735w,\n/static/f784bddc9194832ab3765b5252fc49b0/9be43/thumbnail.webp 1470w","type":"image/webp","sizes":"(min-width: 1470px) 1470px, 100vw"}]},"width":1470,"height":738}},"publicURL":"/static/f784bddc9194832ab3765b5252fc49b0/thumbnail.png"}}}}]}},"pageContext":{"slug":"/tus/","series":[],"lastmod":"2025.07.11."}},"staticQueryHashes":["2383754777"],"slicesMap":{}}